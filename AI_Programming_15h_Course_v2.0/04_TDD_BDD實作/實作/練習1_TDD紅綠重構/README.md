# 練習 1：TDD 紅綠重構實戰

## 🎯 練習目標

透過完整的 TDD 實作練習，深度體驗紅-綠-重構的循環過程，建立測試驅動開發的肌肉記憶。

## 📊 練習概覽

- **練習類型**：TDD 基礎實作
- **預計時間**：2-3 小時
- **難度等級**：基礎到中級
- **前置要求**：完成理論 4.1 和基礎情境 B01-B03

## 🎮 核心任務

### 主任務：建立任務管理系統

你將使用嚴格的 TDD 方法，從零開始建立一個完整的任務管理系統，包含：

1. **任務創建與管理**
2. **優先級設定與排序**
3. **狀態追蹤與更新**
4. **到期日期管理**
5. **任務搜尋與篩選**

### TDD 循環要求

```
每個功能都必須嚴格遵循：
1. 🔴 紅燈：寫失敗的測試
2. 🟢 綠燈：寫最小可行實作
3. 🔵 重構：改善程式碼品質
```

## 📁 練習結構

```
練習1_TDD紅綠重構/
├── README.md                    # 本練習說明
├── 任務規格/
│   ├── 功能需求.md              # 詳細功能需求
│   ├── 驗收標準.md              # 每個功能的驗收標準
│   └── API設計.md               # 介面設計規範
├── 起始程式碼/
│   ├── package.json            # Node.js 專案配置
│   ├── jest.config.js          # 測試框架設定
│   ├── src/
│   │   └── Task.js             # 空的 Task 類別骨架
│   └── tests/
│       └── Task.test.js        # 空的測試檔案
├── 參考解答/
│   ├── 完整實作/               # 完成版本程式碼
│   ├── 階段紀錄/               # 每個 TDD 循環的程式碼快照
│   └── 重構歷程.md             # 重構思考過程記錄
└── 評量標準/
    ├── TDD實踐檢查清單.md      # TDD 品質檢查
    └── 程式碼品質標準.md       # 程式碼審查標準
```

## 🚀 練習步驟

### 第一階段：環境準備（15分鐘）

#### 步驟 1：複製起始程式碼
```bash
cd 練習1_TDD紅綠重構/起始程式碼
npm install
```

#### 步驟 2：確認測試環境
```bash
npm test
# 應該看到 0 個測試通過（因為還沒有測試）
```

#### 步驟 3：閱讀需求規格
- 詳細閱讀 `任務規格/功能需求.md`
- 理解每個功能的驗收標準
- 熟悉 API 設計規範

### 第二階段：TDD 循環實作（2小時）

#### 功能 1：任務創建（30分鐘）

**🔴 紅燈階段（10分鐘）**
```javascript
// tests/Task.test.js
describe('Task Creation', () => {
  test('should create a task with title and description', () => {
    const task = new Task('Buy groceries', 'Milk, eggs, bread');

    expect(task.title).toBe('Buy groceries');
    expect(task.description).toBe('Milk, eggs, bread');
    expect(task.status).toBe('pending');
    expect(task.id).toBeDefined();
    expect(task.createdAt).toBeInstanceOf(Date);
  });
});
```

執行測試，確認失敗：
```bash
npm test
# 應該看到測試失敗，因為 Task 類別還沒有實作
```

**🟢 綠燈階段（10分鐘）**
```javascript
// src/Task.js
class Task {
  constructor(title, description) {
    this.id = Date.now().toString();
    this.title = title;
    this.description = description;
    this.status = 'pending';
    this.createdAt = new Date();
  }
}

module.exports = Task;
```

執行測試，確認通過：
```bash
npm test
# 應該看到測試通過
```

**🔵 重構階段（10分鐘）**
- 檢查程式碼是否有改善空間
- 考慮更好的 ID 生成方式
- 添加輸入驗證
- 保持測試綠燈

#### 功能 2：狀態管理（30分鐘）

重複紅-綠-重構循環：

1. **寫測試**：任務狀態變更功能
2. **最小實作**：實現狀態變更方法
3. **重構**：改善程式碼結構

#### 功能 3：優先級設定（30分鐘）

1. **寫測試**：優先級設定和排序
2. **最小實作**：實現優先級功能
3. **重構**：優化排序算法

#### 功能 4：日期管理（30分鐘）

1. **寫測試**：到期日期設定和檢查
2. **最小實作**：實現日期功能
3. **重構**：改善日期處理邏輯

### 第三階段：整合與重構（30分鐘）

#### 步驟 1：完整功能測試
```bash
npm test
# 確保所有測試都通過
```

#### 步驟 2：程式碼品質檢查
- 檢查測試覆蓋率
- 審查程式碼結構
- 識別重構機會

#### 步驟 3：最終重構
- 消除重複程式碼
- 改善命名
- 優化程式碼結構
- 確保測試持續通過

## 📝 TDD 實踐記錄

### 循環記錄模板

每完成一個功能，填寫以下記錄：

```markdown
## 功能：[功能名稱]

### 🔴 紅燈階段
- 測試描述：[寫了什麼測試]
- 失敗原因：[為什麼失敗]
- 學習收穫：[對需求的理解]

### 🟢 綠燈階段
- 實作策略：[選擇的實作方式]
- 最小實作：[具體程式碼]
- 通過確認：[測試通過情況]

### 🔵 重構階段
- 識別問題：[發現的程式碼問題]
- 重構動作：[執行的重構]
- 品質改善：[改善後的效果]

### 反思
- 這個循環學到什麼？
- 下次可以改善什麼？
```

## ✅ 成果檢核

### 必備產出
- [ ] **完整的測試套件**（覆蓋率 > 90%）
- [ ] **可執行的任務管理系統**
- [ ] **TDD 循環記錄**（每個功能）
- [ ] **重構歷程文檔**
- [ ] **程式碼品質達標**

### 品質標準

#### TDD 實踐品質
- [ ] 每個功能都經過完整的紅-綠-重構循環
- [ ] 測試在實作前編寫
- [ ] 每次只寫必要的程式碼讓測試通過
- [ ] 重構保持測試綠燈
- [ ] 測試具備 FIRST 特性

#### 程式碼品質
- [ ] 程式碼結構清晰
- [ ] 命名有意義
- [ ] 沒有重複程式碼
- [ ] 單一職責原則
- [ ] 測試覆蓋率高

### 學習驗證

請回答以下問題驗證學習成果：

1. **TDD 循環理解**：為什麼要先寫測試？紅-綠-重構各階段的目的是什麼？
2. **最小實作原則**：什麼是「最小可行實作」？為什麼要遵循這個原則？
3. **重構時機**：什麼時候應該重構？如何確保重構不會破壞功能？
4. **測試設計**：如何設計好的測試？FIRST 原則如何應用？

## 🚀 進階挑戰

### 挑戰 1：效能優化
在保持測試通過的前提下：
- 優化任務搜尋算法
- 改善大量任務的處理效能
- 添加效能測試

### 挑戰 2：錯誤處理
添加完整的錯誤處理機制：
- 輸入驗證
- 異常情況處理
- 友善的錯誤訊息

### 挑戰 3：持久化
添加資料持久化功能：
- 檔案存儲
- 資料序列化
- 載入與保存

## 💡 實戰技巧

### TDD 最佳實踐
1. **小步快跑**：每次只實作一小部分功能
2. **測試先行**：永遠先寫測試，再寫實作
3. **保持簡單**：不要過度設計，讓測試引導設計
4. **頻繁重構**：小幅度、頻繁的重構比大型重構安全

### 常見陷阱避免
1. **跳過紅燈**：確保測試真的會失敗
2. **過度實作**：只寫讓測試通過的最少程式碼
3. **忽略重構**：不要累積技術債務
4. **複雜測試**：一個測試只驗證一個行為

## 🔗 相關資源

### 練習內資源
- **任務規格**：詳細的功能需求和驗收標準
- **參考解答**：完整的實作範例和重構歷程
- **評量標準**：客觀的品質檢查清單

### 模組資源
- **理論 4.1**：AI 驅動的測試驅動開發
- **情境 B01-B03**：TDD 基礎實作情境
- **學習資源**：TDD 工作流程和最佳實踐

---

**記住**：TDD 不只是一種技術方法，更是一種思維方式。透過測試先行，你將學會更好地思考需求、設計和實作。

**開始你的 TDD 之旅，讓測試引導你寫出更好的程式碼！**