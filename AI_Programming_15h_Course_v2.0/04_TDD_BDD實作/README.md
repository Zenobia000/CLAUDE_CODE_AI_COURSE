# 模組 4：TDD/BDD 與 AI 協作

## 📋 模組概述

本模組教你如何用 AI 輔助測試驅動開發（TDD）和行為驅動開發（BDD），建立「測試先行」的開發習慣。

**核心理念**：
> 在 AI 時代，TDD 不再是「慢」的代名詞，而是「快速且正確」的保證。
> AI 生成測試，人類把關邏輯，雙劍合璧達到開發速度與品質的雙贏。

**學習時長**：2 小時（核心模組）

---

## 🎯 學習目標

完成本模組後，你將能夠：

- ✅ 理解 TDD 紅-綠-重構循環的本質
- ✅ 掌握 AI 輔助 TDD 的完整工作流程
- ✅ 理解 BDD 與 Gherkin 語法的核心價值
- ✅ 能用 AI 從使用者故事生成可執行測試
- ✅ 理解測試金字塔與不同測試層級的策略
- ✅ 能用 TDD/BDD 方式完整實作一個功能模組
- ✅ 建立「測試即文檔」的思維模式

---

## 📂 模組結構

```
04_TDD_BDD實作/
├── README.md（本文件）
├── 理論/
│   ├── 4.1_AI驅動的測試驅動開發.md（60 分鐘）
│   ├── 4.2_行為驅動開發與Gherkin.md（45 分鐘）
│   └── 4.3_測試金字塔與AI.md（15 分鐘）
├── 情境題庫/
│   ├── README.md（題庫導覽）
│   ├── 基礎級/（8 題，30-45 分鐘/題）
│   │   ├── B01_TDD構建用戶註冊功能.md
│   │   ├── B02_BDD用戶登入流程.md
│   │   └── ...（共 8 題）
│   ├── 組合級/（10 題，1-2.5 小時/題）
│   │   ├── C01_BDD電商結帳流程.md
│   │   ├── C02_TDD任務管理系統.md
│   │   └── ...（共 10 題）
│   └── 複雜級/（2 題，8-15 小時/專案）
│       ├── E01_企業級專案TDD實踐.md
│       └── E02_Legacy系統BDD改造.md
├── 實作/
│   ├── 練習1_TDD任務管理系統/
│   │   ├── README.md
│   │   ├── 情境描述.md
│   │   ├── 起始程式碼/
│   │   ├── 參考解答/
│   │   └── 評量標準.md
│   └── 練習2_BDD購物車流程/
│       ├── README.md
│       ├── Gherkin規範範例.feature
│       ├── 測試骨架/
│       ├── 參考解答/
│       └── 評量標準.md
├── 記憶卡庫/
│   └── README.md（100+ 張記憶卡架構）
└── 作業/
    └── 作業說明.md
```

---

## 📚 學習路徑

### 第 1 步：理解 TDD 與 AI 的完美結合（60 分鐘）

**閱讀**：`理論/4.1_AI驅動的測試驅動開發.md`

**關鍵問題**：
- TDD 的紅-綠-重構循環是什麼？
- 為什麼 TDD 與 AI 是完美組合？
- AI 在 TDD 每個階段扮演什麼角色？
- 如何用 AI 加速 TDD 而不破壞其精神？

**學習檢查點**：
- [ ] 能說明 TDD 三個階段的目的
- [ ] 理解「測試先行」的價值
- [ ] 能描述 AI 輔助 TDD 的工作流程
- [ ] 知道如何讓 AI 生成測試骨架

**實踐練習**：
- 跟著文章中的任務管理系統範例實作
- 體驗完整的紅-綠-重構循環
- 對比傳統 TDD 與 AI 輔助 TDD 的差異

---

### 第 2 步：掌握 BDD 與 Gherkin（45 分鐘）

**閱讀**：`理論/4.2_行為驅動開發與Gherkin.md`

**關鍵問題**：
- BDD 與 TDD 有什麼不同？
- Gherkin 語法的核心是什麼？
- 如何從使用者故事寫出 Gherkin 規範？
- AI 如何幫助生成 BDD 測試？

**學習檢查點**：
- [ ] 理解 Given-When-Then 結構
- [ ] 能撰寫清晰的 Gherkin 規範
- [ ] 知道何時用 TDD、何時用 BDD
- [ ] 能用 AI 從規範生成測試程式碼

**實踐練習**：
- 為電商結帳流程撰寫 Gherkin 規範
- 用 AI 生成對應的測試程式碼
- 驗證規範的可讀性和可執行性

---

### 第 3 步：理解測試策略（15 分鐘）

**閱讀**：`理論/4.3_測試金字塔與AI.md`

**關鍵問題**：
- 測試金字塔的三個層級是什麼？
- 如何分配不同層級的測試比例？
- AI 在不同測試層級的應用策略？
- 如何維護和重構測試程式碼？

**學習檢查點**：
- [ ] 理解單元/整合/E2E 測試的差異
- [ ] 知道 70%-20%-10% 的測試分配原則
- [ ] 能為專案設計測試策略
- [ ] 理解測試覆蓋率的意義與限制

---

### 第 4 步：實戰練習 1 - TDD 任務管理系統（90-120 分鐘）

**實作**：`實作/練習1_TDD任務管理系統/`

**任務**：
用完整的 TDD 方式實作任務管理系統，包含：
- 建立任務（標題、描述、優先級）
- 標記任務完成/未完成
- 過濾和排序任務
- 任務統計功能

**重點**：
- 嚴格遵守紅-綠-重構循環
- 先寫測試，再寫實作
- 每次只實作最小可用功能
- 持續重構保持程式碼乾淨

**完成標準**：
- [ ] 所有測試通過
- [ ] 測試覆蓋率 ≥ 90%
- [ ] 程式碼乾淨且可讀
- [ ] 提交歷史顯示完整的 TDD 流程

---

### 第 5 步：實戰練習 2 - BDD 購物車流程（90-120 分鐘）

**實作**：`實作/練習2_BDD購物車流程/`

**任務**：
用 BDD 方式實作購物車功能，包含：
- 加入商品到購物車
- 更新商品數量
- 移除商品
- 計算總價（含折扣）
- 清空購物車

**重點**：
- 先撰寫 Gherkin 規範
- 用 AI 生成測試程式碼
- 實作讓測試通過
- 確保規範即文檔

**完成標準**：
- [ ] Gherkin 規範清晰易讀
- [ ] 所有場景測試通過
- [ ] 非技術人員能理解規範
- [ ] 測試即完整的功能文檔

---

## 🎓 學習成果

### 理論知識

完成本模組後，你應該能夠：

**關於 TDD**：
- [ ] 說明紅-綠-重構循環的每個步驟
- [ ] 理解「測試先行」的核心價值
- [ ] 知道如何用 AI 加速 TDD
- [ ] 能判斷何時該重構測試程式碼

**關於 BDD**：
- [ ] 撰寫清晰的 Gherkin 規範
- [ ] 從使用者故事推導測試場景
- [ ] 用 AI 生成 BDD 測試程式碼
- [ ] 理解 BDD 與 TDD 的協同使用

**關於測試策略**：
- [ ] 理解測試金字塔的意義
- [ ] 為專案設計合理的測試策略
- [ ] 知道不同測試層級的成本與價值
- [ ] 能維護和優化測試套件

---

### 實踐能力

**TDD 實作能力**：
- [ ] 能嚴格遵循紅-綠-重構循環
- [ ] 寫出清晰且有意義的測試
- [ ] 用測試驅動設計（介面先行）
- [ ] 持續重構保持程式碼品質

**BDD 實作能力**：
- [ ] 撰寫清晰的 Given-When-Then 場景
- [ ] 用 Gherkin 規範作為溝通工具
- [ ] 實作可執行的規範
- [ ] 維護測試與規範的一致性

**AI 協作能力**：
- [ ] 用 AI 生成測試骨架
- [ ] 讓 AI 實作讓測試通過的程式碼
- [ ] 與 AI 協作重構程式碼
- [ ] 驗證和改進 AI 生成的測試

---

## 📊 評量方式

### 練習 1：TDD 任務管理系統（50 分）

**功能完整性（20 分）**：
- 所有功能正確實作（15 分）
- 邊界情況正確處理（5 分）

**測試品質（20 分）**：
- 測試覆蓋率 ≥ 90%（10 分）
- 測試清晰且有意義（10 分）

**TDD 流程（10 分）**：
- 提交歷史顯示測試先行（5 分）
- 小步迭代且持續重構（5 分）

**及格標準**：30 分（基本功能完整 + 測試覆蓋率達標）

---

### 練習 2：BDD 購物車流程（50 分）

**Gherkin 規範品質（15 分）**：
- 場景完整且清晰（10 分）
- 非技術人員可理解（5 分）

**測試實作（20 分）**：
- 所有場景測試通過（15 分）
- 測試程式碼清晰（5 分）

**功能實作（15 分）**：
- 功能正確且完整（10 分）
- 程式碼品質良好（5 分）

**及格標準**：30 分（規範清晰 + 測試通過 + 功能完整）

---

### 總成績

- **60-69 分**：基本及格，理解 TDD/BDD 概念
- **70-79 分**：良好，能完成 TDD/BDD 實作
- **80-89 分**：優秀，能熟練運用 AI 輔助 TDD/BDD
- **90-100 分**：卓越，測試品質優異且流程嚴謹

---

## 💡 學習建議

### 理論學習策略

**不要**：
- ❌ 跳過理論直接寫程式碼
- ❌ 認為 TDD 會拖慢開發速度
- ❌ 為了測試而測試（無意義的測試）
- ❌ 完全依賴 AI 生成測試

**應該**：
- ✅ 理解 TDD/BDD 的核心價值
- ✅ 嚴格遵循紅-綠-重構循環
- ✅ 寫有意義的測試（不是為了覆蓋率）
- ✅ 用 AI 加速，但人類把關邏輯

---

### 實踐學習策略

**練習 1 建議（TDD）**：
```
第 1 次迭代：最簡單的功能（30 分鐘）
→ 建立任務
→ 嚴格遵守紅-綠-重構

第 2 次迭代：新增功能（30 分鐘）
→ 標記完成/未完成
→ 體驗測試的保護作用

第 3 次迭代：複雜功能（30 分鐘）
→ 過濾和排序
→ 重構保持程式碼乾淨

第 4 次迭代：收尾（30 分鐘）
→ 統計功能
→ 檢查測試品質
```

**練習 2 建議（BDD）**：
```
第 1 步：撰寫 Gherkin（30 分鐘）
→ 列出所有使用者場景
→ 用 Given-When-Then 描述
→ 與「假想的」非技術人員確認

第 2 步：生成測試程式碼（30 分鐘）
→ 用 AI 生成測試骨架
→ 完善斷言邏輯
→ 執行測試（全紅）

第 3 步：實作功能（60 分鐘）
→ 讓測試一個個通過
→ 保持程式碼簡潔
→ 持續驗證規範
```

---

### TDD 關鍵心法

**紅階段（寫失敗的測試）**：
- 只寫「下一個」測試，不要一次寫完所有測試
- 測試應該清楚描述期望的行為
- 確認測試真的會失敗（避免假陽性）

**綠階段（讓測試通過）**：
- 用最簡單的方式讓測試通過
- 不要過度設計（YAGNI 原則）
- 可以寫「醜陋」的程式碼（下一步會重構）

**重構階段（改善程式碼）**：
- 在測試保護下放心重構
- 消除重複程式碼
- 改善命名和結構
- 確保所有測試依然通過

---

### BDD 關鍵心法

**撰寫 Gherkin 規範**：
- 用「業務語言」而非「技術語言」
- 一個場景只測試一個行為
- 避免實作細節（不要寫「點擊按鈕」）
- 場景應該獨立且可單獨執行

**從規範到測試**：
- 先理解業務邏輯再生成測試
- AI 生成後仔細檢查斷言
- 確保測試真正驗證規範的意圖
- 保持規範與測試的一致性

**維護 BDD 測試**：
- 規範變更時先更新 Gherkin
- 讓規範成為活文檔（持續維護）
- 定期與業務人員 review 規範
- 刪除過時或無意義的場景

---

## 🔗 相關資源

### 延伸閱讀

**TDD 經典**：
- [Test Driven Development: By Example](https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530) - Kent Beck
- [Growing Object-Oriented Software, Guided by Tests](https://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627)

**BDD 資源**：
- [The Cucumber Book](https://pragprog.com/titles/hwcuc2/the-cucumber-book-second-edition/)
- [BDD in Action](https://www.manning.com/books/bdd-in-action)
- [Gherkin 語法參考](https://cucumber.io/docs/gherkin/reference/)

**測試策略**：
- [The Practical Test Pyramid](https://martinfowler.com/articles/practical-test-pyramid.html) - Martin Fowler
- [Testing Strategies in a Microservice Architecture](https://martinfowler.com/articles/microservice-testing/)

---

### 推薦工具

**Python 測試工具**：
- [pytest](https://docs.pytest.org/) - 最流行的 Python 測試框架
- [pytest-cov](https://pytest-cov.readthedocs.io/) - 測試覆蓋率工具
- [pytest-bdd](https://pytest-bdd.readthedocs.io/) - Python BDD 框架
- [behave](https://behave.readthedocs.io/) - 另一個 Python BDD 框架

**JavaScript 測試工具**：
- [Jest](https://jestjs.io/) - React 生態系標準測試框架
- [Vitest](https://vitest.dev/) - Vite 生態系測試框架
- [Cucumber.js](https://github.com/cucumber/cucumber-js) - JavaScript BDD 框架
- [Playwright](https://playwright.dev/) - E2E 測試工具

**測試輔助工具**：
- [Coverage.py](https://coverage.readthedocs.io/) - Python 覆蓋率分析
- [Hypothesis](https://hypothesis.readthedocs.io/) - Property-based testing
- [FactoryBoy](https://factoryboy.readthedocs.io/) - 測試資料生成

---

## 💬 常見問題

### Q1：TDD 會不會拖慢開發速度？

**A**：
**短期看**：可能會慢 10-20%（寫測試的時間）

**長期看**：會快 2-3 倍（減少 debug 時間）

**關鍵差異**：
- 傳統開發：快速寫程式碼 → 漫長的 debug → 害怕重構
- TDD 開發：慢速寫程式碼 → 幾乎不用 debug → 放心重構

**AI 輔助後**：
- AI 生成測試骨架（節省 50% 時間）
- AI 實作讓測試通過（節省 30% 時間）
- 整體開發速度反而更快

---

### Q2：什麼時候該用 TDD？什麼時候該用 BDD？

**A**：
**用 TDD（測試驅動開發）**：
- ✅ 開發核心業務邏輯
- ✅ 演算法和資料結構
- ✅ 工具函數和 utilities
- ✅ 底層模組和函式庫

**用 BDD（行為驅動開發）**：
- ✅ 使用者可見的功能
- ✅ 需要與非技術人員溝通的需求
- ✅ 驗收測試
- ✅ E2E 測試場景

**混合使用**：
```
BDD（驗收層）
  → 描述「購物車應該能計算總價」

TDD（實作層）
  → 實作 calculateTotal() 函數
  → 處理折扣邏輯
  → 處理多種貨幣
```

---

### Q3：測試覆蓋率要達到多少才夠？

**A**：
**錯誤思維**：
- ❌ 追求 100% 覆蓋率
- ❌ 為了覆蓋率而寫無意義的測試

**正確思維**：
- ✅ 核心業務邏輯：≥ 90% 覆蓋率
- ✅ 工具函數：≥ 80% 覆蓋率
- ✅ UI 層：≥ 50% 覆蓋率（重點在關鍵流程）

**重點不是數字，而是信心**：
- 你敢放心重構嗎？
- 你敢部署到正式環境嗎？
- 出問題時測試能幫你定位嗎？

如果答案是「是」，覆蓋率就夠了。

---

### Q4：AI 生成的測試可以直接用嗎？

**A**：
**不可以！必須檢查：**

**檢查點 1：測試邏輯**
- 測試真的驗證了正確的行為嗎？
- 斷言是否足夠嚴格？
- 有沒有漏掉邊界情況？

**檢查點 2：測試品質**
- 測試清晰且易讀嗎？
- 測試名稱描述了預期行為嗎？
- 測試是否獨立且可重複執行？

**檢查點 3：測試價值**
- 這個測試真的有必要嗎？
- 測試失敗時能快速定位問題嗎？
- 維護成本是否合理？

**正確使用 AI**：
1. 用 AI 生成測試骨架（節省打字時間）
2. 人類檢查並完善邏輯（確保正確性）
3. 執行測試驗證（確保會失敗）
4. 實作功能讓測試通過

---

### Q5：重構測試程式碼的時機？

**A**：
**應該重構的信號**：
- 測試程式碼有大量重複
- 測試難以理解（太長或太複雜）
- 測試彼此相依（不能獨立執行）
- 測試執行太慢
- 測試脆弱（常因無關變更而失敗）

**重構技巧**：
```python
# 重構前：重複的測試設置
def test_user_can_create_task():
    user = User("test@example.com")
    task_service = TaskService()
    task = task_service.create_task(user, "Test task")
    assert task.title == "Test task"

def test_user_can_complete_task():
    user = User("test@example.com")
    task_service = TaskService()
    task = task_service.create_task(user, "Test task")
    task_service.complete_task(task.id)
    assert task.is_completed

# 重構後：使用 fixture
@pytest.fixture
def task_service():
    return TaskService()

@pytest.fixture
def user():
    return User("test@example.com")

def test_user_can_create_task(task_service, user):
    task = task_service.create_task(user, "Test task")
    assert task.title == "Test task"

def test_user_can_complete_task(task_service, user):
    task = task_service.create_task(user, "Test task")
    task_service.complete_task(task.id)
    assert task.is_completed
```

---

## 🎯 下一步

完成本模組後，繼續學習：

➡️ **模組 5：CI/CD 自動化整合**
- 將測試整合到 CI/CD pipeline
- 建立自動化測試管線
- 實作持續部署流程

**預習建議**：
1. 了解 GitHub Actions 基礎
2. 準備一個 GitHub 專案用於實作
3. 思考如何自動化執行測試

---

### 測試驅動開發的長期價值

完成本模組只是開始。真正的價值在於：

**第 1-2 週**：
- 感覺有點慢（要先寫測試）
- 不習慣測試先行的思維
- 可能會質疑 TDD 的價值

**第 3-4 週**：
- 開始感受到測試的保護作用
- 重構時更有信心
- Debug 時間明顯減少

**1-2 個月後**：
- TDD 成為自然的工作流程
- 沒有測試保護反而不敢寫程式碼
- 程式碼品質明顯提升

**3-6 個月後**：
- 測試成為設計工具（測試驅動設計）
- 能用測試思考介面設計
- 成為更優秀的開發者

**堅持下去，你會感謝今天的自己！**

---

## 📈 學習追蹤

使用以下檢查清單追蹤你的學習進度：

### 理論學習進度

- [ ] 完成 4.1 AI 驅動的測試驅動開發
- [ ] 完成 4.2 行為驅動開發與 Gherkin
- [ ] 完成 4.3 測試金字塔與 AI

### 實作練習進度

- [ ] 完成練習 1：TDD 任務管理系統（≥ 30 分）
- [ ] 完成練習 2：BDD 購物車流程（≥ 30 分）

### 情境題挑戰

- [ ] 完成至少 4/8 基礎級情境
- [ ] 完成至少 3/10 組合級情境
- [ ] 嘗試 1/2 複雜級情境（可選）

### 能力驗證

- [ ] 能嚴格遵循紅-綠-重構循環
- [ ] 能撰寫清晰的 Gherkin 規範
- [ ] 能用 AI 加速 TDD/BDD
- [ ] 準備好進入模組 5（CI/CD）

---

## 🏆 進階挑戰

如果你已經完成基本要求，可以挑戰：

### 挑戰 1：測試優先重構
選擇一個 legacy 程式碼專案：
1. 先補充測試（characterization tests）
2. 在測試保護下重構
3. 提升程式碼品質和測試覆蓋率

### 挑戰 2：BDD 文檔系統
建立一個 BDD 規範管理系統：
1. 集中管理所有 Gherkin 規範
2. 自動生成測試程式碼
3. 產出可讀的功能文檔

### 挑戰 3：TDD Kata 練習
每天練習一個 TDD Kata（15-30 分鐘）：
- FizzBuzz
- Roman Numerals
- Bowling Game
- String Calculator
- Mars Rover

重點不是完成功能，而是練習 TDD 節奏。

---

**模組版本**：v2.0
**最後更新**：2025-01-30
**學習時長**：2-4 小時（依深度而定）
**難度**：⭐⭐ 中階

**準備好用 AI 輔助 TDD/BDD 了嗎？讓我們開始！**
