# 練習 1：圖書館系統建模

## 📋 練習概述

**難度**：中等
**預估時間**：1.5-2 小時
**目標**：獨立完成一個完整的 DDD 建模流程

本練習提供完整的業務需求，但不提供逐步指導。你需要獨立使用 AI 完成從通用語言提取到程式碼生成的所有階段。

---

## 🎯 任務目標

為圖書館管理系統建立 DDD 領域模型，包含：

- [ ] 通用語言詞彙表
- [ ] 事件風暴圖（Mermaid）
- [ ] 限界上下文劃分
- [ ] 核心聚合的領域模型（至少 2 個聚合）
- [ ] Python 程式碼實現（至少 500 行）
- [ ] 單元測試（至少 10 個測試用例）

---

## 📝 業務需求

### 系統背景

**系統名稱**：智慧圖書館管理系統
**使用者**：圖書館員工、讀者
**業務目標**：數位化管理圖書借閱流程

### 核心功能

#### 1. 讀者管理
- 讀者註冊（提供身份證、姓名、聯絡方式）
- 讀者有借閱權限（普通讀者、VIP 讀者）
- 讀者可以暫停借閱權限（如逾期未還）

#### 2. 圖書管理
- 圖書入庫（ISBN、書名、作者、出版社、館藏數量）
- 圖書可以有多個副本（每個副本有唯一編號）
- 圖書狀態：可借、已借出、維護中、遺失

#### 3. 借閱管理
- 讀者借書（最多同時借 5 本）
- 借閱期限：普通書籍 30 天，熱門書籍 14 天
- 可以續借（最多續借 2 次，每次延長 14 天）
- 逾期會產生罰金（每天 1 元，最高 20 元）
- 還書時需要檢查圖書狀態（如損壞需要賠償）

#### 4. 預約管理
- 當圖書全部借出時，讀者可以預約
- 書歸還後通知預約的讀者（FIFO 順序）
- 預約有效期 3 天，超過時間自動取消

### 業務規則

| 規則 ID | 描述 |
|---------|------|
| BR-001 | 普通讀者最多同時借 3 本書，VIP 讀者最多 5 本 |
| BR-002 | 逾期未還的讀者不能借新書 |
| BR-003 | 圖書續借時，剩餘借閱期必須 > 0 天 |
| BR-004 | 預約圖書歸還後，必須在 3 天內借出，否則預約失效 |
| BR-005 | 圖書損壞需要賠償（賠償金額 = 圖書定價 × 0.8）|
| BR-006 | 借閱期限：普通書籍 30 天，熱門書籍 14 天 |
| BR-007 | 每本書最多續借 2 次，每次延長 14 天 |

### 使用者故事

**Story 1：借書**
```
作為一個讀者
我想要借閱圖書
以便我可以閱讀
```

**Story 2：還書**
```
作為一個讀者
我想要歸還圖書
如果逾期需要支付罰金
```

**Story 3：續借**
```
作為一個讀者
我想要續借圖書
以便延長借閱期限
```

**Story 4：預約**
```
作為一個讀者
當圖書全部借出時，我想要預約
以便圖書歸還後優先借給我
```

**Story 5：逾期處理**
```
作為系統
我需要每天檢查逾期圖書
並暫停逾期讀者的借閱權限
```

---

## 🔧 技術要求

- **語言**：Python 3.10+
- **測試框架**：pytest
- **圖表工具**：Mermaid
- **程式碼風格**：使用 type hints，遵循 PEP 8

---

## ✅ 評量標準

### 通用語言詞彙表（20 分）
- [ ] 識別出核心領域概念（10 分）
- [ ] 區分實體與值對象（5 分）
- [ ] 提取業務規則（5 分）

### 事件風暴圖（20 分）
- [ ] 完整的業務流程（10 分）
- [ ] 標記觸發者與領域事件（5 分）
- [ ] 包含異常流程（5 分）

### 限界上下文劃分（15 分）
- [ ] 合理劃分上下文（10 分）
- [ ] 說明上下文關係（5 分）

### 領域模型設計（25 分）
- [ ] 設計至少 2 個聚合（10 分）
- [ ] 聚合邊界合理（5 分）
- [ ] 值對象設計合理（5 分）
- [ ] 領域事件設計（5 分）

### 程式碼實現（20 分）
- [ ] 實現核心業務邏輯（10 分）
- [ ] 程式碼品質（5 分）
- [ ] 測試覆蓋率 > 80%（5 分）

---

## 💡 提示

### 提示 1：如何劃分限界上下文？

可能的上下文：
- 讀者上下文（Reader Context）
- 圖書目錄上下文（Catalog Context）
- 借閱上下文（Lending Context）
- 預約上下文（Reservation Context）

思考：這些上下文應該合併還是分離？

### 提示 2：核心聚合有哪些？

可能的聚合：
- Lending（借閱聚合）- 包含借閱記錄、逾期罰金
- Book（圖書聚合）- 包含圖書資訊、副本
- Reader（讀者聚合）- 包含讀者資訊、借閱權限
- Reservation（預約聚合）- 包含預約記錄

思考：哪些應該是聚合根？哪些是實體？哪些是值對象？

### 提示 3：關鍵業務邏輯

重點實現：
- 借書時的規則檢查（借閱數量限制、是否逾期）
- 逾期罰金計算
- 續借邏輯（剩餘期限檢查、續借次數限制）
- 預約隊列管理（FIFO）

---

## 📖 參考解答

參考解答位於 `參考解答/` 目錄，包含：

- `ubiquitous-language.md`：通用語言詞彙表
- `event-storming.mmd`：事件風暴圖
- `context-map.md`：限界上下文地圖
- `domain-model.mmd`：領域模型類圖
- `src/`：完整的 Python 程式碼實現
- `tests/`：單元測試

**建議**：先獨立完成，再對比參考解答。

---

## 🤔 反思問題

完成後思考：

1. **聚合設計**：
   - 你如何劃分聚合邊界？與參考解答有何不同？
   - 如果需求變更（如增加圖書預訂功能），聚合設計需要如何調整？

2. **上下文劃分**：
   - 你劃分了幾個限界上下文？與參考解答有何不同？
   - 如果團隊規模是 2 人 vs 10 人，上下文劃分會有何不同？

3. **業務規則**：
   - 借閱數量限制（普通 3 本、VIP 5 本）應該放在哪裡？
   - 如果規則頻繁變更，如何設計更靈活的模型？

4. **AI 協作**：
   - AI 在哪些部分幫助最大？
   - 哪些部分需要你自己判斷和調整？

---

## 📊 學習記錄

完成後請記錄：

- 實際花費時間：______ 小時
- 遇到的主要困難：
- 學到的核心經驗：
- 與參考解答的主要差異：

---

**練習版本**：v1.0
**難度級別**：中等
**預估時間**：1.5-2 小時
