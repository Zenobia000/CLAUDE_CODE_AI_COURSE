# 2.4 EPCV å·¥ä½œæµç¨‹æ·±åº¦è§£æ

## å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å¾Œ,ä½ å°‡èƒ½å¤ :
- ç†è§£ä¸¦æ‡‰ç”¨ EPCV(Explore-Plan-Code-Verify)é–‹ç™¼æ¡†æ¶
- åœ¨æ¯å€‹éšæ®µé¸æ“‡æ­£ç¢ºçš„ Claude Code æŒ‡ä»¤çµ„åˆ
- å°‡é©—è­‰å‰ç½®(Validation-First)èå…¥é–‹ç™¼æµç¨‹
- å®Œæˆå¾éœ€æ±‚åˆ°éƒ¨ç½²çš„å®Œæ•´é–‹ç™¼é€±æœŸ
- å»ºç«‹å¯é‡è¤‡çš„é«˜å“è³ªé–‹ç™¼æµç¨‹

**é è¨ˆæ™‚é–“**: 60-90 åˆ†é˜
**å¯¦æˆ°æ¬Šé‡**: æ¥µé«˜(50% å¯¦å‹™æ“ä½œ)

---

## æƒ…å¢ƒå¼•å…¥:æ··äº‚é–‹ç™¼ vs ç³»çµ±åŒ–é–‹ç™¼

### æƒ…å¢ƒ 2.4.1:å‚³çµ±é–‹ç™¼çš„æ··äº‚

**çœŸå¯¦å ´æ™¯:æ–°å¢ã€Œå¿˜è¨˜å¯†ç¢¼ã€åŠŸèƒ½**

```
å‚³çµ±é–‹ç™¼æµç¨‹(ç„¡ç« æ³•):

8:00  - PM: "åŠ å€‹å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½"
8:05  - ä½ : "å¥½" (æ²’å•éœ€æ±‚ç´°ç¯€)
8:10  - é–‹å§‹å¯«ç¨‹å¼ç¢¼(ç›´æ¥å‹•æ‰‹)
9:30  - å¯«å®Œäº†,è¦ºå¾—ä¸éŒ¯
9:35  - æ¸¬è©¦... ç™¼ç¾ bug
10:00 - ä¿® bug... ç™¼ç¾æ›´å¤š bug
11:00 - åˆä¿®... ç™¼ç¾æ¶æ§‹æœ‰å•é¡Œ
12:00 - é‡å¯«ä¸€åŠ
14:00 - çµ‚æ–¼èƒ½è·‘äº†
14:30 - Code Review: "é€™è·Ÿç¾æœ‰ API é¢¨æ ¼ä¸ä¸€è‡´"
15:00 - ğŸ˜­ å†é‡å¯«
17:00 - çµ‚æ–¼æ”¹å¥½äº†
17:30 - QA: "æ²’æœ‰é€Ÿç‡é™åˆ¶,å¯ä»¥æš´åŠ›ç ´è§£"
18:00 - åˆè¦æ”¹...

è€—æ™‚: 10 å°æ™‚
å“è³ª: ä¸ç©©å®š
å£“åŠ›: çˆ†è¡¨
```

**EPCV é–‹ç™¼æµç¨‹(ç³»çµ±åŒ–)**

```
EPCV æµç¨‹:

ã€E - Explore æ¢ç´¢ã€‘ (30 åˆ†é˜)
- ç†è§£éœ€æ±‚:å¿˜è¨˜å¯†ç¢¼è¦åšä»€éº¼?
- åˆ†æç¾æœ‰ç¨‹å¼ç¢¼:èªè­‰ç³»çµ±å¦‚ä½•é‹ä½œ?
- è­˜åˆ¥ä¾è³´:éœ€è¦ç”¨åˆ°å“ªäº›æ¨¡çµ„?
- æ‰¾å‡ºåƒè€ƒ:å…¶ä»–å°ˆæ¡ˆæ€éº¼åš?

ã€P - Plan è¦åŠƒã€‘ (30 åˆ†é˜)
- è¨­è¨ˆ API å¥‘ç´„
- è¦åŠƒè³‡æ–™åº«è®Šæ›´
- è¨­è¨ˆå®‰å…¨æ©Ÿåˆ¶(é€Ÿç‡é™åˆ¶ã€token éæœŸ)
- åˆ¶å®šæ¸¬è©¦è¨ˆåŠƒ
- Code Review:è¦åŠƒéšæ®µå°±å¯©æŸ¥è¨­è¨ˆ

ã€C - Code ç·¨ç¢¼ã€‘ (2 å°æ™‚)
- å…ˆå¯«æ¸¬è©¦(TDD)
- å¯¦ä½œåŠŸèƒ½
- é‚Šå¯«é‚Šé©—è­‰
- æŒçºŒæ•´åˆ

ã€V - Verify é©—è­‰ã€‘ (30 åˆ†é˜)
- å–®å…ƒæ¸¬è©¦
- æ•´åˆæ¸¬è©¦
- å®‰å…¨æƒæ
- æ•ˆèƒ½æ¸¬è©¦
- æœ€çµ‚ Code Review

ç¸½è€—æ™‚: 3.5 å°æ™‚
å“è³ª: ç©©å®šå¯é 
å£“åŠ›: å¯æ§
```

**å·®ç•°å°æ¯”**:

| ç¶­åº¦ | å‚³çµ±æ–¹æ³• | EPCV æ–¹æ³• |
|------|---------|----------|
| é–‹ç™¼æ™‚é–“ | 10 å°æ™‚ | 3.5 å°æ™‚ |
| Bug æ•¸é‡ | 15+ | 2-3 |
| é‡å·¥æ¬¡æ•¸ | 3 æ¬¡ | 0 æ¬¡ |
| Code Review é€šé | ç¬¬ 2 è¼ª | ç¬¬ 1 è¼ª |
| å®‰å…¨å•é¡Œ | ç™¼ç¾ 5 å€‹ | ç™¼ç¾ 0 å€‹ |
| å£“åŠ›æŒ‡æ•¸ | ğŸ˜­ğŸ˜­ğŸ˜­ | ğŸ˜Š |

---

## ç¬¬ä¸€éƒ¨åˆ†:EPCV æ¡†æ¶è©³è§£

### E - Explore (æ¢ç´¢éšæ®µ)

**ç›®æ¨™**: å®Œæ•´ç†è§£å•é¡Œèˆ‡ä¸Šä¸‹æ–‡

**æ ¸å¿ƒå•é¡Œ**:
```
1. è¦è§£æ±ºä»€éº¼å•é¡Œ?
2. ç¾æœ‰ç³»çµ±å¦‚ä½•é‹ä½œ?
3. æœ‰å“ªäº›ç´„æŸæ¢ä»¶?
4. ç›¸é—œçš„ç¨‹å¼ç¢¼åœ¨å“ªè£¡?
5. æœ‰æ²’æœ‰é¡ä¼¼çš„å¯¦ä½œå¯ä»¥åƒè€ƒ?
```

**ä½¿ç”¨çš„æŒ‡ä»¤çµ„åˆ**:

```bash
# 1. ç†è§£å°ˆæ¡ˆçµæ§‹
/glob src/**/*.py                # æ‰¾å‡ºæ‰€æœ‰ç¨‹å¼ç¢¼æª”æ¡ˆ
/read CLAUDE.md                  # è®€å–å°ˆæ¡ˆè¨˜æ†¶

# 2. æ‰¾å‡ºç›¸é—œç¨‹å¼ç¢¼
/grep "auth" --type py           # æ‰¾èªè­‰ç›¸é—œç¨‹å¼ç¢¼
/grep "login" --type py          # æ‰¾ç™»å…¥ç›¸é—œç¨‹å¼ç¢¼
/grep "password" --type py       # æ‰¾å¯†ç¢¼è™•ç†ç¨‹å¼ç¢¼

# 3. æ·±å…¥ç†è§£
/read src/api/auth.py            # è®€å–èªè­‰ API
/read src/models/user.py         # è®€å–ä½¿ç”¨è€…æ¨¡å‹
/read src/utils/email.py         # è®€å–éƒµä»¶å·¥å…·

# 4. æª¢æŸ¥æ¸¬è©¦
/glob tests/**/*auth*.py         # æ‰¾èªè­‰ç›¸é—œæ¸¬è©¦
/read tests/test_auth.py         # ç†è§£æ¸¬è©¦æ–¹å¼

# 5. æŸ¥çœ‹æ–‡æª”
/read docs/api.md                # API æ–‡æª”
/read docs/security.md           # å®‰å…¨è¦ç¯„
```

**å¯¦æˆ°ç¯„ä¾‹:æ¢ç´¢ã€Œå¿˜è¨˜å¯†ç¢¼ã€åŠŸèƒ½**

```bash
claude --add-dir ./src/api --add-dir ./src/models

æç¤ºè©:
æˆ‘éœ€è¦æ–°å¢ã€Œå¿˜è¨˜å¯†ç¢¼ã€åŠŸèƒ½,è«‹å¹«æˆ‘æ¢ç´¢ç¾æœ‰ç¨‹å¼ç¢¼:

1. ç¾åœ¨çš„èªè­‰ç³»çµ±å¦‚ä½•é‹ä½œ?
2. å¯†ç¢¼å„²å­˜æ–¹å¼?(bcrypt? hash?)
3. æœ‰éƒµä»¶ç™¼é€åŠŸèƒ½å—?
4. æœ‰æ²’æœ‰é¡ä¼¼çš„ token æ©Ÿåˆ¶?(å¦‚ JWT)
5. API é¢¨æ ¼æ˜¯ä»€éº¼?(REST? éŒ¯èª¤æ ¼å¼?)
6. æœ‰æ²’æœ‰é€Ÿç‡é™åˆ¶æ©Ÿåˆ¶?

# Claude åŸ·è¡Œæ¢ç´¢...

/read src/api/auth.py
/read src/models/user.py
/read src/utils/email.py
/read src/utils/jwt.py

# Claude å ±å‘Š:
ã€æ¢ç´¢å ±å‘Šã€‘

1. èªè­‰ç³»çµ±:
   - ç™»å…¥: POST /api/v1/auth/login
   - ä½¿ç”¨ JWT token
   - Token æœ‰æ•ˆæœŸ:1 å°æ™‚

2. å¯†ç¢¼å„²å­˜:
   - ä½¿ç”¨ bcrypt åŠ å¯†
   - å„²å­˜åœ¨ User.password_hash æ¬„ä½

3. éƒµä»¶ç³»çµ±:
   âœ“ å·²å­˜åœ¨ src/utils/email.py
   - ä½¿ç”¨ SMTP
   - æ”¯æ´ HTML æ¨¡æ¿
   - ç¯„ä¾‹:send_email(to, subject, body)

4. Token æ©Ÿåˆ¶:
   âœ“ å·²å­˜åœ¨ JWT å·¥å…·
   - generate_token(user_id, expires_in)
   - verify_token(token)
   - å¯ä»¥é‡ç”¨ä¾†ç”Ÿæˆé‡è¨­å¯†ç¢¼ token

5. API é¢¨æ ¼:
   - RESTful API
   - éŒ¯èª¤æ ¼å¼:{"error": "message", "code": "ERROR_CODE"}
   - æˆåŠŸæ ¼å¼:{"data": {...}, "message": "success"}

6. é€Ÿç‡é™åˆ¶:
   âŒ ä¸å­˜åœ¨!éœ€è¦æ–°å¢
   - é€™æ˜¯å®‰å…¨é¢¨éšª
   - å»ºè­°:ä½¿ç”¨ Flask-Limiter æˆ– Redis

ã€å»ºè­°ã€‘:
- é‡ç”¨ JWT å·¥å…·ç”Ÿæˆé‡è¨­ token
- é‡ç”¨éƒµä»¶ç³»çµ±ç™¼é€é€£çµ
- âš ï¸ å¿…é ˆæ–°å¢é€Ÿç‡é™åˆ¶(é˜²æ­¢æš´åŠ›æ”»æ“Š)
- API è¨­è¨ˆ:
  * POST /api/v1/auth/forgot-password (è«‹æ±‚é‡è¨­)
  * POST /api/v1/auth/reset-password (åŸ·è¡Œé‡è¨­)
```

**æ¢ç´¢éšæ®µæª¢æŸ¥é»**:

- [ ] å·²ç†è§£ç¾æœ‰ç³»çµ±æ¶æ§‹
- [ ] å·²æ‰¾å‡ºæ‰€æœ‰ç›¸é—œç¨‹å¼ç¢¼
- [ ] å·²è­˜åˆ¥å¯é‡ç”¨çš„å…ƒä»¶
- [ ] å·²ç™¼ç¾æ½›åœ¨é¢¨éšª
- [ ] å·²ç¢ºèªæŠ€è¡“å¯è¡Œæ€§

### P - Plan (è¦åŠƒéšæ®µ)

**ç›®æ¨™**: åˆ¶å®šè©³ç´°çš„å¯¦ä½œè¨ˆåŠƒ

**è¦åŠƒå…§å®¹**:
```
1. API è¨­è¨ˆ
2. è³‡æ–™åº«è®Šæ›´
3. å®‰å…¨æ©Ÿåˆ¶
4. éŒ¯èª¤è™•ç†
5. æ¸¬è©¦è¨ˆåŠƒ
6. éƒ¨ç½²æ­¥é©Ÿ
```

**å¯¦æˆ°ç¯„ä¾‹:è¦åŠƒã€Œå¿˜è¨˜å¯†ç¢¼ã€åŠŸèƒ½**

```bash
æç¤ºè©:
åŸºæ–¼æ¢ç´¢çµæœ,è«‹åˆ¶å®šã€Œå¿˜è¨˜å¯†ç¢¼ã€åŠŸèƒ½çš„å¯¦ä½œè¨ˆåŠƒ

# Claude è¦åŠƒ:
ã€å¯¦ä½œè¨ˆåŠƒã€‘

## 1. API è¨­è¨ˆ

### API 1: è«‹æ±‚é‡è¨­å¯†ç¢¼
**ç«¯é»**: POST /api/v1/auth/forgot-password
**è«‹æ±‚**:
```json
{
  "email": "user@example.com"
}
```

**å›æ‡‰**:
```json
{
  "message": "If email exists, reset link will be sent",
  "code": "SUCCESS"
}
```

**æ³¨æ„**: ä¸è«– email æ˜¯å¦å­˜åœ¨,éƒ½è¿”å›ç›¸åŒè¨Šæ¯(é¿å…æ´©æ¼ä½¿ç”¨è€…è³‡è¨Š)

---

### API 2: åŸ·è¡Œå¯†ç¢¼é‡è¨­
**ç«¯é»**: POST /api/v1/auth/reset-password
**è«‹æ±‚**:
```json
{
  "token": "abc123xyz...",
  "new_password": "NewSecure@123"
}
```

**å›æ‡‰**:
```json
{
  "message": "Password reset successfully",
  "code": "SUCCESS"
}
```

**éŒ¯èª¤**:
- 400: Token ç„¡æ•ˆæˆ–éæœŸ
- 400: å¯†ç¢¼ä¸ç¬¦åˆè¦å‰‡

---

## 2. è³‡æ–™åº«è®Šæ›´

### æ–°å¢æ¬„ä½åˆ° User è¡¨

```sql
ALTER TABLE users ADD COLUMN reset_token VARCHAR(255);
ALTER TABLE users ADD COLUMN reset_token_expires_at TIMESTAMP;
CREATE INDEX idx_users_reset_token ON users(reset_token);
```

æˆ–ä½¿ç”¨ ORM é·ç§»:
```python
# migrations/add_reset_token.py
def upgrade():
    op.add_column('users', sa.Column('reset_token', sa.String(255)))
    op.add_column('users', sa.Column('reset_token_expires_at', sa.DateTime()))
    op.create_index('idx_users_reset_token', 'users', ['reset_token'])
```

---

## 3. å®‰å…¨æ©Ÿåˆ¶

### 3.1 é€Ÿç‡é™åˆ¶
```python
from flask_limiter import Limiter

# é™åˆ¶:æ¯ IP æ¯ 15 åˆ†é˜æœ€å¤š 3 æ¬¡è«‹æ±‚
@limiter.limit("3 per 15 minutes")
@app.route('/api/v1/auth/forgot-password', methods=['POST'])
def forgot_password():
    pass
```

### 3.2 Token è¨­è¨ˆ
```python
# ä½¿ç”¨å®‰å…¨çš„éš¨æ©Ÿ token
import secrets

reset_token = secrets.token_urlsafe(32)  # 256-bit éš¨æ©Ÿ token
expires_at = datetime.now() + timedelta(hours=1)  # 1 å°æ™‚æœ‰æ•ˆ
```

### 3.3 å¯†ç¢¼è¦å‰‡
```python
# æœ€å°‘ 8 å­—å…ƒ,åŒ…å«å¤§å°å¯«ã€æ•¸å­—ã€ç‰¹æ®Šå­—å…ƒ
PASSWORD_REGEX = r'^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$'
```

### 3.4 é˜²æ­¢ Timing Attack
```python
# ä½¿ç”¨å›ºå®šæ™‚é–“å›æ‡‰,é¿å…æ´©æ¼ä½¿ç”¨è€…å­˜åœ¨è³‡è¨Š
import time

def forgot_password(email):
    start = time.time()
    user = User.query.filter_by(email=email).first()
    if user:
        send_reset_email(user)

    # ç¢ºä¿ç„¡è«–ä½¿ç”¨è€…æ˜¯å¦å­˜åœ¨,éƒ½èŠ±è²»ç›¸åŒæ™‚é–“
    elapsed = time.time() - start
    if elapsed < 0.5:
        time.sleep(0.5 - elapsed)

    return {"message": "If email exists, reset link will be sent"}
```

---

## 4. å¯¦ä½œæ­¥é©Ÿ

### Phase 1: è³‡æ–™åº«é·ç§» (15 åˆ†é˜)
1. å»ºç«‹é·ç§»æª”æ¡ˆ
2. åŸ·è¡Œé·ç§»
3. é©—è­‰è³‡æ–™åº«è®Šæ›´

### Phase 2: æ–°å¢é€Ÿç‡é™åˆ¶ (15 åˆ†é˜)
1. å®‰è£ Flask-Limiter
2. é…ç½®é™åˆ¶è¦å‰‡
3. æ¸¬è©¦é™åˆ¶æ˜¯å¦ç”Ÿæ•ˆ

### Phase 3: å¯¦ä½œ forgot-password API (30 åˆ†é˜)
1. å»ºç«‹è·¯ç”±
2. é©—è­‰ email
3. ç”Ÿæˆ reset token
4. å„²å­˜åˆ°è³‡æ–™åº«
5. ç™¼é€éƒµä»¶

### Phase 4: å¯¦ä½œ reset-password API (30 åˆ†é˜)
1. å»ºç«‹è·¯ç”±
2. é©—è­‰ token
3. é©—è­‰æ–°å¯†ç¢¼
4. æ›´æ–°å¯†ç¢¼
5. æ¸…é™¤ token

### Phase 5: æ¸¬è©¦ (30 åˆ†é˜)
1. å–®å…ƒæ¸¬è©¦
2. æ•´åˆæ¸¬è©¦
3. å®‰å…¨æ¸¬è©¦
4. æ‰‹å‹•æ¸¬è©¦

---

## 5. æ¸¬è©¦è¨ˆåŠƒ

### 5.1 å–®å…ƒæ¸¬è©¦
```python
# tests/test_forgot_password.py

def test_forgot_password_existing_user():
    """æ¸¬è©¦å·²å­˜åœ¨çš„ä½¿ç”¨è€…"""
    response = client.post('/api/v1/auth/forgot-password',
                          json={'email': 'existing@example.com'})
    assert response.status_code == 200
    assert "reset link will be sent" in response.json['message']

    # é©—è­‰è³‡æ–™åº«
    user = User.query.filter_by(email='existing@example.com').first()
    assert user.reset_token is not None
    assert user.reset_token_expires_at > datetime.now()


def test_forgot_password_nonexistent_user():
    """æ¸¬è©¦ä¸å­˜åœ¨çš„ä½¿ç”¨è€…"""
    response = client.post('/api/v1/auth/forgot-password',
                          json={'email': 'nonexistent@example.com'})
    # æ‡‰è©²è¿”å›ç›¸åŒè¨Šæ¯(ä¸æ´©æ¼ä½¿ç”¨è€…è³‡è¨Š)
    assert response.status_code == 200
    assert "reset link will be sent" in response.json['message']


def test_reset_password_valid_token():
    """æ¸¬è©¦æœ‰æ•ˆçš„ token"""
    # å»ºç«‹æ¸¬è©¦ token
    user = create_test_user()
    token = generate_reset_token(user)

    response = client.post('/api/v1/auth/reset-password',
                          json={'token': token, 'new_password': 'NewPass@123'})
    assert response.status_code == 200

    # é©—è­‰å¯†ç¢¼å·²æ›´æ–°
    assert user.check_password('NewPass@123')


def test_reset_password_expired_token():
    """æ¸¬è©¦éæœŸçš„ token"""
    user = create_test_user()
    token = generate_expired_token(user)

    response = client.post('/api/v1/auth/reset-password',
                          json={'token': token, 'new_password': 'NewPass@123'})
    assert response.status_code == 400
    assert "expired" in response.json['error'].lower()


def test_rate_limiting():
    """æ¸¬è©¦é€Ÿç‡é™åˆ¶"""
    for i in range(3):
        response = client.post('/api/v1/auth/forgot-password',
                              json={'email': 'test@example.com'})
        assert response.status_code == 200

    # ç¬¬ 4 æ¬¡æ‡‰è©²è¢«é™åˆ¶
    response = client.post('/api/v1/auth/forgot-password',
                          json={'email': 'test@example.com'})
    assert response.status_code == 429  # Too Many Requests
```

### 5.2 å®‰å…¨æ¸¬è©¦
```python
def test_timing_attack_resistance():
    """æ¸¬è©¦æ˜¯å¦é˜²ç¦¦ Timing Attack"""
    import time

    # æ¸¬è©¦å­˜åœ¨çš„ä½¿ç”¨è€…
    start = time.time()
    client.post('/api/v1/auth/forgot-password',
                json={'email': 'existing@example.com'})
    time_existing = time.time() - start

    # æ¸¬è©¦ä¸å­˜åœ¨çš„ä½¿ç”¨è€…
    start = time.time()
    client.post('/api/v1/auth/forgot-password',
                json={'email': 'nonexistent@example.com'})
    time_nonexistent = time.time() - start

    # æ™‚é–“å·®æ‡‰è©²å°æ–¼ 100ms
    assert abs(time_existing - time_nonexistent) < 0.1
```

---

## 6. éƒ¨ç½²æª¢æŸ¥æ¸…å–®

- [ ] è³‡æ–™åº«é·ç§»å·²åŸ·è¡Œ
- [ ] ç’°å¢ƒè®Šæ•¸å·²é…ç½®(SMTP è¨­å®š)
- [ ] é€Ÿç‡é™åˆ¶å·²å•Ÿç”¨
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] API æ–‡æª”å·²æ›´æ–°
- [ ] CLAUDE.md å·²æ›´æ–°
- [ ] ç›£æ§å‘Šè­¦å·²è¨­ç½®

---

ã€è¦åŠƒå®Œæˆã€‘
ç¸½é ä¼°æ™‚é–“: 2.5-3 å°æ™‚
é¢¨éšªç­‰ç´š: ä¸­(éœ€æ³¨æ„å®‰å…¨å•é¡Œ)
```

**è¦åŠƒéšæ®µæª¢æŸ¥é»**:

- [ ] API å¥‘ç´„å·²å®šç¾©
- [ ] è³‡æ–™åº«è®Šæ›´å·²è¦åŠƒ
- [ ] å®‰å…¨æ©Ÿåˆ¶å·²è¨­è¨ˆ
- [ ] æ¸¬è©¦è¨ˆåŠƒå·²åˆ¶å®š
- [ ] å¯¦ä½œæ­¥é©Ÿå·²æ’åº
- [ ] æ™‚é–“é ä¼°å·²å®Œæˆ
- [ ] **è¦åŠƒå·² Review(é‡è¦!)**

### C - Code (ç·¨ç¢¼éšæ®µ)

**ç›®æ¨™**: æŒ‰è¨ˆåŠƒå¯¦ä½œ,é‚Šå¯«é‚Šé©—è­‰

**TDD æµç¨‹**:
```
1. å¯«æ¸¬è©¦(ç´…ç‡ˆ)
2. å¯«ç¨‹å¼ç¢¼(ç¶ ç‡ˆ)
3. é‡æ§‹(å„ªåŒ–)
```

**å¯¦æˆ°ç¯„ä¾‹:å¯¦ä½œã€Œå¿˜è¨˜å¯†ç¢¼ã€**

```bash
æç¤ºè©:
æŒ‰ç…§è¦åŠƒ,ä½¿ç”¨ TDD æ–¹å¼å¯¦ä½œã€Œå¿˜è¨˜å¯†ç¢¼ã€åŠŸèƒ½

# Claude åŸ·è¡Œ:

ã€Phase 1: è³‡æ–™åº«é·ç§»ã€‘

# Step 1: å»ºç«‹é·ç§»æª”æ¡ˆ
/write migrations/add_reset_token.py

```python
"""Add reset token fields to users table"""
from alembic import op
import sqlalchemy as sa

def upgrade():
    op.add_column('users',
        sa.Column('reset_token', sa.String(255), nullable=True)
    )
    op.add_column('users',
        sa.Column('reset_token_expires_at', sa.DateTime(), nullable=True)
    )
    op.create_index('idx_users_reset_token', 'users', ['reset_token'])

def downgrade():
    op.drop_index('idx_users_reset_token', 'users')
    op.drop_column('users', 'reset_token_expires_at')
    op.drop_column('users', 'reset_token')
```

# Step 2: åŸ·è¡Œé·ç§»
```bash
alembic upgrade head
# âœ“ Migration applied successfully
```

---

ã€Phase 2: å…ˆå¯«æ¸¬è©¦(TDD)ã€‘

/write tests/test_forgot_password.py

```python
import pytest
from datetime import datetime, timedelta
from src.api import app
from src.models import User, db

@pytest.fixture
def client():
    app.config['TESTING'] = True
    with app.test_client() as client:
        yield client

def test_forgot_password_existing_user(client):
    """æ¸¬è©¦å·²å­˜åœ¨çš„ä½¿ç”¨è€…"""
    # Arrange
    user = User(email='test@example.com', username='testuser')
    user.set_password('OldPass@123')
    db.session.add(user)
    db.session.commit()

    # Act
    response = client.post('/api/v1/auth/forgot-password',
                          json={'email': 'test@example.com'})

    # Assert
    assert response.status_code == 200
    assert "reset link will be sent" in response.json['message']

    # é©—è­‰è³‡æ–™åº«
    user = User.query.filter_by(email='test@example.com').first()
    assert user.reset_token is not None
    assert user.reset_token_expires_at > datetime.now()

# ... æ›´å¤šæ¸¬è©¦ ...
```

# Step 3: åŸ·è¡Œæ¸¬è©¦(æ‡‰è©²å¤±æ•—,å› ç‚ºé‚„æ²’å¯¦ä½œ)
```bash
pytest tests/test_forgot_password.py
# FAILED - 404 Not Found (è·¯ç”±ä¸å­˜åœ¨)
```

---

ã€Phase 3: å¯¦ä½œåŠŸèƒ½ã€‘

/write src/api/auth.py

```python
from flask import Blueprint, request, jsonify
from flask_limiter import Limiter
from src.models import User, db
from src.utils.email import send_reset_email
import secrets
from datetime import datetime, timedelta
import time

auth_bp = Blueprint('auth', __name__)
limiter = Limiter(app)


@auth_bp.route('/forgot-password', methods=['POST'])
@limiter.limit("3 per 15 minutes")
def forgot_password():
    """
    è«‹æ±‚å¯†ç¢¼é‡è¨­

    é™åˆ¶: æ¯ IP æ¯ 15 åˆ†é˜æœ€å¤š 3 æ¬¡
    """
    start_time = time.time()

    data = request.get_json()
    email = data.get('email')

    if not email:
        return jsonify({
            'error': 'Email is required',
            'code': 'VALIDATION_ERROR'
        }), 400

    # æŸ¥è©¢ä½¿ç”¨è€…
    user = User.query.filter_by(email=email).first()

    if user:
        # ç”Ÿæˆé‡è¨­ token
        reset_token = secrets.token_urlsafe(32)
        user.reset_token = reset_token
        user.reset_token_expires_at = datetime.now() + timedelta(hours=1)
        db.session.commit()

        # ç™¼é€éƒµä»¶
        send_reset_email(user.email, reset_token)

    # é˜²æ­¢ Timing Attack:ç¢ºä¿å›ºå®šæ™‚é–“å›æ‡‰
    elapsed = time.time() - start_time
    if elapsed < 0.5:
        time.sleep(0.5 - elapsed)

    # ç„¡è«–ä½¿ç”¨è€…æ˜¯å¦å­˜åœ¨,éƒ½è¿”å›ç›¸åŒè¨Šæ¯
    return jsonify({
        'message': 'If email exists, reset link will be sent',
        'code': 'SUCCESS'
    }), 200


@auth_bp.route('/reset-password', methods=['POST'])
def reset_password():
    """åŸ·è¡Œå¯†ç¢¼é‡è¨­"""
    data = request.get_json()
    token = data.get('token')
    new_password = data.get('new_password')

    if not token or not new_password:
        return jsonify({
            'error': 'Token and new password are required',
            'code': 'VALIDATION_ERROR'
        }), 400

    # é©—è­‰å¯†ç¢¼å¼·åº¦
    if not _is_strong_password(new_password):
        return jsonify({
            'error': 'Password must be at least 8 characters with uppercase, lowercase, number and special character',
            'code': 'WEAK_PASSWORD'
        }), 400

    # æŸ¥è©¢ token
    user = User.query.filter_by(reset_token=token).first()

    if not user:
        return jsonify({
            'error': 'Invalid reset token',
            'code': 'INVALID_TOKEN'
        }), 400

    # æª¢æŸ¥éæœŸ
    if user.reset_token_expires_at < datetime.now():
        return jsonify({
            'error': 'Reset token has expired',
            'code': 'EXPIRED_TOKEN'
        }), 400

    # æ›´æ–°å¯†ç¢¼
    user.set_password(new_password)
    user.reset_token = None
    user.reset_token_expires_at = None
    db.session.commit()

    return jsonify({
        'message': 'Password reset successfully',
        'code': 'SUCCESS'
    }), 200


def _is_strong_password(password: str) -> bool:
    """æª¢æŸ¥å¯†ç¢¼å¼·åº¦"""
    import re
    pattern = r'^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$'
    return bool(re.match(pattern, password))
```

---

ã€Phase 4: å¯¦ä½œéƒµä»¶ç™¼é€ã€‘

/write src/utils/email.py (è£œå…… send_reset_email)

```python
def send_reset_email(email: str, reset_token: str) -> None:
    """
    ç™¼é€å¯†ç¢¼é‡è¨­éƒµä»¶

    Args:
        email: ä½¿ç”¨è€… email
        reset_token: é‡è¨­ token
    """
    reset_link = f"https://yourapp.com/reset-password?token={reset_token}"

    subject = "Password Reset Request"
    body = f"""
    <html>
    <body>
        <h2>Password Reset Request</h2>
        <p>You requested to reset your password.</p>
        <p>Click the link below to reset your password:</p>
        <p><a href="{reset_link}">Reset Password</a></p>
        <p>This link will expire in 1 hour.</p>
        <p>If you didn't request this, please ignore this email.</p>
    </body>
    </html>
    """

    send_email(
        to=email,
        subject=subject,
        body=body,
        html=True
    )
```

---

ã€Phase 5: åŸ·è¡Œæ¸¬è©¦(æ‡‰è©²å…¨éƒ¨é€šé)ã€‘

```bash
pytest tests/test_forgot_password.py -v

# è¼¸å‡º:
test_forgot_password_existing_user âœ“
test_forgot_password_nonexistent_user âœ“
test_reset_password_valid_token âœ“
test_reset_password_expired_token âœ“
test_reset_password_weak_password âœ“
test_rate_limiting âœ“
test_timing_attack_resistance âœ“

7 tests passed
Coverage: 95%
```

âœ… å¯¦ä½œå®Œæˆ!
```

**ç·¨ç¢¼éšæ®µæª¢æŸ¥é»**:

- [ ] æ¸¬è©¦å…ˆè¡Œ(TDD)
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] ç¨‹å¼ç¢¼ç¬¦åˆé¢¨æ ¼è¦ç¯„
- [ ] éŒ¯èª¤è™•ç†å®Œå–„
- [ ] æ—¥èªŒè¨˜éŒ„å……åˆ†
- [ ] æ•ˆèƒ½å¯æ¥å—

### V - Verify (é©—è­‰éšæ®µ)

**ç›®æ¨™**: å…¨é¢é©—è­‰åŠŸèƒ½æ­£ç¢ºæ€§èˆ‡å“è³ª

**é©—è­‰æ¸…å–®**:
```
1. âœ… å–®å…ƒæ¸¬è©¦
2. âœ… æ•´åˆæ¸¬è©¦
3. âœ… å®‰å…¨æƒæ
4. âœ… æ•ˆèƒ½æ¸¬è©¦
5. âœ… Code Review
6. âœ… æ–‡æª”æ›´æ–°
```

**å¯¦æˆ°ç¯„ä¾‹:é©—è­‰ã€Œå¿˜è¨˜å¯†ç¢¼ã€**

```bash
ã€é©—è­‰ 1: å–®å…ƒæ¸¬è©¦ã€‘

pytest tests/test_forgot_password.py --cov=src/api/auth -v

# çµæœ:
7 tests passed
Coverage: 95%
âœ“ é€šé

---

ã€é©—è­‰ 2: æ•´åˆæ¸¬è©¦ã€‘

pytest tests/integration/test_auth_flow.py -v

# æ¸¬è©¦å®Œæ•´æµç¨‹:
1. ä½¿ç”¨è€…è¨»å†Š âœ“
2. ä½¿ç”¨è€…ç™»å…¥ âœ“
3. è«‹æ±‚å¯†ç¢¼é‡è¨­ âœ“
4. æ”¶åˆ°éƒµä»¶ âœ“
5. ä½¿ç”¨ token é‡è¨­å¯†ç¢¼ âœ“
6. ç”¨æ–°å¯†ç¢¼ç™»å…¥ âœ“

âœ“ é€šé

---

ã€é©—è­‰ 3: å®‰å…¨æƒæã€‘

æç¤ºè©:
è«‹å°ã€Œå¿˜è¨˜å¯†ç¢¼ã€åŠŸèƒ½é€²è¡Œå®‰å…¨å¯©è¨ˆ

# Claude åŸ·è¡Œæƒæ:

/grep "reset_token" --type py -C 5
/grep "reset_password" --type py -C 5

# å®‰å…¨æª¢æŸ¥æ¸…å–®:

âœ“ SQL æ³¨å…¥é˜²è­·
  - ä½¿ç”¨ ORM,ç„¡ç›´æ¥ SQL æ‹¼æ¥

âœ“ XSS é˜²è­·
  - éƒµä»¶å…§å®¹å·²è½‰ç¾©
  - API è¿”å› JSON,ç„¡ HTML æ³¨å…¥

âœ“ CSRF é˜²è­·
  - API ä½¿ç”¨ token é©—è­‰,ä¸ä¾è³´ Cookie

âœ“ é€Ÿç‡é™åˆ¶
  - å·²å¯¦ä½œ 3 æ¬¡/15 åˆ†é˜é™åˆ¶

âœ“ Token å®‰å…¨æ€§
  - ä½¿ç”¨ secrets.token_urlsafe(256-bit)
  - Token æœ‰éæœŸæ™‚é–“(1 å°æ™‚)
  - ä½¿ç”¨å¾Œç«‹å³å¤±æ•ˆ

âœ“ é˜²æ­¢è³‡è¨Šæ´©æ¼
  - ä¸è«–ä½¿ç”¨è€…æ˜¯å¦å­˜åœ¨,éƒ½è¿”å›ç›¸åŒè¨Šæ¯
  - é˜²ç¦¦ Timing Attack

âœ“ å¯†ç¢¼å¼·åº¦
  - è¦æ±‚ 8+ å­—å…ƒ,åŒ…å«å¤§å°å¯«ã€æ•¸å­—ã€ç‰¹æ®Šå­—å…ƒ

âš ï¸ ç™¼ç¾å•é¡Œ:
1. å»ºè­°æ·»åŠ ã€Œå·²ä½¿ç”¨ tokenã€æ¨™è¨˜,é˜²æ­¢é‡è¤‡ä½¿ç”¨
2. å»ºè­°æ·»åŠ æ—¥èªŒè¨˜éŒ„,è¿½è¹¤å¯ç–‘æ´»å‹•

---

ã€é©—è­‰ 4: æ•ˆèƒ½æ¸¬è©¦ã€‘

æç¤ºè©:
æ¸¬è©¦ã€Œå¿˜è¨˜å¯†ç¢¼ã€API åœ¨é«˜ä¸¦ç™¼ä¸‹çš„æ•ˆèƒ½

# ä½¿ç”¨ locust é€²è¡Œå£“åŠ›æ¸¬è©¦
locust -f tests/performance/test_forgot_password.py --users 100 --spawn-rate 10

# çµæœ:
- RPS: 45 requests/sec
- å¹³å‡å›æ‡‰æ™‚é–“: 22ms
- 99th ç™¾åˆ†ä½: 89ms
- éŒ¯èª¤ç‡: 0%

âœ“ æ•ˆèƒ½å¯æ¥å—

---

ã€é©—è­‰ 5: Code Reviewã€‘

æç¤ºè©:
è«‹ review å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½çš„ç¨‹å¼ç¢¼

# Claude Review:

âœ“ ç¨‹å¼ç¢¼é¢¨æ ¼:ç¬¦åˆ PEP 8
âœ“ å‘½åæ¸…æ™°:å‡½æ•¸åç¨±æè¿°æº–ç¢º
âœ“ è¨»è§£å……åˆ†:é—œéµé‚è¼¯éƒ½æœ‰èªªæ˜
âœ“ éŒ¯èª¤è™•ç†:å®Œå–„
âœ“ æ¸¬è©¦è¦†è“‹:95%

å»ºè­°:
1. å¯ä»¥å°‡ _is_strong_password æå–åˆ° utils
2. è€ƒæ…®æ·»åŠ ã€Œé‡è¨­æˆåŠŸã€çš„éƒµä»¶é€šçŸ¥

---

ã€é©—è­‰ 6: æ–‡æª”æ›´æ–°ã€‘

# æ›´æ–° API æ–‡æª”
/write docs/api/auth.md (è£œå……æ–° API)

# æ›´æ–° CLAUDE.md
/memory

å»ºè­°æ·»åŠ åˆ° CLAUDE.md:

## å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½
### å¯¦ä½œæ™‚é–“: 2025-01-20
### æŠ€è¡“ç´°ç¯€:
- Token: 256-bit éš¨æ©Ÿ,1 å°æ™‚éæœŸ
- é€Ÿç‡é™åˆ¶: 3 æ¬¡/15 åˆ†é˜/IP
- å®‰å…¨æ©Ÿåˆ¶: é˜² Timing Attack

### å·²çŸ¥å•é¡Œ:
- ç„¡

### ç›£æ§æŒ‡æ¨™:
- é‡è¨­è«‹æ±‚æ•¸
- Token ä½¿ç”¨ç‡
- é€Ÿç‡é™åˆ¶è§¸ç™¼æ¬¡æ•¸

---

âœ… ã€æ‰€æœ‰é©—è­‰é€šéã€‘
åŠŸèƒ½å·²å°±ç·’,å¯ä»¥éƒ¨ç½²!
```

---

## ç¬¬äºŒéƒ¨åˆ†:EPCV å¯¦æˆ°ç¯„ä¾‹

### ç¯„ä¾‹ 1:æ–°å¢ API ç«¯é»(ç°¡å–®)

**éœ€æ±‚**: æ–°å¢ã€Œå–å¾—ä½¿ç”¨è€…å€‹äººè³‡æ–™ã€API

**æ™‚é–“**: 45 åˆ†é˜

```bash
ã€E - Exploreã€‘ (10 åˆ†é˜)

æç¤ºè©:
æˆ‘éœ€è¦æ–°å¢ã€Œå–å¾—ä½¿ç”¨è€…å€‹äººè³‡æ–™ã€API,è«‹æ¢ç´¢:
1. ç¾æœ‰çš„ä½¿ç”¨è€… API é¢¨æ ¼
2. èªè­‰æ©Ÿåˆ¶
3. User æ¨¡å‹çµæ§‹

# Claude åˆ†æç¾æœ‰ç¨‹å¼ç¢¼...

---

ã€P - Planã€‘ (10 åˆ†é˜)

API è¨­è¨ˆ:
GET /api/v1/users/me
Headers: Authorization: Bearer <token>
Response:
{
  "id": "uuid",
  "username": "string",
  "email": "string",
  "created_at": "datetime"
}

å¯¦ä½œæ­¥é©Ÿ:
1. æ–°å¢è·¯ç”±
2. å¯¦ä½œ JWT é©—è­‰è£é£¾å™¨
3. è¿”å›ä½¿ç”¨è€…è³‡æ–™(æ’é™¤æ•æ„Ÿè³‡è¨Š)
4. å¯«æ¸¬è©¦

---

ã€C - Codeã€‘ (20 åˆ†é˜)

# 1. å…ˆå¯«æ¸¬è©¦
/write tests/test_user_api.py

# 2. å¯¦ä½œåŠŸèƒ½
/write src/api/users.py

# 3. åŸ·è¡Œæ¸¬è©¦
pytest tests/test_user_api.py
# âœ“ å…¨éƒ¨é€šé

---

ã€V - Verifyã€‘ (5 åˆ†é˜)

# å®‰å…¨æª¢æŸ¥
# æ•ˆèƒ½æ¸¬è©¦
# Code Review
# æ–‡æª”æ›´æ–°

âœ… å®Œæˆ!
```

### ç¯„ä¾‹ 2:ä¿®å¾©è·¨å¤šæª”æ¡ˆçš„ Bug(ä¸­ç­‰)

**å•é¡Œ**: è¨‚å–®å–æ¶ˆå¾Œåº«å­˜æ²’æœ‰å›æ»¾

**æ™‚é–“**: 90 åˆ†é˜

```bash
ã€E - Exploreã€‘ (30 åˆ†é˜)

æç¤ºè©:
ã€Œè¨‚å–®å–æ¶ˆå¾Œåº«å­˜æ²’æœ‰å›æ»¾ã€,è«‹æ¢ç´¢:
1. è¨‚å–®å–æ¶ˆæµç¨‹åœ¨å“ªè£¡?
2. åº«å­˜æ‰£é™¤é‚è¼¯åœ¨å“ªè£¡?
3. æœ‰æ²’æœ‰äº¤æ˜“æ©Ÿåˆ¶?
4. æœ‰æ²’æœ‰æ¸¬è©¦è¦†è“‹é€™å€‹å ´æ™¯?

# Claude åŸ·è¡Œ:
/grep "cancel_order" --type py
/grep "deduct.*stock" --type py
/read src/api/orders.py
/read src/models/product.py
/glob tests/**/*order*.py

# ç™¼ç¾å•é¡Œ:
1. cancel_order() åªæ›´æ–°è¨‚å–®ç‹€æ…‹
2. æ²’æœ‰å‘¼å« restore_inventory()
3. ç¼ºå°‘æ¸¬è©¦

---

ã€P - Planã€‘ (15 åˆ†é˜)

ä¿®å¾©æ–¹æ¡ˆ:
1. åœ¨ cancel_order() ä¸­æ·»åŠ åº«å­˜å›æ»¾
2. ä½¿ç”¨è³‡æ–™åº«äº¤æ˜“ç¢ºä¿åŸå­æ€§
3. æ·»åŠ æ¸¬è©¦è¦†è“‹æ­¤å ´æ™¯
4. æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦ä¿®å¾©

å¯¦ä½œæ­¥é©Ÿ:
Phase 1: å»ºç«‹æ¸¬è©¦(é‡ç¾ bug)
Phase 2: ä¿®å¾© cancel_order()
Phase 3: æ·»åŠ äº¤æ˜“æ©Ÿåˆ¶
Phase 4: é©—è­‰ä¿®å¾©

---

ã€C - Codeã€‘ (35 åˆ†é˜)

# Phase 1: å…ˆå¯«æ¸¬è©¦(æ‡‰è©²å¤±æ•—)
/write tests/test_order_cancel.py

def test_cancel_order_restores_inventory():
    """æ¸¬è©¦å–æ¶ˆè¨‚å–®æœƒå›æ»¾åº«å­˜"""
    # åˆå§‹åº«å­˜
    product = create_test_product(stock=100)

    # å»ºç«‹è¨‚å–®(æ‰£é™¤ 10 å€‹)
    order = create_test_order(product_id=product.id, quantity=10)
    assert product.stock == 90

    # å–æ¶ˆè¨‚å–®
    cancel_order(order.id)

    # é©—è­‰åº«å­˜å›æ»¾
    assert product.stock == 100  # æ‡‰è©²æ¢å¾©

# åŸ·è¡Œæ¸¬è©¦
pytest tests/test_order_cancel.py::test_cancel_order_restores_inventory
# FAILED - AssertionError: assert 90 == 100
# âœ“ æˆåŠŸé‡ç¾ bug

---

# Phase 2: ä¿®å¾©ç¨‹å¼ç¢¼
/read src/api/orders.py
/edit src/api/orders.py

# ä¿®æ”¹ cancel_order å‡½æ•¸,æ·»åŠ åº«å­˜å›æ»¾

---

# Phase 3: å†æ¬¡æ¸¬è©¦
pytest tests/test_order_cancel.py
# âœ“ å…¨éƒ¨é€šé

---

ã€V - Verifyã€‘ (10 åˆ†é˜)

# 1. åŸ·è¡Œæ‰€æœ‰è¨‚å–®ç›¸é—œæ¸¬è©¦
pytest tests/*order* -v
# âœ“ å…¨éƒ¨é€šé

# 2. æª¢æŸ¥æ˜¯å¦å¼•å…¥æ–°å•é¡Œ
pytest tests/ -v
# âœ“ å…¨éƒ¨é€šé

# 3. Code Review
# 4. æ›´æ–°æ–‡æª”

âœ… Bug ä¿®å¾©å®Œæˆ!
```

### ç¯„ä¾‹ 3:é‡æ§‹éºç•™ç³»çµ±(è¤‡é›œ)

**ä»»å‹™**: é‡æ§‹æ··äº‚çš„æ”¯ä»˜æ¨¡çµ„

**æ™‚é–“**: 4 å°æ™‚

```bash
ã€E - Exploreã€‘ (60 åˆ†é˜)

æç¤ºè©:
è«‹å…¨é¢åˆ†æ src/api/payment.py,æ‰¾å‡º:
1. ä¸»è¦åŠŸèƒ½
2. ç¨‹å¼ç¢¼ç•°å‘³
3. å®‰å…¨å•é¡Œ
4. æ•ˆèƒ½å•é¡Œ
5. æ¸¬è©¦è¦†è“‹ç‡

# Claude åŸ·è¡Œæ·±åº¦åˆ†æ...
/read src/api/payment.py
/grep "payment" --type py
/glob tests/**/*payment*.py

# å ±å‘Š:
- ä¸»å‡½æ•¸ 387 è¡Œ
- 8 ç¨®æ”¯ä»˜æ–¹å¼æ··åœ¨ä¸€èµ·
- ç„¡éŒ¯èª¤è™•ç†
- ç„¡äº¤æ˜“æ©Ÿåˆ¶
- æ¸¬è©¦è¦†è“‹ç‡ 15%

---

ã€P - Planã€‘ (60 åˆ†é˜)

é‡æ§‹ç­–ç•¥:
1. æå–æ¯ç¨®æ”¯ä»˜æ–¹å¼ç‚ºç¨ç«‹é¡åˆ¥
2. ä½¿ç”¨ç­–ç•¥æ¨¡å¼
3. æ·»åŠ çµ±ä¸€éŒ¯èª¤è™•ç†
4. å¯¦ä½œäº¤æ˜“æ©Ÿåˆ¶
5. å»ºç«‹å®Œæ•´æ¸¬è©¦

æ¶æ§‹è¨­è¨ˆ:
[è©³ç´°çš„é¡åˆ¥åœ–ã€æµç¨‹åœ–]

åˆ†éšæ®µå¯¦æ–½:
Week 1: å»ºç«‹æ–°æ¶æ§‹
Week 2: é·ç§»ç¾æœ‰åŠŸèƒ½
Week 3: æ¸¬è©¦èˆ‡é©—è­‰

---

ã€C - Codeã€‘ (90 åˆ†é˜)

# æŒ‰è¨ˆåŠƒé€æ­¥å¯¦ä½œ...
[è©³ç´°å¯¦ä½œéç¨‹]

---

ã€V - Verifyã€‘ (30 åˆ†é˜)

# å…¨é¢é©—è­‰...
[æ¸¬è©¦ã€Reviewã€æ–‡æª”]

âœ… é‡æ§‹å®Œæˆ!
```

---

## ç¬¬ä¸‰éƒ¨åˆ†:é©—è­‰å‰ç½®(Validation-First)

### ç‚ºä»€éº¼é©—è­‰å‰ç½®?

**å‚³çµ±æ–¹å¼** (ç”Ÿæˆå¾Œé©—è­‰):
```
å¯«ç¨‹å¼ç¢¼ â†’ åŸ·è¡Œ â†’ ç™¼ç¾ bug â†’ ä¿®æ”¹ â†’ å†åŸ·è¡Œ â†’ åˆæœ‰ bug â†’ ...
```

**é©—è­‰å‰ç½®** (æ¸¬è©¦é©…å‹•):
```
å¯«æ¸¬è©¦ â†’ å¯«ç¨‹å¼ç¢¼(æ¸¬è©¦å°å‘) â†’ æ¸¬è©¦é€šé â†’ å®Œæˆ
```

### TDD èˆ‡ AI çµåˆ

```bash
æç¤ºè©:
ä½¿ç”¨ TDD æ–¹å¼å¯¦ä½œã€Œå•†å“æœå°‹ã€åŠŸèƒ½

# Claude è‡ªå‹•åŸ·è¡Œ TDD:

ã€ç´…ç‡ˆã€‘å…ˆå¯«æ¸¬è©¦
/write tests/test_product_search.py

def test_search_by_name():
    """æ¸¬è©¦æŒ‰åç¨±æœå°‹"""
    products = [
        create_product(name="iPhone 15"),
        create_product(name="Samsung Galaxy"),
        create_product(name="iPhone 14")
    ]

    result = search_products(query="iPhone")

    assert len(result) == 2
    assert all("iPhone" in p.name for p in result)

# åŸ·è¡Œ:pytest â†’ FAILED(å‡½æ•¸ä¸å­˜åœ¨)

---

ã€ç¶ ç‡ˆã€‘å¯«æœ€ç°¡å¯¦ä½œ
/write src/api/products.py

def search_products(query: str) -> list[Product]:
    """æœå°‹å•†å“"""
    return Product.query.filter(
        Product.name.ilike(f"%{query}%")
    ).all()

# åŸ·è¡Œ:pytest â†’ PASSED

---

ã€é‡æ§‹ã€‘å„ªåŒ–ç¨‹å¼ç¢¼
# æ·»åŠ æ›´å¤šéæ¿¾æ¢ä»¶
# å„ªåŒ–æŸ¥è©¢æ•ˆèƒ½
# æ·»åŠ åˆ†é 

# åŸ·è¡Œ:pytest â†’ PASSED(ç¢ºä¿é‡æ§‹æ²’ç ´å£åŠŸèƒ½)
```

### BDD å ´æ™¯æ¸¬è©¦

```python
# tests/test_order_flow.feature
Feature: è¨‚å–®æµç¨‹
  ä½œç‚ºä¸€å€‹ä½¿ç”¨è€…
  æˆ‘æƒ³è¦å®Œæˆè³¼ç‰©æµç¨‹
  ä»¥ä¾¿è³¼è²·å•†å“

  Scenario: æˆåŠŸä¸‹å–®
    Given ä½¿ç”¨è€…å·²ç™»å…¥
    And è³¼ç‰©è»Šæœ‰ 2 å€‹å•†å“
    And åº«å­˜å……è¶³
    When ä½¿ç”¨è€…ç¢ºèªè¨‚å–®
    Then è¨‚å–®å»ºç«‹æˆåŠŸ
    And åº«å­˜æ‰£é™¤æˆåŠŸ
    And ä½¿ç”¨è€…æ”¶åˆ°ç¢ºèªéƒµä»¶

  Scenario: åº«å­˜ä¸è¶³
    Given ä½¿ç”¨è€…å·²ç™»å…¥
    And è³¼ç‰©è»Šæœ‰ 10 å€‹å•†å“
    And åº«å­˜åªæœ‰ 5 å€‹
    When ä½¿ç”¨è€…ç¢ºèªè¨‚å–®
    Then é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ã€Œåº«å­˜ä¸è¶³ã€
    And è¨‚å–®æœªå»ºç«‹
    And åº«å­˜æœªæ‰£é™¤
```

---

## ç¬¬å››éƒ¨åˆ†:æŒ‡ä»¤çµ„åˆé€ŸæŸ¥

### E - Explore éšæ®µ

```bash
# ç†è§£å°ˆæ¡ˆçµæ§‹
/glob **/*.py
/read CLAUDE.md
/context

# æ‰¾ç›¸é—œç¨‹å¼ç¢¼
/grep "<é—œéµå­—>" --type <èªè¨€>
/read <é—œéµæª”æ¡ˆ>

# åˆ†æä¾è³´
/grep "import" --type py | åˆ†ææ¨¡çµ„ä¾è³´
```

### P - Plan éšæ®µ

```bash
# AI è¼”åŠ©è¦åŠƒ
æç¤ºè©: è«‹åˆ¶å®š<åŠŸèƒ½>çš„å¯¦ä½œè¨ˆåŠƒ,åŒ…å«:
1. API è¨­è¨ˆ
2. è³‡æ–™åº«è®Šæ›´
3. å®‰å…¨è€ƒé‡
4. æ¸¬è©¦è¨ˆåŠƒ
5. åˆ†éšæ®µå¯¦æ–½
```

### C - Code éšæ®µ

```bash
# TDD æµç¨‹
/write tests/test_<åŠŸèƒ½>.py   # å…ˆå¯«æ¸¬è©¦
# åŸ·è¡Œ: pytest â†’ ç´…ç‡ˆ
/write src/<åŠŸèƒ½>.py           # å¯¦ä½œåŠŸèƒ½
# åŸ·è¡Œ: pytest â†’ ç¶ ç‡ˆ
/edit src/<åŠŸèƒ½>.py            # é‡æ§‹å„ªåŒ–
# åŸ·è¡Œ: pytest â†’ æŒçºŒç¶ ç‡ˆ
```

### V - Verify éšæ®µ

```bash
# å…¨é¢æ¸¬è©¦
pytest tests/ -v --cov=src

# å®‰å…¨æƒæ
/grep "<å®‰å…¨é—œéµå­—>" --type py

# Code Review
æç¤ºè©: è«‹ review <æª”æ¡ˆ>,æª¢æŸ¥:
1. é¢¨æ ¼
2. é‚è¼¯
3. æ•ˆèƒ½
4. å®‰å…¨

# æ›´æ–°æ–‡æª”
/memory
/write docs/<æ–‡æª”>.md
```

---

## ç¸½çµ

### EPCV æ ¸å¿ƒåƒ¹å€¼

```
1. ç³»çµ±åŒ–:ä¸å†é é‹æ°£,æœ‰æ˜ç¢ºæµç¨‹
2. é«˜å“è³ª:é©—è­‰å‰ç½®,bug æ›´å°‘
3. é«˜æ•ˆç‡:æ¸›å°‘è¿”å·¥,ä¸€æ¬¡åšå°
4. å¯é‡è¤‡:æµç¨‹æ¨™æº–åŒ–,å¯è¤‡è£½
```

### é—œéµåŸå‰‡

1. **Explore è¦å……åˆ†** - ç†è§£ä¸è¶³å°è‡´è¿”å·¥
2. **Plan è¦ç´°ç·»** - è¦åŠƒéšæ®µå°± Review
3. **Code è¦æ¸¬è©¦** - TDD/BDD ç¢ºä¿å“è³ª
4. **Verify è¦å…¨é¢** - ä¸åªåŠŸèƒ½,é‚„æœ‰å®‰å…¨ã€æ•ˆèƒ½

### Linux é¡æ¯”

```bash
EPCV = ç³»çµ±åŒ–é–‹ç™¼æ–¹æ³•è«–

å°±åƒ Linux çš„ã€Œä¸€åˆ‡çš†æª”æ¡ˆã€å“²å­¸,
EPCV æä¾›äº†ã€Œä¸€åˆ‡çš†æµç¨‹ã€çš„é–‹ç™¼å“²å­¸
```

### ä¸‹ä¸€æ­¥

æ­å–œå®Œæˆ Module 2!ä½ å·²ç¶“æŒæ¡:
- Claude Code åŸºç¤æ“ä½œ
- ä¸Šä¸‹æ–‡ç®¡ç†
- ç¨‹å¼ç¢¼åˆ†æèˆ‡é‡æ§‹
- EPCV ç³»çµ±åŒ–é–‹ç™¼

æ¥ä¸‹ä¾†:
- **Module 3: IDE æ•´åˆ** - åœ¨ç†Ÿæ‚‰çš„ç’°å¢ƒä¸­ä½¿ç”¨ AI
- **Module 4: TDD/BDD å¯¦è¸** - æ·±å…¥æ¸¬è©¦é©…å‹•é–‹ç™¼

---

**ç¹¼çºŒå­¸ç¿’**: [Module 3 - IDE æ•´åˆé–‹ç™¼](../../03_IDEæ•´åˆé–‹ç™¼/README.md)
