# S1.1：首次安裝 Claude Code

## 📋 情境資訊

- **難度**：⭐
- **預估時間**：30 分鐘
- **核心學習**：Claude Code 安裝流程、環境驗證、基本配置
- **前置知識**：基本命令列操作、API Key 概念

---

## 🎯 情境背景

你剛加入一家軟體公司,團隊正在評估使用 Claude Code 作為主要的 AI 輔助開發工具。作為團隊的早期採用者,你需要在本地機器上正確安裝並配置 Claude Code,然後向團隊展示基本功能。

**公司環境資訊**:
- 作業系統: Windows 10/11, macOS, 或 Linux
- 網路環境: 需要穩定的網際網路連線
- 已有工具: Git, Visual Studio Code (或其他編輯器)
- API Access: 公司已提供 Anthropic API Key

**你的任務**:
1. 成功安裝 Claude Code CLI 工具
2. 配置 API Key
3. 驗證安裝是否正確
4. 測試基本功能
5. 記錄安裝過程以便分享給團隊

---

## 🎓 學習目標

完成本情境後,你將能夠:

- ✅ 理解 Claude Code 的系統需求
- ✅ 正確安裝 Claude Code CLI 工具
- ✅ 配置和管理 API Key
- ✅ 驗證安裝狀態
- ✅ 執行基本的 Claude Code 指令
- ✅ 排查常見安裝問題

---

## 📝 任務描述

### 階段 1: 環境檢查與準備 (5 分鐘)

#### 任務 1.1: 檢查系統需求

**檢查清單**:
```markdown
## 系統需求檢查

### 作業系統
- [ ] Windows 10/11 (64-bit)
- [ ] macOS 10.15 或更新版本
- [ ] Linux (Ubuntu 20.04+, Fedora 35+, 或相容發行版)

### 基礎工具
- [ ] 已安裝 Node.js 18+ 或 Python 3.8+
- [ ] 已安裝 Git
- [ ] 有命令列/終端機使用經驗

### 網路環境
- [ ] 穩定的網際網路連線
- [ ] 能夠訪問 https://api.anthropic.com
- [ ] 公司防火牆允許 HTTPS 連線 (port 443)

### 帳號準備
- [ ] 已有 Anthropic 帳號
- [ ] 已取得 API Key (以 sk-ant- 開頭)
```

**執行步驟**:
1. 開啟終端機/命令提示字元
2. 執行以下指令檢查必要工具:
   ```bash
   # 檢查 Node.js 版本
   node --version

   # 檢查 npm 版本
   npm --version

   # 檢查 Git 版本
   git --version
   ```

**預期結果**:
- Node.js 版本 ≥ 18.0.0
- npm 版本 ≥ 9.0.0
- Git 已安裝

---

### 階段 2: 安裝 Claude Code (10 分鐘)

#### 任務 2.1: 安裝 CLI 工具

**方式 1: 使用 npm 安裝 (推薦)**

```bash
# 全域安裝 Claude Code
npm install -g @anthropic-ai/claude-code

# 驗證安裝
claude-code --version
```

**方式 2: 使用 Homebrew (macOS/Linux)**

```bash
# 安裝 Claude Code
brew install claude-code

# 驗證安裝
claude-code --version
```

**方式 3: 使用 pipx (Python 使用者)**

```bash
# 安裝 pipx (如果尚未安裝)
python3 -m pip install --user pipx
python3 -m pipx ensurepath

# 安裝 Claude Code
pipx install claude-code

# 驗證安裝
claude-code --version
```

**預期輸出**:
```
Claude Code CLI version 1.2.0
```

#### 任務 2.2: 處理常見安裝問題

**問題 1: 權限錯誤 (Permission Denied)**

```bash
# 錯誤訊息
npm ERR! Error: EACCES: permission denied

# 解決方法: 使用 npm 全域安裝目錄設定
npm config set prefix ~/.npm-global
export PATH=~/.npm-global/bin:$PATH

# 重新安裝
npm install -g @anthropic-ai/claude-code
```

**問題 2: 找不到指令 (Command Not Found)**

```bash
# 檢查安裝路徑
npm list -g @anthropic-ai/claude-code

# 確認 PATH 設定
echo $PATH

# 添加到 PATH (Linux/macOS)
export PATH="$PATH:$(npm config get prefix)/bin"

# 添加到 PATH (Windows)
# 手動將 npm 全域路徑添加到系統環境變數
```

**問題 3: 網路連線問題**

```bash
# 使用公司 proxy
npm config set proxy http://proxy.company.com:8080
npm config set https-proxy http://proxy.company.com:8080

# 重新安裝
npm install -g @anthropic-ai/claude-code
```

---

### 階段 3: API Key 配置 (5 分鐘)

#### 任務 3.1: 取得 API Key

**步驟**:
1. 訪問 https://console.anthropic.com/
2. 登入你的帳號
3. 導航到 "API Keys" 頁面
4. 點擊 "Create Key" 建立新的 API Key
5. 複製 API Key (格式: `sk-ant-xxxxxxxx`)
6. **重要**: 安全保存此 Key,它只會顯示一次

#### 任務 3.2: 配置 API Key

**方式 1: 環境變數 (推薦 - 全域設定)**

```bash
# Linux/macOS: 添加到 ~/.bashrc 或 ~/.zshrc
export ANTHROPIC_API_KEY="sk-ant-your-api-key-here"

# 重新載入配置
source ~/.bashrc  # 或 source ~/.zshrc

# Windows: 設定系統環境變數
setx ANTHROPIC_API_KEY "sk-ant-your-api-key-here"
# 重新開啟命令提示字元
```

**方式 2: 配置檔案 (推薦 - 專案級設定)**

```bash
# 建立配置目錄
mkdir -p ~/.claude

# 建立配置檔案
cat > ~/.claude/config.json << EOF
{
  "apiKey": "sk-ant-your-api-key-here",
  "model": "claude-3-5-sonnet-20241022",
  "maxTokens": 8192
}
EOF

# 設定檔案權限 (重要!)
chmod 600 ~/.claude/config.json
```

**方式 3: 互動式設定 (初學者友善)**

```bash
# 執行設定精靈
claude-code config setup

# 按照提示輸入:
# - API Key
# - 預設模型
# - 其他偏好設定
```

#### 任務 3.3: 驗證 API Key 配置

```bash
# 檢查配置狀態
claude-code config show

# 測試 API 連線
claude-code test-connection

# 預期輸出:
# ✓ API Key is valid
# ✓ Connection to Anthropic API successful
# ✓ Current usage: 1,234 / 50,000 tokens
```

---

### 階段 4: 環境驗證與測試 (10 分鐘)

#### 任務 4.1: 執行基本指令測試

**測試 1: 版本資訊**

```bash
claude-code --version
claude-code version

# 預期輸出:
# Claude Code CLI version 1.2.0
# Claude API: claude-3-5-sonnet-20241022
```

**測試 2: 說明文件**

```bash
# 查看所有可用指令
claude-code --help

# 查看特定指令說明
claude-code chat --help
claude-code code --help
```

**測試 3: 簡單對話測試**

```bash
# 啟動互動式對話
claude-code chat "Hello! Please confirm you can respond."

# 預期回應:
# Hello! I can respond. I'm Claude, and I'm ready to assist you with programming tasks.
```

**測試 4: 簡單程式碼生成**

```bash
# 生成簡單函數
claude-code code "Write a Python function to calculate factorial"

# 預期產出:
# Created file: factorial.py
# [顯示生成的程式碼]
```

#### 任務 4.2: 測試檔案操作

**建立測試專案**:

```bash
# 建立測試目錄
mkdir ~/claude-code-test
cd ~/claude-code-test

# 初始化 Git repository
git init

# 建立簡單測試檔案
echo "# Claude Code Test Project" > README.md
echo "print('Hello from Claude!')" > test.py
```

**測試專案分析**:

```bash
# 分析專案結構
claude-code /glob "**/*.py"

# 預期輸出:
# Found 1 file:
#   - test.py

# 讀取檔案內容
claude-code /read test.py

# 預期輸出:
# [顯示 test.py 的內容]
```

**測試程式碼搜尋**:

```bash
# 搜尋特定模式
claude-code /grep "print" --output-mode=content

# 預期輸出:
# test.py:1: print('Hello from Claude!')
```

---

## ✅ 檢查點

### 基礎檢查點 (必須完成)

- [ ] **安裝驗證**: `claude-code --version` 成功執行並顯示版本號
- [ ] **API Key 配置**: `claude-code config show` 顯示已配置的 API Key
- [ ] **連線測試**: `claude-code test-connection` 顯示連線成功
- [ ] **基本對話**: 能夠使用 `claude-code chat` 進行對話
- [ ] **檔案操作**: 能夠使用 `/glob`, `/read`, `/grep` 等指令

### 進階檢查點 (建議完成)

- [ ] **環境變數**: API Key 已添加到 shell 配置檔案 (~/.bashrc 或 ~/.zshrc)
- [ ] **安全性**: 配置檔案權限設定為 600
- [ ] **文檔閱讀**: 已閱讀 `claude-code --help` 的所有主要指令
- [ ] **測試專案**: 建立測試專案並成功執行基本指令
- [ ] **問題排查**: 了解常見問題的解決方法

---

## 🎯 自然學到的指令

通過本情境,你應該自然學會以下指令:

### 系統管理指令

| 指令 | 用途 | 何時使用 |
|------|------|----------|
| `claude-code --version` | 查看版本 | 驗證安裝、報告問題 |
| `claude-code --help` | 查看說明 | 學習新指令、查詢語法 |
| `claude-code config setup` | 互動式配置 | 首次設定、重新配置 |
| `claude-code config show` | 顯示配置 | 驗證設定、檢查 API Key |
| `claude-code test-connection` | 測試連線 | 驗證 API Key、網路診斷 |

### 基本操作指令

| 指令 | 用途 | 何時使用 |
|------|------|----------|
| `claude-code chat [message]` | 開始對話 | 詢問問題、獲取建議 |
| `claude-code code [prompt]` | 生成程式碼 | 快速原型、程式碼片段 |
| `/glob [pattern]` | 搜尋檔案 | 找出特定類型檔案 |
| `/read [file]` | 讀取檔案 | 檢視檔案內容 |
| `/grep [pattern]` | 搜尋內容 | 找出特定程式碼模式 |

---

## ❓ 常見問題

### Q1: 安裝後顯示 "command not found"

**原因**: CLI 工具未添加到系統 PATH

**解決方法**:
```bash
# 檢查安裝位置
npm list -g @anthropic-ai/claude-code

# 添加到 PATH
export PATH="$PATH:$(npm config get prefix)/bin"

# 永久添加 (Linux/macOS)
echo 'export PATH="$PATH:$(npm config get prefix)/bin"' >> ~/.bashrc
source ~/.bashrc
```

---

### Q2: API Key 配置後仍提示 "API Key not found"

**檢查步驟**:
```bash
# 1. 確認環境變數
echo $ANTHROPIC_API_KEY

# 2. 如果為空,重新設定
export ANTHROPIC_API_KEY="sk-ant-your-key"

# 3. 或使用配置檔案
claude-code config setup

# 4. 驗證配置
claude-code config show
```

---

### Q3: 執行指令時顯示 "Rate limit exceeded"

**原因**: API 使用量超過限制

**解決方法**:
1. 檢查當前使用量: `claude-code usage`
2. 等待限制重置 (通常每分鐘重置)
3. 考慮升級 API 方案
4. 優化請求頻率

---

### Q4: Windows 上安裝失敗

**常見原因與解決方法**:

```powershell
# 問題: 需要管理員權限
# 解決: 以管理員身份執行 PowerShell

# 問題: 執行政策限制
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser

# 問題: PATH 未更新
# 解決: 重新開啟命令提示字元或 PowerShell
```

---

### Q5: 如何更新 Claude Code?

```bash
# 使用 npm
npm update -g @anthropic-ai/claude-code

# 使用 Homebrew
brew upgrade claude-code

# 使用 pipx
pipx upgrade claude-code

# 驗證更新
claude-code --version
```

---

## 🚀 延伸挑戰

### 挑戰 1: 建立團隊安裝指南

**任務**: 撰寫一份簡潔的安裝指南文件供團隊使用

**要求**:
- 涵蓋 Windows, macOS, Linux 三平台
- 包含常見問題排查
- 提供安裝驗證清單
- 添加公司特定配置 (如 proxy 設定)

---

### 挑戰 2: 自動化安裝腳本

**任務**: 撰寫安裝腳本自動化整個過程

**範例 (Linux/macOS)**:
```bash
#!/bin/bash

# Claude Code 自動化安裝腳本

set -e  # 遇到錯誤立即停止

echo "Starting Claude Code installation..."

# 檢查 Node.js
if ! command -v node &> /dev/null; then
    echo "Error: Node.js is not installed"
    exit 1
fi

# 安裝 Claude Code
echo "Installing Claude Code..."
npm install -g @anthropic-ai/claude-code

# 驗證安裝
echo "Verifying installation..."
claude-code --version

# 配置 API Key
echo "Please enter your Anthropic API Key:"
read -s API_KEY

echo "export ANTHROPIC_API_KEY=\"$API_KEY\"" >> ~/.bashrc

echo "Installation completed successfully!"
echo "Please restart your terminal or run: source ~/.bashrc"
```

---

### 挑戰 3: 建立配置管理系統

**任務**: 建立統一的配置管理方案

**要求**:
- 使用版本控制管理 CLAUDE.md
- 建立團隊共用的配置模板
- 設定 Git ignore 排除敏感資訊 (API Key)
- 建立配置驗證腳本

**範例 .gitignore**:
```
# Claude Code 配置
.claude/config.json
.env
.anthropic_api_key

# 但保留模板
!.claude/config.template.json
```

---

## 📚 相關資源

### 官方文檔
- [Claude Code 官方文檔](https://docs.anthropic.com/claude-code)
- [Anthropic API 文檔](https://docs.anthropic.com/api)
- [CLI 使用指南](https://docs.anthropic.com/claude-code/cli)

### 課程資源
- **理論**: `2.1_Claude_Code安裝與配置.md`
- **下一步**: `S1.2_配置專案記憶檔案.md`

### 社群資源
- [Claude Code GitHub](https://github.com/anthropics/claude-code)
- [Discord 社群](https://discord.gg/anthropic)
- [Stack Overflow](https://stackoverflow.com/questions/tagged/claude-code)

---

## 📝 反思問題

完成情境後,思考以下問題:

1. **安裝體驗**: 安裝過程中最困難的部分是什麼?為什麼?

2. **配置理解**: 為什麼 API Key 需要特別的安全保護?有哪些最佳實踐?

3. **工具對比**: Claude Code 與其他 AI 編程工具 (如 GitHub Copilot) 的安裝有何不同?

4. **團隊推廣**: 如果要向團隊推廣 Claude Code,你會如何簡化安裝流程?

5. **問題預防**: 如何避免常見的安裝問題?可以建立什麼機制來幫助新手?

---

**情境版本**: v1.0
**最後更新**: 2025-01-30
**預估完成率**: 首次安裝通常 90% 學員能在 30 分鐘內完成
**常見卡點**: API Key 配置 (15%), PATH 設定 (10%)
