# C08ï¼šä¾è³´é …å‡ç´šï¼ˆçµ„åˆç´šï¼‰

## æƒ…å¢ƒè³‡è¨Š

**ç·¨è™Ÿ**ï¼šC08
**é›£åº¦**ï¼šâ­â­â­â­â˜†ï¼ˆçµ„åˆç´šï¼‰
**é è¨ˆæ™‚é–“**ï¼š2 å°æ™‚
**å­¸ç¿’ç›®æ¨™**ï¼š
- æŒæ¡ä½¿ç”¨ /grep æŸ¥æ‰¾å»¢æ£„ API ä½¿ç”¨
- å­¸æœƒç³»çµ±åŒ–è™•ç† breaking changes
- ç·´ç¿’å¤§è¦æ¨¡ä»£ç¢¼é·ç§»ç­–ç•¥
- å»ºç«‹ä¾è³´å‡ç´šæª¢æŸ¥æ¸…å–®

**é©ç”¨å°è±¡**ï¼š
- å®Œæˆæ¨¡çµ„ 2 åŸºç¤ç†è«–
- ç†Ÿæ‚‰ Python ä¾è³´ç®¡ç†
- éœ€è¦è™•ç†æ¡†æ¶å‡ç´šå•é¡Œ

---

## æƒ…å¢ƒæè¿°

### èƒŒæ™¯

ä½ è² è²¬ç¶­è­·ä¸€å€‹é›»å•†å¹³å°çš„å¾Œç«¯ç³»çµ±ï¼Œä½¿ç”¨ Django æ¡†æ¶é–‹ç™¼ã€‚ç³»çµ±å·²ç¶“é‹è¡Œäº† 3 å¹´ï¼Œç›®å‰ä½¿ç”¨çš„æ˜¯ **Django 2.2 LTS**ï¼Œä½†é€™å€‹ç‰ˆæœ¬å°‡åœ¨ä¸‹å€‹æœˆåœæ­¢å®‰å…¨æ›´æ–°æ”¯æŒã€‚

å…¬å¸å®‰å…¨åœ˜éšŠè¦æ±‚å¿…é ˆå‡ç´šåˆ° **Django 4.2 LTS**ï¼ˆæœ€æ–°çš„é•·æœŸæ”¯æŒç‰ˆæœ¬ï¼‰ã€‚ç„¶è€Œï¼Œå¾ 2.2 åˆ° 4.2 è·¨è¶Šäº†å…©å€‹å¤§ç‰ˆæœ¬ï¼ŒåŒ…å«å¤§é‡ breaking changesï¼š

- **URL é…ç½®**ï¼š`django.conf.urls.url()` å·²å»¢æ£„ï¼Œæ”¹ç”¨ `path()` å’Œ `re_path()`
- **ORM æŸ¥è©¢**ï¼š`QuerySet.count()` è¡Œç‚ºè®Šæ›´ï¼Œ`on_delete` æˆç‚ºå¿…å¡«
- **Middleware**ï¼šèˆŠå¼ middleware ä¸å†æ”¯æŒ
- **æ¨¡æ¿**ï¼šæŸäº›æ¨¡æ¿æ¨™ç±¤èªæ³•è®Šæ›´
- **ç¬¬ä¸‰æ–¹å¥—ä»¶**ï¼šå¤šå€‹ä¾è³´ä¹Ÿéœ€è¦å‡ç´š

### ç¾æœ‰å•é¡Œç¯„åœ

```python
# é …ç›®çµæ§‹
myproject/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ accounts/      # ç”¨æˆ¶ç³»çµ±
â”‚   â”œâ”€â”€ orders/        # è¨‚å–®ç³»çµ±
â”‚   â”œâ”€â”€ products/      # å•†å“ç³»çµ±
â”‚   â””â”€â”€ payments/      # æ”¯ä»˜ç³»çµ±
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ middleware.py
â”‚   â””â”€â”€ utils.py
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ urls.py
â”‚   â””â”€â”€ settings.py
â””â”€â”€ requirements.txt

çµ±è¨ˆï¼š
- Python æ–‡ä»¶ï¼š156 å€‹
- ä»£ç¢¼è¡Œæ•¸ï¼š32,450 è¡Œ
- URL é…ç½®ï¼š87 å€‹è·¯ç”±
- æ•¸æ“šæ¨¡å‹ï¼š45 å€‹
- ç¬¬ä¸‰æ–¹ä¾è³´ï¼š23 å€‹
```

### å·²çŸ¥çš„ Breaking Changes

**1. URL é…ç½®å»¢æ£„**

```python
# Django 2.2ï¼ˆèˆŠï¼‰
from django.conf.urls import url
from . import views

urlpatterns = [
    url(r'^products/$', views.product_list, name='product-list'),
    url(r'^products/(?P<pk>[0-9]+)/$', views.product_detail),
    url(r'^orders/(?P<order_id>[a-z0-9-]+)/$', views.order_detail),
]

# Django 4.2ï¼ˆæ–°ï¼‰
from django.urls import path, re_path
from . import views

urlpatterns = [
    path('products/', views.product_list, name='product-list'),
    path('products/<int:pk>/', views.product_detail),
    re_path(r'^orders/(?P<order_id>[a-z0-9-]+)/$', views.order_detail),
]
```

**2. ORM å¤–éµ on_delete å¿…å¡«**

```python
# Django 2.2ï¼ˆå¯é¸ï¼‰
class Order(models.Model):
    user = models.ForeignKey(User)  # on_delete å¯ä»¥çœç•¥
    product = models.ForeignKey('Product')

# Django 4.2ï¼ˆå¿…å¡«ï¼‰
class Order(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    product = models.ForeignKey('Product', on_delete=models.PROTECT)
```

**3. Middleware èˆŠæ ¼å¼å»¢æ£„**

```python
# Django 2.2ï¼ˆèˆŠæ ¼å¼ï¼‰
class OldStyleMiddleware:
    def process_request(self, request):
        pass

    def process_response(self, request, response):
        return response

# Django 4.2ï¼ˆæ–°æ ¼å¼ï¼‰
class NewStyleMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        # process_request logic
        response = self.get_response(request)
        # process_response logic
        return response
```

**4. å°å…¥è·¯å¾‘è®Šæ›´**

```python
# Django 2.2
from django.utils.encoding import force_text
from django.contrib.postgres.fields import JSONField

# Django 4.2
from django.utils.encoding import force_str  # force_text â†’ force_str
from django.db.models import JSONField      # ç§»åˆ° models
```

### ä½ çš„ä»»å‹™

ç³»çµ±åŒ–åœ°å®Œæˆ Django å‡ç´šï¼š

1. **æƒæèˆ‡è©•ä¼°**ï¼šæ‰¾å‡ºæ‰€æœ‰éœ€è¦ä¿®æ”¹çš„åœ°æ–¹
2. **åˆ¶å®šé·ç§»è¨ˆåŠƒ**ï¼šæŒ‰å„ªå…ˆç´šå’Œä¾è³´é—œä¿‚æ’åº
3. **é€æ­¥åŸ·è¡Œé·ç§»**ï¼šç¢ºä¿æ¯ä¸€æ­¥éƒ½å¯æ¸¬è©¦
4. **é©—è­‰èˆ‡éƒ¨ç½²**ï¼šå®Œæ•´æ¸¬è©¦ï¼Œå¹³æ»‘ä¸Šç·š

---

## å­¸ç¿’é‡é»

### ç›®æ¨™ 1ï¼šä½¿ç”¨ /grep å®šä½æ‰€æœ‰å»¢æ£„ API

å­¸æœƒç²¾æº–æŸ¥æ‰¾éœ€è¦ä¿®æ”¹çš„ä»£ç¢¼ï¼š
- æ­£å‰‡è¡¨é”å¼åŒ¹é…å°å…¥èªå¥
- æŸ¥æ‰¾ç‰¹å®šå‡½æ•¸èª¿ç”¨æ¨¡å¼
- è­˜åˆ¥å»¢æ£„çš„é¡å’Œæ–¹æ³•
- çµ±è¨ˆå½±éŸ¿ç¯„åœ

### ç›®æ¨™ 2ï¼šç†è§£ Breaking Changes å½±éŸ¿

åˆ†æå‡ç´šå°ç³»çµ±çš„å½±éŸ¿ï¼š
- å“ªäº›æ˜¯èªæ³•è®Šæ›´ï¼ˆå¿…é ˆæ”¹ï¼‰
- å“ªäº›æ˜¯è¡Œç‚ºè®Šæ›´ï¼ˆéœ€è¦æ¸¬è©¦ï¼‰
- å“ªäº›æ˜¯æ€§èƒ½è®Šæ›´ï¼ˆéœ€è¦ç›£æ§ï¼‰
- ç¬¬ä¸‰æ–¹ä¾è³´çš„å…¼å®¹æ€§

### ç›®æ¨™ 3ï¼šå®‰å…¨çš„é·ç§»ç­–ç•¥

æŒæ¡å¤§è¦æ¨¡é·ç§»æŠ€å·§ï¼š
- åˆ†éšæ®µåŸ·è¡Œï¼ˆURL â†’ Models â†’ Middlewareï¼‰
- å»ºç«‹æ¸¬è©¦è¦†è“‹ï¼ˆé·ç§»å‰è£œå……æ¸¬è©¦ï¼‰
- ä½¿ç”¨å…¼å®¹å±¤ï¼ˆæ–°èˆŠä»£ç¢¼å…±å­˜ï¼‰
- Feature flag æ§åˆ¶ä¸Šç·š

### ç›®æ¨™ 4ï¼šè‡ªå‹•åŒ–å·¥å…·æ‡‰ç”¨

åˆ©ç”¨å·¥å…·åŠ é€Ÿé·ç§»ï¼š
- `django-upgrade`ï¼šè‡ªå‹•é‡å¯«ä»£ç¢¼
- `codemod`ï¼šæ‰¹é‡ä»£ç¢¼è½‰æ›
- è‡ªå®šç¾©è…³æœ¬è™•ç†ç‰¹æ®Šæƒ…æ³

---

## å»ºè­°è§£æ±ºæµç¨‹

### éšæ®µä¸€ï¼šæƒæèˆ‡å½±éŸ¿è©•ä¼°ï¼ˆ30 åˆ†é˜ï¼‰

**ç›®æ¨™**ï¼šå®Œæ•´äº†è§£éœ€è¦ä¿®æ”¹çš„ç¯„åœ

#### æ­¥é©Ÿ 1ï¼šæƒæ URL é…ç½®å»¢æ£„

```bash
/grep "from django.conf.urls import url" --type py

æç¤ºè©ï¼š
è«‹æ‰¾å‡ºæ‰€æœ‰ä½¿ç”¨èˆŠå¼ URL é…ç½®çš„æ–‡ä»¶ï¼š

1. å°å…¥ django.conf.urls.url çš„æ–‡ä»¶
2. ä½¿ç”¨ url() å‡½æ•¸çš„åœ°æ–¹
3. çµ±è¨ˆç¸½å…±æœ‰å¤šå°‘å€‹è·¯ç”±éœ€è¦é·ç§»
4. è©•ä¼°å“ªäº›å¯ä»¥ç›´æ¥ç”¨ path()ï¼Œå“ªäº›éœ€è¦ re_path()

å°æ¯å€‹ URL æ¨¡å¼åˆ†æï¼š
- ç°¡å–®è·¯å¾‘ï¼ˆç„¡æ­£å‰‡ï¼‰â†’ å¯ç”¨ path()
- è¤‡é›œæ­£å‰‡ â†’ éœ€è¦ re_path()
```

**é æœŸè¼¸å‡º**ï¼š

```markdown
## URL é…ç½®æƒæå ±å‘Š

### å½±éŸ¿ç¯„åœ

æ‰¾åˆ° **18 å€‹æ–‡ä»¶** ä½¿ç”¨èˆŠå¼ URL é…ç½®ï¼š

#### æ ¸å¿ƒ URL é…ç½®
config/urls.py:3
    from django.conf.urls import url, include

apps/accounts/urls.py:1
    from django.conf.urls import url

apps/orders/urls.py:2
    from django.conf.urls import url

... (å…± 18 å€‹æ–‡ä»¶)

### URL æ¨¡å¼åˆ†é¡

#### é¡åˆ¥ Aï¼šç°¡å–®è·¯å¾‘ï¼ˆå¯ç›´æ¥æ”¹ç‚º pathï¼‰- 67 å€‹

```python
# ç„¡æ­£å‰‡ï¼Œå¯ç›´æ¥è½‰æ›
url(r'^products/$', views.product_list)
â†’ path('products/', views.product_list)

url(r'^accounts/login/$', views.login)
â†’ path('accounts/login/', views.login)

url(r'^orders/create/$', views.create_order)
â†’ path('orders/create/', views.create_order)
```

ç¸½è¨ˆï¼š67 å€‹ï¼ˆ77%ï¼‰

#### é¡åˆ¥ Bï¼šå¸¶åƒæ•¸è·¯å¾‘ï¼ˆéœ€è¦è½‰æ›èªæ³•ï¼‰- 15 å€‹

```python
# æ•´æ•¸ ID
url(r'^products/(?P<pk>[0-9]+)/$', views.product_detail)
â†’ path('products/<int:pk>/', views.product_detail)

# å­—ç¬¦ä¸² slug
url(r'^categories/(?P<slug>[\w-]+)/$', views.category_detail)
â†’ path('categories/<slug:slug>/', views.category_detail)

# UUID
url(r'^orders/(?P<uuid>[a-f0-9-]{36})/$', views.order_detail)
â†’ path('orders/<uuid:uuid>/', views.order_detail)
```

ç¸½è¨ˆï¼š15 å€‹ï¼ˆ17%ï¼‰

#### é¡åˆ¥ Cï¼šè¤‡é›œæ­£å‰‡ï¼ˆéœ€è¦ re_pathï¼‰- 5 å€‹

```python
# è¤‡é›œæ¨¡å¼ï¼Œç„¡æ³•ç”¨ path() è¡¨é”
url(r'^api/v(?P<version>[12])/products/$', views.api_products)
â†’ re_path(r'^api/v(?P<version>[12])/products/$', views.api_products)

url(r'^files/(?P<path>.+\.(jpg|png))$', views.serve_image)
â†’ re_path(r'^files/(?P<path>.+\.(jpg|png))$', views.serve_image)
```

ç¸½è¨ˆï¼š5 å€‹ï¼ˆ6%ï¼‰

### é·ç§»å·¥ä½œé‡

| é¡åˆ¥ | æ•¸é‡ | é›£åº¦ | é è¨ˆæ™‚é–“ |
|------|------|------|----------|
| ç°¡å–®è·¯å¾‘ | 67 | ä½ | 30 minï¼ˆå¯è‡ªå‹•åŒ–ï¼‰ |
| å¸¶åƒæ•¸è·¯å¾‘ | 15 | ä¸­ | 20 min |
| è¤‡é›œæ­£å‰‡ | 5 | ä¸­ | 15 min |
| **ç¸½è¨ˆ** | **87** | - | **65 min** |

### è‡ªå‹•åŒ–å»ºè­°

å¯ä»¥ä½¿ç”¨ `django-upgrade` è‡ªå‹•è™•ç† 90% çš„æƒ…æ³ï¼š

```bash
pip install django-upgrade
django-upgrade --target-version 4.2 apps/*/urls.py config/urls.py
```

å‰©é¤˜ 10% éœ€è¦äººå·¥æª¢æŸ¥ã€‚
```

**æª¢æŸ¥é»**ï¼š
- [ ] æ‰¾å‡ºæ‰€æœ‰ä½¿ç”¨èˆŠ API çš„æ–‡ä»¶
- [ ] æŒ‰è¤‡é›œåº¦åˆ†é¡
- [ ] è©•ä¼°äº†å·¥ä½œé‡
- [ ] ç¢ºå®šäº†è‡ªå‹•åŒ–ç­–ç•¥

---

#### æ­¥é©Ÿ 2ï¼šæƒæ ORM æ¨¡å‹å•é¡Œ

```bash
/grep "ForeignKey\(" --type py -C 3

æç¤ºè©ï¼š
è«‹æ‰¾å‡ºæ‰€æœ‰ç¼ºå°‘ on_delete åƒæ•¸çš„ ForeignKey å®šç¾©ï¼š

1. æƒææ‰€æœ‰ models.py æ–‡ä»¶
2. æ‰¾å‡º ForeignKey å’Œ OneToOneField å®šç¾©
3. æª¢æŸ¥æ˜¯å¦åŒ…å« on_delete åƒæ•¸
4. çµ±è¨ˆéœ€è¦æ·»åŠ  on_delete çš„æ•¸é‡

å°æ¯å€‹å¤–éµåˆ†ææ‡‰è©²ä½¿ç”¨å“ªç¨® on_deleteï¼š
- CASCADEï¼šç´šè¯åˆªé™¤
- PROTECTï¼šé˜²æ­¢åˆªé™¤
- SET_NULLï¼šè¨­ç‚º NULL
- SET_DEFAULTï¼šè¨­ç‚ºé»˜èªå€¼
```

**é æœŸè¼¸å‡º**ï¼š

```markdown
## ORM æ¨¡å‹æƒæå ±å‘Š

### ç¼ºå°‘ on_delete çš„å¤–éµï¼ˆ34 è™•ï¼‰

#### é«˜å„ªå…ˆï¼ˆæ ¸å¿ƒæ¥­å‹™æ¨¡å‹ï¼‰

apps/orders/models.py:23
```python
class Order(models.Model):
    user = models.ForeignKey(User)  # âŒ ç¼ºå°‘ on_delete
    # å»ºè­°ï¼šCASCADEï¼ˆåˆªé™¤ç”¨æˆ¶æ™‚åˆªé™¤è¨‚å–®ï¼‰
```

apps/orders/models.py:34
```python
class OrderItem(models.Model):
    order = models.ForeignKey(Order)  # âŒ ç¼ºå°‘ on_delete
    product = models.ForeignKey('products.Product')  # âŒ
    # å»ºè­°ï¼šorder â†’ CASCADEï¼Œproduct â†’ PROTECT
```

apps/payments/models.py:15
```python
class Payment(models.Model):
    order = models.ForeignKey('orders.Order')  # âŒ
    # å»ºè­°ï¼šPROTECTï¼ˆæœ‰æ”¯ä»˜è¨˜éŒ„çš„è¨‚å–®ä¸èƒ½åˆªé™¤ï¼‰
```

#### ä¸­å„ªå…ˆï¼ˆè¼”åŠ©æ¨¡å‹ï¼‰

apps/products/models.py:45
```python
class ProductImage(models.Model):
    product = models.ForeignKey(Product)  # âŒ
    # å»ºè­°ï¼šCASCADEï¼ˆåˆªé™¤å•†å“æ™‚åˆªé™¤åœ–ç‰‡ï¼‰
```

### on_delete é¸æ“‡æŒ‡å—

| å ´æ™¯ | æ¨è–¦å€¼ | åŸå›  |
|------|--------|------|
| OrderItem â†’ Order | CASCADE | è¨‚å–®åˆªé™¤æ™‚ï¼Œè¨‚å–®é …ä¹Ÿæ‡‰åˆªé™¤ |
| Order â†’ User | CASCADE | ç”¨æˆ¶åˆªé™¤æ™‚ï¼Œè¨‚å–®ä¹Ÿåˆªé™¤ |
| Payment â†’ Order | PROTECT | æœ‰æ”¯ä»˜è¨˜éŒ„çš„è¨‚å–®ä¸èƒ½åˆªé™¤ |
| Product â†’ Category | SET_NULL | åˆ†é¡åˆªé™¤æ™‚ï¼Œå•†å“ä¿ç•™ä½†åˆ†é¡æ¸…ç©º |
| OrderItem â†’ Product | PROTECT | æœ‰è¨‚å–®çš„å•†å“ä¸èƒ½åˆªé™¤ |

### é·ç§»è¨ˆåŠƒ

1. **å…ˆæ·»åŠ ï¼Œå¾Œæ¸¬è©¦**ï¼ˆä¸è¦ç›´æ¥åˆªé™¤èˆŠä»£ç¢¼ï¼‰
2. **æŒ‰æ¥­å‹™å„ªå…ˆç´š**ï¼šOrders â†’ Payments â†’ Products â†’ Others
3. **æ¯å€‹ app ä¸€å€‹ migration**
4. **å……åˆ†æ¸¬è©¦åˆªé™¤è¡Œç‚º**

### ç¤ºä¾‹é·ç§»

```python
# apps/orders/models.py

class Order(models.Model):
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,  # æ–°å¢
        related_name='orders'
    )

class OrderItem(models.Model):
    order = models.ForeignKey(
        Order,
        on_delete=models.CASCADE,  # è¨‚å–®åˆªé™¤æ™‚ç´šè¯åˆªé™¤
        related_name='items'
    )
    product = models.ForeignKey(
        'products.Product',
        on_delete=models.PROTECT,  # é˜²æ­¢åˆªé™¤æœ‰è¨‚å–®çš„å•†å“
        related_name='order_items'
    )
```

### é¢¨éšªæç¤º âš ï¸

**é‡è¦**ï¼šon_delete è¡Œç‚ºæœƒå½±éŸ¿æ•¸æ“šå®Œæ•´æ€§ï¼

- CASCADEï¼šå¯èƒ½æ„å¤–åˆªé™¤å¤§é‡æ•¸æ“š
- PROTECTï¼šå¯èƒ½å°è‡´ç„¡æ³•åˆªé™¤ï¼ˆéœ€è¦æ¥­å‹™ç¢ºèªï¼‰
- SET_NULLï¼šç¢ºä¿å­—æ®µå…è¨± NULL

**å»ºè­°**ï¼šåœ¨æ¸¬è©¦ç’°å¢ƒå…ˆåŸ·è¡Œåˆªé™¤æ“ä½œæ¸¬è©¦ã€‚
```

**æª¢æŸ¥é»**ï¼š
- [ ] æ‰¾å‡ºæ‰€æœ‰ç¼ºå°‘ on_delete çš„å¤–éµ
- [ ] ç‚ºæ¯å€‹å¤–éµé¸æ“‡äº†åˆé©çš„ on_delete
- [ ] ç†è§£äº†å„ç¨® on_delete çš„å½±éŸ¿
- [ ] è©•ä¼°äº†æ•¸æ“šé¢¨éšª

---

#### æ­¥é©Ÿ 3ï¼šæƒæå…¶ä»–å»¢æ£„ API

```bash
/grep "force_text\|smart_text\|ugettext" --type py

æç¤ºè©ï¼š
è«‹æ‰¾å‡ºä»¥ä¸‹å»¢æ£„ API çš„ä½¿ç”¨ï¼š

1. django.utils.encoding.force_text â†’ force_str
2. django.utils.encoding.smart_text â†’ smart_str
3. django.utils.translation.ugettext â†’ gettext
4. django.contrib.postgres.fields.JSONField â†’ django.db.models.JSONField

çµ±è¨ˆæ¯ç¨® API çš„ä½¿ç”¨æ¬¡æ•¸å’Œä½ç½®ã€‚
```

**é æœŸè¼¸å‡º**ï¼š

```markdown
## å»¢æ£„ API ä½¿ç”¨çµ±è¨ˆ

### 1. force_text â†’ force_strï¼ˆ23 è™•ï¼‰

apps/core/utils.py:12, 34, 56
apps/accounts/views.py:89
apps/products/serializers.py:23, 45
...

**æ‰¹é‡æ›¿æ›å‘½ä»¤**ï¼š
```bash
find . -name "*.py" -exec sed -i 's/force_text/force_str/g' {} \;
find . -name "*.py" -exec sed -i 's/from django.utils.encoding import force_text/from django.utils.encoding import force_str/g' {} \;
```

### 2. JSONField å°å…¥è·¯å¾‘è®Šæ›´ï¼ˆ8 è™•ï¼‰

apps/products/models.py:3
apps/orders/models.py:5

**ä¿®æ”¹**ï¼š
```python
# èˆŠ
from django.contrib.postgres.fields import JSONField

# æ–°
from django.db.models import JSONField
```

### 3. ugettext â†’ gettextï¼ˆ34 è™•ï¼‰

ä¸»è¦åœ¨ç¿»è­¯å­—ç¬¦ä¸²ï¼š

```python
# èˆŠ
from django.utils.translation import ugettext as _

# æ–°
from django.utils.translation import gettext as _
```

**æ‰¹é‡æ›¿æ›**ï¼š
```bash
find . -name "*.py" -exec sed -i 's/ugettext/gettext/g' {} \;
```

### é·ç§»å„ªå…ˆç´š

ğŸ”´ **é«˜å„ªå…ˆï¼ˆé˜»å¡å‡ç´šï¼‰**ï¼š
- ForeignKey on_deleteï¼ˆ34 è™•ï¼‰
- URL é…ç½®ï¼ˆ87 è™•ï¼‰

ğŸŸ¡ **ä¸­å„ªå…ˆï¼ˆæœ‰è­¦å‘Šï¼‰**ï¼š
- force_text â†’ force_strï¼ˆ23 è™•ï¼‰
- JSONField å°å…¥ï¼ˆ8 è™•ï¼‰

ğŸŸ¢ **ä½å„ªå…ˆï¼ˆå‘å¾Œå…¼å®¹ï¼‰**ï¼š
- ugettext â†’ gettextï¼ˆ34 è™•ï¼‰
- å¯ä»¥å‡ç´šå¾Œå†æ…¢æ…¢æ”¹
```

**æª¢æŸ¥é»**ï¼š
- [ ] æƒæäº†æ‰€æœ‰å»¢æ£„ API
- [ ] çµ±è¨ˆäº†ä½¿ç”¨æ¬¡æ•¸
- [ ] è©•ä¼°äº†é·ç§»å„ªå…ˆç´š
- [ ] æº–å‚™äº†æ‰¹é‡æ›¿æ›å‘½ä»¤

---

### éšæ®µäºŒï¼šåˆ¶å®šé·ç§»è¨ˆåŠƒï¼ˆ20 åˆ†é˜ï¼‰

**ç›®æ¨™**ï¼šåˆ¶å®šå®‰å…¨ã€å¯åŸ·è¡Œçš„å‡ç´šè¨ˆåŠƒ

```bash
æç¤ºè©ï¼š
åŸºæ–¼ä»¥ä¸Šæƒæçµæœï¼Œè«‹åˆ¶å®šè©³ç´°çš„ Django å‡ç´šè¨ˆåŠƒï¼š

1. åˆ†éšæ®µåŸ·è¡Œï¼ˆæ¯å€‹éšæ®µå¯ç¨ç«‹æ¸¬è©¦ï¼‰
2. è™•ç†ä¾è³´é †åºï¼ˆå…ˆè§£æ±ºé˜»å¡å•é¡Œï¼‰
3. æ¸¬è©¦ç­–ç•¥ï¼ˆå–®å…ƒæ¸¬è©¦ã€é›†æˆæ¸¬è©¦ã€æ‰‹å‹•æ¸¬è©¦ï¼‰
4. å›æ»¾æ–¹æ¡ˆï¼ˆå¦‚æœå‡ç´šå¤±æ•—ï¼‰
5. éƒ¨ç½²ç­–ç•¥ï¼ˆè—ç¶ éƒ¨ç½²ï¼Ÿé‡‘çµ²é›€ï¼Ÿï¼‰

æ™‚é–“é ç®—ï¼š2-3 å¤©ï¼ˆåŒ…å«æ¸¬è©¦ï¼‰
```

**é æœŸè¨ˆåŠƒ**ï¼š

```markdown
## Django 2.2 â†’ 4.2 å‡ç´šåŸ·è¡Œè¨ˆåŠƒ

### Phase 0ï¼šæº–å‚™å·¥ä½œï¼ˆåŠå¤©ï¼‰

#### 0.1 å‚™ä»½èˆ‡ç’°å¢ƒæº–å‚™
- [ ] å‚™ä»½ç”Ÿç”¢æ•¸æ“šåº«
- [ ] å‰µå»ºå‡ç´šåˆ†æ”¯ï¼š`git checkout -b upgrade/django-4.2`
- [ ] è¨­ç½® Django 3.2 æ¸¬è©¦ç’°å¢ƒï¼ˆä¸­é–“ç‰ˆæœ¬ï¼Œæ¸›å°‘è·¨åº¦ï¼‰

#### 0.2 è£œå……æ¸¬è©¦
- [ ] ç‚ºæ ¸å¿ƒåŠŸèƒ½æ·»åŠ é›†æˆæ¸¬è©¦
- [ ] è¨˜éŒ„ç•¶å‰æ¸¬è©¦è¦†è“‹ç‡ï¼ˆåŸºæº–ï¼‰
- [ ] ç‚º ORM æ“ä½œæ·»åŠ åˆªé™¤è¡Œç‚ºæ¸¬è©¦

```bash
# é‹è¡Œæ¸¬è©¦ç¢ºä¿ç•¶å‰ç‰ˆæœ¬æ­£å¸¸
pytest tests/ -v --cov=apps
```

#### 0.3 ä¾è³´æª¢æŸ¥
```bash
# æª¢æŸ¥ç¬¬ä¸‰æ–¹åŒ…å…¼å®¹æ€§
pip list --outdated
# é—œéµåŒ…ï¼šdjangorestframework, celery, channels, etc.
```

---

### Phase 1ï¼šä»£ç¢¼é·ç§»ï¼ˆ1 å¤©ï¼‰

#### 1.1 URL é…ç½®é·ç§»ï¼ˆ2 å°æ™‚ï¼‰

**å·¥å…·**ï¼šä½¿ç”¨ `django-upgrade` è‡ªå‹•åŒ–

```bash
# å®‰è£å·¥å…·
pip install django-upgrade

# è‡ªå‹•å‡ç´š URL é…ç½®
django-upgrade --target-version 4.2 \
    config/urls.py \
    apps/*/urls.py

# æ‰‹å‹•æª¢æŸ¥è¤‡é›œæ­£å‰‡ï¼ˆ5 å€‹ï¼‰
```

**é©—è­‰**ï¼š
```bash
python manage.py check --deploy
```

**æäº¤**ï¼š
```bash
git add -A
git commit -m "refactor(urls): migrate to Django 4.2 path() syntax"
```

#### 1.2 ORM æ¨¡å‹é·ç§»ï¼ˆ3 å°æ™‚ï¼‰

**åŸ·è¡Œé †åº**ï¼š
1. Orders appï¼ˆæ ¸å¿ƒæ¥­å‹™ï¼‰
2. Payments appï¼ˆä¾è³´ Ordersï¼‰
3. Products app
4. Accounts app
5. å…¶ä»– apps

**ç¤ºä¾‹**ï¼š

```python
# apps/orders/models.py

class Order(models.Model):
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='orders'
    )
    # ...

# ç”Ÿæˆ migration
python manage.py makemigrations orders

# æª¢æŸ¥ migration SQL
python manage.py sqlmigrate orders 0XXX

# åœ¨æ¸¬è©¦ç’°å¢ƒåŸ·è¡Œ
python manage.py migrate --database=test_db
```

**æ¸¬è©¦åˆªé™¤è¡Œç‚º**ï¼š
```python
# tests/test_deletion_behavior.py

def test_delete_user_cascades_to_orders():
    """æ¸¬è©¦åˆªé™¤ç”¨æˆ¶æ™‚è¨‚å–®ä¹Ÿè¢«åˆªé™¤"""
    user = User.objects.create(username='test')
    order = Order.objects.create(user=user)

    user.delete()

    assert Order.objects.filter(id=order.id).count() == 0

def test_cannot_delete_product_with_orders():
    """æ¸¬è©¦ç„¡æ³•åˆªé™¤æœ‰è¨‚å–®çš„å•†å“"""
    product = Product.objects.create(name='Test')
    order = Order.objects.create(...)
    OrderItem.objects.create(order=order, product=product)

    with pytest.raises(ProtectedError):
        product.delete()
```

**æäº¤**ï¼šæ¯å€‹ app ä¸€å€‹ commit

#### 1.3 å»¢æ£„ API æ›¿æ›ï¼ˆ1 å°æ™‚ï¼‰

**æ‰¹é‡æ›¿æ›**ï¼š

```bash
# force_text â†’ force_str
find apps/ -name "*.py" -type f -exec sed -i 's/force_text/force_str/g' {} \;
find apps/ -name "*.py" -type f -exec sed -i 's/smart_text/smart_str/g' {} \;

# JSONField å°å…¥è·¯å¾‘
find apps/ -name "*.py" -type f -exec sed -i \
    's/from django.contrib.postgres.fields import JSONField/from django.db.models import JSONField/g' {} \;

# ç¿»è­¯å‡½æ•¸
find apps/ -name "*.py" -type f -exec sed -i 's/ugettext/gettext/g' {} \;
```

**é©—è­‰**ï¼š
```bash
# æª¢æŸ¥èªæ³•éŒ¯èª¤
python -m py_compile apps/**/*.py

# é‹è¡Œæ¸¬è©¦
pytest tests/ -v
```

**æäº¤**ï¼š
```bash
git commit -m "refactor: replace deprecated Django APIs"
```

#### 1.4 Middleware é·ç§»ï¼ˆ1 å°æ™‚ï¼‰

å¦‚æœæœ‰è‡ªå®šç¾© middlewareï¼š

```python
# èˆŠæ ¼å¼
class OldMiddleware:
    def process_request(self, request):
        pass

# æ–°æ ¼å¼
class NewMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        # process_request logic
        response = self.get_response(request)
        # process_response logic
        return response
```

---

### Phase 2ï¼šå‡ç´š Django ç‰ˆæœ¬ï¼ˆ2 å°æ™‚ï¼‰

#### 2.1 å…ˆå‡ç´šåˆ° Django 3.2ï¼ˆä¸­é–“ç‰ˆæœ¬ï¼‰

```bash
# requirements.txt
Django==3.2.20  # LTS ç‰ˆæœ¬

# å®‰è£
pip install -r requirements.txt

# é‹è¡Œæ¸¬è©¦
pytest tests/ -v
```

**ç‚ºä»€éº¼å…ˆå‡ç´šåˆ° 3.2ï¼Ÿ**
- æ¸›å°‘è·¨åº¦ï¼Œé™ä½é¢¨éšª
- 3.2 ä¹Ÿæ˜¯ LTSï¼Œå¦‚æœ 4.2 æœ‰å•é¡Œå¯ä»¥åœç•™åœ¨ 3.2

#### 2.2 å†å‡ç´šåˆ° Django 4.2

```bash
# requirements.txt
Django==4.2.5  # æœ€æ–° LTS

# å®‰è£
pip install -r requirements.txt

# é‹è¡Œ check
python manage.py check --deploy

# é‹è¡Œæ¸¬è©¦
pytest tests/ -v --cov=apps

# æ‰‹å‹•æ¸¬è©¦é—œéµåŠŸèƒ½
```

#### 2.3 æ›´æ–°ç¬¬ä¸‰æ–¹ä¾è³´

```bash
# æª¢æŸ¥å…¼å®¹æ€§
pip install django-rest-framework==3.14.0
pip install celery==5.3.1
pip install channels==4.0.0

# æ¸¬è©¦
pytest tests/
```

---

### Phase 3ï¼šæ¸¬è©¦èˆ‡é©—è­‰ï¼ˆåŠå¤©ï¼‰

#### 3.1 è‡ªå‹•åŒ–æ¸¬è©¦

```bash
# å–®å…ƒæ¸¬è©¦
pytest tests/unit/ -v

# é›†æˆæ¸¬è©¦
pytest tests/integration/ -v

# E2E æ¸¬è©¦ï¼ˆé—œéµæ¥­å‹™æµç¨‹ï¼‰
pytest tests/e2e/ -v

# è¦†è“‹ç‡æª¢æŸ¥ï¼ˆä¸æ‡‰ä¸‹é™ï¼‰
pytest --cov=apps --cov-report=html
```

#### 3.2 æ€§èƒ½æ¸¬è©¦

```bash
# æ•¸æ“šåº«æŸ¥è©¢æ€§èƒ½
python manage.py test --debug-sql

# ä½¿ç”¨ django-silk æˆ– django-debug-toolbar æª¢æŸ¥æ…¢æŸ¥è©¢
```

#### 3.3 æ‰‹å‹•æ¸¬è©¦æ¸…å–®

- [ ] ç”¨æˆ¶è¨»å†Š/ç™»å…¥
- [ ] å‰µå»ºè¨‚å–®
- [ ] æ”¯ä»˜æµç¨‹
- [ ] è¨‚å–®æŸ¥è©¢
- [ ] ç®¡ç†å¾Œå°æ“ä½œ
- [ ] API æ¥å£æ¸¬è©¦

---

### Phase 4ï¼šéƒ¨ç½²ä¸Šç·šï¼ˆåŠå¤©ï¼‰

#### 4.1 é ç™¼å¸ƒç’°å¢ƒ

```bash
# éƒ¨ç½²åˆ° staging
git push origin upgrade/django-4.2

# é‹è¡Œ migration
python manage.py migrate

# ç…™éœ§æ¸¬è©¦
curl -X GET https://staging.example.com/api/health/
```

#### 4.2 ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

**ç­–ç•¥**ï¼šè—ç¶ éƒ¨ç½²ï¼ˆé›¶åœæ©Ÿï¼‰

```bash
# 1. éƒ¨ç½²æ–°ç‰ˆæœ¬åˆ°ç¶ è‰²ç’°å¢ƒ
# 2. é‹è¡Œ migrationï¼ˆæ•¸æ“šåº« migration å‘å¾Œå…¼å®¹ï¼‰
# 3. å¥åº·æª¢æŸ¥
# 4. åˆ‡æ›æµé‡ï¼ˆ10% â†’ 50% â†’ 100%ï¼‰
# 5. ç›£æ§éŒ¯èª¤ç‡
# 6. å¦‚æœæœ‰å•é¡Œï¼Œç«‹å³å›æ»¾
```

**ç›£æ§æŒ‡æ¨™**ï¼š
- éŒ¯èª¤ç‡ï¼ˆ< 0.1%ï¼‰
- éŸ¿æ‡‰æ™‚é–“ï¼ˆ< 500ms p95ï¼‰
- æ•¸æ“šåº«é€£æ¥æ•¸ï¼ˆæ­£å¸¸ç¯„åœï¼‰

#### 4.3 å›æ»¾é æ¡ˆ

å¦‚æœå‡ç´šå¤±æ•—ï¼š

```bash
# 1. åˆ‡æ›æµé‡å›è—è‰²ç’°å¢ƒ
# 2. å›æ»¾æ•¸æ“šåº« migrationï¼ˆå¦‚æœæœ‰ï¼‰
python manage.py migrate orders 0XXX  # å›åˆ°ä¹‹å‰çš„ migration

# 3. å›æ»¾ä»£ç¢¼
git revert <commit-hash>
```

---

### é©—è­‰æ¸…å–®

æ¯å€‹ Phase å®Œæˆå¾Œæª¢æŸ¥ï¼š

- [ ] æ‰€æœ‰è‡ªå‹•åŒ–æ¸¬è©¦é€šé
- [ ] ä»£ç¢¼ç„¡èªæ³•éŒ¯èª¤
- [ ] `python manage.py check --deploy` ç„¡è­¦å‘Š
- [ ] Git commit æ­·å²æ¸…æ™°
- [ ] é—œéµåŠŸèƒ½æ‰‹å‹•æ¸¬è©¦é€šé

### æ™‚é–“é ç®—

| Phase | é è¨ˆæ™‚é–“ | ç´¯è¨ˆæ™‚é–“ |
|-------|----------|----------|
| Phase 0 | 4 å°æ™‚ | 4 å°æ™‚ |
| Phase 1 | 7 å°æ™‚ | 11 å°æ™‚ |
| Phase 2 | 2 å°æ™‚ | 13 å°æ™‚ |
| Phase 3 | 4 å°æ™‚ | 17 å°æ™‚ |
| Phase 4 | 4 å°æ™‚ | 21 å°æ™‚ |
| **ç¸½è¨ˆ** | **21 å°æ™‚ï¼ˆç´„ 3 å¤©ï¼‰** | - |

### é¢¨éšªèˆ‡å°ç­–

| é¢¨éšª | æ¦‚ç‡ | å½±éŸ¿ | å°ç­– |
|------|------|------|------|
| ç¬¬ä¸‰æ–¹åŒ…ä¸å…¼å®¹ | ä¸­ | é«˜ | æå‰æª¢æŸ¥ï¼Œå°‹æ‰¾æ›¿ä»£å“ |
| on_delete è¡Œç‚ºæ„å¤– | ä¸­ | é«˜ | å……åˆ†æ¸¬è©¦åˆªé™¤æ“ä½œ |
| æ€§èƒ½ä¸‹é™ | ä½ | ä¸­ | æ€§èƒ½æ¸¬è©¦ï¼Œå„ªåŒ–æ…¢æŸ¥è©¢ |
| éƒ¨ç½²å¤±æ•— | ä½ | é«˜ | è—ç¶ éƒ¨ç½²ï¼Œå¿«é€Ÿå›æ»¾ |
```

**æª¢æŸ¥é»**ï¼š
- [ ] åˆ¶å®šäº†åˆ†éšæ®µè¨ˆåŠƒ
- [ ] è©•ä¼°äº†æ™‚é–“å’Œé¢¨éšª
- [ ] æº–å‚™äº†æ¸¬è©¦ç­–ç•¥
- [ ] è¨­è¨ˆäº†å›æ»¾æ–¹æ¡ˆ

---

### éšæ®µä¸‰ï¼šåŸ·è¡Œé·ç§»ï¼ˆ60 åˆ†é˜ï¼‰

**ç›®æ¨™**ï¼šæŒ‰è¨ˆåŠƒåŸ·è¡Œé·ç§»

**åŸ·è¡Œè¦é»**ï¼š

1. **åš´æ ¼æŒ‰è¨ˆåŠƒåŸ·è¡Œ**ï¼šä¸è¦è·³æ­¥é©Ÿ
2. **é »ç¹æ¸¬è©¦**ï¼šæ¯å€‹ Phase éƒ½é‹è¡Œæ¸¬è©¦
3. **åŠæ™‚æäº¤**ï¼šæ¯å€‹é‚è¼¯å–®å…ƒ commit ä¸€æ¬¡
4. **è¨˜éŒ„å•é¡Œ**ï¼šé‡åˆ°æ„å¤–å•é¡Œè¨˜éŒ„åˆ° CLAUDE.md

**ä½¿ç”¨ Claude è¼”åŠ©**ï¼š

```bash
# ç¤ºä¾‹ï¼šæ‰¹é‡ä¿®æ”¹ ForeignKey

æç¤ºè©ï¼š
è«‹å¹«æˆ‘ç‚º apps/orders/models.py ä¸­çš„æ‰€æœ‰ ForeignKey æ·»åŠ  on_delete åƒæ•¸ï¼š

Order.user â†’ on_delete=models.CASCADE
OrderItem.order â†’ on_delete=models.CASCADE
OrderItem.product â†’ on_delete=models.PROTECT

è¼¸å‡ºä¿®æ”¹å¾Œçš„å®Œæ•´ models.py æ–‡ä»¶ã€‚
```

**æª¢æŸ¥é»**ï¼š
- [ ] å®Œæˆäº†æ‰€æœ‰ä»£ç¢¼ä¿®æ”¹
- [ ] æ¯æ­¥éƒ½é‹è¡Œäº†æ¸¬è©¦
- [ ] Git æ­·å²æ¸…æ™°
- [ ] åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

### éšæ®µå››ï¼šé©—è­‰èˆ‡è¨˜éŒ„ï¼ˆ10 åˆ†é˜ï¼‰

**ç›®æ¨™**ï¼šç¢ºèªå‡ç´šæˆåŠŸï¼Œæ²‰æ¾±ç¶“é©—

#### æœ€çµ‚é©—è­‰

```bash
# å®Œæ•´æ¸¬è©¦å¥—ä»¶
pytest tests/ -v --cov=apps

# Django check
python manage.py check --deploy

# æ‰‹å‹•æ¸¬è©¦é—œéµæµç¨‹
# ...
```

#### ç”Ÿæˆå‡ç´šå ±å‘Š

```bash
æç¤ºè©ï¼š
è«‹ç”Ÿæˆä¸€ä»½ Django å‡ç´šå ±å‘Šï¼ŒåŒ…å«ï¼š

1. å‡ç´šå‰å¾Œç‰ˆæœ¬å°æ¯”
2. ä¿®æ”¹çµ±è¨ˆï¼ˆå¤šå°‘æ–‡ä»¶ã€å¤šå°‘è¡Œï¼‰
3. ä¸»è¦è®Šæ›´åˆ—è¡¨
4. é‡åˆ°çš„å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ
5. æ€§èƒ½å°æ¯”ï¼ˆå¦‚æœæœ‰æ•¸æ“šï¼‰
6. å¾ŒçºŒå„ªåŒ–å»ºè­°
```

#### æ²‰æ¾±åˆ°è¨˜æ†¶åº«

```bash
/memory save

ä¸»é¡Œï¼šDjango å¤§ç‰ˆæœ¬å‡ç´šæœ€ä½³å¯¦è¸ï¼ˆ2.2 â†’ 4.2ï¼‰

é—œéµæ­¥é©Ÿï¼š
1. æƒæèˆ‡è©•ä¼°ï¼ˆ/grep æ‰¹é‡æŸ¥æ‰¾ï¼‰
   - URL é…ç½®ï¼šdjango.conf.urls.url
   - ORM å¤–éµï¼šForeignKey.*on_delete
   - å»¢æ£„ APIï¼šforce_text, ugettext, JSONField
   - çµ±è¨ˆå½±éŸ¿ç¯„åœå’Œå·¥ä½œé‡

2. åˆ¶å®šåˆ†éšæ®µè¨ˆåŠƒ
   - Phase 0: æº–å‚™ï¼ˆå‚™ä»½ã€æ¸¬è©¦ã€ä¾è³´æª¢æŸ¥ï¼‰
   - Phase 1: ä»£ç¢¼é·ç§»ï¼ˆURLã€Modelsã€APIï¼‰
   - Phase 2: å‡ç´šç‰ˆæœ¬ï¼ˆ3.2 â†’ 4.2 åˆ†æ­¥ï¼‰
   - Phase 3: æ¸¬è©¦é©—è­‰
   - Phase 4: éƒ¨ç½²ä¸Šç·š

3. å®‰å…¨é·ç§»ç­–ç•¥
   - å…ˆä¸­é–“ç‰ˆæœ¬ï¼ˆ2.2 â†’ 3.2 â†’ 4.2ï¼‰é™ä½é¢¨éšª
   - æ¯å€‹ app å–®ç¨ migration
   - å……åˆ†æ¸¬è©¦åˆªé™¤è¡Œç‚ºï¼ˆon_deleteï¼‰
   - è—ç¶ éƒ¨ç½²ï¼Œå¿«é€Ÿå›æ»¾

4. è‡ªå‹•åŒ–å·¥å…·
   - django-upgradeï¼šè‡ªå‹•é‡å¯«ä»£ç¢¼
   - sedï¼šæ‰¹é‡æ–‡æœ¬æ›¿æ›
   - pytestï¼šè‡ªå‹•åŒ–æ¸¬è©¦
   - coverageï¼šè¦†è“‹ç‡æª¢æŸ¥

5. é—œéµ Breaking Changes
   - URL: url() â†’ path() / re_path()
   - ORM: on_delete æˆç‚ºå¿…å¡«
   - API: force_text â†’ force_str
   - Middleware: æ–°æ ¼å¼è¦æ±‚

å¸¸ç”¨æŸ¥æ‰¾å‘½ä»¤ï¼š
- URL é…ç½®ï¼š/grep "from django.conf.urls import url" --type py
- ç¼ºå°‘ on_deleteï¼š/grep "ForeignKey\(" --type py -C 3
- å»¢æ£„ APIï¼š/grep "force_text\|ugettext" --type py

é¢¨éšªæ§åˆ¶ï¼š
- å‚™ä»½æ•¸æ“šåº«ï¼ˆå¯å›æ»¾ï¼‰
- åˆ†éšæ®µåŸ·è¡Œï¼ˆå¯æ¸¬è©¦ï¼‰
- è—ç¶ éƒ¨ç½²ï¼ˆå¯åˆ‡æ›ï¼‰
- ç›£æ§æŒ‡æ¨™ï¼ˆå¯è§€å¯Ÿï¼‰

æ™‚é–“é ç®—ï¼š
- å°é …ç›®ï¼ˆ< 10k è¡Œï¼‰ï¼š1 å¤©
- ä¸­é …ç›®ï¼ˆ10k-50k è¡Œï¼‰ï¼š2-3 å¤©
- å¤§é …ç›®ï¼ˆ> 50k è¡Œï¼‰ï¼š1-2 é€±

ç›¸é—œå·¥å…·ï¼šdjango-upgrade, pytest, coverage, django-silk
ç›¸é—œæŒ‡ä»¤ï¼š/grepï¼ˆæŸ¥æ‰¾å»¢æ£„ APIï¼‰ï¼Œ/readï¼ˆç†è§£è®Šæ›´ï¼‰
```

**æª¢æŸ¥é»**ï¼š
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] Django 4.2 é‹è¡Œæ­£å¸¸
- [ ] ç”Ÿæˆäº†å‡ç´šå ±å‘Š
- [ ] æ²‰æ¾±äº†ç¶“é©—åˆ° /memory

---

## é©—è­‰æ¨™æº–

### å¿…é ˆé”æˆ âœ…

- [ ] æˆåŠŸå°‡ Django å¾ 2.2 å‡ç´šåˆ° 4.2
- [ ] æ‰€æœ‰ URL é…ç½®é·ç§»åˆ°æ–°èªæ³•
- [ ] æ‰€æœ‰ ForeignKey æ·»åŠ äº† on_delete
- [ ] æ‰€æœ‰å»¢æ£„ API å·²æ›¿æ›
- [ ] æ‰€æœ‰æ¸¬è©¦é€šéï¼Œè¦†è“‹ç‡æœªä¸‹é™
- [ ] é—œéµåŠŸèƒ½æ‰‹å‹•æ¸¬è©¦é€šé
- [ ] ä½¿ç”¨ /memory æ²‰æ¾±äº†å‡ç´šç¶“é©—

### é¡å¤–æˆå°± ğŸŒŸ

- [ ] ä½¿ç”¨è‡ªå‹•åŒ–å·¥å…·ï¼ˆdjango-upgradeï¼‰
- [ ] ç‚º on_delete è¡Œç‚ºè£œå……äº†æ¸¬è©¦
- [ ] å‡ç´šäº†æ‰€æœ‰ç¬¬ä¸‰æ–¹ä¾è³´åˆ°æœ€æ–°å…¼å®¹ç‰ˆæœ¬
- [ ] å¯¦ç¾äº†è—ç¶ éƒ¨ç½²
- [ ] ç·¨å¯«äº†å‡ç´šæ–‡æª”ä¾›åœ˜éšŠåƒè€ƒ
- [ ] è¨­ç½®äº†ä¾è³´ç‰ˆæœ¬ç›£æ§ï¼ˆå®šæœŸæª¢æŸ¥æ›´æ–°ï¼‰

---

## å­¸ç¿’åæ€

### åæ€å•é¡Œ

1. **è¦åŠƒçš„é‡è¦æ€§**ï¼š
   - ç‚ºä»€éº¼å¤§ç‰ˆæœ¬å‡ç´šéœ€è¦è©³ç´°è¨ˆåŠƒï¼Ÿ
   - å¦‚ä½•è©•ä¼° breaking changes çš„å½±éŸ¿ç¯„åœï¼Ÿ
   - åˆ†éšæ®µåŸ·è¡Œçš„å¥½è™•æ˜¯ä»€éº¼ï¼Ÿ

2. **é¢¨éšªæ§åˆ¶**ï¼š
   - on_delete åƒæ•¸ç‚ºä»€éº¼æ˜¯é«˜é¢¨éšªè®Šæ›´ï¼Ÿ
   - å¦‚ä½•åœ¨ä¸å½±éŸ¿ç”Ÿç”¢çš„å‰æä¸‹æ¸¬è©¦åˆªé™¤è¡Œç‚ºï¼Ÿ
   - è—ç¶ éƒ¨ç½²ç›¸æ¯”ç›´æ¥å‡ç´šæœ‰ä»€éº¼å„ªå‹¢ï¼Ÿ

3. **è‡ªå‹•åŒ–å·¥å…·**ï¼š
   - django-upgrade èƒ½è™•ç†å¤šå°‘æ¯”ä¾‹çš„é·ç§»ï¼Ÿ
   - å“ªäº›æƒ…æ³å¿…é ˆäººå·¥åˆ¤æ–·ï¼Ÿ
   - å¦‚ä½•é©—è­‰è‡ªå‹•åŒ–å·¥å…·çš„æ­£ç¢ºæ€§ï¼Ÿ

4. **æŠ€è¡“å‚µå‹™**ï¼š
   - ç‚ºä»€éº¼è¦åŠæ™‚å‡ç´šæ¡†æ¶ç‰ˆæœ¬ï¼Ÿ
   - å¦‚ä½•å¹³è¡¡æ–°åŠŸèƒ½é–‹ç™¼èˆ‡æŠ€è¡“å‡ç´šï¼Ÿ
   - å¦‚ä½•èªªæœç®¡ç†å±¤æŠ•å…¥æ™‚é–“åšå‡ç´šï¼Ÿ

### å»¶ä¼¸ç·´ç¿’

1. **ç·¨å¯«è‡ªå‹•åŒ–å‡ç´šè…³æœ¬**ï¼š
   - è‡ªå‹•æª¢æ¸¬å»¢æ£„ API
   - ç”Ÿæˆå‡ç´šå ±å‘Š
   - æä¾›ä¿®å¾©å»ºè­°

2. **å»ºç«‹ä¾è³´ç®¡ç†æµç¨‹**ï¼š
   - å®šæœŸæª¢æŸ¥ä¾è³´æ›´æ–°ï¼ˆdependabotï¼‰
   - è‡ªå‹•é‹è¡Œå®‰å…¨æƒæï¼ˆsafety, banditï¼‰
   - è¨­ç½® CI æ¸¬è©¦å¤šç‰ˆæœ¬å…¼å®¹æ€§

3. **è™•ç†æ›´è¤‡é›œçš„å‡ç´š**ï¼š
   - Python 2 â†’ Python 3
   - PostgreSQL å¤§ç‰ˆæœ¬å‡ç´š
   - Redis é›†ç¾¤å‡ç´š

---

## ç›¸é—œè³‡æº

### ä¸‹ä¸€æ­¥å­¸ç¿’

- **C09**ï¼šæ€§èƒ½ç“¶é ¸å„ªåŒ– - ä½¿ç”¨ /grep æ‰¾æ…¢æŸ¥è©¢
- **C10**ï¼šéŒ¯èª¤è™•ç†å¢å¼· - ç³»çµ±åŒ–æ”¹é€²
- **æ¨¡çµ„ 4**ï¼šCI/CD é›†æˆ - è‡ªå‹•åŒ–æ¸¬è©¦èˆ‡éƒ¨ç½²

### å·¥å…·åƒè€ƒ

- **django-upgrade**ï¼šè‡ªå‹•å‡ç´š Django ä»£ç¢¼
- **pip-tools**ï¼šä¾è³´ç®¡ç†
- **safety**ï¼šå®‰å…¨æ¼æ´æƒæ
- **dependabot**ï¼šè‡ªå‹•ä¾è³´æ›´æ–°
- **django-silk**ï¼šæ€§èƒ½åˆ†æ

### å­¸ç¿’è³‡æº

- **Django Release Notes**ï¼šå®˜æ–¹å‡ç´šæŒ‡å—
- **Django Deprecation Timeline**ï¼šå»¢æ£„æ™‚é–“è¡¨
- **Django Best Practices**
- **ã€ŠTwo Scoops of Djangoã€‹**

---

**å»ºè­°å®Œæˆæ™‚é–“**ï¼š2-2.5 å°æ™‚ï¼ˆå¯¦éš›é …ç›®éœ€ 2-3 å¤©ï¼‰
**é›£åº¦è©•ä¼°**ï¼š4/5
**é‡è¦åº¦**ï¼š5/5ï¼ˆæ¡†æ¶å‡ç´šæ˜¯å¿…é ˆçš„ç¶­è­·å·¥ä½œï¼‰
**å¯è¤‡ç”¨æ€§**ï¼š5/5ï¼ˆæ–¹æ³•é©ç”¨æ–¼ä»»ä½•æ¡†æ¶å‡ç´šï¼‰
