# C04ï¼šåŠŸèƒ½æ¨¡çµ„æå–ï¼ˆçµ„åˆç´šï¼‰

## æƒ…å¢ƒè³‡è¨Š

**ç·¨è™Ÿ**ï¼šC04
**é›£åº¦**ï¼šâ­â­â­â­â˜†ï¼ˆçµ„åˆç´šï¼‰
**é è¨ˆæ™‚é–“**ï¼š2 å°æ™‚
**å­¸ç¿’ç›®æ¨™**ï¼š
- æŒæ¡å¾å–®é«”æ‡‰ç”¨æå–æ¨¡çµ„çš„ç³»çµ±åŒ–æ–¹æ³•
- ç†Ÿç·´ä½¿ç”¨ /glob å’Œ /grep è­˜åˆ¥æ¨¡çµ„é‚Šç•Œ
- å­¸æœƒä½¿ç”¨ /read åˆ†æä¾è³´é—œä¿‚
- ç†è§£å¦‚ä½•ä½¿ç”¨ CLAUDE.md è¨˜éŒ„é‡æ§‹æ¨¡å¼
- å»ºç«‹å®‰å…¨çš„æ¨¡çµ„æå–æµç¨‹

**é©ç”¨å°è±¡**ï¼š
- å®Œæˆæ¨¡çµ„ 2 åŸºç¤ç†è«–
- æœ‰é‡æ§‹ç¶“é©—
- éœ€è¦è™•ç†å¾®æœå‹™æ‹†åˆ†çš„é–‹ç™¼è€…

---

## æƒ…å¢ƒæè¿°

### èƒŒæ™¯

ä½ çš„å…¬å¸é‹ç‡Ÿä¸€å€‹é›»å•†å¹³å°ï¼Œæœ€åˆæ˜¯å€‹ç°¡å–®çš„ Node.js å–®é«”æ‡‰ç”¨ã€‚ç¶“é 3 å¹´ç™¼å±•ï¼Œç¨‹å¼ç¢¼å·²ç¶“è®Šå¾—é¾å¤§ä¸”é›£ä»¥ç¶­è­·ï¼š

```
Current Problems:
- 120,000 lines of code in one repo
- 25 developers working on same codebase
- Deployment takes 45 minutes
- One bug in checkout can break entire site
- Payment processing coupled with everything
```

æŠ€è¡“ä¸»ç®¡æ±ºå®šå°‡æ”¯ä»˜è™•ç†æ¨¡çµ„æå–æˆç¨ç«‹çš„å¾®æœå‹™ã€‚ä½ è¢«åˆ†é…åˆ°é€™å€‹ä»»å‹™ã€‚

### ç¾æœ‰æ¶æ§‹

```
monolith-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ products.js       # ç”¢å“è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ orders.js         # è¨‚å–®è·¯ç”±ï¼ˆä½¿ç”¨æ”¯ä»˜ï¼‰
â”‚   â”‚   â”œâ”€â”€ users.js          # ç”¨æˆ¶è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ payments.js       # æ”¯ä»˜è·¯ç”±ï¼ˆè¦æå–ï¼‰
â”‚   â”‚   â””â”€â”€ admin.js          # ç®¡ç†å¾Œå°ï¼ˆä½¿ç”¨æ”¯ä»˜ï¼‰
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ ProductService.js
â”‚   â”‚   â”œâ”€â”€ OrderService.js   # ä¾è³´æ”¯ä»˜
â”‚   â”‚   â”œâ”€â”€ PaymentService.js # è¦æå–
â”‚   â”‚   â”œâ”€â”€ RefundService.js  # è¦æå–
â”‚   â”‚   â”œâ”€â”€ UserService.js
â”‚   â”‚   â””â”€â”€ NotificationService.js  # ä¾è³´æ”¯ä»˜
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ Product.js
â”‚   â”‚   â”œâ”€â”€ Order.js          # åŒ…å«æ”¯ä»˜è³‡æ–™
â”‚   â”‚   â”œâ”€â”€ Payment.js        # è¦æå–
â”‚   â”‚   â”œâ”€â”€ Refund.js         # è¦æå–
â”‚   â”‚   â””â”€â”€ User.js
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ validators.js     # åŒ…å«æ”¯ä»˜é©—è­‰
â”‚   â”‚   â”œâ”€â”€ formatters.js     # åŒ…å«æ”¯ä»˜æ ¼å¼åŒ–
â”‚   â”‚   â””â”€â”€ encryption.js     # æ”¯ä»˜åŠ å¯†ï¼ˆè¦æå–ï¼‰
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ payment-validation.js  # è¦æå–
â”‚   â”‚   â””â”€â”€ rate-limit.js
â”‚   â””â”€â”€ database/
â”‚       â”œâ”€â”€ migrations/       # åŒ…å«æ”¯ä»˜ç›¸é—œè¡¨
â”‚       â””â”€â”€ seeders/
â””â”€â”€ tests/

Total: 287 files, 120,000 lines
```

### ç›®æ¨™æ¶æ§‹

```
# æå–å¾Œ

## Monolith (ä¸»æ‡‰ç”¨)
monolith-app/
â””â”€â”€ src/
    â”œâ”€â”€ routes/
    â”‚   â”œâ”€â”€ products.js
    â”‚   â”œâ”€â”€ orders.js       # æ”¹ç‚ºå‘¼å« Payment Service API
    â”‚   â””â”€â”€ users.js
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ OrderService.js # ç§»é™¤æ”¯ä»˜é‚è¼¯ï¼Œæ”¹å‘¼å« API
    â”‚   â””â”€â”€ ...
    â””â”€â”€ clients/
        â””â”€â”€ PaymentClient.js  # æ–°å¢ï¼šå‘¼å« Payment Service

## Payment Service (æ–°å¾®æœå‹™)
payment-service/
â””â”€â”€ src/
    â”œâ”€â”€ routes/
    â”‚   â””â”€â”€ payments.js      # å¾ monolith ç§»å‹•éä¾†
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ PaymentService.js
    â”‚   â””â”€â”€ RefundService.js
    â”œâ”€â”€ models/
    â”‚   â”œâ”€â”€ Payment.js
    â”‚   â””â”€â”€ Refund.js
    â”œâ”€â”€ utils/
    â”‚   â”œâ”€â”€ payment-validators.js
    â”‚   â””â”€â”€ encryption.js
    â””â”€â”€ database/
        â””â”€â”€ migrations/
```

### ä½ çš„ä»»å‹™

1. **è­˜åˆ¥é‚Šç•Œ**ï¼šæ‰¾å‡ºæ‰€æœ‰èˆ‡æ”¯ä»˜ç›¸é—œçš„ç¨‹å¼ç¢¼
2. **åˆ†æä¾è³´**ï¼šç†è§£æ”¯ä»˜æ¨¡çµ„èˆ‡å…¶ä»–æ¨¡çµ„çš„ä¾è³´é—œä¿‚
3. **æå–ç¨‹å¼ç¢¼**ï¼šå°‡æ”¯ä»˜ç›¸é—œç¨‹å¼ç¢¼ç§»åˆ°æ–°å°ˆæ¡ˆ
4. **å»ºç«‹ API å±¤**ï¼šåœ¨å–®é«”æ‡‰ç”¨ä¸­å»ºç«‹ Payment Client
5. **æ¸¬è©¦é©—è­‰**ï¼šç¢ºä¿åŠŸèƒ½ä¸å—å½±éŸ¿

### é™åˆ¶æ¢ä»¶

- ä¸èƒ½ç ´å£ç¾æœ‰åŠŸèƒ½
- éœ€è¦æ”¯æ´é€æ­¥é·ç§»ï¼ˆå–®é«”å’Œå¾®æœå‹™å…±å­˜ï¼‰
- è³‡æ–™åº«é·ç§»éœ€è¦é›¶åœæ©Ÿ
- å¿…é ˆä¿æŒå‘å¾Œå…¼å®¹
- éœ€è¦å®Œæ•´çš„ä¾è³´åˆ†æ

---

## å­¸ç¿’é‡é»

1. **æ¨¡çµ„é‚Šç•Œè­˜åˆ¥**
   - å¦‚ä½•æ‰¾å‡ºæ‰€æœ‰ç›¸é—œæª”æ¡ˆï¼Ÿ
   - å¦‚ä½•è­˜åˆ¥éš±è—çš„ä¾è³´ï¼Ÿ

2. **ä¾è³´é—œä¿‚åˆ†æ**
   - å¦‚ä½•ç¹ªè£½ä¾è³´åœ–ï¼Ÿ
   - å¦‚ä½•è™•ç†å¾ªç’°ä¾è³´ï¼Ÿ

3. **å®‰å…¨æå–ç­–ç•¥**
   - å¦‚ä½•ç¢ºä¿ä¸éºæ¼ï¼Ÿ
   - å¦‚ä½•æ”¯æ´é€æ­¥é·ç§»ï¼Ÿ

4. **çŸ¥è­˜æ²‰æ¾±**
   - å¦‚ä½•è¨˜éŒ„æå–æ¨¡å¼ï¼Ÿ
   - å¦‚ä½•è®“ä¸‹æ¬¡æå–æ›´å®¹æ˜“ï¼Ÿ

---

## å»ºè­°è§£æ±ºæµç¨‹

### éšæ®µä¸€ï¼šå…¨é¢æƒæèˆ‡é‚Šç•Œè­˜åˆ¥ï¼ˆ30 åˆ†é˜ï¼‰

**ç›®æ¨™**ï¼šæ‰¾å‡ºæ‰€æœ‰èˆ‡æ”¯ä»˜ç›¸é—œçš„æª”æ¡ˆå’Œç¨‹å¼ç¢¼

**æ­¥é©Ÿ**ï¼š

1. **æœå°‹æ”¯ä»˜ç›¸é—œçš„æª”æ¡ˆ**
```bash
# æœå°‹æª”æ¡ˆåç¨±åŒ…å« payment çš„æª”æ¡ˆ
/glob "**/*payment*.js"
/glob "**/*refund*.js"

# é æœŸçµæœ
Found:
- src/routes/payments.js
- src/services/PaymentService.js
- src/services/RefundService.js
- src/models/Payment.js
- src/models/Refund.js
- src/middleware/payment-validation.js
- tests/payment.test.js
- tests/refund.test.js
```

2. **æœå°‹ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨æ”¯ä»˜çš„åœ°æ–¹**
```bash
# æœå°‹ import/require PaymentService
/grep "PaymentService" --type js

# æœå°‹æ”¯ä»˜ç›¸é—œçš„æ–¹æ³•å‘¼å«
/grep "\.charge\|\.refund\|\.processPayment" src/ --type js -i

# æœå°‹æ”¯ä»˜ç›¸é—œçš„è³‡æ–™åº«æŸ¥è©¢
/grep "payments\.|Payment\.find" src/ --type js -i
```

**é æœŸç™¼ç¾**ï¼š
```
Imports of PaymentService found in:
- src/services/OrderService.js (5 uses)
- src/routes/orders.js (2 uses)
- src/routes/admin.js (3 uses)
- src/services/NotificationService.js (1 use)

Database queries found in:
- src/services/OrderService.js
- src/routes/admin.js
- src/services/AnalyticsService.js
```

3. **å»ºç«‹åˆæ­¥æ¸…å–®**
```bash
# è«‹ Claude æ•´ç†æˆçµæ§‹åŒ–æ¸…å–®
è«‹å°‡æœå°‹çµæœæ•´ç†æˆä»¥ä¸‹æ ¼å¼ï¼š

1. æ ¸å¿ƒæ”¯ä»˜æª”æ¡ˆï¼ˆè¦å®Œæ•´ç§»å‹•ï¼‰
   - routes/
   - services/
   - models/
   - middleware/

2. éƒ¨åˆ†æ”¯ä»˜é‚è¼¯ï¼ˆéœ€è¦é‡æ§‹ï¼‰
   - OrderService.jsï¼ˆä½¿ç”¨ PaymentServiceï¼‰
   - NotificationService.jsï¼ˆç›£è½æ”¯ä»˜äº‹ä»¶ï¼‰

3. å·¥å…·å‡½æ•¸ï¼ˆéœ€è¦åˆ¤æ–·ï¼‰
   - validators.jsï¼ˆå¯èƒ½åŒ…å«æ”¯ä»˜å’Œå…¶ä»–é©—è­‰ï¼‰
   - formatters.jsï¼ˆå¯èƒ½åŒ…å«æ”¯ä»˜å’Œå…¶ä»–æ ¼å¼åŒ–ï¼‰
   - encryption.jsï¼ˆå°ˆé–€ç”¨æ–¼æ”¯ä»˜ï¼Œæ‡‰è©²ç§»å‹•ï¼‰

4. è³‡æ–™åº«ç›¸é—œ
   - migrations/ï¼ˆéœ€è¦åˆ†æå“ªäº›å±¬æ–¼æ”¯ä»˜ï¼‰
   - seeders/
```

**Claude ç”¢ç”Ÿçš„æ¸…å–®**ï¼š
```markdown
# æ”¯ä»˜æ¨¡çµ„æå–æ¸…å–®

## ğŸ”´ Tier 1ï¼šæ ¸å¿ƒæ”¯ä»˜æª”æ¡ˆï¼ˆ100% ç§»å‹•ï¼‰

### Routes (2 files)
- [ ] src/routes/payments.js (347 lines)
- [ ] src/routes/refunds.js (189 lines)

### Services (3 files)
- [ ] src/services/PaymentService.js (562 lines)
  - Dependencies: PaymentGateway, encryption, validators
- [ ] src/services/RefundService.js (234 lines)
  - Dependencies: PaymentService
- [ ] src/services/PaymentGateway.js (421 lines)
  - External: Stripe API

### Models (2 files)
- [ ] src/models/Payment.js (156 lines)
- [ ] src/models/Refund.js (98 lines)

### Middleware (1 file)
- [ ] src/middleware/payment-validation.js (134 lines)

### Utils (1 file)
- [ ] src/utils/encryption.js (78 lines) - åªç”¨æ–¼æ”¯ä»˜

**å°è¨ˆï¼š9 files, ~2,219 lines**

## ğŸŸ¡ Tier 2ï¼šéƒ¨åˆ†ä¾è³´æª”æ¡ˆï¼ˆéœ€è¦é‡æ§‹ï¼‰

### ä¾è³´æ”¯ä»˜çš„æœå‹™
- [ ] src/services/OrderService.js
  - ä¾è³´ï¼šPaymentService.charge() (5 calls)
  - å‹•ä½œï¼šæ”¹ç‚ºå‘¼å« Payment API

- [ ] src/services/NotificationService.js
  - ä¾è³´ï¼šç›£è½æ”¯ä»˜äº‹ä»¶
  - å‹•ä½œï¼šæ”¹ç‚ºç›£è½ Payment Service webhook

- [ ] src/routes/orders.js
  - ä¾è³´ï¼šç›´æ¥å‘¼å« PaymentService (2 calls)
  - å‹•ä½œï¼šæ”¹ç‚ºä½¿ç”¨ OrderServiceï¼ˆå·²ç¶“æœƒå‘¼å« Payment APIï¼‰

- [ ] src/routes/admin.js
  - ä¾è³´ï¼šè®€å–æ”¯ä»˜çµ±è¨ˆ (3 queries)
  - å‹•ä½œï¼šæ”¹ç‚ºå‘¼å« Payment API

### æ··åˆå·¥å…·å‡½æ•¸
- [ ] src/utils/validators.js
  - åŒ…å«ï¼šæ”¯ä»˜é©—è­‰ + å…¶ä»–é©—è­‰
  - å‹•ä½œï¼šæå–æ”¯ä»˜é©—è­‰åˆ° payment-serviceï¼Œä¿ç•™å…¶ä»–

- [ ] src/utils/formatters.js
  - åŒ…å«ï¼šé‡‘é¡æ ¼å¼åŒ– + å…¶ä»–æ ¼å¼åŒ–
  - å‹•ä½œï¼šæå–é‡‘é¡æ ¼å¼åŒ–åˆ° payment-serviceï¼Œä¿ç•™å…¶ä»–

**å°è¨ˆï¼š6 files, éƒ¨åˆ†ä¿®æ”¹**

## ğŸŸ¢ Tier 3ï¼šè³‡æ–™åº«ç›¸é—œ

### Migrations
- [ ] 20230101_create_payments_table.js (ç§»å‹•)
- [ ] 20230115_create_refunds_table.js (ç§»å‹•)
- [ ] 20230302_add_order_payment_relation.js (éœ€è¦åˆ†æ)

### Seeders
- [ ] payments.seed.js (ç§»å‹•)

## ğŸ“Š çµ±è¨ˆ

- å®Œæ•´ç§»å‹•ï¼š9 files, 2,219 lines
- éƒ¨åˆ†ä¿®æ”¹ï¼š6 files
- è³‡æ–™åº«ï¼š4 migrations, 1 seeder
- ç¸½å½±éŸ¿ï¼š19 files
```

4. **è¨˜éŒ„åˆ° CLAUDE.md**
```bash
# å»ºç«‹å°ˆæ¡ˆå°ˆå±¬çš„ CLAUDE.md
è«‹å¹«æˆ‘å»ºç«‹ CLAUDE.mdï¼Œè¨˜éŒ„æ”¯ä»˜æ¨¡çµ„çš„é‚Šç•Œå®šç¾©å’Œæå–ç­–ç•¥ã€‚
```

**ç”¢ç”Ÿçš„ CLAUDE.md**ï¼š
```markdown
# Payment Module Extraction Guide

## Module Boundary Definition

### What belongs to Payment Service?
- All payment processing logic
- Refund processing
- Payment gateway integrations (Stripe, PayPal)
- Payment-specific validations and encryption
- Payment and Refund models

### What stays in Monolith?
- Order management (calls Payment API)
- User management
- Product catalog
- General-purpose utilities (non-payment validators, formatters)

### Gray Areas (Requires Discussion)
- Payment-related analytics (read-only queries)
- Notification for payment events (webhook?)

## Extraction Strategy

1. Phase 1: Create Payment Service skeleton
2. Phase 2: Move core files (Tier 1)
3. Phase 3: Refactor dependent files (Tier 2)
4. Phase 4: Database migration
5. Phase 5: Gradual traffic cutover

## Dependencies Map

```
PaymentService
  â”œâ”€ Used by: OrderService (charge on order creation)
  â”œâ”€ Used by: RefundService (charge reversals)
  â”œâ”€ Used by: NotificationService (payment events)
  â””â”€ Used by: Admin routes (payment analytics)

  Dependencies:
  â”œâ”€ PaymentGateway â†’ Stripe API (external)
  â”œâ”€ encryption utility
  â””â”€ payment validators
```

## API Contract

### Endpoints to expose
- POST /api/payments
- POST /api/refunds
- GET /api/payments/:id
- GET /api/payments/orders/:orderId

### Webhooks
- POST /webhooks/payment-completed
- POST /webhooks/payment-failed
- POST /webhooks/refund-processed
```

**è‡ªç„¶å­¸åˆ°çš„æ–¹æ³•**ï¼š
- ç‚ºä»€éº¼è¦åˆ†å±¤ï¼ˆTier 1/2/3ï¼‰ï¼Ÿå› ç‚ºå¯ä»¥è¦åŠƒå„ªå…ˆç´š
- ç‚ºä»€éº¼è¦çµ±è¨ˆè¡Œæ•¸ï¼Ÿå› ç‚ºå¯ä»¥ä¼°ç®—å·¥ä½œé‡
- ç‚ºä»€éº¼å¯« CLAUDE.mdï¼Ÿå› ç‚ºå¯ä»¥è®“ AI ç†è§£å°ˆæ¡ˆè„ˆçµ¡

**æª¢æŸ¥é»**ï¼š
- [ ] æ‰¾å‡ºæ‰€æœ‰æ ¸å¿ƒæ”¯ä»˜æª”æ¡ˆï¼ˆTier 1ï¼‰
- [ ] è­˜åˆ¥æ‰€æœ‰ä¾è³´ï¼ˆTier 2ï¼‰
- [ ] åˆ†æè³‡æ–™åº«å½±éŸ¿ï¼ˆTier 3ï¼‰
- [ ] å»ºç«‹å®Œæ•´æ¸…å–®
- [ ] å»ºç«‹ CLAUDE.md è¨˜éŒ„é‚Šç•Œ

---

### éšæ®µäºŒï¼šä¾è³´é—œä¿‚æ·±å…¥åˆ†æï¼ˆ30 åˆ†é˜ï¼‰

**ç›®æ¨™**ï¼šç†è§£æ¯å€‹ä¾è³´çš„å…·é«”ç´°ç¯€ï¼Œé¿å…éºæ¼

**æ­¥é©Ÿ**ï¼š

1. **åˆ†æ OrderService çš„ä¾è³´**
```bash
/read src/services/OrderService.js
```

**ç™¼ç¾çš„ä¾è³´**ï¼š
```javascript
// src/services/OrderService.js

const PaymentService = require('./PaymentService');

class OrderService {
  async createOrder(userId, items) {
    // 1. å»ºç«‹è¨‚å–®è¨˜éŒ„
    const order = await Order.create({ userId, items, status: 'pending' });

    try {
      // 2. å‘¼å«æ”¯ä»˜æœå‹™ï¼ˆâŒ ç·Šè€¦åˆï¼‰
      const payment = await PaymentService.charge({
        orderId: order.id,
        amount: order.total,
        userId: userId
      });

      // 3. æ›´æ–°è¨‚å–®ç‹€æ…‹
      order.paymentId = payment.id;
      order.status = 'paid';
      await order.save();

      return order;
    } catch (error) {
      // 4. æ”¯ä»˜å¤±æ•—è™•ç†
      order.status = 'payment_failed';
      await order.save();
      throw error;
    }
  }

  async getOrderWithPayment(orderId) {
    const order = await Order.findById(orderId);

    // âŒ ç›´æ¥æŸ¥è©¢æ”¯ä»˜è³‡æ–™
    const payment = await Payment.findOne({ orderId });

    return { ...order, payment };
  }
}
```

**åˆ†æ**ï¼š
```bash
# è«‹ Claude åˆ†æä¸¦å»ºè­°é‡æ§‹æ–¹æ¡ˆ
é€™å€‹ OrderService å¦‚ä½•ä¾è³´ PaymentServiceï¼Ÿ
æä¾›é‡æ§‹å»ºè­°ï¼Œä½¿å…¶é€šé API å‘¼å«è€Œéç›´æ¥ä¾è³´ã€‚
```

**Claude çš„é‡æ§‹å»ºè­°**ï¼š
```javascript
// é‡æ§‹å¾Œçš„ OrderService

const PaymentClient = require('../clients/PaymentClient');

class OrderService {
  constructor(paymentClient = new PaymentClient()) {
    this.paymentClient = paymentClient;
  }

  async createOrder(userId, items) {
    const order = await Order.create({ userId, items, status: 'pending' });

    try {
      // âœ… é€šé API å‘¼å«
      const payment = await this.paymentClient.charge({
        orderId: order.id,
        amount: order.total,
        userId: userId
      });

      order.paymentId = payment.id;
      order.status = 'paid';
      await order.save();

      return order;
    } catch (error) {
      order.status = 'payment_failed';
      await order.save();
      throw error;
    }
  }

  async getOrderWithPayment(orderId) {
    const order = await Order.findById(orderId);

    // âœ… é€šé API å–å¾—æ”¯ä»˜è³‡æ–™
    const payment = await this.paymentClient.getPayment(order.paymentId);

    return { ...order, payment };
  }
}
```

2. **åˆ†æå·¥å…·å‡½æ•¸çš„æ··åˆä½¿ç”¨**
```bash
/read src/utils/validators.js
```

**ç™¼ç¾**ï¼š
```javascript
// src/utils/validators.jsï¼ˆæ··åˆï¼‰

module.exports = {
  // æ”¯ä»˜ç›¸é—œï¼ˆè¦æå–ï¼‰
  validateCardNumber: (cardNumber) => { ... },
  validateCVV: (cvv) => { ... },
  validateAmount: (amount) => { ... },

  // ä¸€èˆ¬é©—è­‰ï¼ˆä¿ç•™ï¼‰
  validateEmail: (email) => { ... },
  validatePhone: (phone) => { ... },
  validatePostalCode: (code) => { ... }
};
```

**é‡æ§‹ç­–ç•¥**ï¼š
```bash
# è«‹ Claude å»ºè­°å¦‚ä½•åˆ†é›¢
é€™å€‹æª”æ¡ˆåŒ…å«æ”¯ä»˜å’Œä¸€èˆ¬é©—è­‰ï¼Œå¦‚ä½•åˆ†é›¢ï¼Ÿ
```

**Claude çš„å»ºè­°**ï¼š
```javascript
// monolith-app/src/utils/validators.jsï¼ˆä¿ç•™ä¸€èˆ¬é©—è­‰ï¼‰
module.exports = {
  validateEmail: (email) => { ... },
  validatePhone: (phone) => { ... },
  validatePostalCode: (code) => { ... }
};

// payment-service/src/utils/validators.jsï¼ˆæ”¯ä»˜é©—è­‰ï¼‰
module.exports = {
  validateCardNumber: (cardNumber) => { ... },
  validateCVV: (cvv) => { ... },
  validateAmount: (amount) => { ... }
};
```

3. **æœå°‹éš±è—çš„ä¾è³´**
```bash
# æœå°‹å¯èƒ½è¢«å¿½ç•¥çš„ä¾è³´

# æœå°‹äº‹ä»¶ç›£è½
/grep "payment.*event\|on.*payment" src/ --type js -i

# æœå°‹ç›´æ¥çš„è³‡æ–™åº«æŸ¥è©¢
/grep "Payment\.find\|payments\." src/ --type js -i

# æœå°‹é…ç½®ä¾è³´
/grep "STRIPE\|PAYMENT" --type js -i
```

**å¯èƒ½ç™¼ç¾çš„éš±è—ä¾è³´**ï¼š
```javascript
// src/services/AnalyticsService.jsï¼ˆå®¹æ˜“éºæ¼ï¼‰
class AnalyticsService {
  async getRevenue() {
    // âŒ ç›´æ¥æŸ¥è©¢æ”¯ä»˜è¡¨
    return await Payment.aggregate([
      { $group: { _id: null, total: { $sum: '$amount' } } }
    ]);
  }
}

// src/config/stripe.jsï¼ˆé…ç½®ï¼‰
module.exports = {
  apiKey: process.env.STRIPE_API_KEY,  // è¦ç§»åˆ° payment-service
  webhook: process.env.STRIPE_WEBHOOK_SECRET
};

// src/jobs/reconciliation.jsï¼ˆæ’ç¨‹ä»»å‹™ï¼‰
// æ¯æ—¥å°å¸³ä»»å‹™ï¼Œç›´æ¥è®€å–æ”¯ä»˜è³‡æ–™
```

4. **ç¹ªè£½å®Œæ•´ä¾è³´åœ–**
```bash
è«‹åŸºæ–¼ä»¥ä¸Šåˆ†æï¼Œç¹ªè£½å®Œæ•´çš„ä¾è³´é—œä¿‚åœ–ï¼ŒåŒ…æ‹¬ï¼š
1. PaymentService è¢«èª°ä½¿ç”¨
2. PaymentService ä½¿ç”¨äº†ä»€éº¼
3. éš±è—ä¾è³´
4. éœ€è¦å»ºç«‹çš„æ–° API
```

**Claude ç”¢ç”Ÿçš„ä¾è³´åœ–**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Monolith Dependencies                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OrderService â”€â”€â”€â”€â”€â”€â”
                   â”‚
NotificationServiceâ”‚â”€â”€â”€â”€ PaymentService â”€â”€â”€â”€ PaymentGateway â”€â”€â”€â”€ Stripe API
                   â”‚           â”‚                    (external)
Admin Routes â”€â”€â”€â”€â”€â”€â”˜           â”œâ”€â”€â”€ Payment Model
                               â”œâ”€â”€â”€ encryption utils
AnalyticsService â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                               â””â”€â”€â”€ payment validators
Reconciliation Job â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        After Extraction (Target State)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
OrderService        â”‚  Payment Service API â”‚
NotificationService â”‚                      â”‚
Admin Routes    â”€â”€â”€â”€â”¤  GET /payments/:id   â”‚
AnalyticsService    â”‚  POST /payments      â”‚
Reconciliation  â”€â”€â”€â”€â”¤  POST /refunds       â”‚
                    â”‚  GET /analytics      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Payment Service   â”‚
                    â”‚ (Microservice)    â”‚
                    â”‚                   â”‚
                    â”‚ - PaymentService  â”‚
                    â”‚ - RefundService   â”‚
                    â”‚ - Models          â”‚
                    â”‚ - Validators      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¨˜æ†¶æ²‰æ¾±**ï¼š
```bash
/memory save

ä¸»é¡Œï¼šæ¨¡çµ„æå–ä¾è³´åˆ†ææ–¹æ³•

ä¸‰å±¤ä¾è³´æœå°‹ç­–ç•¥ï¼š

1ï¸âƒ£ æ˜é¡¯ä¾è³´ï¼ˆå®¹æ˜“æ‰¾ï¼‰
- import/require èªå¥
- ç›´æ¥æ–¹æ³•å‘¼å«
- /grep "PaymentService" å³å¯æ‰¾åˆ°

2ï¸âƒ£ è³‡æ–™å±¤ä¾è³´ï¼ˆå¸¸è¢«å¿½ç•¥ï¼‰
- ç›´æ¥çš„è³‡æ–™åº«æŸ¥è©¢ï¼ˆPayment.findï¼‰
- ORM é—œè¯ï¼ˆorder.paymentï¼‰
- è³‡æ–™åº« JOIN
- /grep "Payment\.find\|payments\." æœå°‹

3ï¸âƒ£ éš±è—ä¾è³´ï¼ˆæœ€å®¹æ˜“éºæ¼ï¼‰
- äº‹ä»¶ç›£è½ï¼ˆpayment.on('charged')ï¼‰
- æ’ç¨‹ä»»å‹™ï¼ˆcron jobsï¼‰
- é…ç½®ä¾è³´ï¼ˆSTRIPE_API_KEYï¼‰
- åˆ†æå ±è¡¨ï¼ˆç›´æ¥æŸ¥è©¢ï¼‰
- /grep "payment.*event\|PAYMENT" æœå°‹

é‡æ§‹æ¨¡å¼ï¼š
- ç›´æ¥å‘¼å« â†’ API å‘¼å«ï¼ˆPaymentClientï¼‰
- ç›´æ¥æŸ¥è©¢ â†’ API ç«¯é»
- æ··åˆå·¥å…·å‡½æ•¸ â†’ åˆ†é›¢åˆ°å„æœå‹™
- äº‹ä»¶ç›£è½ â†’ Webhook

å·¥å…·çµ„åˆï¼š
- /globï¼šæ‰¾æª”æ¡ˆ
- /grepï¼šæ‰¾ç¨‹å¼ç¢¼å¼•ç”¨
- /readï¼šç†è§£é‚è¼¯
- CLAUDE.mdï¼šè¨˜éŒ„é‚Šç•Œå®šç¾©
```

**æª¢æŸ¥é»**ï¼š
- [ ] åˆ†ææ‰€æœ‰æœå‹™å±¤ä¾è³´
- [ ] è­˜åˆ¥æ··åˆå·¥å…·å‡½æ•¸
- [ ] ç™¼ç¾éš±è—ä¾è³´
- [ ] ç¹ªè£½å®Œæ•´ä¾è³´åœ–
- [ ] ä½¿ç”¨ /memory è¨˜éŒ„æ–¹æ³•

---

### éšæ®µä¸‰ï¼šå»ºç«‹ Payment Service éª¨æ¶ï¼ˆ20 åˆ†é˜ï¼‰

**ç›®æ¨™**ï¼šå»ºç«‹æ–°çš„å¾®æœå‹™å°ˆæ¡ˆçµæ§‹

**æ­¥é©Ÿ**ï¼š

1. **å»ºç«‹å°ˆæ¡ˆçµæ§‹**
```bash
mkdir payment-service
cd payment-service

# è«‹ Claude å¹«å¿™å»ºç«‹æ¨™æº– Node.js å¾®æœå‹™çµæ§‹
è«‹å»ºç«‹ä¸€å€‹æ¨™æº–çš„ Express.js å¾®æœå‹™çµæ§‹ï¼ŒåŒ…å«ï¼š
- src/ (routes, services, models, utils, middleware)
- tests/
- config/
- package.json
- Dockerfile
- README.md
```

2. **ç§»å‹•æ ¸å¿ƒæª”æ¡ˆ**
```bash
# è¤‡è£½ï¼ˆä¸æ˜¯ç§»å‹•ï¼Œå…ˆä¿æŒé›™ä»½ï¼‰æ ¸å¿ƒæ”¯ä»˜æª”æ¡ˆ

# Routes
cp ../monolith-app/src/routes/payments.js ./src/routes/
cp ../monolith-app/src/routes/refunds.js ./src/routes/

# Services
cp ../monolith-app/src/services/PaymentService.js ./src/services/
cp ../monolith-app/src/services/RefundService.js ./src/services/
cp ../monolith-app/src/services/PaymentGateway.js ./src/services/

# Models
cp ../monolith-app/src/models/Payment.js ./src/models/
cp ../monolith-app/src/models/Refund.js ./src/models/

# Utils
cp ../monolith-app/src/utils/encryption.js ./src/utils/
# å¾ validators.js æå–æ”¯ä»˜é©—è­‰ï¼ˆæ‰‹å‹•ï¼‰

# Middleware
cp ../monolith-app/src/middleware/payment-validation.js ./src/middleware/
```

3. **ä¿®å¾©å¼•ç”¨è·¯å¾‘**
```bash
# åœ¨ payment-service ä¸­ï¼Œä¿®å¾©æ‰€æœ‰ import è·¯å¾‘
/grep "require\(.*\.\./\.\./\)" src/ --type js

# è«‹ Claude å¹«å¿™ä¿®å¾©
è«‹ä¿®å¾©æ‰€æœ‰ require è·¯å¾‘ï¼Œå› ç‚ºæª”æ¡ˆçµæ§‹æ”¹è®Šäº†ã€‚
```

4. **å»ºç«‹ API ç«¯é»**
```bash
/read src/routes/payments.js

# è«‹æ±‚ä¿®æ”¹
è«‹å°‡é€™å€‹ Express route æ”¹é€ æˆ RESTful APIï¼Œä¸¦æ·»åŠ ï¼š
1. API ç‰ˆæœ¬å‰ç¶´ (/api/v1)
2. é©ç•¶çš„éŒ¯èª¤è™•ç†
3. è«‹æ±‚é©—è­‰
4. å›æ‡‰æ ¼å¼æ¨™æº–åŒ–
```

**æª¢æŸ¥é»**ï¼š
- [ ] Payment Service å°ˆæ¡ˆçµæ§‹å»ºç«‹
- [ ] æ ¸å¿ƒæª”æ¡ˆå·²è¤‡è£½
- [ ] å¼•ç”¨è·¯å¾‘å·²ä¿®å¾©
- [ ] API ç«¯é»å·²å»ºç«‹

---

### éšæ®µå››ï¼šå»ºç«‹ API Client å±¤ï¼ˆ20 åˆ†é˜ï¼‰

**ç›®æ¨™**ï¼šåœ¨å–®é«”æ‡‰ç”¨ä¸­å»ºç«‹ Payment API å®¢æˆ¶ç«¯

**æ­¥é©Ÿ**ï¼š

1. **å»ºç«‹ PaymentClient**
```bash
# åœ¨ monolith-app ä¸­å»ºç«‹
# monolith-app/src/clients/PaymentClient.js

è«‹å»ºç«‹ä¸€å€‹ PaymentClient é¡åˆ¥ï¼Œå°è£æ‰€æœ‰å° Payment Service çš„ HTTP å‘¼å«ã€‚

æ–¹æ³•éœ€è¦åŒ…å«ï¼š
- charge(data): å»ºç«‹æ”¯ä»˜
- refund(paymentId, amount): é€€æ¬¾
- getPayment(paymentId): å–å¾—æ”¯ä»˜è³‡è¨Š
- getPaymentsByOrder(orderId): å–å¾—è¨‚å–®çš„æ‰€æœ‰æ”¯ä»˜

ä½¿ç”¨ axios æˆ– fetchï¼ŒåŒ…å«ï¼š
- éŒ¯èª¤è™•ç†
- Retry æ©Ÿåˆ¶
- Timeout è¨­å®š
- æ—¥èªŒè¨˜éŒ„
```

**ç”¢ç”Ÿçš„ PaymentClient**ï¼š
```javascript
// monolith-app/src/clients/PaymentClient.js

const axios = require('axios');
const logger = require('../utils/logger');

class PaymentClient {
  constructor() {
    this.baseURL = process.env.PAYMENT_SERVICE_URL || 'http://localhost:3001';
    this.timeout = 5000;
    this.client = axios.create({
      baseURL: this.baseURL,
      timeout: this.timeout,
      headers: {
        'Content-Type': 'application/json'
      }
    });
  }

  async charge(data) {
    try {
      logger.info(`Charging payment for order ${data.orderId}`);

      const response = await this.client.post('/api/v1/payments', data);
      return response.data;
    } catch (error) {
      logger.error(`Payment charge failed: ${error.message}`);
      throw new Error(`Payment service error: ${error.message}`);
    }
  }

  async refund(paymentId, amount) {
    try {
      const response = await this.client.post('/api/v1/refunds', {
        paymentId,
        amount
      });
      return response.data;
    } catch (error) {
      logger.error(`Refund failed: ${error.message}`);
      throw error;
    }
  }

  async getPayment(paymentId) {
    try {
      const response = await this.client.get(`/api/v1/payments/${paymentId}`);
      return response.data;
    } catch (error) {
      logger.error(`Get payment failed: ${error.message}`);
      throw error;
    }
  }

  async getPaymentsByOrder(orderId) {
    try {
      const response = await this.client.get('/api/v1/payments', {
        params: { orderId }
      });
      return response.data;
    } catch (error) {
      logger.error(`Get payments by order failed: ${error.message}`);
      throw error;
    }
  }
}

module.exports = PaymentClient;
```

2. **é‡æ§‹ OrderService ä½¿ç”¨ PaymentClient**
```bash
/read src/services/OrderService.js

# è«‹æ±‚é‡æ§‹
è«‹å°‡é€™å€‹ OrderService é‡æ§‹ï¼Œæ”¹ç‚ºä½¿ç”¨ PaymentClient è€Œéç›´æ¥ä¾è³´ PaymentServiceã€‚
```

**æª¢æŸ¥é»**ï¼š
- [ ] PaymentClient å·²å»ºç«‹
- [ ] åŒ…å«æ‰€æœ‰å¿…è¦æ–¹æ³•
- [ ] åŒ…å«éŒ¯èª¤è™•ç†å’Œ retry
- [ ] OrderService å·²é‡æ§‹ä½¿ç”¨ PaymentClient

---

### éšæ®µäº”ï¼šæ¸¬è©¦èˆ‡é©—è­‰ï¼ˆ20 åˆ†é˜ï¼‰

**ç›®æ¨™**ï¼šç¢ºä¿å…©ç¨®æ¨¡å¼éƒ½èƒ½æ­£å¸¸é‹ä½œ

**æ­¥é©Ÿ**ï¼š

1. **æ¸¬è©¦ Payment Service ç¨ç«‹é‹ä½œ**
```bash
cd payment-service
npm install
npm test

# å•Ÿå‹•æœå‹™
npm start

# æ¸¬è©¦ API
curl -X POST http://localhost:3001/api/v1/payments \
  -H "Content-Type: application/json" \
  -d '{
    "orderId": "ORD-123",
    "amount": 99.99,
    "userId": "user-456"
  }'
```

2. **æ¸¬è©¦å–®é«”æ‡‰ç”¨å‘¼å« Payment Service**
```bash
cd ../monolith-app

# è¨­å®šç’°å¢ƒè®Šæ•¸
export PAYMENT_SERVICE_URL=http://localhost:3001

# åŸ·è¡Œæ¸¬è©¦
npm test -- OrderService

# æ‰‹å‹•æ¸¬è©¦å»ºç«‹è¨‚å–®
npm start
# å»ºç«‹è¨‚å–®ï¼Œç¢ºèªæ”¯ä»˜æµç¨‹æ­£å¸¸
```

3. **é©—è­‰æ²’æœ‰éºæ¼**
```bash
# ç¢ºèªå–®é«”æ‡‰ç”¨ä¸å†ç›´æ¥ä¾è³´ PaymentService
/grep "require.*PaymentService" src/ --type js

# æ‡‰è©²åªæ‰¾åˆ° PaymentClientï¼Œä¸æ‡‰æœ‰ PaymentServiceï¼ˆé™¤äº†è¨»è§£ï¼‰
```

4. **å»ºç«‹é·ç§»æª¢æŸ¥æ¸…å–®**
```bash
è«‹å»ºç«‹ä¸€å€‹æª¢æŸ¥æ¸…å–®ï¼Œç¢ºä¿æå–å®Œæˆä¸”æ²’æœ‰éºæ¼ã€‚
```

**ç”¢ç”Ÿçš„æª¢æŸ¥æ¸…å–®**ï¼š
```markdown
# Payment Module Extraction Checklist

## Phase 1: Preparation âœ…
- [x] Identify all payment-related files
- [x] Analyze dependencies
- [x] Create dependency graph
- [x] Document module boundary in CLAUDE.md

## Phase 2: Payment Service Setup âœ…
- [x] Create payment-service project
- [x] Copy core files (routes, services, models)
- [x] Fix import paths
- [x] Create API endpoints
- [x] Write tests

## Phase 3: Monolith Refactoring âœ…
- [x] Create PaymentClient
- [x] Refactor OrderService
- [x] Refactor Admin routes
- [x] Refactor NotificationService
- [x] Update tests

## Phase 4: Validation
- [ ] Payment Service tests passing
- [ ] Monolith tests passing
- [ ] Integration tests passing
- [ ] No direct PaymentService imports in monolith
- [ ] All payment operations work through API

## Phase 5: Deployment (Future)
- [ ] Database migration strategy
- [ ] Gradual traffic cutover plan
- [ ] Rollback plan
- [ ] Monitoring and alerts
```

**æœ€çµ‚è¨˜æ†¶æ²‰æ¾±**ï¼š
```bash
/memory save

ä¸»é¡Œï¼šåŠŸèƒ½æ¨¡çµ„æå–å®Œæ•´æµç¨‹ï¼ˆå–®é«” â†’ å¾®æœå‹™ï¼‰

5 éšæ®µæå–æµç¨‹ï¼š

éšæ®µ1ï¸âƒ£ï¼šé‚Šç•Œè­˜åˆ¥ï¼ˆ30 minï¼‰
- /glob æ‰¾æ‰€æœ‰ç›¸é—œæª”æ¡ˆ
- /grep æ‰¾æ‰€æœ‰å¼•ç”¨
- åˆ†å±¤ï¼ˆTier 1/2/3ï¼‰
- å»ºç«‹ CLAUDE.md è¨˜éŒ„é‚Šç•Œ
- å·¥å…·ï¼š/glob, /grep, CLAUDE.md

éšæ®µ2ï¸âƒ£ï¼šä¾è³´åˆ†æï¼ˆ30 minï¼‰
- åˆ†ææ¯å€‹ä¾è³´ç´°ç¯€
- è­˜åˆ¥æ··åˆå·¥å…·å‡½æ•¸
- ç™¼ç¾éš±è—ä¾è³´ï¼ˆäº‹ä»¶ã€ä»»å‹™ã€é…ç½®ï¼‰
- ç¹ªè£½ä¾è³´åœ–
- å·¥å…·ï¼š/read, /grep, /memory

éšæ®µ3ï¸âƒ£ï¼šå»ºç«‹æ–°æœå‹™ï¼ˆ20 minï¼‰
- å»ºç«‹å°ˆæ¡ˆçµæ§‹
- è¤‡è£½æ ¸å¿ƒæª”æ¡ˆï¼ˆä¿ç•™é›™ä»½ï¼‰
- ä¿®å¾©å¼•ç”¨è·¯å¾‘
- å»ºç«‹ API ç«¯é»

éšæ®µ4ï¸âƒ£ï¼šå»ºç«‹ Client å±¤ï¼ˆ20 minï¼‰
- å»ºç«‹ API Client é¡åˆ¥
- é‡æ§‹ä¾è³´æœå‹™æ”¹ç”¨ Client
- ç§»é™¤ç›´æ¥ä¾è³´

éšæ®µ5ï¸âƒ£ï¼šæ¸¬è©¦é©—è­‰ï¼ˆ20 minï¼‰
- æ¸¬è©¦æ–°æœå‹™ç¨ç«‹é‹ä½œ
- æ¸¬è©¦å–®é«”å‘¼å«æ–°æœå‹™
- /grep ç¢ºèªç„¡éºæ¼
- å»ºç«‹æª¢æŸ¥æ¸…å–®

é—œéµæˆåŠŸå› ç´ ï¼š
- å®Œæ•´çš„ä¾è³´åˆ†æï¼ˆé¿å…éºæ¼ï¼‰
- ä¿ç•™é›™ä»½ç¨‹å¼ç¢¼ï¼ˆå…ˆä¸åˆªé™¤ï¼‰
- API Client å°è£ï¼ˆéš”é›¢è®Šæ›´ï¼‰
- å……åˆ†æ¸¬è©¦ï¼ˆç¢ºä¿ä¸ç ´å£ï¼‰
- ä½¿ç”¨ CLAUDE.md è¨˜éŒ„é‚Šç•Œ

å¸¸è¦‹é™·é˜±ï¼š
- å¿½ç•¥è³‡æ–™å±¤ä¾è³´
- å¿½ç•¥éš±è—ä¾è³´ï¼ˆäº‹ä»¶ã€ä»»å‹™ï¼‰
- éæ—©åˆªé™¤èˆŠç¨‹å¼ç¢¼
- æ²’æœ‰ API Client å°è£

ç¸½æ™‚é–“ï¼š2 å°æ™‚
æå–è¦æ¨¡ï¼š9 æ ¸å¿ƒæª”æ¡ˆ + 6 é‡æ§‹æª”æ¡ˆ
```

**æª¢æŸ¥é»**ï¼š
- [ ] Payment Service ç¨ç«‹é‹ä½œæ­£å¸¸
- [ ] å–®é«”æ‡‰ç”¨é€šé API å‘¼å«æ­£å¸¸
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] ç„¡ç›´æ¥ä¾è³´éºç•™
- [ ] ä½¿ç”¨ /memory è¨˜éŒ„æµç¨‹

---

## é©—è­‰æ¨™æº–

### å¿…é ˆé”æˆ âœ…

- [ ] ä½¿ç”¨ /glob å’Œ /grep æ‰¾å‡ºæ‰€æœ‰ç›¸é—œæª”æ¡ˆ
- [ ] è­˜åˆ¥ Tier 1/2/3 æª”æ¡ˆä¸¦åˆ†é¡
- [ ] åˆ†ææ‰€æœ‰ä¾è³´é—œä¿‚ï¼ˆåŒ…æ‹¬éš±è—ä¾è³´ï¼‰
- [ ] å»ºç«‹ CLAUDE.md è¨˜éŒ„æ¨¡çµ„é‚Šç•Œ
- [ ] Payment Service ç¨ç«‹é‹ä½œ
- [ ] å»ºç«‹ PaymentClient å°è£ API å‘¼å«
- [ ] é‡æ§‹æ‰€æœ‰ä¾è³´æœå‹™
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] ç„¡ç›´æ¥ PaymentService å¼•ç”¨éºç•™
- [ ] ä½¿ç”¨ /memory è¨˜éŒ„æå–æµç¨‹

### é¡å¤–æˆå°± ğŸŒŸ

- [ ] å»ºç«‹è‡ªå‹•åŒ–è…³æœ¬æƒæä¾è³´
- [ ] å¯¦ä½œ Circuit Breaker æ¨¡å¼
- [ ] æ·»åŠ  API ç‰ˆæœ¬æ§åˆ¶
- [ ] å»ºç«‹å®Œæ•´çš„ API æ–‡æª”
- [ ] å¯¦ä½œè³‡æ–™åº«é·ç§»ç­–ç•¥
- [ ] å»ºç«‹æµé‡é€æ­¥åˆ‡æ›æ©Ÿåˆ¶
- [ ] æ•´ç†æˆåœ˜éšŠçš„ã€Œæ¨¡çµ„æå– SOPã€

---

## å­¸ç¿’åæ€

### åæ€å•é¡Œ

1. **é‚Šç•Œè­˜åˆ¥**ï¼š
   - å¦‚ä½•åˆ¤æ–·ä¸€å€‹æª”æ¡ˆæ˜¯å¦å±¬æ–¼æ”¯ä»˜æ¨¡çµ„ï¼Ÿ
   - æ··åˆå·¥å…·å‡½æ•¸å¦‚ä½•è™•ç†æœ€åˆé©ï¼Ÿ
   - å¦‚ä½•ç¢ºä¿é‚Šç•Œå®šç¾©æ¸…æ™°ï¼Ÿ

2. **ä¾è³´åˆ†æ**ï¼š
   - å“ªäº›ä¾è³´æœ€å®¹æ˜“éºæ¼ï¼Ÿç‚ºä»€éº¼ï¼Ÿ
   - å¦‚ä½•ç³»çµ±åŒ–åœ°ç™¼ç¾éš±è—ä¾è³´ï¼Ÿ
   - å¾ªç’°ä¾è³´å¦‚ä½•è™•ç†ï¼Ÿ

3. **æå–ç­–ç•¥**ï¼š
   - ç‚ºä»€éº¼å…ˆè¤‡è£½è€Œéç§»å‹•ï¼Ÿ
   - API Client çš„åƒ¹å€¼æ˜¯ä»€éº¼ï¼Ÿ
   - å¦‚ä½•å¹³è¡¡é€Ÿåº¦èˆ‡å®Œæ•´æ€§ï¼Ÿ

4. **æ¸¬è©¦é©—è­‰**ï¼š
   - å¦‚ä½•ç¢ºä¿æ²’æœ‰éºæ¼ï¼Ÿ
   - å¦‚ä½•æ¸¬è©¦å…©ç¨®æ¨¡å¼å…±å­˜ï¼Ÿ
   - å›æ»¾è¨ˆåŠƒé‡è¦å—ï¼Ÿ

### å»¶ä¼¸ç·´ç¿’

1. **å®Œå–„é·ç§»**ï¼š
   - å¯¦ä½œè³‡æ–™åº«é·ç§»ï¼ˆæ”¯ä»˜è¡¨åˆ†é›¢ï¼‰
   - å»ºç«‹æµé‡é€æ­¥åˆ‡æ›æ©Ÿåˆ¶
   - å¯¦ä½œ Circuit Breaker

2. **è‡ªå‹•åŒ–å·¥å…·**ï¼š
   - å»ºç«‹è…³æœ¬è‡ªå‹•æƒæä¾è³´
   - å»ºç«‹ä¾è³´é—œä¿‚è¦–è¦ºåŒ–
   - å»ºç«‹é·ç§»é€²åº¦è¿½è¹¤

3. **æå–å…¶ä»–æ¨¡çµ„**ï¼š
   - æ‡‰ç”¨ç›¸åŒæµç¨‹æå–ç”¨æˆ¶æ¨¡çµ„
   - æ‡‰ç”¨ç›¸åŒæµç¨‹æå–é€šçŸ¥æ¨¡çµ„
   - æ•´ç†æˆå¯å¾©ç”¨çš„æµç¨‹

4. **çŸ¥è­˜æ²‰æ¾±**ï¼š
   - æ•´ç†æˆã€Œå¾®æœå‹™æ‹†åˆ† SOPã€
   - å»ºç«‹ä¾è³´åˆ†ææª¢æŸ¥æ¸…å–®
   - åˆ†äº«åˆ°åœ˜éšŠçŸ¥è­˜åº«

---

## ç›¸é—œè³‡æº

### ä¸‹ä¸€æ­¥å­¸ç¿’

- **C05ï¼šå®‰å…¨æ¼æ´ä¿®å¾©** - å­¸ç¿’ç³»çµ±åŒ–å®‰å…¨å¯©æŸ¥
- **æ¨¡çµ„ 6ï¼šè³‡æ–™åº«è¨­è¨ˆèˆ‡é·ç§»** - å­¸ç¿’è³‡æ–™åº«æ‹†åˆ†ç­–ç•¥
- **æ¨¡çµ„ 11ï¼šå¾®æœå‹™æ¶æ§‹** - å­¸ç¿’å®Œæ•´å¾®æœå‹™è¨­è¨ˆ

### å·¥å…·åƒè€ƒ

- **Dependency Cruiser** - ä¾è³´é—œä¿‚åˆ†æå·¥å…·
- **Madge** - JavaScript æ¨¡çµ„ä¾è³´è¦–è¦ºåŒ–
- **API Gateway** (Kong, AWS API Gateway) - API ç®¡ç†
- **Circuit Breaker** (Hystrix, Resilience4j) - å®¹éŒ¯æ©Ÿåˆ¶

### ç›¸é—œæ¦‚å¿µ

- **Strangler Fig Pattern** - é€æ­¥æ›¿æ›éºç•™ç³»çµ±
- **Anti-Corruption Layer** - é˜²è…å±¤éš”é›¢èˆŠç³»çµ±
- **API Gateway Pattern** - çµ±ä¸€ API å…¥å£
- **Database per Service** - æ¯å€‹æœå‹™ç¨ç«‹è³‡æ–™åº«
- **Saga Pattern** - åˆ†æ•£å¼äº‹å‹™

---

**å»ºè­°å®Œæˆæ™‚é–“**ï¼š2-2.5 å°æ™‚ï¼ˆå«æ¸¬è©¦èˆ‡åæ€ï¼‰
**é›£åº¦è©•ä¼°**ï¼š4/5
**é‡è¦åº¦**ï¼š5/5ï¼ˆå¾®æœå‹™æ‹†åˆ†æ˜¯æ¶æ§‹æ¼”é€²çš„é—œéµæŠ€èƒ½ï¼‰
**å¯è¤‡ç”¨æ€§**ï¼š5/5ï¼ˆæ­¤æµç¨‹å¯æ‡‰ç”¨åˆ°ä»»ä½•æ¨¡çµ„æå–ï¼‰
