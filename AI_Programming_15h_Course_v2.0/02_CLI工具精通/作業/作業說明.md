# 模組 2 作業：CLI 工具精通

## 📋 作業概述

本作業旨在檢驗你對模組 2 核心技能的理解和應用能力,包括:
- Claude Code 環境配置與上下文管理
- 程式碼庫分析與重構能力
- EPCV 工作流程完整應用

**預計時間**: 3-4 小時
**截止日期**: 課程第 2 週結束
**提交方式**: GitHub Repository 或 Markdown 文件

---

## 🎯 作業目標

完成本作業後,你將能夠:
- ✅ 正確配置 Claude Code 開發環境
- ✅ 建立高品質的專案記憶檔案
- ✅ 系統化分析陌生程式碼庫
- ✅ 應用 EPCV 流程執行複雜任務
- ✅ 使用進階工具指令提升效率

---

## 📝 作業內容

### 任務 1: Claude Code 環境配置與上下文管理 (30 分)

#### 背景

你加入新團隊,接手一個 Node.js 專案,需要配置 Claude Code 並建立專案記憶系統。

#### 專案資訊

**基本資訊**:
```
專案名稱: Task Management API
語言: Node.js (v18+)
框架: Express.js
資料庫: MongoDB + Redis
測試: Jest + Supertest
部署: Docker + AWS ECS
```

**架構原則**:
1. RESTful API 設計,統一使用 `/api/v1` 前綴
2. 所有回應必須包含 `requestId` 和 `timestamp`
3. 錯誤回應格式統一:
   ```json
   {
     "success": false,
     "error": {
       "code": "ERROR_CODE",
       "message": "Human readable message",
       "details": {}
     },
     "requestId": "uuid",
     "timestamp": "ISO 8601"
   }
   ```

**編碼規範**:
- 格式化: Prettier (semi: true, singleQuote: true)
- Linting: ESLint (Airbnb style guide)
- 命名: camelCase (變數/函數), PascalCase (類別)
- 非同步: 必須使用 async/await,禁用 callback
- 錯誤處理: 所有 async 函數必須有 try-catch
- 測試覆蓋率: ≥ 80%

**Memory 系統使用**:
- 每次重構記錄決策理由
- 遇到問題記錄解決方案
- 重要 API 規格變更記錄歷史

**已知常見問題**:
1. **問題**: MongoDB 連線逾時
   **原因**: 連線池設定不當
   **解決**: 設定 `maxPoolSize: 50, minPoolSize: 10, connectTimeoutMS: 30000`

2. **問題**: Redis session 清理失敗
   **原因**: TTL 設定錯誤
   **解決**: 明確設定 `EX` 參數,例如 `SET key value EX 3600`

3. **問題**: JWT token 驗證失敗
   **原因**: 時間同步問題
   **解決**: 設定 `clockTolerance: 30` 秒容錯

#### 任務要求

**第 1 步: 環境配置 (10 分)**

假設你已安裝 Claude Code,請說明如何配置專案:

```markdown
## 環境配置檢查清單

### 1. Claude Code 安裝驗證
- [ ] 如何驗證 Claude Code 已正確安裝?
- [ ] 如何檢查版本資訊?
- [ ] 如何配置 API Key?

### 2. 專案初始化
- [ ] 如何初始化專案的 Claude Code 配置?
- [ ] 需要建立哪些配置檔案?
- [ ] 如何驗證配置正確?

### 3. Memory 系統設定
- [ ] 如何啟用 Memory 功能?
- [ ] 如何查看現有記憶?
- [ ] 如何手動添加記憶?
```

**評分標準**:
- 配置步驟完整正確: 6 分
- 驗證方法明確: 2 分
- Memory 系統理解: 2 分

---

**第 2 步: 建立 CLAUDE.md (15 分)**

基於上述專案資訊,撰寫完整的 CLAUDE.md:

**要求**:
- 包含所有必要章節
- 至少 3 個程式碼範例
- 至少 2 個 API 端點定義
- 包含常見問題解決方案
- 總長度 600-800 行

**必須包含的章節**:
1. 專案概述
2. 技術棧與工具
3. 架構設計原則
4. API 設計規範
5. 編碼規範與風格
6. 錯誤處理策略
7. 測試要求
8. 部署流程
9. 常見問題與解決方案
10. 檔案結構說明

**評分標準**:
- 結構完整清晰: 5 分
- 資訊準確實用: 5 分
- 程式碼範例品質: 3 分
- API 定義完整性: 2 分

---

**第 3 步: Memory 系統應用 (5 分)**

設計 3 個真實場景,說明如何使用 Memory 系統:

```markdown
## Memory 使用場景

### 場景 1: 記錄重構決策
**情況**: 將 callback 重構為 async/await
**Memory 內容**: [寫出你會記錄的內容]
**記錄原因**: [說明為什麼要記錄這個]

### 場景 2: 記錄問題解決
**情況**: [設計一個技術問題]
**Memory 內容**: [寫出你會記錄的內容]
**記錄原因**: [說明為什麼要記錄這個]

### 場景 3: 記錄 API 變更
**情況**: [設計一個 API 變更場景]
**Memory 內容**: [寫出你會記錄的內容]
**記錄原因**: [說明為什麼要記錄這個]
```

**評分標準**:
- 場景設計真實性: 2 分
- Memory 內容品質: 2 分
- 記錄理由合理性: 1 分

---

### 任務 2: 程式碼庫分析與重構實戰 (40 分)

#### 背景

你接手一個遺留的 Python 專案,需要快速理解程式碼庫並提出重構方案。

#### 專案程式碼

**檔案結構**:
```
legacy-api/
├── app.py (主程式)
├── database.py (資料庫操作)
├── utils.py (工具函數)
└── requirements.txt
```

**app.py**:
```python
from flask import Flask, request, jsonify
import sqlite3
import hashlib
from datetime import datetime

app = Flask(__name__)

# 全域資料庫連線
conn = sqlite3.connect('app.db', check_same_thread=False)
cursor = conn.cursor()

# 初始化資料表
cursor.execute('''
CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY,
    username TEXT,
    password TEXT,
    email TEXT,
    created_at TEXT
)
''')
conn.commit()

@app.route('/api/register', methods=['POST'])
def register():
    data = request.json
    username = data['username']
    password = data['password']
    email = data['email']

    # 檢查使用者是否存在
    query = f"SELECT * FROM users WHERE username = '{username}'"
    cursor.execute(query)
    if cursor.fetchone():
        return jsonify({"error": "User exists"}), 400

    # 加密密碼
    hashed = hashlib.md5(password.encode()).hexdigest()

    # 儲存使用者
    insert_query = f"INSERT INTO users (username, password, email, created_at) VALUES ('{username}', '{hashed}', '{email}', '{datetime.now()}')"
    cursor.execute(insert_query)
    conn.commit()

    return jsonify({"message": "User created"}), 201

@app.route('/api/login', methods=['POST'])
def login():
    data = request.json
    username = data['username']
    password = data['password']

    hashed = hashlib.md5(password.encode()).hexdigest()
    query = f"SELECT * FROM users WHERE username = '{username}' AND password = '{hashed}'"
    cursor.execute(query)
    user = cursor.fetchone()

    if user:
        return jsonify({
            "success": True,
            "user_id": user[0],
            "username": user[1],
            "email": user[3],
            "password_hash": user[2]
        })

    return jsonify({"success": False}), 401

@app.route('/api/users', methods=['GET'])
def get_users():
    cursor.execute("SELECT * FROM users")
    users = cursor.fetchall()

    result = []
    for user in users:
        result.append({
            "id": user[0],
            "username": user[1],
            "password": user[2],
            "email": user[3],
            "created_at": user[4]
        })

    return jsonify(result)

@app.route('/api/users/<user_id>', methods=['DELETE'])
def delete_user(user_id):
    query = f"DELETE FROM users WHERE id = {user_id}"
    cursor.execute(query)
    conn.commit()
    return jsonify({"message": "User deleted"}), 200

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)
```

#### 任務要求

**第 1 步: 使用 Explore 階段分析程式碼 (15 分)**

使用 Claude Code 的分析工具完成以下任務:

**1.1 結構分析** (5 分)
```markdown
## 程式碼結構分析

### 檔案組織
- 總檔案數: __
- 程式碼行數: __
- 主要模組: __

### 依賴分析
- 外部依賴清單:
- 缺少的依賴:
- 版本衝突:

### 架構模式
- 使用的架構模式: __
- 優點: __
- 缺點: __
```

**1.2 問題識別** (10 分)

使用驗證清單系統化檢查:

| 問題類別 | 發現的問題 | 嚴重程度 | 影響範圍 | 具體位置 |
|---------|----------|---------|---------|---------|
| 安全性 | | 高/中/低 | | 行號 |
| 效能 | | 高/中/低 | | 行號 |
| 可維護性 | | 高/中/低 | | 行號 |
| 錯誤處理 | | 高/中/低 | | 行號 |
| 程式碼品質 | | 高/中/低 | | 行號 |

**要求**:
- 至少找出 10 個問題
- 正確分類和評估嚴重程度
- 明確指出問題位置

**評分標準**:
- 結構分析完整性: 5 分
- 問題識別完整性: 7 分
- 嚴重程度評估準確性: 3 分

---

**第 2 步: 使用 Plan 階段設計重構方案 (10 分)**

```markdown
## 重構計劃

### 優先級排序 (按嚴重程度)
1. [最嚴重問題]
   - 影響: __
   - 修復方案: __
   - 預估時間: __

2. ...

### 重構階段設計

#### 階段 1: 緊急安全修復 (高優先級)
**時間**: 0.5 天
**任務**:
- [ ] 修復 SQL 注入漏洞
- [ ] 修復密碼加密問題
- [ ] 移除敏感資料洩露

**產出**:
- 安全修復版本
- 安全測試報告

#### 階段 2: 架構重構 (中優先級)
**時間**: 1 天
**任務**:
- [ ] 分離資料庫層
- [ ] 實作連線池
- [ ] 添加錯誤處理

**產出**:
- 重構後的程式碼
- 架構文檔

#### 階段 3: 程式碼品質提升 (低優先級)
**時間**: 0.5 天
**任務**:
- [ ] 添加類型提示
- [ ] 改進命名
- [ ] 添加文檔字串

**產出**:
- 高品質程式碼
- 完整文檔

### 風險評估
- **風險 1**: [識別風險]
  - 發生機率: 高/中/低
  - 影響: 高/中/低
  - 緩解策略: __

- **風險 2**: ...
```

**評分標準**:
- 優先級排序合理性: 3 分
- 階段設計完整性: 4 分
- 風險評估品質: 3 分

---

**第 3 步: 使用 Code 階段執行重構 (10 分)**

提供完整的重構程式碼:

**要求**:
- 修復所有安全問題
- 實作正確的架構模式
- 添加完整的錯誤處理
- 添加類型提示和文檔
- 確保程式碼可執行

**評分標準**:
- 安全問題修復: 4 分
- 架構改進: 3 分
- 程式碼品質: 3 分

---

**第 4 步: 使用 Verify 階段驗證結果 (5 分)**

```markdown
## 驗證報告

### 安全性驗證
- [ ] SQL 注入測試: [結果]
- [ ] 密碼加密測試: [結果]
- [ ] 敏感資料洩露測試: [結果]

### 功能驗證
- [ ] 使用者註冊: [結果]
- [ ] 使用者登入: [結果]
- [ ] 使用者查詢: [結果]
- [ ] 使用者刪除: [結果]

### 效能驗證
- [ ] 並發測試 (100 requests): [結果]
- [ ] 記憶體使用: [改進前] → [改進後]
- [ ] 回應時間: [改進前] → [改進後]

### 程式碼品質驗證
- [ ] Linting (flake8): [結果]
- [ ] 類型檢查 (mypy): [結果]
- [ ] 測試覆蓋率: [百分比]
```

**評分標準**:
- 驗證項目完整性: 3 分
- 測試方法正確性: 2 分

---

### 任務 3: EPCV 工作流程完整演練 (30 分)

#### 背景

你的團隊需要將現有 API 從 v1 升級到 v2,涉及多個端點的破壞性變更。

#### 變更需求

**API 變更清單**:

1. **端點路徑變更**:
   - `/users` → `/api/v2/users`
   - `/tasks` → `/api/v2/tasks`
   - `/projects` → `/api/v2/projects`

2. **回應格式統一**:
   ```json
   // v1 (舊)
   {
     "data": [...],
     "count": 10
   }

   // v2 (新)
   {
     "success": true,
     "data": [...],
     "metadata": {
       "count": 10,
       "page": 1,
       "total_pages": 5,
       "request_id": "uuid"
     }
   }
   ```

3. **錯誤處理改進**:
   ```json
   // v1 (舊)
   {
     "error": "Something went wrong"
   }

   // v2 (新)
   {
     "success": false,
     "error": {
       "code": "VALIDATION_ERROR",
       "message": "Invalid input data",
       "details": {
         "field": "email",
         "reason": "Invalid format"
       }
     },
     "metadata": {
       "request_id": "uuid",
       "timestamp": "2025-01-30T10:00:00Z"
     }
   }
   ```

4. **新增功能**:
   - 分頁支援 (query params: `page`, `limit`)
   - 排序支援 (query param: `sort`)
   - 欄位過濾 (query param: `fields`)

#### 任務要求

**完整記錄 EPCV 每個階段的操作**:

**Explore 階段** (8 分)
```markdown
## Explore 階段記錄

### 1. 理解現有實作
**使用的工具/指令**:
- [ ] `/glob` 搜尋所有 API 檔案
- [ ] `/grep` 搜尋端點定義
- [ ] `/read` 閱讀關鍵檔案
- [ ] 其他: __

**記錄指令與產出**:
指令 1: [實際指令]
產出: [簡要摘要]

指令 2: ...

**發現的問題**:
1. [問題描述]
2. ...

### 2. 分析影響範圍
**受影響的檔案**:
- 檔案 1: [檔案路徑] - [影響描述]
- 檔案 2: ...

**受影響的測試**:
- 測試 1: [測試檔案] - [需要修改的內容]
- 測試 2: ...

**相依性分析**:
- 外部相依: __
- 內部相依: __

### 3. 決策記錄
**決策 1**: [決策內容]
- 理由: __
- 風險: __
- 緩解策略: __

**決策 2**: ...
```

**評分標準**:
- 工具使用正確性: 3 分
- 影響範圍分析: 3 分
- 決策記錄品質: 2 分

---

**Plan 階段** (8 分)
```markdown
## Plan 階段記錄

### 1. 任務分解
**任務樹狀圖**:
API v1 → v2 遷移
├── 1. 端點路徑遷移
│   ├── 1.1 更新路由定義
│   ├── 1.2 更新路由測試
│   └── 1.3 更新 API 文檔
├── 2. 回應格式統一
│   ├── 2.1 建立回應格式化器
│   ├── 2.2 更新所有端點
│   └── 2.3 更新測試斷言
├── 3. 錯誤處理改進
│   ├── 3.1 建立錯誤類別
│   ├── 3.2 更新錯誤中介層
│   └── 3.3 更新錯誤測試
└── 4. 新增功能實作
    ├── 4.1 分頁中介層
    ├── 4.2 排序中介層
    └── 4.3 欄位過濾中介層

### 2. 執行順序
**階段 1**: [任務編號]
- 時間: __
- 理由: __

**階段 2**: ...

### 3. 檢查點設計
**檢查點 1**: 端點路徑遷移完成
- 驗證方式: __
- 成功標準: __

**檢查點 2**: ...

### 4. 回退計劃
**如果遇到問題 X**:
- 檢測方法: __
- 回退步驟: __
- 備份策略: __
```

**評分標準**:
- 任務分解完整性: 3 分
- 執行順序合理性: 2 分
- 檢查點設計: 2 分
- 回退計劃: 1 分

---

**Code 階段** (8 分)
```markdown
## Code 階段記錄

### 1. 實作過程
**任務 1.1**: 更新路由定義
- 使用的工具: [如 `/edit`, `/code`]
- 修改的檔案: __
- 程式碼片段: [關鍵程式碼]
- 遇到的問題: __
- 解決方法: __

**任務 1.2**: ...

### 2. 使用 Checkpoint 管理進度
**Checkpoint 1**: 端點路徑遷移
- 建立時間: __
- 包含的變更: __
- 驗證結果: __

**Checkpoint 2**: ...

### 3. 使用 Undo 處理錯誤
**Undo 場景 1**: [描述錯誤]
- 問題: __
- 回退操作: __
- 修正方案: __

### 4. 關鍵程式碼
[提供 2-3 個關鍵程式碼片段,展示你的實作]
```

**評分標準**:
- 實作過程記錄: 3 分
- Checkpoint 使用: 2 分
- Undo 使用: 2 分
- 程式碼品質: 1 分

---

**Verify 階段** (6 分)
```markdown
## Verify 階段記錄

### 1. 功能驗證
**測試案例 1**: [描述]
- 輸入: __
- 預期輸出: __
- 實際輸出: __
- 結果: ✅/❌

**測試案例 2**: ...

### 2. 回歸測試
- 既有測試通過率: ___%
- 新增測試數: __
- 失敗的測試: __
- 修復情況: __

### 3. 效能驗證
| 端點 | v1 回應時間 | v2 回應時間 | 變化 |
|------|-----------|-----------|------|
| GET /api/v2/users | | | |
| POST /api/v2/tasks | | | |

### 4. 向後相容性驗證
- v1 端點是否仍可用: 是/否
- v1 → v2 遷移指南: [連結或描述]
- 破壞性變更清單: __

### 5. 文檔更新
- [ ] API 文檔已更新
- [ ] 遷移指南已撰寫
- [ ] CHANGELOG 已更新
- [ ] README 已更新
```

**評分標準**:
- 功能驗證完整性: 2 分
- 回歸測試: 2 分
- 效能驗證: 1 分
- 文檔更新: 1 分

---

## 📤 提交要求

### 提交格式

**方式 1: GitHub Repository (推薦)**
```
repo/
├── README.md (作業說明)
├── task1_environment_setup/
│   ├── configuration_checklist.md
│   ├── CLAUDE.md
│   └── memory_scenarios.md
├── task2_code_analysis/
│   ├── explore_report.md
│   ├── refactor_plan.md
│   ├── refactored_code/
│   └── verification_report.md
└── task3_epcv_workflow/
    ├── explore_phase.md
    ├── plan_phase.md
    ├── code_phase.md
    ├── verify_phase.md
    └── source_code/
```

**方式 2: 單一 Markdown 文件**
- 檔名: `module2_assignment_[你的名字].md`
- 包含所有任務的完整答案
- 程式碼使用程式碼區塊標記

---

### 提交檢查清單

**任務 1**:
- [ ] 環境配置步驟完整
- [ ] CLAUDE.md 結構完整 (600-800 行)
- [ ] 包含至少 3 個程式碼範例
- [ ] 包含至少 2 個 API 定義
- [ ] Memory 使用場景真實可行

**任務 2**:
- [ ] 識別至少 10 個問題
- [ ] 問題分類和嚴重程度評估正確
- [ ] 重構計劃完整 (包含 3 個階段)
- [ ] 重構程式碼可執行
- [ ] 驗證報告完整

**任務 3**:
- [ ] 記錄完整的 EPCV 四個階段
- [ ] 每個階段包含實際操作步驟
- [ ] 使用 Checkpoint 和 Undo
- [ ] 包含驗證測試結果
- [ ] 文檔已更新

---

## 📊 評分標準

### 總分: 100 分

| 任務 | 分數 | 評分重點 |
|------|------|---------|
| 任務 1: 環境配置與上下文管理 | 30 分 | 配置正確性、CLAUDE.md 品質、Memory 使用 |
| 任務 2: 程式碼庫分析與重構 | 40 分 | 問題識別、重構方案、程式碼品質 |
| 任務 3: EPCV 工作流程演練 | 30 分 | 流程完整性、工具使用、驗證品質 |

### 等級劃分

- **90-100 分**: 卓越
  - 配置完整且 CLAUDE.md 品質優秀
  - 找出所有關鍵問題並提供高品質重構
  - EPCV 流程記錄完整且操作正確

- **80-89 分**: 優秀
  - 配置正確,CLAUDE.md 結構完整
  - 找出大部分問題 (≥ 80%),重構合理
  - EPCV 流程基本完整

- **70-79 分**: 良好
  - 配置基本正確
  - 找出主要問題 (≥ 70%)
  - EPCV 流程有記錄但不夠詳細

- **60-69 分**: 及格
  - 完成基本配置
  - 找出部分問題 (≥ 60%)
  - EPCV 流程記錄不完整

- **< 60 分**: 不及格
  - 需要重新學習模組 2 內容

---

## 💡 完成建議

### 時間分配

```
任務 1: 60-90 分鐘
  - 配置檢查清單: 15 分鐘
  - 撰寫 CLAUDE.md: 40-60 分鐘
  - Memory 場景設計: 10-15 分鐘

任務 2: 90-120 分鐘
  - Explore 階段: 30 分鐘
  - Plan 階段: 20 分鐘
  - Code 階段: 30-50 分鐘
  - Verify 階段: 10-20 分鐘

任務 3: 60-90 分鐘
  - Explore: 15-20 分鐘
  - Plan: 15-20 分鐘
  - Code: 20-30 分鐘
  - Verify: 10-20 分鐘

總計: 3.5-5 小時
```

---

### 資源參考

**環境配置**:
- 模組 2 理論: `2.1_Claude_Code安裝與配置.md`
- 情境題庫: `情境題庫/基礎級/S1.1, S1.2`
- 學習資源: `學習資源/A - 安裝與配置`

**上下文管理**:
- 模組 2 理論: `2.2_上下文管理與Memory系統.md`
- 情境題庫: `情境題庫/基礎級/S1.3`
- 學習資源: `學習資源/B - 上下文管理`

**程式碼庫分析**:
- 模組 2 理論: `2.3_程式碼庫分析與重構.md`
- 情境題庫: `情境題庫/基礎級/S1.4-S1.6`
- 學習資源: `學習資源/C - 程式碼庫分析`

**EPCV 工作流程**:
- 模組 2 理論: `2.4_EPCV工作流程深度解析.md`
- 情境題庫: `情境題庫/基礎級/S1.7-S1.10`
- 學習資源: `學習資源/D - EPCV 工作流程`

---

### 常見問題

**Q1: 可以使用 Claude Code 完成作業嗎?**

A: 可以,且**強烈建議**使用 Claude Code 完成任務 2 和任務 3。

**建議做法**:
1. 使用 Claude Code 分析程式碼
2. 記錄每個步驟的操作和產出
3. 截圖關鍵操作過程
4. 將過程整理成報告

---

**Q2: CLAUDE.md 應該包含哪些內容?**

A: 必須包含:
- 專案概述 (目標、技術棧)
- 架構設計原則
- 編碼規範 (格式化、命名、錯誤處理)
- API 設計規範 (端點格式、回應格式)
- 常見問題與解決方案
- 程式碼範例 (至少 3 個)

不應包含:
- 過於詳細的實作細節
- 大量重複的程式碼
- 不常用的邊緣案例

---

**Q3: 如何驗證重構後的程式碼?**

A: 建議使用:
1. **單元測試**: 確保功能正確
2. **安全掃描**: 使用 Bandit (Python) 或 ESLint (JavaScript)
3. **類型檢查**: mypy (Python) 或 TypeScript
4. **手動測試**: 實際執行並測試 API

如果無法執行,可以:
- 設計理論測試案例
- 說明預期結果
- 對比改進前後的差異

---

**Q4: EPCV 工作流程必須完整執行嗎?**

A: 是的。任務 3 的重點是**記錄完整的 EPCV 流程**。

每個階段必須包含:
- **Explore**: 使用的工具、發現的問題、分析結果
- **Plan**: 任務分解、執行順序、檢查點
- **Code**: 實作過程、Checkpoint 使用、關鍵程式碼
- **Verify**: 測試結果、效能驗證、文檔更新

---

## 🎓 學習成果

完成本作業後,你將能夠:

**環境配置能力**:
- ✅ 正確配置 Claude Code 開發環境
- ✅ 建立高品質的專案記憶檔案
- ✅ 有效使用 Memory 系統

**分析能力**:
- ✅ 快速理解陌生程式碼庫
- ✅ 系統化識別問題
- ✅ 設計可執行的重構方案

**工作流程能力**:
- ✅ 應用完整的 EPCV 工作流程
- ✅ 使用進階工具提升效率
- ✅ 記錄和驗證開發過程

---

**作業版本**: v1.0
**發布日期**: 2025-01-30
**適用模組**: 模組 2 - CLI 工具精通

**祝你作業順利!如有疑問,請參考課程資料或諮詢講師。**
