# 練習 1：上下文管理實戰

## 📋 練習概述

**練習時長**：60 分鐘
**難度**：⭐⭐⭐ (中級)
**前置條件**：完成模組 2 理論學習 + 至少 3 個基礎級情境

**學習目標**：
- 掌握上下文管理的核心技巧
- 學會在大型專案中高效管理上下文
- 理解 /context, /compact, /memory 的實際應用
- 建立專案記憶檔案 (CLAUDE.md)

---

## 🎯 練習情境

### 背景描述

你剛加入一個開發團隊，需要接手維護一個**中型電商專案**。專案已經運行 2 年，程式碼結構較為複雜，包含：

- **前端**：React + TypeScript (25 個元件)
- **後端**：FastAPI + Python (30 個模組)
- **資料庫**：PostgreSQL + Redis
- **工具**：Docker, GitHub Actions, pytest

**你的任務**：
1. 快速理解專案架構
2. 找出當前的技術債務
3. 建立完整的專案記憶檔案
4. 為新加入的團隊成員準備 onboarding 指南

---

## 🚀 練習步驟

### 階段 1：專案初探 (15 分鐘)

#### 1.1 啟動與載入專案
```bash
# 進入練習目錄
cd 練習1_上下文管理實戰/sample_project

# 啟動 Claude Code
claude

# 首次載入（預期會接近上下文限制）
--add-dir ./
```

#### 1.2 診斷上下文狀況
- 使用指令檢查當前上下文使用情況
- 記錄觀察到的問題
- 思考：如何優化上下文管理？

**檢查點 1**：
- [ ] 能夠看到上下文使用統計
- [ ] 識別出上下文使用過高的問題
- [ ] 理解為什麼不能直接載入整個專案

---

### 階段 2：策略性上下文管理 (20 分鐘)

#### 2.1 清理與重新載入
使用學到的技巧優化上下文：

1. **壓縮對話歷史**
2. **選擇性載入重要目錄**
3. **排除不必要的檔案**

建議載入優先順序：
```
高優先：src/api/, src/models/, src/services/
中優先：src/utils/, requirements.txt, docker-compose.yml
低優先：tests/, docs/, .github/
暫時忽略：node_modules/, __pycache__/, logs/
```

#### 2.2 專案架構分析
使用優化後的上下文，要求 Claude：
```
分析這個電商專案：
1. 主要功能模組有哪些？
2. 資料流向如何？（用戶請求 → API → 資料庫）
3. 關鍵依賴關係？
4. 潛在的技術債務？
5. 需要優化的地方？
```

**檢查點 2**：
- [ ] 上下文使用率降到 70% 以下
- [ ] 獲得清晰的專案架構理解
- [ ] 識別出至少 3 個技術債務問題

---

### 階段 3：知識固化 (15 分鐘)

#### 3.1 建立專案記憶
將重要發現保存到長期記憶：

```
使用 /memory 記錄：
1. 專案架構總結
2. 關鍵技術債務
3. 重要的檔案路徑
4. 常見問題和解決方案
```

#### 3.2 創建 CLAUDE.md
為專案建立記憶檔案，包含：

```markdown
# 電商專案記憶檔案

## 技術棧
- 前端：React 18 + TypeScript
- 後端：FastAPI + Python 3.9
- 資料庫：PostgreSQL 14 + Redis 6
- 部署：Docker + Docker Compose

## 架構概述
[從分析中提取的架構資訊]

## 已知問題
[記錄發現的技術債務]

## 常見任務
[記錄常用的操作流程]
```

**檢查點 3**：
- [ ] 成功使用 /memory 保存關鍵資訊
- [ ] 創建完整的 CLAUDE.md 檔案
- [ ] 能夠查詢已保存的記憶

---

### 階段 4：團隊協作準備 (10 分鐘)

#### 4.1 新人指南生成
基於你的理解，為新團隊成員生成：

```
生成新人指南：
1. 如何設定開發環境？
2. 專案的核心概念？
3. 第一個開發任務建議？
4. 遇到問題時的解決步驟？
```

#### 4.2 知識驗證
測試你的專案理解：

```
假設場景：
- 用戶回報「結帳後金額不對」
- 需要快速定位可能的問題檔案
- 提供初步的偵錯方向
```

**檢查點 4**：
- [ ] 生成實用的新人指南
- [ ] 能夠快速回答專案相關問題
- [ ] 建立可持續的知識管理工作流程

---

## 📊 評分標準

### 基本要求 (60 分)
- [ ] 成功管理上下文，避免過載
- [ ] 理解專案基本架構
- [ ] 創建基本的 CLAUDE.md 檔案

### 良好表現 (80 分)
- [ ] 策略性地載入和管理上下文
- [ ] 深入理解專案架構和資料流
- [ ] 創建詳細且實用的專案記憶檔案
- [ ] 識別主要技術債務

### 優秀表現 (100 分)
- [ ] 建立高效的上下文管理工作流程
- [ ] 全面分析專案並提出改進建議
- [ ] 創建完整的團隊協作知識庫
- [ ] 展示進階的記憶管理技巧

---

## 💡 提示與技巧

### 上下文管理技巧
```bash
# 檢查上下文使用
/context

# 壓縮對話歷史
/compact

# 移除特定檔案
/remove path/to/file

# 選擇性載入
--add-dir ./src/api --ignore "tests/,docs/"
```

### 專案分析技巧
```
好的分析問題：
- 「這個專案的資料流向如何？」
- 「哪些檔案是修改 XX 功能時需要關注的？」
- 「有哪些潛在的效能瓶頸？」

避免的問題：
- 「這個專案是做什麼的？」（太寬泛）
- 「所有檔案都做什麼？」（會消耗大量上下文）
```

### 記憶管理技巧
```bash
# 結構化記憶
/memory --category="architecture" "API Gateway 負責路由和認證"

# 標籤記憶
/memory --tags="performance,database" "用戶查詢存在 N+1 問題"

# 查詢記憶
/recall performance
```

---

## 🔍 故障排除

### 常見問題

**Q: 上下文很快就滿了，怎麼辦？**
A:
1. 使用 /compact 壓縮對話
2. 用 --ignore 排除大檔案
3. 分階段載入不同模組
4. 及時使用 /memory 保存重要資訊

**Q: 不知道該載入哪些檔案？**
A:
1. 先載入 README.md 和 package.json 了解概況
2. 載入主要入口檔案（main.py, app.js）
3. 根據需要逐步載入相關模組

**Q: /memory 保存的資訊找不到？**
A:
1. 檢查記憶標籤：/recall --tags
2. 使用關鍵字搜尋：/recall [keyword]
3. 查看所有記憶：/recall --all

---

## 📚 延伸挑戰

完成基本練習後，可以嘗試：

1. **效能優化分析**：找出專案中的效能瓶頸
2. **安全漏洞掃描**：識別潛在的安全問題
3. **測試覆蓋率分析**：評估測試的完整性
4. **重構建議**：提出程式碼重構方案

---

## 📖 參考資料

- [模組 2.2：上下文管理與記憶系統](../理論/2.2_上下文管理與記憶系統.md)
- [基礎級情境：S1.3 快速理解新專案](../情境題庫/基礎級/S1.3_快速理解新專案.md)
- [記憶卡：B類 上下文管理策略](../記憶卡庫/02_CLI工具記憶卡.md#b-上下文管理策略8張)

**記住**：上下文管理就像 Linux 的記憶體管理 - 要根據需要分配和釋放資源！ 🚀