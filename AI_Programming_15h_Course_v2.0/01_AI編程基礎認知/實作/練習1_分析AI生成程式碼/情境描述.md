# 練習 1 情境描述

## 🏢 專案背景

你在一家快速成長的新創公司工作，公司剛剛開始採用 AI 編程工具來加速開發。

### 公司資訊
- **公司**：TechStart Inc.
- **產品**：SaaS 平台（專案管理工具）
- **團隊規模**：15 位工程師
- **你的角色**：資深後端工程師 + Code Reviewer

### 技術棧
- **語言**：Python 3.11+
- **框架**：FastAPI
- **資料庫**：PostgreSQL
- **快取**：Redis
- **部署**：Docker + Kubernetes

---

## 📋 當前情況

### 問題

團隊最近開始使用 AI 編程工具（GitHub Copilot、Claude Code）來加速開發。初級工程師們很興奮，生產力提升了 3倍。

但是，你注意到一些問題：

**週一早上的事件**：
```
9:00 AM - 生產環境出現嚴重漏洞
         → SQL 注入攻擊，洩漏了 1,000 位用戶的資料
         → 原因：AI 生成的程式碼沒有使用參數化查詢

11:00 AM - API 大量 500 錯誤
          → 原因：AI 生成的程式碼沒有錯誤處理

2:00 PM - 資料庫負載飆升
         → 原因：AI 生成的程式碼有 N+1 查詢問題
```

**CEO 的指示**：
> "我們需要在不放棄 AI 工具的情況下，確保程式碼品質。
> 請建立一套 AI 程式碼審查流程。"

---

## 🎯 你的任務

作為資深工程師，你需要：

### 階段 1：審查積壓的 Pull Requests

過去一週，團隊提交了 10 個 Pull Requests，全部使用 AI 生成程式碼。
這些 PR 都在等待你的審查。

你需要：
1. 審查每個 PR 的程式碼
2. 找出所有問題（安全性、錯誤處理、效能、程式碼品質）
3. 給出具體的修改建議
4. 提供改進後的程式碼範例

### 階段 2：建立審查指南

基於你的審查經驗，建立一份「AI 程式碼審查指南」，
讓團隊成員在提交前自我檢查。

---

## 📦 待審查的 Pull Requests

### PR #1：用戶認證功能
- **作者**：Alice（初級工程師）
- **描述**：實作用戶登入功能
- **AI 工具**：GitHub Copilot
- **檔案**：`starter_code/example_01_user_auth.py`

**Alice 的註解**：
> "Copilot 生成的程式碼看起來很完整，測試也通過了。應該可以直接部署吧？"

### PR #2：檔案上傳功能
- **作者**：Bob（初級工程師）
- **描述**：允許用戶上傳專案附件
- **AI 工具**：Claude Code
- **檔案**：`starter_code/example_02_file_upload.py`

**Bob 的註解**：
> "Claude 生成的程式碼很簡潔，一次就能跑通。"

### PR #3：第三方 API 整合
- **作者**：Carol（中級工程師）
- **描述**：整合 Slack 通知功能
- **AI 工具**：GitHub Copilot
- **檔案**：`starter_code/example_03_api_call.py`

### PR #4：資料驗證
- **作者**：David（初級工程師）
- **描述**：創建新專案的資料驗證
- **AI 工具**：Copilot
- **檔案**：`starter_code/example_04_data_validation.py`

### PR #5：快取實現
- **作者**：Eve（中級工程師）
- **描述**：添加快取層提升效能
- **AI 工具**：Claude Code
- **檔案**：`starter_code/example_05_cache_implementation.py`

### PR #6：資料庫查詢優化
- **作者**：Frank（初級工程師）
- **描述**：獲取專案及其任務列表
- **AI 工具**：Copilot
- **檔案**：`starter_code/example_06_database_query.py`

### PR #7：密碼重置功能
- **作者**：Grace（中級工程師）
- **描述**：實作密碼重置流程
- **AI 工具**：Claude Code
- **檔案**：`starter_code/example_07_password_reset.py`

### PR #8：Webhook 處理器
- **作者**：Henry（初級工程師）
- **描述**：處理第三方 webhook 事件
- **AI 工具**：Copilot
- **檔案**：`starter_code/example_08_webhook_handler.py`

### PR #9：CSV 資料處理
- **作者**：Ivy（中級工程師）
- **描述**：批量匯入任務資料
- **AI 工具**：Copilot
- **檔案**：`starter_code/example_09_csv_processor.py`

### PR #10：Email 發送服務
- **作者**：Jack（初級工程師）
- **描述**：發送通知郵件
- **AI 工具**：Claude Code
- **檔案**：`starter_code/example_10_email_sender.py`

---

## 🎯 審查重點

根據週一的事件，特別注意以下問題：

### 1. 安全性（最高優先）
- ✅ SQL 注入
- ✅ XSS 攻擊
- ✅ 路徑遍歷
- ✅ 硬編碼密鑰
- ✅ 未檢查權限

### 2. 錯誤處理
- ✅ 沒有 try-except
- ✅ 沒有處理 None 值
- ✅ 沒有處理網路錯誤
- ✅ 錯誤訊息不清楚

### 3. 效能
- ✅ N+1 查詢
- ✅ SELECT *
- ✅ 沒有使用索引
- ✅ 記憶體洩漏

### 4. 程式碼品質
- ✅ 沒有類型提示
- ✅ 沒有文檔字串
- ✅ 命名不清楚
- ✅ 函數太複雜

---

## 📝 審查報告格式

對每個 PR，提供以下報告：

```markdown
# PR #X 審查報告

## 總體評分：❌ 拒絕 / ⚠️ 需要修改 / ✅ 通過

## 發現的問題

### 🔴 嚴重問題（必須修改）
1. [問題描述]
   - 位置：第 X 行
   - 影響：[安全/功能/效能]
   - 建議：[具體修改方案]

### 🟡 中等問題（應該修改）
1. [問題描述]
   ...

### 🟢 輕微問題（建議修改）
1. [問題描述]
   ...

## 改進後的程式碼

```python
# 完整的改進版本
...
```

## 學習要點

給 PR 作者的建議，幫助他們避免類似問題。
```

---

## 🎓 成功標準

### 審查品質

**優秀的審查**應該：
- ✅ 找出所有嚴重問題（安全漏洞、致命錯誤）
- ✅ 提出具體可執行的修改建議
- ✅ 提供改進後的程式碼範例
- ✅ 解釋問題的原因和影響
- ✅ 給出學習建議，幫助作者成長

**避免的審查方式**：
- ❌ 只說「有問題」但不說明具體問題
- ❌ 只指出問題但不提供解決方案
- ❌ 過於苛刻，打擊作者信心
- ❌ 只關注風格，忽略安全和功能

---

## 💡 審查提示

### 心態

```
你是導師，不是批評者

目標：
1. 確保程式碼品質
2. 幫助團隊成長
3. 建立安全文化
4. 提升對 AI 工具的正確使用

方法：
- 指出問題時，解釋「為什麼」
- 提供解決方案時，解釋「怎麼做」
- 給予正面回饋，鼓勵好的實踐
- 分享你的經驗和學習資源
```

### 流程

```
第一步：快速瀏覽
  → 理解程式碼的目的和邏輯

第二步：安全檢查
  → 找出所有安全漏洞（最高優先）

第三步：功能檢查
  → 程式碼是否正確實現功能？
  → 邊界情況是否處理？

第四步：品質檢查
  → 錯誤處理、類型提示、文檔、測試

第五步：效能檢查
  → 有沒有明顯的效能問題？

第六步：撰寫報告
  → 清楚、友善、具體、可執行
```

---

## 🔗 參考資料

團隊的編碼規範和最佳實踐：

### 安全規範
- 所有資料庫查詢必須使用參數化查詢
- 所有用戶輸入必須驗證和淨化
- 檔案操作必須驗證路徑
- 不可硬編碼密鑰和密碼
- 所有 API 必須檢查權限

### 編碼規範
- Python 3.11+ 語法
- 所有函數必須有類型提示
- 所有公開函數必須有 docstring
- 使用 Black 格式化（line-length=88）
- 使用 mypy 類型檢查

### 測試規範
- 測試覆蓋率 ≥ 80%
- 必須測試錯誤情況
- 必須測試邊界情況

---

**準備好了嗎？開始審查第一個 PR！**
