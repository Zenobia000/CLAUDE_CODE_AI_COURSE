# 模組 5 記憶卡庫：CI/CD 自動化整合

## 📚 記憶卡架構

本模組提供 **情境式記憶卡**,幫助你在實際問題中鞏固 CI/CD 知識。

**總卡片數**：約 80-100 張（規劃中）

---

## 🎯 記憶卡設計哲學

### ❌ 不採用的傳統方式

```
Q: GitHub Actions 的 workflow 檔案應該放在哪裡？
A: .github/workflows/ 目錄
```

**問題**：
- 機械記憶,容易忘記
- 不知道實際應用場景
- 無法建立知識連結

### ✅ 採用的情境式方式

```
Q: 【情境】
你想為專案建立自動化測試,但 push 後在 GitHub Actions 看不到 workflow。
可能的原因是什麼？

A: 【分析】
最常見原因：
1. workflow 檔案路徑錯誤
   ✅ 正確：.github/workflows/test.yml
   ❌ 錯誤：github/workflows/test.yml（少了點）
   ❌ 錯誤：.github/workflow/test.yml（少了 s）

2. YAML 語法錯誤
   - 使用 yamllint 檢查

3. 檔案沒有 push 到 remote
   - 檢查：git status
   - 確認：git push

【記憶點】
路徑是 .github/workflows/（有點、有 s）
```

---

## 📋 記憶卡分類

### 1. GitHub Actions 基礎（20 張）

**涵蓋主題**：
- Workflow 結構與語法
- 觸發條件（triggers）
- Jobs 和 Steps 關係
- 執行環境選擇
- Actions Marketplace 使用

**範例卡片**：

```
【情境】
你的 workflow 需要在 push 到 main 或 develop 分支時執行,
也要在對 main 的 PR 時執行。該如何配置？

【解答】
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

【變化題】
Q: 如果只想在 src/ 目錄變更時觸發？
A: 加入 paths:
   push:
     paths:
       - 'src/**'
```

### 2. 環境變數與密鑰管理（15 張）

**涵蓋主題**：
- GitHub Secrets 設定與使用
- 環境變數的三個層級
- 敏感資訊處理
- ${{ }} 表達式語法

**範例卡片**：

```
【情境】
你需要在 workflow 中使用資料庫連線字串,但不想暴露在代碼中。
該怎麼做？

【步驟】
1. 在 GitHub 設定 Secret
   Settings → Secrets → New secret
   Name: DATABASE_URL
   Value: postgresql://...

2. 在 workflow 中使用
   steps:
     - name: Run tests
       env:
         DATABASE_URL: ${{ secrets.DATABASE_URL }}
       run: pytest

【注意】
✅ Secret 不會出現在日誌中（自動遮罩）
❌ 不要用 echo 輸出 secret
❌ 不要在 git 提交 secret
```

### 3. 快取與效能優化（10 張）

**涵蓋主題**：
- 快取策略
- 並行執行
- Matrix strategy
- 執行時間優化

**範例卡片**：

```
【情境】
你的 workflow 每次都要安裝依賴,花費 2 分鐘。
如何優化到 30 秒？

【解答】
使用快取：

- uses: actions/cache@v3
  with:
    path: ~/.cache/pip
    key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}

【原理】
第一次：安裝依賴 → 存入快取（慢）
第二次：檢查 key → 恢復快取（快）
如果 requirements.txt 改變 → key 改變 → 重新安裝

【記憶點】
key 包含檔案 hash,檔案變了快取就失效
```

### 4. 安全掃描工具（20 張）

**涵蓋主題**：
- CodeQL 配置與使用
- Snyk 依賴掃描
- Trivy 容器掃描
- 漏洞嚴重度判斷
- 修復策略

**範例卡片**：

```
【情境】
Dependabot 發現你的專案使用的 requests 2.27.0 有漏洞（CVE-2023-32681）,
建議升級到 2.31.0。該如何決定？

【決策流程】
1. 檢查嚴重性
   → High: 需要盡快處理

2. 檢查版本差異
   2.27.0 → 2.31.0
   → 次版本更新（2.27 → 2.31）
   → 可能有 breaking changes

3. 決策
   ✅ 先在本機測試
   ✅ 確認測試通過
   ✅ 合併 Dependabot PR
   ❌ 不要直接合併未測試的更新

【記憶點】
High severity → 本週內修復
Critical severity → 24 小時內修復
```

### 5. 故障排除（15 張）

**涵蓋主題**：
- 常見錯誤診斷
- 日誌分析
- 除錯技巧
- 問題定位

**範例卡片**：

```
【情境】
Workflow 失敗,錯誤訊息：
"Error: Unable to locate executable file: python"

可能原因和解決方案？

【分析】
原因：沒有設置 Python 環境

【解決】
加入 setup-python step：

steps:
  - uses: actions/checkout@v4
  - uses: actions/setup-python@v4  ← 加這個
    with:
      python-version: '3.11'
  - run: python --version

【記憶點】
執行環境是空的 VM,需要明確設置環境
```

### 6. 部署策略（10 張）

**涵蓋主題**：
- 滾動部署 vs 藍綠部署
- 金絲雀部署
- 回退機制
- 多環境管理

**範例卡片**：

```
【情境】
你需要部署新版本到生產環境,但擔心有問題無法快速回退。
該選擇哪種部署策略？

【對比】
滾動部署（Rolling）:
  ✅ 不需額外資源
  ❌ 回退慢（需逐一回復）

藍綠部署（Blue-Green）:
  ✅ 瞬間切換,快速回退
  ❌ 需要雙倍資源

金絲雀部署（Canary）:
  ✅ 風險最低（逐步驗證）
  ❌ 部署時間長

【建議】
高風險更新 + 有充足資源 → 藍綠部署
資源有限但時間充裕 → 金絲雀部署
低風險更新 → 滾動部署

【記憶點】
快速回退 = 藍綠部署
```

### 7. 實戰情境題（10 張）

**涵蓋主題**：
- 複雜問題解決
- 多工具整合
- 效能調優
- 成本優化

---

## 📖 記憶卡使用方法

### 方法 1：Anki 匯入（推薦）

1. 下載 Anki：https://apps.ankiweb.net/
2. 匯入卡片：
   ```
   File → Import → 選擇 .apkg 檔案
   ```
3. 每天複習 10-15 張

### 方法 2：間隔重複學習

**Leitner 系統**：

```
盒子 1（每天複習）
  ↓ 答對
盒子 2（每 3 天複習）
  ↓ 答對
盒子 3（每週複習）
  ↓ 答對
盒子 4（每月複習）

答錯 → 回到盒子 1
```

### 方法 3：主動回憶練習

**不要只是讀卡片！**

```
❌ 錯誤方式：
1. 看問題
2. 立即看答案
3. 想「嗯,有道理」
4. 下一張

✅ 正確方式：
1. 看問題
2. 遮住答案
3. 嘗試回答（說出聲或寫下來）
4. 檢查答案
5. 如果錯了,理解為什麼
```

---

## 🎯 學習檢查點

### Level 1：基礎掌握（完成 40 張卡片）

能夠：
- [ ] 建立基本 workflow
- [ ] 設定觸發條件
- [ ] 使用環境變數和 secrets
- [ ] 查看和理解 workflow 日誌

### Level 2：進階應用（完成 70 張卡片）

能夠：
- [ ] 配置多層次安全掃描
- [ ] 優化 workflow 效能
- [ ] 處理複雜的錯誤
- [ ] 設計多環境部署流程

### Level 3：專家級別（完成所有卡片）

能夠：
- [ ] 設計企業級 CI/CD 架構
- [ ] 診斷和解決複雜問題
- [ ] 優化成本和效能
- [ ] 指導團隊建立最佳實踐

---

## 💡 記憶技巧

### 技巧 1：建立心智模型

```
不要記：「workflow 包含 jobs,jobs 包含 steps」
而要想：「workflow 像劇本,jobs 是場景,steps 是台詞」
```

### 技巧 2：錯誤是最好的老師

```
每次 workflow 失敗：
1. 記錄錯誤訊息
2. 記錄解決方法
3. 製作成記憶卡
→ 這是最有價值的卡片！
```

### 技巧 3：連結實際經驗

```
卡片內容 + 實際使用 = 長期記憶

學完記憶卡後：
1. 在實際專案中使用
2. 遇到問題回顧卡片
3. 更新卡片內容
```

### 技巧 4：教授他人

```
最好的學習方式是教授：
- 向同事解釋 CI/CD 概念
- 寫部落格文章
- 製作教學影片
→ 教一次 = 複習十次
```

---

## 📊 學習進度追蹤

### 每日學習計畫

```
Week 1-2：基礎卡片（20 張 × 2）
  - 每天 5 張新卡片
  - 複習 10 張舊卡片

Week 3-4：進階卡片（35 張）
  - 每天 3 張新卡片
  - 複習 12 張舊卡片

Week 5：複雜情境（10 張）
  - 每天 2 張新卡片
  - 複習 15 張舊卡片

Week 6：總複習
  - 不學新卡片
  - 複習所有卡片
```

### 成效評估

**每週自我測試**：

```
隨機抽 10 張卡片：
- 8-10 張答對：優秀
- 6-7 張答對：良好
- 4-5 張答對：需加強
- < 4 張答對：重新複習
```

---

## 🔗 相關資源

### 課程理論
- 理論 5.1：GitHub Actions 整合
- 理論 5.2：安全掃描與自動修復
- 理論 5.3：自動化部署策略

### 實戰練習
- 情境題庫：18 個實戰情境
- 實作練習：2 個深度練習

### 範例配置
- Workflow 範本庫：4 個生產級範本

---

## 📝 製作你自己的記憶卡

**情境式卡片範本**：

```markdown
【情境】
[描述一個真實的問題或場景]

【分析】
[分析問題的原因或背景]

【解答】
[提供具體的解決方案]

【變化題】
[提供相關的變化情境]

【記憶點】
[提煉出最關鍵的記憶要點]
```

**範例**：

```
【情境】
你的 workflow 每次執行都很慢,但實際上程式碼沒有改變。
如何加速？

【分析】
可能每次都在重新安裝依賴,這是最耗時的步驟。
如果依賴沒變,應該使用快取。

【解答】
使用 actions/cache：
[程式碼範例]

【變化題】
Q: 如果 requirements.txt 改變了呢？
A: key 會改變,快取失效,重新安裝（正確行為）

【記憶點】
快取的 key 包含檔案 hash,確保版本一致
```

---

**開始使用記憶卡,鞏固你的 CI/CD 知識！**
