# C03ï¼šå‰ç«¯å°ˆæ¡ˆå®Œæ•´ç®¡ç·š

## ğŸ“‹ æƒ…å¢ƒè³‡è¨Š

**é›£åº¦ç­‰ç´š**ï¼šâ­â­ çµ„åˆç´š
**é ä¼°æ™‚é–“**ï¼š1.5-2 å°æ™‚
**æ ¸å¿ƒæŠ€èƒ½**ï¼šå‰ç«¯ CI/CDã€éœæ…‹ç¶²ç«™éƒ¨ç½²ã€æ•ˆèƒ½å„ªåŒ–ã€å®‰å…¨æƒæ
**å‰ç½®çŸ¥è­˜**ï¼šB01-B03 åŸºç¤ç®¡ç·šã€åŸºæœ¬ React/Vue çŸ¥è­˜

---

## ğŸ¯ æƒ…å¢ƒèƒŒæ™¯

ä½ çš„å…¬å¸æ­£åœ¨é–‹ç™¼ä¸€å€‹é›»å•†å¹³å°çš„å‰ç«¯æ‡‰ç”¨ï¼Œä½¿ç”¨ React + TypeScript + Vite æŠ€è¡“æ£§ã€‚

**ç›®å‰æŒ‘æˆ°**ï¼š
- **æ€§èƒ½å•é¡Œ**ï¼šé¦–æ¬¡è¼‰å…¥æ™‚é–“è¶…é 5 ç§’ï¼Œå½±éŸ¿ç”¨æˆ¶é«”é©—
- **å®‰å…¨é¢¨éšª**ï¼šç¬¬ä¸‰æ–¹å¥—ä»¶å­˜åœ¨å·²çŸ¥æ¼æ´ï¼Œéœ€è¦å®šæœŸæƒæ
- **éƒ¨ç½²æ··äº‚**ï¼šé–‹ç™¼è€…æ‰‹å‹•ä¸Šå‚³æª”æ¡ˆåˆ° CDNï¼Œç¶“å¸¸å‡ºéŒ¯
- **å“è³ªä¸ä¸€**ï¼šæ²’æœ‰çµ±ä¸€çš„ç¨‹å¼ç¢¼é¢¨æ ¼æª¢æŸ¥ï¼ŒPR å¯©æŸ¥å›°é›£
- **ç’°å¢ƒä¸ä¸€è‡´**ï¼šæ¸¬è©¦ç’°å¢ƒå’Œç”Ÿç”¢ç’°å¢ƒé…ç½®ä¸åŒ

**å…¬å¸è¦æ±‚**ï¼š
> ã€Œæˆ‘å€‘éœ€è¦ä¸€å€‹ç¾ä»£åŒ–çš„å‰ç«¯ CI/CD ç®¡ç·šï¼Œç¢ºä¿æ¯æ¬¡éƒ¨ç½²éƒ½æ˜¯é«˜å“è³ªã€å®‰å…¨ä¸”å„ªåŒ–çš„ã€‚ã€

**ä½ çš„ä»»å‹™**ï¼š
ç‚ºé€™å€‹ React é›»å•†å‰ç«¯å»ºç«‹å®Œæ•´çš„ CI/CD ç®¡ç·šï¼ŒåŒ…å«æ¸¬è©¦ã€å®‰å…¨ã€æ•ˆèƒ½å’Œéƒ¨ç½²ã€‚

---

## ğŸ“¦ å°ˆæ¡ˆçµæ§‹

```
ecommerce-frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ favicon.ico
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ProductCard.tsx
â”‚   â”‚   â”œâ”€â”€ ShoppingCart.tsx
â”‚   â”‚   â””â”€â”€ Checkout.tsx
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Home.tsx
â”‚   â”‚   â”œâ”€â”€ Product.tsx
â”‚   â”‚   â””â”€â”€ Cart.tsx
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useApi.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ main.tsx
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __mocks__/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ ProductCard.test.tsx
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ Home.test.tsx
â”‚   â””â”€â”€ e2e/
â”‚       â””â”€â”€ checkout.spec.ts
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .eslintrc.js
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ Dockerfile
â””â”€â”€ docker-compose.yml
```

**package.json é—œéµé…ç½®**ï¼š
```json
{
  "name": "ecommerce-frontend",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "test": "vitest",
    "test:coverage": "vitest --coverage",
    "test:e2e": "playwright test",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint src --ext ts,tsx --fix",
    "type-check": "tsc --noEmit",
    "preview": "vite preview",
    "analyze": "npx vite-bundle-analyzer"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.8.0",
    "axios": "^1.3.0",
    "zustand": "^4.3.0"
  },
  "devDependencies": {
    "@types/react": "^18.0.0",
    "@types/react-dom": "^18.0.0",
    "@typescript-eslint/eslint-plugin": "^5.0.0",
    "@vitejs/plugin-react": "^3.1.0",
    "vite": "^4.1.0",
    "vitest": "^0.28.0",
    "@testing-library/react": "^14.0.0",
    "playwright": "^1.30.0",
    "eslint": "^8.35.0",
    "prettier": "^2.8.0"
  }
}
```

---

## ğŸ¯ ä»»å‹™ç›®æ¨™

### å¿…é”ç›®æ¨™

#### 1. âœ… ç¨‹å¼ç¢¼å“è³ªç®¡ç·š
- **éœæ…‹åˆ†æ**ï¼šESLint + TypeScript é¡å‹æª¢æŸ¥
- **æ ¼å¼åŒ–**ï¼šPrettier è‡ªå‹•æ ¼å¼åŒ–
- **æ¸¬è©¦è¦†è“‹ç‡**ï¼šå–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%
- **E2E æ¸¬è©¦**ï¼šé—œéµç”¨æˆ¶æµç¨‹è‡ªå‹•åŒ–æ¸¬è©¦

#### 2. âœ… å®‰å…¨æƒæç®¡ç·š
- **ä¾è³´æƒæ**ï¼šnpm audit + Snyk æ¼æ´æª¢æ¸¬
- **æ©Ÿå¯†æƒæ**ï¼šé˜²æ­¢ API é‡‘é‘°å¤–æ´©
- **å…§å®¹å®‰å…¨ç­–ç•¥**ï¼šCSP é…ç½®æª¢æŸ¥
- **OWASP å‰ç«¯å®‰å…¨**ï¼šXSSã€CSRF é˜²è­·æª¢æŸ¥

#### 3. âœ… å»ºç½®å„ªåŒ–ç®¡ç·š
- **Bundle åˆ†æ**ï¼šè‡ªå‹•åˆ†ææ‰“åŒ…å¤§å°
- **æ•ˆèƒ½å„ªåŒ–**ï¼šTree-shakingã€ç¨‹å¼ç¢¼åˆ†å‰²
- **è³‡æºå£“ç¸®**ï¼šåœ–ç‰‡ã€CSSã€JS å£“ç¸®
- **å¿«å–å„ªåŒ–**ï¼šä¾è³´å¿«å–ã€å»ºç½®å¿«å–

#### 4. âœ… å¤šç’°å¢ƒéƒ¨ç½²
- **é–‹ç™¼ç’°å¢ƒ**ï¼šæ¯å€‹ PR è‡ªå‹•éƒ¨ç½²é è¦½ç‰ˆæœ¬
- **æ¸¬è©¦ç’°å¢ƒ**ï¼šdevelop åˆ†æ”¯è‡ªå‹•éƒ¨ç½²
- **ç”Ÿç”¢ç’°å¢ƒ**ï¼šmain åˆ†æ”¯æ‰‹å‹•å¯©æ ¸å¾Œéƒ¨ç½²
- **CDN æ•´åˆ**ï¼šè‡ªå‹•ä¸Šå‚³åˆ° CloudFront/CloudFlare

### åŠ åˆ†é …ç›®
- ğŸŒŸ Lighthouse CI æ•ˆèƒ½ç›£æ§
- ğŸŒŸ Visual Regression Testing
- ğŸŒŸ Progressive Web App æª¢æŸ¥
- ğŸŒŸ SEO å’Œ Accessibility æª¢æŸ¥

---

## ğŸ“š å­¸ç¿’æª¢æŸ¥é»

### Checkpoint 1ï¼šå‰ç«¯ç‰¹æœ‰çš„ CI/CD éœ€æ±‚
- [ ] ç†è§£å‰ç«¯å°ˆæ¡ˆèˆ‡å¾Œç«¯å°ˆæ¡ˆ CI/CD çš„å·®ç•°
- [ ] çŸ¥é“ç‚ºä»€éº¼å‰ç«¯éœ€è¦ç‰¹åˆ¥é—œæ³¨ Bundle å¤§å°
- [ ] äº†è§£éœæ…‹ç¶²ç«™éƒ¨ç½²çš„ç‰¹é»

### Checkpoint 2ï¼šæ•ˆèƒ½å„ªåŒ–è‡ªå‹•åŒ–
- [ ] æŒæ¡ Bundle åˆ†æå·¥å…·çš„ä½¿ç”¨
- [ ] ç†è§£ Tree-shaking å’Œç¨‹å¼ç¢¼åˆ†å‰²
- [ ] çŸ¥é“å¦‚ä½•åœ¨ CI ä¸­æª¢æŸ¥æ•ˆèƒ½æŒ‡æ¨™

### Checkpoint 3ï¼šå‰ç«¯å®‰å…¨æƒæ
- [ ] äº†è§£å‰ç«¯ç‰¹æœ‰çš„å®‰å…¨é¢¨éšªï¼ˆXSSã€ä¾è³´æ¼æ´ï¼‰
- [ ] æŒæ¡ CSP å’Œ HTTPS çš„é…ç½®
- [ ] çŸ¥é“å¦‚ä½•é˜²æ­¢æ©Ÿå¯†è³‡è¨Šå¤–æ´©

### Checkpoint 4ï¼šå¤šç’°å¢ƒéƒ¨ç½²ç­–ç•¥
- [ ] ç†è§£ PR Preview çš„åƒ¹å€¼å’Œå¯¦ç¾æ–¹å¼
- [ ] æŒæ¡éœæ…‹ç¶²ç«™çš„è—ç¶ éƒ¨ç½²
- [ ] äº†è§£ CDN æ•´åˆçš„æœ€ä½³å¯¦è¸

---

## ğŸš€ å¯¦ä½œæ­¥é©Ÿ

### éšæ®µ 1ï¼šå»ºç«‹ç¨‹å¼ç¢¼å“è³ªç®¡ç·šï¼ˆ30 åˆ†é˜ï¼‰

#### æ­¥é©Ÿ 1.1ï¼šç”¨ Claude ç”ŸæˆåŸºç¤ Workflow

**æç¤ºè©**ï¼š
```
æˆ‘æœ‰ä¸€å€‹ React + TypeScript + Vite çš„é›»å•†å‰ç«¯å°ˆæ¡ˆï¼Œè«‹å¹«æˆ‘å»ºç«‹ä¸€å€‹ GitHub Actions workflowï¼š

å°ˆæ¡ˆç‰¹å¾µï¼š
- ä½¿ç”¨ Vite ä½œç‚ºå»ºç½®å·¥å…·
- TypeScript + React 18
- æ¸¬è©¦ï¼šVitest + Playwright
- Lintingï¼šESLint + Prettier

éœ€æ±‚ï¼š
1. åœ¨ PR å’Œ push æ™‚è§¸ç™¼
2. ç¨‹å¼ç¢¼æ ¼å¼æª¢æŸ¥ï¼ˆPrettierï¼‰
3. éœæ…‹åˆ†æï¼ˆESLint + TypeScriptï¼‰
4. å–®å…ƒæ¸¬è©¦ï¼ˆVitest with coverageï¼‰
5. E2E æ¸¬è©¦ï¼ˆPlaywrightï¼‰
6. ä½¿ç”¨é©ç•¶çš„å¿«å–ç­–ç•¥

è«‹æä¾›å®Œæ•´çš„ .github/workflows/frontend-ci.yml é…ç½®ã€‚
```

#### æ­¥é©Ÿ 1.2ï¼šå»ºç«‹ Workflow æª”æ¡ˆ

```yaml
# .github/workflows/frontend-ci.yml
name: Frontend CI

on:
  push:
    branches: [main, develop]
    paths:
      - 'src/**'
      - 'tests/**'
      - 'public/**'
      - 'package.json'
      - 'package-lock.json'
      - 'vite.config.ts'
      - 'tsconfig.json'
  pull_request:
    branches: [main, develop]

jobs:
  quality-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # ç¨‹å¼ç¢¼æ ¼å¼æª¢æŸ¥
      - name: Check code formatting
        run: |
          npm run lint
          npx prettier --check "src/**/*.{ts,tsx,js,jsx,css,md}"

      # TypeScript é¡å‹æª¢æŸ¥
      - name: TypeScript type check
        run: npm run type-check

      # å–®å…ƒæ¸¬è©¦ + è¦†è“‹ç‡
      - name: Run unit tests
        run: npm run test:coverage

      # ä¸Šå‚³è¦†è“‹ç‡å ±å‘Š
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info

  e2e-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: Build application
        run: npm run build

      - name: Start preview server
        run: |
          npm run preview &
          npx wait-on http://localhost:4173

      - name: Run E2E tests
        run: npm run test:e2e

      - name: Upload Playwright report
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
```

### éšæ®µ 2ï¼šæ•´åˆå®‰å…¨æƒæï¼ˆ30 åˆ†é˜ï¼‰

#### æ­¥é©Ÿ 2.1ï¼šåŠ å…¥å®‰å…¨æƒæä½œæ¥­

```yaml
# åœ¨ frontend-ci.yml ä¸­åŠ å…¥
  security-scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # ä¾è³´æ¼æ´æƒæ
      - name: Run npm audit
        run: |
          npm audit --audit-level high
          npm audit --production --audit-level moderate

      # Snyk å®‰å…¨æƒæ
      - name: Run Snyk to check for vulnerabilities
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=medium

      # æ©Ÿå¯†æƒæ
      - name: Scan for secrets
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          base: ${{ github.event.repository.default_branch }}
          head: HEAD

      # æª¢æŸ¥ Content Security Policy
      - name: Build and check CSP
        run: |
          npm run build

          # æª¢æŸ¥æ˜¯å¦æœ‰å…§åµŒè…³æœ¬ï¼ˆå®‰å…¨é¢¨éšªï¼‰
          if grep -r "script.*>" dist/ --include="*.html"; then
            echo "âš ï¸ Found inline scripts - security risk"
            exit 1
          fi

          # æª¢æŸ¥æ˜¯å¦æœ‰ CSP meta tag
          if ! grep -r "Content-Security-Policy" dist/ --include="*.html"; then
            echo "âš ï¸ No CSP header found"
            exit 1
          fi
```

#### æ­¥é©Ÿ 2.2ï¼šè¨­å®šç’°å¢ƒè®Šæ•¸å®‰å…¨æª¢æŸ¥

```javascript
// scripts/check-env-security.js
const fs = require('fs');
const path = require('path');

// æª¢æŸ¥æ˜¯å¦æœ‰ç¡¬ç·¨ç¢¼çš„æ•æ„Ÿè³‡è¨Š
const sensitivePatterns = [
  /REACT_APP_API_KEY\s*=\s*['"]\w+['"]/,
  /password\s*[:=]\s*['"]\w+['"]/i,
  /secret\s*[:=]\s*['"]\w+['"]/i,
  /token\s*[:=]\s*['"]\w+['"]/i
];

function checkFile(filePath) {
  const content = fs.readFileSync(filePath, 'utf8');
  const violations = [];

  sensitivePatterns.forEach((pattern, index) => {
    if (pattern.test(content)) {
      violations.push(`Sensitive pattern ${index + 1} found in ${filePath}`);
    }
  });

  return violations;
}

// æª¢æŸ¥æ‰€æœ‰ TypeScript/JavaScript æª”æ¡ˆ
function scanDirectory(dir) {
  const files = fs.readdirSync(dir, { withFileTypes: true });
  let allViolations = [];

  for (const file of files) {
    const fullPath = path.join(dir, file.name);

    if (file.isDirectory() && !['node_modules', '.git', 'dist', 'build'].includes(file.name)) {
      allViolations = allViolations.concat(scanDirectory(fullPath));
    } else if (file.isFile() && /\.(ts|tsx|js|jsx)$/.test(file.name)) {
      allViolations = allViolations.concat(checkFile(fullPath));
    }
  }

  return allViolations;
}

const violations = scanDirectory('./src');
if (violations.length > 0) {
  console.error('ğŸš¨ Security violations found:');
  violations.forEach(v => console.error(`  ${v}`));
  process.exit(1);
} else {
  console.log('âœ… No security violations found');
}
```

### éšæ®µ 3ï¼šå»ºç½®å„ªåŒ–èˆ‡åˆ†æï¼ˆ45 åˆ†é˜ï¼‰

#### æ­¥é©Ÿ 3.1ï¼šBundle åˆ†æ Workflow

```yaml
# .github/workflows/build-analysis.yml
name: Build Analysis

on:
  pull_request:
    branches: [main]
    paths:
      - 'src/**'
      - 'package.json'
      - 'vite.config.ts'

jobs:
  analyze-bundle:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # Bundle åˆ†æ
      - name: Build and analyze bundle
        run: |
          npm run build
          npx vite-bundle-analyzer dist --open-analyzer false --analyzer-mode static

          # æª¢æŸ¥ bundle å¤§å°
          BUNDLE_SIZE=$(du -sh dist | cut -f1)
          echo "Bundle size: $BUNDLE_SIZE" >> $GITHUB_STEP_SUMMARY

          # æª¢æŸ¥æ˜¯å¦è¶…éé™åˆ¶ (ä¾‹å¦‚ 5MB)
          BUNDLE_SIZE_BYTES=$(du -s dist | cut -f1)
          if [ $BUNDLE_SIZE_BYTES -gt 5120 ]; then
            echo "âŒ Bundle size exceeds 5MB limit"
            exit 1
          fi

      # æª¢æŸ¥æœªä½¿ç”¨çš„ä¾è³´
      - name: Check for unused dependencies
        run: |
          npx depcheck --json > depcheck-report.json

          # åˆ†æå ±å‘Š
          node -e "
            const report = JSON.parse(require('fs').readFileSync('depcheck-report.json', 'utf8'));
            if (report.dependencies.length > 0) {
              console.log('âš ï¸ Unused dependencies:', report.dependencies.join(', '));
            }
            if (report.devDependencies.length > 0) {
              console.log('âš ï¸ Unused dev dependencies:', report.devDependencies.join(', '));
            }
          "

      # ç”Ÿæˆ bundle å ±å‘Š
      - name: Generate bundle report
        run: |
          cat > bundle-report.md << EOF
          ## ğŸ“¦ Bundle Analysis Report

          ### Size Analysis
          - **Total Size**: $(du -sh dist | cut -f1)
          - **Gzipped Size**: $(gzip -c dist/assets/*.js | wc -c | awk '{print int($1/1024)"KB"}')

          ### File Breakdown
          \`\`\`
          $(ls -lh dist/assets/ | grep -E '\.(js|css)$')
          \`\`\`

          ### Recommendations
          - Consider code splitting for files > 500KB
          - Check for duplicate dependencies
          - Optimize images and assets
          EOF

          echo "$(cat bundle-report.md)" >> $GITHUB_STEP_SUMMARY

      # ä¸Šå‚³ bundle åˆ†æçµæœ
      - name: Upload bundle analysis
        uses: actions/upload-artifact@v3
        with:
          name: bundle-analysis
          path: |
            dist/
            depcheck-report.json
            bundle-report.md
```

#### æ­¥é©Ÿ 3.2ï¼šæ•ˆèƒ½ç›£æ§é…ç½®

```yaml
# åœ¨ä¸» workflow ä¸­åŠ å…¥ Lighthouse CI
  lighthouse-ci:
    runs-on: ubuntu-latest
    needs: [quality-check]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Run Lighthouse CI
        uses: treosh/lighthouse-ci-action@v9
        with:
          uploadArtifacts: true
          temporaryPublicStorage: true
          configPath: '.lighthouserc.json'

      # Lighthouse é…ç½®æª”æ¡ˆ
      - name: Create Lighthouse config
        run: |
          cat > .lighthouserc.json << EOF
          {
            "ci": {
              "collect": {
                "staticDistDir": "./dist",
                "numberOfRuns": 3
              },
              "assert": {
                "assertions": {
                  "categories:performance": ["error", {"minScore": 0.8}],
                  "categories:accessibility": ["error", {"minScore": 0.9}],
                  "categories:best-practices": ["error", {"minScore": 0.85}],
                  "categories:seo": ["error", {"minScore": 0.8}]
                }
              },
              "upload": {
                "target": "temporary-public-storage"
              }
            }
          }
          EOF
```

### éšæ®µ 4ï¼šå¤šç’°å¢ƒéƒ¨ç½²é…ç½®ï¼ˆ45 åˆ†é˜ï¼‰

#### æ­¥é©Ÿ 4.1ï¼šPR é è¦½éƒ¨ç½²

```yaml
# .github/workflows/preview-deploy.yml
name: Preview Deployment

on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]

jobs:
  deploy-preview:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # å»ºç½®é è¦½ç‰ˆæœ¬
      - name: Build for preview
        run: |
          # è¨­å®šé è¦½ç’°å¢ƒè®Šæ•¸
          echo "VITE_APP_ENV=preview" >> .env
          echo "VITE_API_BASE_URL=https://api-staging.example.com" >> .env
          echo "VITE_PREVIEW_MODE=true" >> .env

          npm run build

      # éƒ¨ç½²åˆ° Vercel/Netlify
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: ./
          scope: ${{ secrets.VERCEL_ORG_ID }}

      # æˆ–è€…éƒ¨ç½²åˆ° AWS S3 + CloudFront
      - name: Deploy to S3 (Alternative)
        run: |
          # åŒæ­¥åˆ° S3 bucket
          aws s3 sync dist/ s3://preview-bucket/pr-${{ github.event.number }}/ --delete

          # è¨­å®š CloudFront å¤±æ•ˆ
          aws cloudfront create-invalidation \
            --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} \
            --paths "/pr-${{ github.event.number }}/*"
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: us-east-1

      # åœ¨ PR ä¸­ç•™ä¸‹é è¦½é€£çµè¨»è§£
      - name: Comment PR with preview link
        uses: actions/github-script@v6
        with:
          script: |
            const previewUrl = `https://preview-bucket.s3-website-us-east-1.amazonaws.com/pr-${{ github.event.number }}/`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## ğŸš€ Preview Deployment

              Your changes have been deployed to a preview environment:

              **ğŸ”— Preview URL**: ${previewUrl}

              ### Quick Links
              - ğŸ  [Home Page](${previewUrl})
              - ğŸ›’ [Product Page](${previewUrl}/products)
              - ğŸ›ï¸ [Cart](${previewUrl}/cart)

              ### Testing Checklist
              - [ ] UI looks correct on desktop
              - [ ] UI looks correct on mobile
              - [ ] All interactive elements work
              - [ ] Performance is acceptable

              ---
              *This preview will be updated automatically when you push new commits.*`
            });
```

#### æ­¥é©Ÿ 4.2ï¼šç”Ÿç”¢éƒ¨ç½² Workflow

```yaml
# .github/workflows/production-deploy.yml
name: Production Deployment

on:
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'production'
        type: choice
        options:
        - staging
        - production

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: ${{ github.event.inputs.environment || 'production' }}
      url: ${{ steps.deploy.outputs.url }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # å®‰å…¨æª¢æŸ¥ï¼ˆç”Ÿç”¢éƒ¨ç½²å‰å¿…é ˆé€šéï¼‰
      - name: Run security checks
        run: |
          npm audit --audit-level high
          npm run lint
          npm run type-check

      # å®Œæ•´æ¸¬è©¦å¥—ä»¶
      - name: Run full test suite
        run: |
          npm run test:coverage
          npm run test:e2e

      # ç”Ÿç”¢å»ºç½®
      - name: Build for production
        run: |
          # ç”Ÿç”¢ç’°å¢ƒè®Šæ•¸
          echo "VITE_APP_ENV=production" >> .env
          echo "VITE_API_BASE_URL=https://api.example.com" >> .env
          echo "VITE_CDN_URL=https://cdn.example.com" >> .env

          npm run build

          # å»ºç½®å¾Œæª¢æŸ¥
          echo "Build size: $(du -sh dist | cut -f1)"
          echo "Files count: $(find dist -type f | wc -l)"

      # éƒ¨ç½²åˆ° CDN
      - name: Deploy to production
        id: deploy
        run: |
          # åŒæ­¥åˆ°ç”Ÿç”¢ S3 bucket
          aws s3 sync dist/ s3://production-bucket/ --delete --cache-control "public,max-age=31536000,immutable"

          # å»ºç«‹ CloudFront å¤±æ•ˆ
          INVALIDATION_ID=$(aws cloudfront create-invalidation \
            --distribution-id ${{ secrets.PROD_CLOUDFRONT_DISTRIBUTION_ID }} \
            --paths "/*" \
            --query 'Invalidation.Id' \
            --output text)

          echo "url=https://ecommerce.example.com" >> $GITHUB_OUTPUT
          echo "invalidation_id=$INVALIDATION_ID" >> $GITHUB_OUTPUT
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.PROD_AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.PROD_AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: us-east-1

      # éƒ¨ç½²å¾Œé©—è­‰
      - name: Post-deployment verification
        run: |
          # ç­‰å¾… CloudFront å¤±æ•ˆå®Œæˆ
          aws cloudfront wait invalidation-completed \
            --distribution-id ${{ secrets.PROD_CLOUDFRONT_DISTRIBUTION_ID }} \
            --id ${{ steps.deploy.outputs.invalidation_id }}

          # å¥åº·æª¢æŸ¥
          for endpoint in "/" "/products" "/cart"; do
            echo "Checking https://ecommerce.example.com$endpoint"
            curl -f "https://ecommerce.example.com$endpoint" > /dev/null
          done

          echo "âœ… Production deployment verified"

      # éƒ¨ç½²é€šçŸ¥
      - name: Notify deployment success
        if: success()
        uses: 8398a7/action-slack@v3
        with:
          status: success
          channel: '#deployments'
          text: |
            ğŸš€ Frontend deployed successfully to production!

            ğŸ“Š Build Info:
            - Size: $(du -sh dist | cut -f1)
            - Commit: ${{ github.sha }}
            - Author: ${{ github.actor }}

            ğŸ”— Live URL: https://ecommerce.example.com
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}

      # å¤±æ•—å›é€€
      - name: Rollback on failure
        if: failure()
        run: |
          echo "ğŸš¨ Deployment failed, initiating rollback..."

          # å›é€€åˆ°ä¸Šä¸€å€‹ç‰ˆæœ¬ï¼ˆå‡è¨­æœ‰ç‰ˆæœ¬ç®¡ç†ï¼‰
          aws s3 sync s3://production-backup-bucket/ s3://production-bucket/ --delete

          # å»ºç«‹æ–°çš„å¤±æ•ˆ
          aws cloudfront create-invalidation \
            --distribution-id ${{ secrets.PROD_CLOUDFRONT_DISTRIBUTION_ID }} \
            --paths "/*"
```

---

## âœ… åƒè€ƒè§£ç­”

### å®Œæ•´çš„å‰ç«¯ CI/CD é…ç½®

**æ ¸å¿ƒ Workflow æ¶æ§‹**ï¼š
```
PR è§¸ç™¼ï¼š
â”œâ”€â”€ ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥
â”œâ”€â”€ å®‰å…¨æƒæ
â”œâ”€â”€ Bundle åˆ†æ
â”œâ”€â”€ é è¦½éƒ¨ç½²
â””â”€â”€ E2E æ¸¬è©¦

Push to mainï¼š
â”œâ”€â”€ å®Œæ•´æ¸¬è©¦å¥—ä»¶
â”œâ”€â”€ å®‰å…¨æª¢æŸ¥
â”œâ”€â”€ ç”Ÿç”¢å»ºç½®
â”œâ”€â”€ ç”Ÿç”¢éƒ¨ç½²
â””â”€â”€ éƒ¨ç½²é©—è­‰
```

### é—œéµé…ç½®æª”æ¡ˆ

**vite.config.ts å„ªåŒ–é…ç½®**ï¼š
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { resolve } from 'path'

export default defineConfig({
  plugins: [react()],

  // å»ºç½®å„ªåŒ–
  build: {
    target: 'es2015',
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: process.env.NODE_ENV !== 'production',

    // Bundle åˆ†å‰²
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          router: ['react-router-dom'],
          utils: ['axios', 'zustand']
        }
      }
    },

    // å£“ç¸®è¨­å®š
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  },

  // é–‹ç™¼ä¼ºæœå™¨
  server: {
    port: 3000,
    open: true
  },

  // è·¯å¾‘åˆ¥å
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@components': resolve(__dirname, 'src/components'),
      '@pages': resolve(__dirname, 'src/pages')
    }
  }
})
```

**package.json scripts å„ªåŒ–**ï¼š
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "build:staging": "tsc && vite build --mode staging",
    "build:analyze": "npm run build && npx vite-bundle-analyzer dist",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint src --ext ts,tsx --fix",
    "format": "prettier --write \"src/**/*.{ts,tsx,js,jsx,css,md}\"",
    "format:check": "prettier --check \"src/**/*.{ts,tsx,js,jsx,css,md}\"",
    "type-check": "tsc --noEmit",
    "preview": "vite preview",
    "deps:check": "depcheck",
    "deps:update": "ncu -u",
    "security:audit": "npm audit",
    "security:fix": "npm audit fix"
  }
}
```

---

## ğŸ” é©—è­‰èˆ‡é™¤éŒ¯

### é©—è­‰æ­¥é©Ÿ

**1. æœ¬åœ°é©—è­‰**
```bash
# å®Œæ•´çš„æœ¬åœ°æ¸¬è©¦æµç¨‹
npm ci
npm run lint
npm run type-check
npm run test:coverage
npm run build
npm run preview
npm run test:e2e
```

**2. CI ç®¡ç·šé©—è­‰**
```bash
# æª¢æŸ¥æ‰€æœ‰ workflow æª”æ¡ˆ
find .github/workflows -name "*.yml" -exec echo "Checking {}" \; -exec yamllint {} \;

# æ¨¡æ“¬ PR æµç¨‹
git checkout -b feature/test-ci
echo "// Test change" >> src/App.tsx
git add . && git commit -m "test: verify CI pipeline"
git push origin feature/test-ci
```

**3. éƒ¨ç½²é©—è­‰**
```bash
# æª¢æŸ¥éƒ¨ç½²çµæœ
curl -I https://your-preview-url.com
curl -I https://your-production-url.com

# æª¢æŸ¥æ•ˆèƒ½
lighthouse https://your-production-url.com --only-categories=performance
```

### å¸¸è¦‹å•é¡Œè§£æ±º

**å•é¡Œ 1ï¼šBundle éå¤§**
```bash
# åˆ†æ bundle
npm run build:analyze

# æª¢æŸ¥å¤§å‹ä¾è³´
npx webpack-bundle-analyzer dist/assets/*.js
```

**å•é¡Œ 2ï¼šæ¸¬è©¦å¤±æ•—**
```bash
# é™¤éŒ¯ E2E æ¸¬è©¦
npx playwright test --debug
npx playwright test --headed
```

**å•é¡Œ 3ï¼šéƒ¨ç½²å¤±æ•—**
```bash
# æª¢æŸ¥ S3 åŒæ­¥
aws s3 ls s3://your-bucket/
aws logs describe-log-groups --log-group-name-prefix /aws/cloudfront
```

---

## ğŸŒŸ å»¶ä¼¸æŒ‘æˆ°

### æŒ‘æˆ° 1ï¼šProgressive Web App æª¢æŸ¥
```yaml
- name: PWA Validation
  run: |
    # æª¢æŸ¥ manifest.json
    if [ ! -f dist/manifest.json ]; then
      echo "âŒ Missing PWA manifest"
      exit 1
    fi

    # æª¢æŸ¥ service worker
    if [ ! -f dist/sw.js ]; then
      echo "âŒ Missing service worker"
      exit 1
    fi

    # æª¢æŸ¥ HTTPS
    if ! grep -q "https://" dist/index.html; then
      echo "âš ï¸ Consider HTTPS for PWA"
    fi
```

### æŒ‘æˆ° 2ï¼šVisual Regression Testing
```yaml
- name: Visual Regression Test
  uses: chromaui/action@v1
  with:
    projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
    buildScriptName: build
```

### æŒ‘æˆ° 3ï¼šSEO å’Œ Accessibility è‡ªå‹•æª¢æŸ¥
```yaml
- name: SEO and A11y Check
  run: |
    # å®‰è£ pa11y
    npm install -g pa11y

    # å¯è¨ªå•æ€§æª¢æŸ¥
    pa11y http://localhost:4173

    # SEO åŸºæœ¬æª¢æŸ¥
    if ! grep -q "<title>" dist/index.html; then
      echo "âŒ Missing page title"
      exit 1
    fi

    if ! grep -q 'name="description"' dist/index.html; then
      echo "âŒ Missing meta description"
      exit 1
    fi
```

---

## ğŸ“– çŸ¥è­˜å›é¡§

å®Œæˆé€™å€‹æƒ…å¢ƒé¡Œå¾Œï¼Œä½ æ‡‰è©²æŒæ¡ï¼š

### å‰ç«¯ç‰¹æœ‰çš„ CI/CD æ¦‚å¿µ
- âœ… éœæ…‹ç¶²ç«™éƒ¨ç½²ç­–ç•¥
- âœ… Bundle åˆ†æå’Œå„ªåŒ–
- âœ… CDN æ•´åˆæœ€ä½³å¯¦è¸
- âœ… å¤šç’°å¢ƒé…ç½®ç®¡ç†

### æ•ˆèƒ½ç›£æ§è‡ªå‹•åŒ–
- âœ… Lighthouse CI æ•´åˆ
- âœ… Bundle å¤§å°ç›£æ§
- âœ… ä¾è³´åˆ†æè‡ªå‹•åŒ–
- âœ… Core Web Vitals è¿½è¹¤

### å‰ç«¯å®‰å…¨å¯¦è¸
- âœ… CSP é…ç½®é©—è­‰
- âœ… ä¾è³´æ¼æ´æƒæ
- âœ… æ©Ÿå¯†è³‡è¨Šé˜²è­·
- âœ… HTTPS å’Œå®‰å…¨æ¨™é ­

### éƒ¨ç½²è‡ªå‹•åŒ–
- âœ… PR é è¦½éƒ¨ç½²
- âœ… è—ç¶ éƒ¨ç½²ç­–ç•¥
- âœ… å›é€€æ©Ÿåˆ¶è¨­è¨ˆ
- âœ… éƒ¨ç½²å¾Œé©—è­‰

---

## ğŸ“ å­¸ç¿’ç­†è¨˜ç¯„æœ¬

```markdown
## C03 å­¸ç¿’ç­†è¨˜ - å‰ç«¯å°ˆæ¡ˆå®Œæ•´ç®¡ç·š

### å®Œæˆæ™‚é–“
[å¡«å¯«å¯¦éš›èŠ±è²»æ™‚é–“]

### é—œéµæ”¶ç©«
1. **å‰ç«¯ CI/CD ç‰¹é»**ï¼š
   - Bundle åˆ†æçš„é‡è¦æ€§
   - éœæ…‹ç¶²ç«™éƒ¨ç½²ç­–ç•¥
   - æ•ˆèƒ½ç›£æ§è‡ªå‹•åŒ–

2. **å®‰å…¨è€ƒé‡**ï¼š
   - ä¾è³´æƒæçš„å¿…è¦æ€§
   - CSP é…ç½®é©—è­‰
   - æ©Ÿå¯†è³‡è¨Šç®¡ç†

3. **éƒ¨ç½²ç­–ç•¥**ï¼š
   - PR é è¦½çš„åƒ¹å€¼
   - CDN å¿«å–ç­–ç•¥
   - éƒ¨ç½²é©—è­‰æ©Ÿåˆ¶

### é‡åˆ°çš„æŒ‘æˆ°
1. [æŒ‘æˆ°æè¿°]
   - è§£æ±ºæ–¹æ¡ˆï¼š[...]
2. [æŒ‘æˆ°æè¿°]
   - è§£æ±ºæ–¹æ¡ˆï¼š[...]

### å¯¦éš›æ‡‰ç”¨è¨ˆåŠƒ
- [ ] åœ¨å…¬å¸å°ˆæ¡ˆä¸­å¯¦æ–½ Bundle åˆ†æ
- [ ] å»ºç«‹ PR é è¦½æ©Ÿåˆ¶
- [ ] æ•´åˆ Lighthouse CI
- [ ] å„ªåŒ–éƒ¨ç½²æµç¨‹

### ä¸‹ä¸€æ­¥å­¸ç¿’
- [ ] é€²å…¥ C04 å¾Œç«¯ API ç®¡ç·š
- [ ] æ·±å…¥å­¸ç¿’ PWA éƒ¨ç½²
- [ ] ç ”ç©¶å¾®å‰ç«¯ CI/CD
```

---

**æ­å–œå®Œæˆ C03ï¼** ä½ å·²ç¶“æŒæ¡äº†ç¾ä»£å‰ç«¯å°ˆæ¡ˆçš„å®Œæ•´ CI/CD å¯¦ä½œã€‚ç¹¼çºŒå‰å¾€ `C04_å¾Œç«¯APIå®Œæ•´ç®¡ç·š.md` â†’