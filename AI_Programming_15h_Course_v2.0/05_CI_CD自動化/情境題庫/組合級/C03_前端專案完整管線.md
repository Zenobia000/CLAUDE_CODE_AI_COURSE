# C03：前端專案完整管線

## 📋 情境資訊

**難度等級**：⭐⭐ 組合級
**預估時間**：1.5-2 小時
**核心技能**：前端 CI/CD、靜態網站部署、效能優化、安全掃描
**前置知識**：B01-B03 基礎管線、基本 React/Vue 知識

---

## 🎯 情境背景

你的公司正在開發一個電商平台的前端應用，使用 React + TypeScript + Vite 技術棧。

**目前挑戰**：
- **性能問題**：首次載入時間超過 5 秒，影響用戶體驗
- **安全風險**：第三方套件存在已知漏洞，需要定期掃描
- **部署混亂**：開發者手動上傳檔案到 CDN，經常出錯
- **品質不一**：沒有統一的程式碼風格檢查，PR 審查困難
- **環境不一致**：測試環境和生產環境配置不同

**公司要求**：
> 「我們需要一個現代化的前端 CI/CD 管線，確保每次部署都是高品質、安全且優化的。」

**你的任務**：
為這個 React 電商前端建立完整的 CI/CD 管線，包含測試、安全、效能和部署。

---

## 📦 專案結構

```
ecommerce-frontend/
├── public/
│   ├── index.html
│   └── favicon.ico
│
├── src/
│   ├── components/
│   │   ├── ProductCard.tsx
│   │   ├── ShoppingCart.tsx
│   │   └── Checkout.tsx
│   ├── pages/
│   │   ├── Home.tsx
│   │   ├── Product.tsx
│   │   └── Cart.tsx
│   ├── hooks/
│   │   └── useApi.ts
│   ├── utils/
│   │   └── api.ts
│   ├── App.tsx
│   └── main.tsx
│
├── tests/
│   ├── __mocks__/
│   ├── components/
│   │   └── ProductCard.test.tsx
│   ├── pages/
│   │   └── Home.test.tsx
│   └── e2e/
│       └── checkout.spec.ts
│
├── package.json
├── vite.config.ts
├── tsconfig.json
├── .eslintrc.js
├── .prettierrc
├── Dockerfile
└── docker-compose.yml
```

**package.json 關鍵配置**：
```json
{
  "name": "ecommerce-frontend",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "test": "vitest",
    "test:coverage": "vitest --coverage",
    "test:e2e": "playwright test",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint src --ext ts,tsx --fix",
    "type-check": "tsc --noEmit",
    "preview": "vite preview",
    "analyze": "npx vite-bundle-analyzer"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.8.0",
    "axios": "^1.3.0",
    "zustand": "^4.3.0"
  },
  "devDependencies": {
    "@types/react": "^18.0.0",
    "@types/react-dom": "^18.0.0",
    "@typescript-eslint/eslint-plugin": "^5.0.0",
    "@vitejs/plugin-react": "^3.1.0",
    "vite": "^4.1.0",
    "vitest": "^0.28.0",
    "@testing-library/react": "^14.0.0",
    "playwright": "^1.30.0",
    "eslint": "^8.35.0",
    "prettier": "^2.8.0"
  }
}
```

---

## 🎯 任務目標

### 必達目標

#### 1. ✅ 程式碼品質管線
- **靜態分析**：ESLint + TypeScript 類型檢查
- **格式化**：Prettier 自動格式化
- **測試覆蓋率**：單元測試覆蓋率 > 80%
- **E2E 測試**：關鍵用戶流程自動化測試

#### 2. ✅ 安全掃描管線
- **依賴掃描**：npm audit + Snyk 漏洞檢測
- **機密掃描**：防止 API 金鑰外洩
- **內容安全策略**：CSP 配置檢查
- **OWASP 前端安全**：XSS、CSRF 防護檢查

#### 3. ✅ 建置優化管線
- **Bundle 分析**：自動分析打包大小
- **效能優化**：Tree-shaking、程式碼分割
- **資源壓縮**：圖片、CSS、JS 壓縮
- **快取優化**：依賴快取、建置快取

#### 4. ✅ 多環境部署
- **開發環境**：每個 PR 自動部署預覽版本
- **測試環境**：develop 分支自動部署
- **生產環境**：main 分支手動審核後部署
- **CDN 整合**：自動上傳到 CloudFront/CloudFlare

### 加分項目
- 🌟 Lighthouse CI 效能監控
- 🌟 Visual Regression Testing
- 🌟 Progressive Web App 檢查
- 🌟 SEO 和 Accessibility 檢查

---

## 📚 學習檢查點

### Checkpoint 1：前端特有的 CI/CD 需求
- [ ] 理解前端專案與後端專案 CI/CD 的差異
- [ ] 知道為什麼前端需要特別關注 Bundle 大小
- [ ] 了解靜態網站部署的特點

### Checkpoint 2：效能優化自動化
- [ ] 掌握 Bundle 分析工具的使用
- [ ] 理解 Tree-shaking 和程式碼分割
- [ ] 知道如何在 CI 中檢查效能指標

### Checkpoint 3：前端安全掃描
- [ ] 了解前端特有的安全風險（XSS、依賴漏洞）
- [ ] 掌握 CSP 和 HTTPS 的配置
- [ ] 知道如何防止機密資訊外洩

### Checkpoint 4：多環境部署策略
- [ ] 理解 PR Preview 的價值和實現方式
- [ ] 掌握靜態網站的藍綠部署
- [ ] 了解 CDN 整合的最佳實踐

---

## 🚀 實作步驟

### 階段 1：建立程式碼品質管線（30 分鐘）

#### 步驟 1.1：用 Claude 生成基礎 Workflow

**提示詞**：
```
我有一個 React + TypeScript + Vite 的電商前端專案，請幫我建立一個 GitHub Actions workflow：

專案特徵：
- 使用 Vite 作為建置工具
- TypeScript + React 18
- 測試：Vitest + Playwright
- Linting：ESLint + Prettier

需求：
1. 在 PR 和 push 時觸發
2. 程式碼格式檢查（Prettier）
3. 靜態分析（ESLint + TypeScript）
4. 單元測試（Vitest with coverage）
5. E2E 測試（Playwright）
6. 使用適當的快取策略

請提供完整的 .github/workflows/frontend-ci.yml 配置。
```

#### 步驟 1.2：建立 Workflow 檔案

```yaml
# .github/workflows/frontend-ci.yml
name: Frontend CI

on:
  push:
    branches: [main, develop]
    paths:
      - 'src/**'
      - 'tests/**'
      - 'public/**'
      - 'package.json'
      - 'package-lock.json'
      - 'vite.config.ts'
      - 'tsconfig.json'
  pull_request:
    branches: [main, develop]

jobs:
  quality-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # 程式碼格式檢查
      - name: Check code formatting
        run: |
          npm run lint
          npx prettier --check "src/**/*.{ts,tsx,js,jsx,css,md}"

      # TypeScript 類型檢查
      - name: TypeScript type check
        run: npm run type-check

      # 單元測試 + 覆蓋率
      - name: Run unit tests
        run: npm run test:coverage

      # 上傳覆蓋率報告
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info

  e2e-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: Build application
        run: npm run build

      - name: Start preview server
        run: |
          npm run preview &
          npx wait-on http://localhost:4173

      - name: Run E2E tests
        run: npm run test:e2e

      - name: Upload Playwright report
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
```

### 階段 2：整合安全掃描（30 分鐘）

#### 步驟 2.1：加入安全掃描作業

```yaml
# 在 frontend-ci.yml 中加入
  security-scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # 依賴漏洞掃描
      - name: Run npm audit
        run: |
          npm audit --audit-level high
          npm audit --production --audit-level moderate

      # Snyk 安全掃描
      - name: Run Snyk to check for vulnerabilities
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=medium

      # 機密掃描
      - name: Scan for secrets
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          base: ${{ github.event.repository.default_branch }}
          head: HEAD

      # 檢查 Content Security Policy
      - name: Build and check CSP
        run: |
          npm run build

          # 檢查是否有內嵌腳本（安全風險）
          if grep -r "script.*>" dist/ --include="*.html"; then
            echo "⚠️ Found inline scripts - security risk"
            exit 1
          fi

          # 檢查是否有 CSP meta tag
          if ! grep -r "Content-Security-Policy" dist/ --include="*.html"; then
            echo "⚠️ No CSP header found"
            exit 1
          fi
```

#### 步驟 2.2：設定環境變數安全檢查

```javascript
// scripts/check-env-security.js
const fs = require('fs');
const path = require('path');

// 檢查是否有硬編碼的敏感資訊
const sensitivePatterns = [
  /REACT_APP_API_KEY\s*=\s*['"]\w+['"]/,
  /password\s*[:=]\s*['"]\w+['"]/i,
  /secret\s*[:=]\s*['"]\w+['"]/i,
  /token\s*[:=]\s*['"]\w+['"]/i
];

function checkFile(filePath) {
  const content = fs.readFileSync(filePath, 'utf8');
  const violations = [];

  sensitivePatterns.forEach((pattern, index) => {
    if (pattern.test(content)) {
      violations.push(`Sensitive pattern ${index + 1} found in ${filePath}`);
    }
  });

  return violations;
}

// 檢查所有 TypeScript/JavaScript 檔案
function scanDirectory(dir) {
  const files = fs.readdirSync(dir, { withFileTypes: true });
  let allViolations = [];

  for (const file of files) {
    const fullPath = path.join(dir, file.name);

    if (file.isDirectory() && !['node_modules', '.git', 'dist', 'build'].includes(file.name)) {
      allViolations = allViolations.concat(scanDirectory(fullPath));
    } else if (file.isFile() && /\.(ts|tsx|js|jsx)$/.test(file.name)) {
      allViolations = allViolations.concat(checkFile(fullPath));
    }
  }

  return allViolations;
}

const violations = scanDirectory('./src');
if (violations.length > 0) {
  console.error('🚨 Security violations found:');
  violations.forEach(v => console.error(`  ${v}`));
  process.exit(1);
} else {
  console.log('✅ No security violations found');
}
```

### 階段 3：建置優化與分析（45 分鐘）

#### 步驟 3.1：Bundle 分析 Workflow

```yaml
# .github/workflows/build-analysis.yml
name: Build Analysis

on:
  pull_request:
    branches: [main]
    paths:
      - 'src/**'
      - 'package.json'
      - 'vite.config.ts'

jobs:
  analyze-bundle:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # Bundle 分析
      - name: Build and analyze bundle
        run: |
          npm run build
          npx vite-bundle-analyzer dist --open-analyzer false --analyzer-mode static

          # 檢查 bundle 大小
          BUNDLE_SIZE=$(du -sh dist | cut -f1)
          echo "Bundle size: $BUNDLE_SIZE" >> $GITHUB_STEP_SUMMARY

          # 檢查是否超過限制 (例如 5MB)
          BUNDLE_SIZE_BYTES=$(du -s dist | cut -f1)
          if [ $BUNDLE_SIZE_BYTES -gt 5120 ]; then
            echo "❌ Bundle size exceeds 5MB limit"
            exit 1
          fi

      # 檢查未使用的依賴
      - name: Check for unused dependencies
        run: |
          npx depcheck --json > depcheck-report.json

          # 分析報告
          node -e "
            const report = JSON.parse(require('fs').readFileSync('depcheck-report.json', 'utf8'));
            if (report.dependencies.length > 0) {
              console.log('⚠️ Unused dependencies:', report.dependencies.join(', '));
            }
            if (report.devDependencies.length > 0) {
              console.log('⚠️ Unused dev dependencies:', report.devDependencies.join(', '));
            }
          "

      # 生成 bundle 報告
      - name: Generate bundle report
        run: |
          cat > bundle-report.md << EOF
          ## 📦 Bundle Analysis Report

          ### Size Analysis
          - **Total Size**: $(du -sh dist | cut -f1)
          - **Gzipped Size**: $(gzip -c dist/assets/*.js | wc -c | awk '{print int($1/1024)"KB"}')

          ### File Breakdown
          \`\`\`
          $(ls -lh dist/assets/ | grep -E '\.(js|css)$')
          \`\`\`

          ### Recommendations
          - Consider code splitting for files > 500KB
          - Check for duplicate dependencies
          - Optimize images and assets
          EOF

          echo "$(cat bundle-report.md)" >> $GITHUB_STEP_SUMMARY

      # 上傳 bundle 分析結果
      - name: Upload bundle analysis
        uses: actions/upload-artifact@v3
        with:
          name: bundle-analysis
          path: |
            dist/
            depcheck-report.json
            bundle-report.md
```

#### 步驟 3.2：效能監控配置

```yaml
# 在主 workflow 中加入 Lighthouse CI
  lighthouse-ci:
    runs-on: ubuntu-latest
    needs: [quality-check]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Run Lighthouse CI
        uses: treosh/lighthouse-ci-action@v9
        with:
          uploadArtifacts: true
          temporaryPublicStorage: true
          configPath: '.lighthouserc.json'

      # Lighthouse 配置檔案
      - name: Create Lighthouse config
        run: |
          cat > .lighthouserc.json << EOF
          {
            "ci": {
              "collect": {
                "staticDistDir": "./dist",
                "numberOfRuns": 3
              },
              "assert": {
                "assertions": {
                  "categories:performance": ["error", {"minScore": 0.8}],
                  "categories:accessibility": ["error", {"minScore": 0.9}],
                  "categories:best-practices": ["error", {"minScore": 0.85}],
                  "categories:seo": ["error", {"minScore": 0.8}]
                }
              },
              "upload": {
                "target": "temporary-public-storage"
              }
            }
          }
          EOF
```

### 階段 4：多環境部署配置（45 分鐘）

#### 步驟 4.1：PR 預覽部署

```yaml
# .github/workflows/preview-deploy.yml
name: Preview Deployment

on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]

jobs:
  deploy-preview:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # 建置預覽版本
      - name: Build for preview
        run: |
          # 設定預覽環境變數
          echo "VITE_APP_ENV=preview" >> .env
          echo "VITE_API_BASE_URL=https://api-staging.example.com" >> .env
          echo "VITE_PREVIEW_MODE=true" >> .env

          npm run build

      # 部署到 Vercel/Netlify
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: ./
          scope: ${{ secrets.VERCEL_ORG_ID }}

      # 或者部署到 AWS S3 + CloudFront
      - name: Deploy to S3 (Alternative)
        run: |
          # 同步到 S3 bucket
          aws s3 sync dist/ s3://preview-bucket/pr-${{ github.event.number }}/ --delete

          # 設定 CloudFront 失效
          aws cloudfront create-invalidation \
            --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} \
            --paths "/pr-${{ github.event.number }}/*"
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: us-east-1

      # 在 PR 中留下預覽連結註解
      - name: Comment PR with preview link
        uses: actions/github-script@v6
        with:
          script: |
            const previewUrl = `https://preview-bucket.s3-website-us-east-1.amazonaws.com/pr-${{ github.event.number }}/`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## 🚀 Preview Deployment

              Your changes have been deployed to a preview environment:

              **🔗 Preview URL**: ${previewUrl}

              ### Quick Links
              - 🏠 [Home Page](${previewUrl})
              - 🛒 [Product Page](${previewUrl}/products)
              - 🛍️ [Cart](${previewUrl}/cart)

              ### Testing Checklist
              - [ ] UI looks correct on desktop
              - [ ] UI looks correct on mobile
              - [ ] All interactive elements work
              - [ ] Performance is acceptable

              ---
              *This preview will be updated automatically when you push new commits.*`
            });
```

#### 步驟 4.2：生產部署 Workflow

```yaml
# .github/workflows/production-deploy.yml
name: Production Deployment

on:
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'production'
        type: choice
        options:
        - staging
        - production

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: ${{ github.event.inputs.environment || 'production' }}
      url: ${{ steps.deploy.outputs.url }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # 安全檢查（生產部署前必須通過）
      - name: Run security checks
        run: |
          npm audit --audit-level high
          npm run lint
          npm run type-check

      # 完整測試套件
      - name: Run full test suite
        run: |
          npm run test:coverage
          npm run test:e2e

      # 生產建置
      - name: Build for production
        run: |
          # 生產環境變數
          echo "VITE_APP_ENV=production" >> .env
          echo "VITE_API_BASE_URL=https://api.example.com" >> .env
          echo "VITE_CDN_URL=https://cdn.example.com" >> .env

          npm run build

          # 建置後檢查
          echo "Build size: $(du -sh dist | cut -f1)"
          echo "Files count: $(find dist -type f | wc -l)"

      # 部署到 CDN
      - name: Deploy to production
        id: deploy
        run: |
          # 同步到生產 S3 bucket
          aws s3 sync dist/ s3://production-bucket/ --delete --cache-control "public,max-age=31536000,immutable"

          # 建立 CloudFront 失效
          INVALIDATION_ID=$(aws cloudfront create-invalidation \
            --distribution-id ${{ secrets.PROD_CLOUDFRONT_DISTRIBUTION_ID }} \
            --paths "/*" \
            --query 'Invalidation.Id' \
            --output text)

          echo "url=https://ecommerce.example.com" >> $GITHUB_OUTPUT
          echo "invalidation_id=$INVALIDATION_ID" >> $GITHUB_OUTPUT
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.PROD_AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.PROD_AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: us-east-1

      # 部署後驗證
      - name: Post-deployment verification
        run: |
          # 等待 CloudFront 失效完成
          aws cloudfront wait invalidation-completed \
            --distribution-id ${{ secrets.PROD_CLOUDFRONT_DISTRIBUTION_ID }} \
            --id ${{ steps.deploy.outputs.invalidation_id }}

          # 健康檢查
          for endpoint in "/" "/products" "/cart"; do
            echo "Checking https://ecommerce.example.com$endpoint"
            curl -f "https://ecommerce.example.com$endpoint" > /dev/null
          done

          echo "✅ Production deployment verified"

      # 部署通知
      - name: Notify deployment success
        if: success()
        uses: 8398a7/action-slack@v3
        with:
          status: success
          channel: '#deployments'
          text: |
            🚀 Frontend deployed successfully to production!

            📊 Build Info:
            - Size: $(du -sh dist | cut -f1)
            - Commit: ${{ github.sha }}
            - Author: ${{ github.actor }}

            🔗 Live URL: https://ecommerce.example.com
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}

      # 失敗回退
      - name: Rollback on failure
        if: failure()
        run: |
          echo "🚨 Deployment failed, initiating rollback..."

          # 回退到上一個版本（假設有版本管理）
          aws s3 sync s3://production-backup-bucket/ s3://production-bucket/ --delete

          # 建立新的失效
          aws cloudfront create-invalidation \
            --distribution-id ${{ secrets.PROD_CLOUDFRONT_DISTRIBUTION_ID }} \
            --paths "/*"
```

---

## ✅ 參考解答

### 完整的前端 CI/CD 配置

**核心 Workflow 架構**：
```
PR 觸發：
├── 程式碼品質檢查
├── 安全掃描
├── Bundle 分析
├── 預覽部署
└── E2E 測試

Push to main：
├── 完整測試套件
├── 安全檢查
├── 生產建置
├── 生產部署
└── 部署驗證
```

### 關鍵配置檔案

**vite.config.ts 優化配置**：
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { resolve } from 'path'

export default defineConfig({
  plugins: [react()],

  // 建置優化
  build: {
    target: 'es2015',
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: process.env.NODE_ENV !== 'production',

    // Bundle 分割
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          router: ['react-router-dom'],
          utils: ['axios', 'zustand']
        }
      }
    },

    // 壓縮設定
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  },

  // 開發伺服器
  server: {
    port: 3000,
    open: true
  },

  // 路徑別名
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@components': resolve(__dirname, 'src/components'),
      '@pages': resolve(__dirname, 'src/pages')
    }
  }
})
```

**package.json scripts 優化**：
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "build:staging": "tsc && vite build --mode staging",
    "build:analyze": "npm run build && npx vite-bundle-analyzer dist",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint src --ext ts,tsx --fix",
    "format": "prettier --write \"src/**/*.{ts,tsx,js,jsx,css,md}\"",
    "format:check": "prettier --check \"src/**/*.{ts,tsx,js,jsx,css,md}\"",
    "type-check": "tsc --noEmit",
    "preview": "vite preview",
    "deps:check": "depcheck",
    "deps:update": "ncu -u",
    "security:audit": "npm audit",
    "security:fix": "npm audit fix"
  }
}
```

---

## 🔍 驗證與除錯

### 驗證步驟

**1. 本地驗證**
```bash
# 完整的本地測試流程
npm ci
npm run lint
npm run type-check
npm run test:coverage
npm run build
npm run preview
npm run test:e2e
```

**2. CI 管線驗證**
```bash
# 檢查所有 workflow 檔案
find .github/workflows -name "*.yml" -exec echo "Checking {}" \; -exec yamllint {} \;

# 模擬 PR 流程
git checkout -b feature/test-ci
echo "// Test change" >> src/App.tsx
git add . && git commit -m "test: verify CI pipeline"
git push origin feature/test-ci
```

**3. 部署驗證**
```bash
# 檢查部署結果
curl -I https://your-preview-url.com
curl -I https://your-production-url.com

# 檢查效能
lighthouse https://your-production-url.com --only-categories=performance
```

### 常見問題解決

**問題 1：Bundle 過大**
```bash
# 分析 bundle
npm run build:analyze

# 檢查大型依賴
npx webpack-bundle-analyzer dist/assets/*.js
```

**問題 2：測試失敗**
```bash
# 除錯 E2E 測試
npx playwright test --debug
npx playwright test --headed
```

**問題 3：部署失敗**
```bash
# 檢查 S3 同步
aws s3 ls s3://your-bucket/
aws logs describe-log-groups --log-group-name-prefix /aws/cloudfront
```

---

## 🌟 延伸挑戰

### 挑戰 1：Progressive Web App 檢查
```yaml
- name: PWA Validation
  run: |
    # 檢查 manifest.json
    if [ ! -f dist/manifest.json ]; then
      echo "❌ Missing PWA manifest"
      exit 1
    fi

    # 檢查 service worker
    if [ ! -f dist/sw.js ]; then
      echo "❌ Missing service worker"
      exit 1
    fi

    # 檢查 HTTPS
    if ! grep -q "https://" dist/index.html; then
      echo "⚠️ Consider HTTPS for PWA"
    fi
```

### 挑戰 2：Visual Regression Testing
```yaml
- name: Visual Regression Test
  uses: chromaui/action@v1
  with:
    projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
    buildScriptName: build
```

### 挑戰 3：SEO 和 Accessibility 自動檢查
```yaml
- name: SEO and A11y Check
  run: |
    # 安裝 pa11y
    npm install -g pa11y

    # 可訪問性檢查
    pa11y http://localhost:4173

    # SEO 基本檢查
    if ! grep -q "<title>" dist/index.html; then
      echo "❌ Missing page title"
      exit 1
    fi

    if ! grep -q 'name="description"' dist/index.html; then
      echo "❌ Missing meta description"
      exit 1
    fi
```

---

## 📖 知識回顧

完成這個情境題後，你應該掌握：

### 前端特有的 CI/CD 概念
- ✅ 靜態網站部署策略
- ✅ Bundle 分析和優化
- ✅ CDN 整合最佳實踐
- ✅ 多環境配置管理

### 效能監控自動化
- ✅ Lighthouse CI 整合
- ✅ Bundle 大小監控
- ✅ 依賴分析自動化
- ✅ Core Web Vitals 追蹤

### 前端安全實踐
- ✅ CSP 配置驗證
- ✅ 依賴漏洞掃描
- ✅ 機密資訊防護
- ✅ HTTPS 和安全標頭

### 部署自動化
- ✅ PR 預覽部署
- ✅ 藍綠部署策略
- ✅ 回退機制設計
- ✅ 部署後驗證

---

## 📝 學習筆記範本

```markdown
## C03 學習筆記 - 前端專案完整管線

### 完成時間
[填寫實際花費時間]

### 關鍵收穫
1. **前端 CI/CD 特點**：
   - Bundle 分析的重要性
   - 靜態網站部署策略
   - 效能監控自動化

2. **安全考量**：
   - 依賴掃描的必要性
   - CSP 配置驗證
   - 機密資訊管理

3. **部署策略**：
   - PR 預覽的價值
   - CDN 快取策略
   - 部署驗證機制

### 遇到的挑戰
1. [挑戰描述]
   - 解決方案：[...]
2. [挑戰描述]
   - 解決方案：[...]

### 實際應用計劃
- [ ] 在公司專案中實施 Bundle 分析
- [ ] 建立 PR 預覽機制
- [ ] 整合 Lighthouse CI
- [ ] 優化部署流程

### 下一步學習
- [ ] 進入 C04 後端 API 管線
- [ ] 深入學習 PWA 部署
- [ ] 研究微前端 CI/CD
```

---

**恭喜完成 C03！** 你已經掌握了現代前端專案的完整 CI/CD 實作。繼續前往 `C04_後端API完整管線.md` →