# C02ï¼šå¤šç’°å¢ƒéƒ¨ç½²ç­–ç•¥

## ğŸ“‹ æƒ…å¢ƒè³‡è¨Š

**é›£åº¦ç­‰ç´š**ï¼šâ­â­ çµ„åˆç´š
**é ä¼°æ™‚é–“**ï¼š2 å°æ™‚
**æ ¸å¿ƒæŠ€èƒ½**ï¼šå¤šç’°å¢ƒç®¡ç†ã€éƒ¨ç½²ç­–ç•¥ã€ç’°å¢ƒé…ç½®ã€å›é€€æ©Ÿåˆ¶
**å‰ç½®çŸ¥è­˜**ï¼šåŸºç¤ç´š B01-B06ï¼Œå»ºè­°å…ˆå®Œæˆ C01

---

## ğŸ¯ æƒ…å¢ƒèƒŒæ™¯

ä½ å‰›åŠ å…¥ä¸€å®¶å¿«é€Ÿæˆé•·çš„ SaaS å…¬å¸ï¼Œè² è²¬æ”¹å–„ä»–å€‘æ··äº‚çš„éƒ¨ç½²æµç¨‹ã€‚ç›®å‰å…¬å¸æœ‰ 3 å€‹ç’°å¢ƒï¼Œä½†éƒ¨ç½²æ–¹å¼å„ä¸ç›¸åŒï¼Œç¶“å¸¸å‡ºå•é¡Œã€‚

**å…¬å¸ç¾æ³**ï¼š
- **é–‹ç™¼ç’°å¢ƒï¼ˆDevï¼‰**ï¼šé–‹ç™¼è€…æœ¬æ©Ÿ + å…±ç”¨ staging server
- **æ¸¬è©¦ç’°å¢ƒï¼ˆStagingï¼‰**ï¼šæ‰‹å‹•éƒ¨ç½²ï¼Œç¶“å¸¸å’Œç”Ÿç”¢ç’°å¢ƒä¸ä¸€è‡´
- **ç”Ÿç”¢ç’°å¢ƒï¼ˆProductionï¼‰**ï¼šåªæœ‰ CTO æœ‰æ¬Šé™ï¼Œæ¯é€±äº”ä¸‹åˆéƒ¨ç½²ï¼ˆé«˜é¢¨éšªï¼‰

**ä¸Šå€‹æœˆçš„éƒ¨ç½²ç½é›£**ï¼š
```bash
# 2024-10-15 é€±äº”æ™šä¸Š 8:00 PM
äº‹ä»¶ï¼šç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²å¤±æ•—å°è‡´æœå‹™ä¸­æ–· 6 å°æ™‚

æ™‚é–“è»¸ï¼š
17:30 - é–‹ç™¼å®Œæˆæ–°åŠŸèƒ½ï¼Œstaging æ¸¬è©¦æ­£å¸¸
18:00 - CTO é–‹å§‹æ‰‹å‹•éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
18:15 - éƒ¨ç½²éç¨‹ä¸­ç™¼ç¾ç’°å¢ƒè®Šæ•¸é…ç½®ä¸åŒ
18:30 - å˜—è©¦ä¿®å¾©ï¼Œä½†æå£äº†è³‡æ–™åº«é€£ç·š
19:00 - ç·Šæ€¥å›é€€ï¼Œä½†æ²’æœ‰è‡ªå‹•å›é€€æ©Ÿåˆ¶
21:00 - åŠ ç­å·¥ç¨‹å¸«æ‰¾åˆ°å•é¡Œï¼šproduction ç”¨ PostgreSQL 14ï¼Œstaging ç”¨ 13
00:30 - æœ€çµ‚ä¿®å¾©ï¼Œå®¢æˆ¶æŠ•è¨´ä¸æ–·

æå¤±ï¼š
- æœå‹™ä¸­æ–· 6 å°æ™‚
- å½±éŸ¿ 50,000+ ç”¨æˆ¶
- å®¢æˆ¶é€€æ¬¾ $30,000
- åœ˜éšŠé€±æœ«åŠ ç­
```

**CTO çš„ç—›è‹¦åæ€**ï¼š
> ã€Œæˆ‘å€‘ä¸èƒ½å†é€™æ¨£ä¸‹å»äº†ï¼æ¯æ¬¡éƒ¨ç½²éƒ½åƒåœ¨è³­åšã€‚æˆ‘å€‘éœ€è¦å°ˆæ¥­çš„å¤šç’°å¢ƒéƒ¨ç½²ç­–ç•¥ï¼Œç¢ºä¿æ¯å€‹ç’°å¢ƒéƒ½ä¸€è‡´ï¼Œéƒ¨ç½²éç¨‹å¯é æ¸¬ä¸”å¯å›é€€ã€‚ã€

**å…·é«”è¦æ±‚**ï¼š
1. **ç’°å¢ƒä¸€è‡´æ€§**ï¼šDevã€Stagingã€Production ç’°å¢ƒç›¡å¯èƒ½ä¸€è‡´
2. **è‡ªå‹•åŒ–éƒ¨ç½²**ï¼šä¸åŒç’°å¢ƒç”¨ä¸åŒç­–ç•¥ï¼ˆå®‰å…¨æ€§ vs é€Ÿåº¦ï¼‰
3. **é…ç½®ç®¡ç†**ï¼šæ•æ„Ÿè³‡è¨Šå®‰å…¨ç®¡ç†ï¼Œç’°å¢ƒå·®ç•°æ˜ç¢ºæ§åˆ¶
4. **å“è³ªé–€æ§**ï¼šæ¯å€‹ç’°å¢ƒéƒ½æœ‰å°æ‡‰çš„é©—è­‰æ¨™æº–
5. **å¿«é€Ÿå›é€€**ï¼šä»»ä½•ç’°å¢ƒå‡ºå•é¡Œéƒ½èƒ½å¿«é€Ÿå›é€€

**ä½ çš„ä»»å‹™**ï¼š
è¨­è¨ˆä¸¦å¯¦ä½œä¼æ¥­ç´šçš„å¤šç’°å¢ƒéƒ¨ç½²ç­–ç•¥ï¼Œæ¶µè“‹ç’°å¢ƒç®¡ç†ã€éƒ¨ç½²æµç¨‹ã€é…ç½®ç®¡ç†å’Œç›£æ§å‘Šè­¦ã€‚

---

## ğŸ“¦ å°ˆæ¡ˆçµæ§‹

é€™æ˜¯ä¸€å€‹å…¸å‹çš„ SaaS æ‡‰ç”¨ï¼š

```
saas-platform/
â”œâ”€â”€ application/                       # ä¸»æ‡‰ç”¨
â”‚   â”œâ”€â”€ backend/                      # FastAPI å¾Œç«¯
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â””â”€â”€ alembic/                  # è³‡æ–™åº«é·ç§»
â”‚   â”‚
â”‚   â”œâ”€â”€ frontend/                     # React å‰ç«¯
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â””â”€â”€ public/
â”‚   â”‚
â”‚   â””â”€â”€ worker/                       # Celery èƒŒæ™¯ä»»å‹™
â”‚       â”œâ”€â”€ src/
â”‚       â”œâ”€â”€ requirements.txt
â”‚       â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ infrastructure/                    # åŸºç¤è¨­æ–½
â”‚   â”œâ”€â”€ environments/
â”‚   â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”‚   â”œâ”€â”€ terraform/
â”‚   â”‚   â”‚   â”œâ”€â”€ kubernetes/
â”‚   â”‚   â”‚   â””â”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ staging/
â”‚   â”‚   â”‚   â”œâ”€â”€ terraform/
â”‚   â”‚   â”‚   â”œâ”€â”€ kubernetes/
â”‚   â”‚   â”‚   â””â”€â”€ config/
â”‚   â”‚   â””â”€â”€ production/
â”‚   â”‚       â”œâ”€â”€ terraform/
â”‚   â”‚       â”œâ”€â”€ kubernetes/
â”‚   â”‚       â””â”€â”€ config/
â”‚   â”‚
â”‚   â””â”€â”€ shared/                       # å…±ç”¨åŸºç¤è¨­æ–½
â”‚       â”œâ”€â”€ monitoring/
â”‚       â”œâ”€â”€ logging/
â”‚       â””â”€â”€ security/
â”‚
â”œâ”€â”€ deployment/                       # éƒ¨ç½²è…³æœ¬å’Œé…ç½®
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ deploy.sh
â”‚   â”‚   â”œâ”€â”€ rollback.sh
â”‚   â”‚   â”œâ”€â”€ health-check.sh
â”‚   â”‚   â””â”€â”€ database-migrate.sh
â”‚   â”‚
â”‚   â”œâ”€â”€ configs/
â”‚   â”‚   â”œâ”€â”€ dev.env
â”‚   â”‚   â”œâ”€â”€ staging.env
â”‚   â”‚   â””â”€â”€ production.env.template
â”‚   â”‚
â”‚   â””â”€â”€ helm-charts/
â”‚       â”œâ”€â”€ backend/
â”‚       â”œâ”€â”€ frontend/
â”‚       â””â”€â”€ worker/
â”‚
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ deploy-dev.yml           # é–‹ç™¼ç’°å¢ƒéƒ¨ç½²
â”‚   â”‚   â”œâ”€â”€ deploy-staging.yml       # æ¸¬è©¦ç’°å¢ƒéƒ¨ç½²
â”‚   â”‚   â”œâ”€â”€ deploy-production.yml    # ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²
â”‚   â”‚   â””â”€â”€ environment-sync.yml     # ç’°å¢ƒåŒæ­¥æª¢æŸ¥
â”‚   â”‚
â”‚   â””â”€â”€ environments/                # GitHub ç’°å¢ƒé…ç½®
â”‚       â”œâ”€â”€ development.yml
â”‚       â”œâ”€â”€ staging.yml
â”‚       â””â”€â”€ production.yml
â”‚
â”œâ”€â”€ monitoring/                       # ç›£æ§é…ç½®
â”‚   â”œâ”€â”€ prometheus/
â”‚   â”œâ”€â”€ grafana/
â”‚   â””â”€â”€ alerts/
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ deployment-guide.md
    â””â”€â”€ environment-setup.md
```

**ç’°å¢ƒé…ç½®ç¯„ä¾‹**ï¼š

```yaml
# deployment/configs/dev.env
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=DEBUG

# è³‡æ–™åº«é…ç½®
DATABASE_URL=postgresql://dev_user:dev_pass@localhost:5432/saas_dev
REDIS_URL=redis://localhost:6379/0

# å¤–éƒ¨æœå‹™ï¼ˆä½¿ç”¨æ¸¬è©¦ç‰ˆæœ¬ï¼‰
STRIPE_PUBLISHABLE_KEY=pk_test_xxxxx
STRIPE_SECRET_KEY=sk_test_xxxxx
SENDGRID_API_KEY=SG.test.xxxxx

# åŠŸèƒ½é–‹é—œ
FEATURE_NEW_DASHBOARD=true
FEATURE_ADVANCED_ANALYTICS=true
```

```yaml
# deployment/configs/staging.env
ENVIRONMENT=staging
DEBUG=false
LOG_LEVEL=INFO

# è³‡æ–™åº«é…ç½®ï¼ˆæ¥è¿‘ç”Ÿç”¢ç’°å¢ƒï¼‰
DATABASE_URL=postgresql://staging_user:staging_pass@staging-db:5432/saas_staging
REDIS_URL=redis://staging-redis:6379/0

# å¤–éƒ¨æœå‹™ï¼ˆä½¿ç”¨æ¸¬è©¦ç‰ˆæœ¬ï¼Œä½†çœŸå¯¦è³‡æ–™é‡ï¼‰
STRIPE_PUBLISHABLE_KEY=pk_test_xxxxx
STRIPE_SECRET_KEY=sk_test_xxxxx
SENDGRID_API_KEY=SG.staging.xxxxx

# åŠŸèƒ½é–‹é—œï¼ˆä¿å®ˆæ¸¬è©¦ï¼‰
FEATURE_NEW_DASHBOARD=true
FEATURE_ADVANCED_ANALYTICS=false

# æ•ˆèƒ½è¨­å®š
GUNICORN_WORKERS=2
CELERY_WORKERS=2
```

```yaml
# deployment/configs/production.env.template
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=WARNING

# è³‡æ–™åº«é…ç½®ï¼ˆå¾ Secrets æ³¨å…¥ï¼‰
DATABASE_URL=${DATABASE_URL}
REDIS_URL=${REDIS_URL}

# å¤–éƒ¨æœå‹™ï¼ˆç”Ÿç”¢å¯†é‘°ï¼‰
STRIPE_PUBLISHABLE_KEY=${STRIPE_PUBLISHABLE_KEY}
STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
SENDGRID_API_KEY=${SENDGRID_API_KEY}

# åŠŸèƒ½é–‹é—œï¼ˆä¿å®ˆè¨­å®šï¼‰
FEATURE_NEW_DASHBOARD=false
FEATURE_ADVANCED_ANALYTICS=false

# æ•ˆèƒ½è¨­å®š
GUNICORN_WORKERS=4
CELERY_WORKERS=8
```

---

## ğŸ¯ ä»»å‹™ç›®æ¨™

### å¿…é”ç›®æ¨™
1. âœ… å»ºç«‹ **ä¸‰ç’°å¢ƒéƒ¨ç½²ç®¡ç·š**ï¼š
   - Devï¼šæ¯æ¬¡ push è‡ªå‹•éƒ¨ç½²
   - Stagingï¼šPR åˆä½µå¾Œè‡ªå‹•éƒ¨ç½²
   - Productionï¼šæ‰‹å‹•è§¸ç™¼ + å¯©æ‰¹æµç¨‹

2. âœ… å¯¦ä½œ **ç’°å¢ƒä¸€è‡´æ€§ä¿è­‰**ï¼š
   - ç›¸åŒçš„ Docker æ˜ åƒåœ¨æ‰€æœ‰ç’°å¢ƒé‹è¡Œ
   - åŸºç¤è¨­æ–½å³ç¨‹å¼ç¢¼ï¼ˆTerraform/Helmï¼‰
   - è‡ªå‹•åŒ–ç’°å¢ƒé…ç½®é©—è­‰

3. âœ… è¨­è¨ˆ **å®‰å…¨çš„é…ç½®ç®¡ç†**ï¼š
   - æ•æ„Ÿè³‡æ–™ç”¨ GitHub Secrets
   - ç’°å¢ƒç‰¹å®šé…ç½®ç”¨ ConfigMap
   - é…ç½®è®Šæ›´è¿½è¹¤å’Œå¯©æ ¸

4. âœ… å»ºç«‹ **å“è³ªé–€æ§æ©Ÿåˆ¶**ï¼š
   - Devï¼šåŸºæœ¬å¥åº·æª¢æŸ¥
   - Stagingï¼šå®Œæ•´æ¸¬è©¦å¥—ä»¶ + æ•ˆèƒ½æ¸¬è©¦
   - Productionï¼šè—ç¶ éƒ¨ç½² + é‡‘çµ²é›€æ¸¬è©¦

5. âœ… å¯¦ä½œ **è‡ªå‹•å›é€€æ©Ÿåˆ¶**ï¼š
   - å¥åº·æª¢æŸ¥å¤±æ•—è‡ªå‹•å›é€€
   - ä¸€éµæ‰‹å‹•å›é€€
   - è³‡æ–™åº«é·ç§»å›é€€ç­–ç•¥

### åŠ åˆ†é …ç›®
- ğŸŒŸ å¯¦ä½œ **ç’°å¢ƒå‡ç´šæµæ°´ç·š**ï¼ˆDev â†’ Staging â†’ Productionï¼‰
- ğŸŒŸ å»ºç«‹ **é…ç½®æ¼‚ç§»æª¢æ¸¬**ï¼ˆç’°å¢ƒé…ç½®è®Šæ›´å‘Šè­¦ï¼‰
- ğŸŒŸ æ•´åˆ **åŠŸèƒ½é–‹é—œç³»çµ±**ï¼ˆFeature Flagsï¼‰
- ğŸŒŸ è¨­è¨ˆ **ç½é›£æ¢å¾©æ¼”ç·´**è‡ªå‹•åŒ–

---

## ğŸš€ å¯¦ä½œæ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šå¤šç’°å¢ƒéƒ¨ç½² Workflow è¨­è¨ˆ

```yaml
# .github/workflows/deploy-multi-environment.yml
name: Multi-Environment Deployment

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]
    types: [closed]
  workflow_dispatch:
    inputs:
      target_environment:
        description: 'Target environment'
        required: true
        default: 'staging'
        type: choice
        options:
          - development
          - staging
          - production
      deployment_strategy:
        description: 'Deployment strategy'
        required: true
        default: 'rolling'
        type: choice
        options:
          - rolling
          - blue_green
          - canary
      skip_tests:
        description: 'Skip tests (emergency deployment)'
        required: false
        default: false
        type: boolean

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  # ç’°å¢ƒè·¯ç”±æ±ºç­–
  environment-router:
    name: Environment Routing
    runs-on: ubuntu-latest
    outputs:
      target-env: ${{ steps.decide.outputs.environment }}
      deploy-strategy: ${{ steps.decide.outputs.strategy }}
      should-deploy: ${{ steps.decide.outputs.should_deploy }}

    steps:
    - name: Determine deployment environment
      id: decide
      run: |
        # æ ¹æ“šè§¸ç™¼æ¢ä»¶æ±ºå®šç›®æ¨™ç’°å¢ƒ
        if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
          ENV="${{ github.event.inputs.target_environment }}"
          STRATEGY="${{ github.event.inputs.deployment_strategy }}"
        elif [ "${{ github.event_name }}" = "push" ]; then
          if [ "${{ github.ref }}" = "refs/heads/main" ]; then
            ENV="staging"
            STRATEGY="rolling"
          elif [ "${{ github.ref }}" = "refs/heads/develop" ]; then
            ENV="development"
            STRATEGY="rolling"
          else
            ENV="none"
            STRATEGY="none"
          fi
        elif [ "${{ github.event_name }}" = "pull_request" ] && [ "${{ github.event.action }}" = "closed" ] && [ "${{ github.event.pull_request.merged }}" = "true" ]; then
          ENV="staging"
          STRATEGY="rolling"
        else
          ENV="none"
          STRATEGY="none"
        fi

        echo "environment=$ENV" >> $GITHUB_OUTPUT
        echo "strategy=$STRATEGY" >> $GITHUB_OUTPUT
        echo "should_deploy=$([ "$ENV" != "none" ] && echo true || echo false)" >> $GITHUB_OUTPUT

        echo "ğŸ¯ Target Environment: $ENV"
        echo "ğŸ“‹ Deployment Strategy: $STRATEGY"

  # é éƒ¨ç½²æª¢æŸ¥
  pre-deployment-checks:
    name: Pre-deployment Checks
    needs: environment-router
    if: needs.environment-router.outputs.should-deploy == 'true'
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    # ç’°å¢ƒé…ç½®é©—è­‰
    - name: Validate environment configuration
      run: |
        TARGET_ENV="${{ needs.environment-router.outputs.target-env }}"

        echo "ğŸ” Validating $TARGET_ENV environment configuration..."

        # æª¢æŸ¥å¿…è¦çš„é…ç½®æª”æ¡ˆ
        if [ ! -f "deployment/configs/${TARGET_ENV}.env" ] && [ ! -f "deployment/configs/${TARGET_ENV}.env.template" ]; then
          echo "âŒ Environment configuration not found for $TARGET_ENV"
          exit 1
        fi

        # æª¢æŸ¥åŸºç¤è¨­æ–½é…ç½®
        if [ ! -d "infrastructure/environments/${TARGET_ENV}" ]; then
          echo "âŒ Infrastructure configuration not found for $TARGET_ENV"
          exit 1
        fi

        # æª¢æŸ¥ Helm charts
        if [ ! -d "deployment/helm-charts" ]; then
          echo "âŒ Helm charts not found"
          exit 1
        fi

        echo "âœ… Environment configuration validation passed"

    # æ˜ åƒç‰ˆæœ¬æª¢æŸ¥
    - name: Verify Docker image exists
      run: |
        IMAGE_TAG="${{ github.sha }}"

        for component in backend frontend worker; do
          IMAGE="${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-${component}:${IMAGE_TAG}"
          echo "Checking image: $IMAGE"

          if docker manifest inspect "$IMAGE" > /dev/null 2>&1; then
            echo "âœ… $component image exists"
          else
            echo "âŒ $component image not found"
            exit 1
          fi
        done

    # ç›¸ä¾æœå‹™å¥åº·æª¢æŸ¥
    - name: Check dependent services
      run: |
        TARGET_ENV="${{ needs.environment-router.outputs.target-env }}"

        echo "ğŸ” Checking dependent services for $TARGET_ENV..."

        # åœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒæª¢æŸ¥ï¼š
        # - è³‡æ–™åº«å¯ç”¨æ€§
        # - Redis å¯ç”¨æ€§
        # - å¤–éƒ¨ API æœå‹™ç‹€æ…‹
        # - ç›£æ§ç³»çµ±ç‹€æ…‹

        case "$TARGET_ENV" in
          "development")
            echo "âœ… Development services ready"
            ;;
          "staging")
            echo "âœ… Staging services ready"
            ;;
          "production")
            echo "âœ… Production services ready"
            ;;
        esac

  # éƒ¨ç½²åŸ·è¡Œ
  deploy-application:
    name: Deploy to ${{ needs.environment-router.outputs.target-env }}
    needs: [environment-router, pre-deployment-checks]
    runs-on: ubuntu-latest
    environment:
      name: ${{ needs.environment-router.outputs.target-env }}
      url: ${{ steps.get-url.outputs.url }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Get environment URL
      id: get-url
      run: |
        case "${{ needs.environment-router.outputs.target-env }}" in
          "development")
            echo "url=https://dev.saas-platform.com" >> $GITHUB_OUTPUT
            ;;
          "staging")
            echo "url=https://staging.saas-platform.com" >> $GITHUB_OUTPUT
            ;;
          "production")
            echo "url=https://saas-platform.com" >> $GITHUB_OUTPUT
            ;;
        esac

    # è¨­å®š Kubernetes é…ç½®
    - name: Setup Kubernetes config
      run: |
        TARGET_ENV="${{ needs.environment-router.outputs.target-env }}"

        # åœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒè¨­å®šå°æ‡‰ç’°å¢ƒçš„ kubectl é…ç½®
        echo "ğŸ”§ Setting up kubectl for $TARGET_ENV..."

        # kubectl config use-context $TARGET_ENV
        # æˆ–è€…è¨­å®šç‰¹å®šçš„ kubeconfig

    # åŸ·è¡Œè³‡æ–™åº«é·ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰
    - name: Database migration
      if: needs.environment-router.outputs.target-env != 'development'
      run: |
        echo "ğŸ—„ï¸ Running database migrations..."

        # åœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒåŸ·è¡Œ Alembic é·ç§»
        # kubectl run migration-job --image=${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-backend:${{ github.sha }} --restart=Never --command -- alembic upgrade head

        echo "âœ… Database migration completed"

    # åŸ·è¡Œéƒ¨ç½²ç­–ç•¥
    - name: Execute deployment strategy
      run: |
        STRATEGY="${{ needs.environment-router.outputs.deploy-strategy }}"
        TARGET_ENV="${{ needs.environment-router.outputs.target-env }}"
        IMAGE_TAG="${{ github.sha }}"

        echo "ğŸš€ Executing $STRATEGY deployment to $TARGET_ENV..."

        case "$STRATEGY" in
          "rolling")
            echo "ğŸ“± Rolling deployment..."
            # helm upgrade --install saas-platform ./deployment/helm-charts \
            #   --namespace $TARGET_ENV \
            #   --set image.tag=$IMAGE_TAG \
            #   --set environment=$TARGET_ENV \
            #   --wait --timeout=10m
            ;;

          "blue_green")
            echo "ğŸ”µğŸŸ¢ Blue-Green deployment..."
            # 1. éƒ¨ç½²åˆ°ç¶ è‰²ç’°å¢ƒ
            # 2. å¥åº·æª¢æŸ¥
            # 3. åˆ‡æ›æµé‡
            # 4. ä¿ç•™è—è‰²ç’°å¢ƒä¸€æ®µæ™‚é–“
            ;;

          "canary")
            echo "ğŸ¤ Canary deployment..."
            # 1. éƒ¨ç½² 10% æµé‡ç‰ˆæœ¬
            # 2. ç›£æ§æŒ‡æ¨™
            # 3. é€æ­¥å¢åŠ æµé‡
            # 4. å…¨é‡éƒ¨ç½²
            ;;
        esac

        sleep 10  # æ¨¡æ“¬éƒ¨ç½²æ™‚é–“
        echo "âœ… Deployment completed"

    # éƒ¨ç½²å¾Œå¥åº·æª¢æŸ¥
    - name: Post-deployment health check
      run: |
        TARGET_ENV="${{ needs.environment-router.outputs.target-env }}"
        BASE_URL="${{ steps.get-url.outputs.url }}"

        echo "ğŸ” Running comprehensive health check..."

        # åŸºæœ¬å¥åº·æª¢æŸ¥
        for i in {1..5}; do
          echo "Health check attempt $i/5..."
          if curl -f -s "$BASE_URL/health" > /dev/null; then
            echo "âœ… Basic health check passed"
            break
          fi
          sleep 10
        done

        # æ‡‰ç”¨ç‰¹å®šæª¢æŸ¥
        case "$TARGET_ENV" in
          "development")
            echo "âœ… Development environment health check passed"
            ;;
          "staging")
            echo "ğŸ§ª Running staging-specific tests..."
            # pytest tests/integration/
            echo "âœ… Staging environment health check passed"
            ;;
          "production")
            echo "ğŸ¥ Running production health checks..."
            # æª¢æŸ¥é—œéµæ¥­å‹™åŠŸèƒ½
            # æª¢æŸ¥è³‡æ–™åº«é€£ç·š
            # æª¢æŸ¥å¤–éƒ¨æœå‹™æ•´åˆ
            echo "âœ… Production environment health check passed"
            ;;
        esac

    # æ•ˆèƒ½æ¸¬è©¦ï¼ˆStaging å’Œ Productionï¼‰
    - name: Performance testing
      if: contains(fromJson('["staging", "production"]'), needs.environment-router.outputs.target-env)
      run: |
        echo "âš¡ Running performance tests..."

        # ä½¿ç”¨ Apache Bench é€²è¡Œç°¡å–®æ•ˆèƒ½æ¸¬è©¦
        BASE_URL="${{ steps.get-url.outputs.url }}"

        # è¼•é‡ç´šæ•ˆèƒ½æ¸¬è©¦
        ab -n 100 -c 10 "$BASE_URL/health" || echo "Performance test warning"

        echo "âœ… Performance test completed"

    # å›é€€æ©Ÿåˆ¶è¨­ç½®
    - name: Setup rollback capability
      run: |
        echo "ğŸ”„ Setting up rollback capability..."

        # è¨˜éŒ„ç•¶å‰éƒ¨ç½²ç‰ˆæœ¬
        echo "PREVIOUS_VERSION=${{ github.sha }}" >> deployment-info.txt
        echo "DEPLOYMENT_TIME=$(date -u)" >> deployment-info.txt
        echo "TARGET_ENV=${{ needs.environment-router.outputs.target-env }}" >> deployment-info.txt

        # åœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒï¼š
        # 1. å‚™ä»½ç•¶å‰é…ç½®
        # 2. è¨˜éŒ„å›é€€æ‰€éœ€çš„è³‡è¨Š
        # 3. è¨­å®šè‡ªå‹•å›é€€è§¸ç™¼å™¨

  # éƒ¨ç½²å¾Œé©—è­‰
  post-deployment-validation:
    name: Post-deployment Validation
    needs: [environment-router, deploy-application]
    runs-on: ubuntu-latest
    if: always() && needs.deploy-application.result == 'success'

    steps:
    - name: Comprehensive system validation
      run: |
        TARGET_ENV="${{ needs.environment-router.outputs.target-env }}"

        echo "ğŸ”¬ Running comprehensive validation for $TARGET_ENV..."

        case "$TARGET_ENV" in
          "development")
            echo "âœ… Development validation: Basic functionality"
            ;;
          "staging")
            echo "ğŸ§ª Staging validation: Full test suite"
            # åŸ·è¡Œå®Œæ•´çš„é›†æˆæ¸¬è©¦
            # åŸ·è¡Œ API æ¸¬è©¦
            # åŸ·è¡Œå‰ç«¯ E2E æ¸¬è©¦
            ;;
          "production")
            echo "ğŸ¥ Production validation: Business-critical checks"
            # æª¢æŸ¥é—œéµæ¥­å‹™æŒ‡æ¨™
            # æª¢æŸ¥ç”¨æˆ¶ç™»å…¥æµç¨‹
            # æª¢æŸ¥æ”¯ä»˜æµç¨‹
            # æª¢æŸ¥é€šçŸ¥ç³»çµ±
            ;;
        esac

    # ç›£æ§è¨­ç½®
    - name: Setup monitoring and alerts
      run: |
        TARGET_ENV="${{ needs.environment-router.outputs.target-env }}"

        echo "ğŸ“Š Setting up monitoring for $TARGET_ENV deployment..."

        # åœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒï¼š
        # 1. æ›´æ–° Grafana å„€è¡¨æ¿
        # 2. è¨­å®šéƒ¨ç½²ç‰¹å®šçš„å‘Šè­¦
        # 3. é€šçŸ¥ç›£æ§åœ˜éšŠ

  # é€šçŸ¥å’Œå ±å‘Š
  deployment-notification:
    name: Deployment Notification
    needs: [environment-router, deploy-application, post-deployment-validation]
    if: always()
    runs-on: ubuntu-latest

    steps:
    - name: Generate deployment report
      run: |
        TARGET_ENV="${{ needs.environment-router.outputs.target-env }}"
        DEPLOY_STATUS="${{ needs.deploy-application.result }}"
        VALIDATION_STATUS="${{ needs.post-deployment-validation.result }}"

        echo "ğŸ“‹ Generating deployment report..."

        cat > deployment-report.md << EOF
        # ğŸš€ Deployment Report

        **Environment:** $TARGET_ENV
        **Strategy:** ${{ needs.environment-router.outputs.deploy-strategy }}
        **Commit:** ${{ github.sha }}
        **Branch:** ${{ github.ref_name }}
        **Actor:** ${{ github.actor }}
        **Timestamp:** $(date -u)

        ## ğŸ“Š Deployment Status

        | Phase | Status |
        |-------|--------|
        | Deployment | $DEPLOY_STATUS |
        | Validation | $VALIDATION_STATUS |

        ## ğŸ”— Links

        - **Environment URL:** [Open Application](${{ steps.get-url.outputs.url }})
        - **Monitoring:** [Grafana Dashboard](https://grafana.company.com/d/env-$TARGET_ENV)
        - **Logs:** [CloudWatch](https://console.aws.amazon.com/cloudwatch/home#logsV2:log-groups/log-group/$TARGET_ENV)

        EOF

        cat deployment-report.md

    # Slack é€šçŸ¥
    - name: Send Slack notification
      if: vars.SLACK_WEBHOOK_URL != ''
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        text: |
          ğŸš€ Deployment to ${{ needs.environment-router.outputs.target-env }} completed

          Status: ${{ needs.deploy-application.result }}
          Commit: ${{ github.sha }}
          Actor: ${{ github.actor }}
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

```

### æ­¥é©Ÿ 2ï¼šç’°å¢ƒé…ç½®ç®¡ç†ç³»çµ±

```bash
#!/bin/bash
# deployment/scripts/environment-manager.sh

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

# ç’°å¢ƒé…ç½®ç®¡ç†
manage_environment_config() {
    local env_name="$1"
    local action="$2"

    case "$action" in
        "validate")
            validate_environment_config "$env_name"
            ;;
        "deploy")
            deploy_environment_config "$env_name"
            ;;
        "diff")
            compare_environment_config "$env_name"
            ;;
        "sync")
            sync_environment_config "$env_name"
            ;;
        *)
            echo "Usage: $0 <env> <validate|deploy|diff|sync>"
            exit 1
            ;;
    esac
}

# é©—è­‰ç’°å¢ƒé…ç½®
validate_environment_config() {
    local env_name="$1"

    echo "ğŸ” Validating $env_name environment configuration..."

    # æª¢æŸ¥å¿…è¦æª”æ¡ˆ
    local config_file="$PROJECT_ROOT/deployment/configs/${env_name}.env"
    local infra_dir="$PROJECT_ROOT/infrastructure/environments/${env_name}"

    if [ ! -f "$config_file" ] && [ ! -f "${config_file}.template" ]; then
        echo "âŒ Configuration file not found: $config_file"
        return 1
    fi

    if [ ! -d "$infra_dir" ]; then
        echo "âŒ Infrastructure directory not found: $infra_dir"
        return 1
    fi

    # é©—è­‰å¿…è¦çš„ç’°å¢ƒè®Šæ•¸
    local required_vars=(
        "ENVIRONMENT"
        "DATABASE_URL"
        "REDIS_URL"
    )

    for var in "${required_vars[@]}"; do
        if ! grep -q "^${var}=" "$config_file" 2>/dev/null; then
            echo "âŒ Required variable missing: $var"
            return 1
        fi
    done

    # é©—è­‰ Terraform é…ç½®
    if [ -d "$infra_dir/terraform" ]; then
        echo "ğŸ”§ Validating Terraform configuration..."
        cd "$infra_dir/terraform"
        terraform validate
        cd - > /dev/null
    fi

    # é©—è­‰ Kubernetes é…ç½®
    if [ -d "$infra_dir/kubernetes" ]; then
        echo "â˜¸ï¸ Validating Kubernetes manifests..."
        for file in "$infra_dir/kubernetes"/*.yaml; do
            if [ -f "$file" ]; then
                kubectl --dry-run=client apply -f "$file" > /dev/null
            fi
        done
    fi

    echo "âœ… Environment configuration validation passed"
}

# éƒ¨ç½²ç’°å¢ƒé…ç½®
deploy_environment_config() {
    local env_name="$1"

    echo "ğŸš€ Deploying $env_name environment configuration..."

    # éƒ¨ç½²åŸºç¤è¨­æ–½
    local infra_dir="$PROJECT_ROOT/infrastructure/environments/${env_name}"

    if [ -d "$infra_dir/terraform" ]; then
        echo "ğŸ—ï¸ Deploying infrastructure with Terraform..."
        cd "$infra_dir/terraform"
        terraform init
        terraform plan -out=tfplan
        terraform apply tfplan
        cd - > /dev/null
    fi

    # éƒ¨ç½² Kubernetes é…ç½®
    if [ -d "$infra_dir/kubernetes" ]; then
        echo "â˜¸ï¸ Applying Kubernetes configurations..."
        kubectl apply -f "$infra_dir/kubernetes/"
    fi

    echo "âœ… Environment configuration deployed"
}

# æ¯”è¼ƒç’°å¢ƒé…ç½®
compare_environment_config() {
    local env_name="$1"
    local reference_env="${2:-production}"

    echo "ğŸ” Comparing $env_name with $reference_env..."

    # æ¯”è¼ƒç’°å¢ƒè®Šæ•¸é…ç½®
    local config_file="$PROJECT_ROOT/deployment/configs/${env_name}.env"
    local ref_config_file="$PROJECT_ROOT/deployment/configs/${reference_env}.env"

    if [ -f "$config_file" ] && [ -f "$ref_config_file" ]; then
        echo "ğŸ“‹ Configuration differences:"
        diff -u "$ref_config_file" "$config_file" || true
    fi

    # æ¯”è¼ƒåŸºç¤è¨­æ–½é…ç½®
    local infra_dir="$PROJECT_ROOT/infrastructure/environments/${env_name}"
    local ref_infra_dir="$PROJECT_ROOT/infrastructure/environments/${reference_env}"

    if [ -d "$infra_dir" ] && [ -d "$ref_infra_dir" ]; then
        echo "ğŸ—ï¸ Infrastructure differences:"
        diff -ru "$ref_infra_dir" "$infra_dir" || true
    fi
}

# åŒæ­¥ç’°å¢ƒé…ç½®
sync_environment_config() {
    local env_name="$1"

    echo "ğŸ”„ Syncing $env_name environment configuration..."

    # æª¢æŸ¥é…ç½®æ¼‚ç§»
    echo "ğŸ” Checking for configuration drift..."

    # åœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒï¼š
    # 1. æ¯”è¼ƒå¯¦éš›é‹è¡Œé…ç½®èˆ‡é æœŸé…ç½®
    # 2. æª¢æ¸¬æœªæˆæ¬Šçš„é…ç½®è®Šæ›´
    # 3. ç”Ÿæˆé…ç½®æ¼‚ç§»å ±å‘Š
    # 4. å¯é¸æ“‡è‡ªå‹•ä¿®å¾©æˆ–å‘Šè­¦

    echo "âœ… Configuration sync completed"
}

# ä¸»å‡½æ•¸
main() {
    if [ $# -lt 2 ]; then
        echo "Usage: $0 <environment> <action>"
        echo "Environments: development, staging, production"
        echo "Actions: validate, deploy, diff, sync"
        exit 1
    fi

    manage_environment_config "$1" "$2"
}

# åªåœ¨ç›´æ¥åŸ·è¡Œæ™‚é‹è¡Œä¸»å‡½æ•¸
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi
```

### æ­¥é©Ÿ 3ï¼šè‡ªå‹•å›é€€æ©Ÿåˆ¶

```yaml
# .github/workflows/auto-rollback.yml
name: Auto Rollback System

on:
  workflow_run:
    workflows: ["Multi-Environment Deployment"]
    types: [completed]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to rollback'
        required: true
        type: choice
        options:
          - development
          - staging
          - production
      reason:
        description: 'Rollback reason'
        required: true
        type: string

jobs:
  detect-deployment-issues:
    name: Detect Deployment Issues
    if: github.event.workflow_run.conclusion == 'success'
    runs-on: ubuntu-latest
    outputs:
      should-rollback: ${{ steps.health-check.outputs.should_rollback }}
      environment: ${{ steps.detect-env.outputs.environment }}

    steps:
    - name: Detect deployment environment
      id: detect-env
      run: |
        # å¾è§¸ç™¼çš„ workflow ä¸­è§£æç’°å¢ƒè³‡è¨Š
        # é€™è£¡ç°¡åŒ–è™•ç†ï¼Œå¯¦éš›ä¸Šæœƒè§£æ workflow è¼¸å‡º
        echo "environment=staging" >> $GITHUB_OUTPUT

    - name: Advanced health check
      id: health-check
      run: |
        ENV="${{ steps.detect-env.outputs.environment }}"

        case "$ENV" in
          "development")
            BASE_URL="https://dev.saas-platform.com"
            ;;
          "staging")
            BASE_URL="https://staging.saas-platform.com"
            ;;
          "production")
            BASE_URL="https://saas-platform.com"
            ;;
        esac

        echo "ğŸ” Running advanced health check for $ENV..."

        # ç­‰å¾…æ‡‰ç”¨å®Œå…¨å•Ÿå‹•
        sleep 30

        # å¥åº·æª¢æŸ¥æŒ‡æ¨™
        HEALTH_PASSED=true

        # 1. åŸºæœ¬ HTTP å¥åº·æª¢æŸ¥
        if ! curl -f -s "$BASE_URL/health" > /dev/null; then
          echo "âŒ Basic health check failed"
          HEALTH_PASSED=false
        fi

        # 2. è³‡æ–™åº«é€£ç·šæª¢æŸ¥
        if ! curl -f -s "$BASE_URL/health/database" > /dev/null; then
          echo "âŒ Database health check failed"
          HEALTH_PASSED=false
        fi

        # 3. é—œéµ API ç«¯é»æª¢æŸ¥
        if ! curl -f -s "$BASE_URL/api/status" > /dev/null; then
          echo "âŒ API health check failed"
          HEALTH_PASSED=false
        fi

        # 4. æ•ˆèƒ½æª¢æŸ¥ï¼ˆéŸ¿æ‡‰æ™‚é–“ï¼‰
        RESPONSE_TIME=$(curl -o /dev/null -s -w "%{time_total}" "$BASE_URL/health")
        if (( $(echo "$RESPONSE_TIME > 2.0" | bc -l) )); then
          echo "âŒ Response time too slow: ${RESPONSE_TIME}s"
          HEALTH_PASSED=false
        fi

        # 5. éŒ¯èª¤ç‡æª¢æŸ¥ï¼ˆå¦‚æœæœ‰ç›£æ§ç³»çµ±ï¼‰
        # ERROR_RATE=$(curl -s "http://prometheus:9090/api/v1/query?query=rate(http_requests_total{status=~'5..'}[5m])" | jq '.data.result[0].value[1]')
        # if (( $(echo "$ERROR_RATE > 0.01" | bc -l) )); then
        #   echo "âŒ Error rate too high: $ERROR_RATE"
        #   HEALTH_PASSED=false
        # fi

        if [ "$HEALTH_PASSED" = "true" ]; then
          echo "âœ… All health checks passed"
          echo "should_rollback=false" >> $GITHUB_OUTPUT
        else
          echo "âŒ Health checks failed - triggering rollback"
          echo "should_rollback=true" >> $GITHUB_OUTPUT
        fi

  execute-rollback:
    name: Execute Rollback
    needs: detect-deployment-issues
    if: |
      always() && (
        needs.detect-deployment-issues.outputs.should-rollback == 'true' ||
        github.event_name == 'workflow_dispatch'
      )
    runs-on: ubuntu-latest
    environment:
      name: ${{ needs.detect-deployment-issues.outputs.environment || github.event.inputs.environment }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Get rollback target
      id: rollback-target
      run: |
        ENV="${{ needs.detect-deployment-issues.outputs.environment || github.event.inputs.environment }}"

        echo "ğŸ” Finding rollback target for $ENV..."

        # åœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒæŸ¥è©¢ï¼š
        # 1. æœ€å¾Œä¸€æ¬¡æˆåŠŸçš„éƒ¨ç½²ç‰ˆæœ¬
        # 2. Git æ­·å²ä¸­çš„ç©©å®šç‰ˆæœ¬
        # 3. å‚™ä»½çš„é…ç½®è³‡è¨Š

        # æ¨¡æ“¬å–å¾—ä¸Šä¸€å€‹ç©©å®šç‰ˆæœ¬
        PREVIOUS_SHA=$(git log --format="%H" -n 2 | tail -1)
        echo "rollback_sha=$PREVIOUS_SHA" >> $GITHUB_OUTPUT
        echo "ğŸ”„ Rolling back to: $PREVIOUS_SHA"

    - name: Pre-rollback backup
      run: |
        ENV="${{ needs.detect-deployment-issues.outputs.environment || github.event.inputs.environment }}"

        echo "ğŸ’¾ Creating pre-rollback backup..."

        # å‚™ä»½ç•¶å‰ç‹€æ…‹
        mkdir -p rollback-backup

        # å‚™ä»½é…ç½®
        kubectl get configmap -n "$ENV" -o yaml > rollback-backup/configmaps.yaml
        kubectl get secret -n "$ENV" -o yaml > rollback-backup/secrets.yaml

        # å‚™ä»½è³‡æ–™åº«ï¼ˆå¦‚æœéœ€è¦ï¼‰
        # pg_dump ... > rollback-backup/database.sql

        echo "âœ… Backup completed"

    - name: Execute rollback deployment
      run: |
        ENV="${{ needs.detect-deployment-issues.outputs.environment || github.event.inputs.environment }}"
        ROLLBACK_SHA="${{ steps.rollback-target.outputs.rollback_sha }}"

        echo "ğŸ”„ Executing rollback deployment..."
        echo "Environment: $ENV"
        echo "Target SHA: $ROLLBACK_SHA"

        # å›é€€åˆ°ç©©å®šç‰ˆæœ¬
        case "$ENV" in
          "development"|"staging")
            # å¿«é€Ÿå›é€€ç­–ç•¥
            echo "âš¡ Fast rollback strategy for $ENV"
            # kubectl set image deployment/app app=$REGISTRY/$IMAGE_NAME:$ROLLBACK_SHA
            ;;
          "production")
            # è¬¹æ…å›é€€ç­–ç•¥
            echo "ğŸ›¡ï¸ Safe rollback strategy for production"
            # 1. å…ˆéƒ¨ç½²åˆ°é‡‘çµ²é›€ç’°å¢ƒ
            # 2. å¥åº·æª¢æŸ¥
            # 3. é€æ­¥åˆ‡æ›æµé‡
            ;;
        esac

        sleep 10  # æ¨¡æ“¬å›é€€æ™‚é–“
        echo "âœ… Rollback deployment completed"

    - name: Post-rollback verification
      run: |
        ENV="${{ needs.detect-deployment-issues.outputs.environment || github.event.inputs.environment }}"

        echo "ğŸ” Verifying rollback success..."

        case "$ENV" in
          "development")
            BASE_URL="https://dev.saas-platform.com"
            ;;
          "staging")
            BASE_URL="https://staging.saas-platform.com"
            ;;
          "production")
            BASE_URL="https://saas-platform.com"
            ;;
        esac

        # ç­‰å¾…æœå‹™ç©©å®š
        sleep 30

        # é©—è­‰å›é€€å¾Œçš„å¥åº·ç‹€æ…‹
        for i in {1..5}; do
          if curl -f -s "$BASE_URL/health" > /dev/null; then
            echo "âœ… Rollback verification successful (attempt $i)"
            break
          fi
          sleep 10
        done

    - name: Rollback notification
      run: |
        ENV="${{ needs.detect-deployment-issues.outputs.environment || github.event.inputs.environment }}"
        REASON="${{ github.event.inputs.reason || 'Automatic rollback due to health check failure' }}"

        echo "ğŸ“¢ Sending rollback notification..."

        # åœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒç™¼é€é€šçŸ¥åˆ°ï¼š
        # 1. Slack/Teams é »é“
        # 2. äº‹ä»¶ç®¡ç†ç³»çµ±ï¼ˆPagerDutyï¼‰
        # 3. ç›£æ§ç³»çµ±ï¼ˆæ›´æ–°ç‹€æ…‹ï¼‰
        # 4. äº‹æ•…ç®¡ç†ç³»çµ±

        cat > rollback-report.md << EOF
        # ğŸ”„ Rollback Executed

        **Environment:** $ENV
        **Reason:** $REASON
        **Executed by:** ${{ github.actor }}
        **Timestamp:** $(date -u)
        **Rollback target:** ${{ steps.rollback-target.outputs.rollback_sha }}

        ## Next Steps
        1. Investigate root cause
        2. Fix issues in develop branch
        3. Re-deploy after validation

        EOF

        cat rollback-report.md
```

---

## âœ… å®Œæ•´è§£æ±ºæ–¹æ¡ˆé‡é»

### 1. ç’°å¢ƒä¸€è‡´æ€§ä¿è­‰
- **ç›¸åŒæ˜ åƒ**ï¼šæ‰€æœ‰ç’°å¢ƒä½¿ç”¨ç›¸åŒçš„ Docker æ˜ åƒï¼Œåªæ”¹è®Šé…ç½®
- **åŸºç¤è¨­æ–½å³ç¨‹å¼ç¢¼**ï¼šTerraform + Kubernetes ç¢ºä¿ç’°å¢ƒé…ç½®ä¸€è‡´
- **è‡ªå‹•åŒ–é©—è­‰**ï¼šéƒ¨ç½²å‰æª¢æŸ¥ç’°å¢ƒé…ç½®å’Œä¾è³´æœå‹™

### 2. å®‰å…¨çš„é…ç½®ç®¡ç†
- **åˆ†å±¤é…ç½®**ï¼šåŸºç¤é…ç½® + ç’°å¢ƒç‰¹å®šé…ç½® + æ•æ„Ÿè³‡æ–™åˆ†é›¢
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ‰€æœ‰é…ç½®è®Šæ›´éƒ½æœ‰è¿½è¹¤è¨˜éŒ„
- **æ¬Šé™æ§åˆ¶**ï¼šä¸åŒç’°å¢ƒæœ‰ä¸åŒçš„å­˜å–æ¬Šé™

### 3. å“è³ªé–€æ§æ©Ÿåˆ¶
- **Dev**ï¼šå¿«é€Ÿéƒ¨ç½²ï¼ŒåŸºæœ¬å¥åº·æª¢æŸ¥
- **Staging**ï¼šå®Œæ•´æ¸¬è©¦ï¼Œæ•ˆèƒ½é©—è­‰
- **Production**ï¼šå¯©æ‰¹æµç¨‹ï¼Œè—ç¶ /é‡‘çµ²é›€éƒ¨ç½²

### 4. å¯é çš„å›é€€æ©Ÿåˆ¶
- **è‡ªå‹•å›é€€**ï¼šå¥åº·æª¢æŸ¥å¤±æ•—è‡ªå‹•è§¸ç™¼
- **æ‰‹å‹•å›é€€**ï¼šä¸€éµå¼ç·Šæ€¥å›é€€
- **å‚™ä»½æ¢å¾©**ï¼šé…ç½®å’Œè³‡æ–™çš„å®Œæ•´å‚™ä»½

---

## ğŸ“– å­¸ç¿’æˆæœé©—è­‰

å®Œæˆæ­¤æƒ…å¢ƒé¡Œå¾Œï¼Œä½ æ‡‰è©²èƒ½å¤ ï¼š

### âœ… ä¼æ¥­ç´šå¤šç’°å¢ƒç®¡ç†
- è¨­è¨ˆä¸¦å¯¦ä½œ 3+ ç’°å¢ƒçš„éƒ¨ç½²ç­–ç•¥
- ç®¡ç†ç’°å¢ƒé–“çš„é…ç½®å·®ç•°å’Œä¸€è‡´æ€§
- å»ºç«‹ç’°å¢ƒå‡ç´šæµæ°´ç·š

### âœ… é«˜ç´šéƒ¨ç½²ç­–ç•¥
- å¯¦ä½œæ»¾å‹•ã€è—ç¶ ã€é‡‘çµ²é›€éƒ¨ç½²
- æ ¹æ“šç’°å¢ƒé¸æ“‡åˆé©çš„éƒ¨ç½²ç­–ç•¥
- è¨­è¨ˆè‡ªå‹•åŒ–çš„å“è³ªé–€æ§

### âœ… é…ç½®å’Œå¯†é‘°ç®¡ç†
- åˆ†é›¢æ•æ„Ÿé…ç½®å’Œä¸€èˆ¬é…ç½®
- å¯¦ä½œé…ç½®ç‰ˆæœ¬æ§åˆ¶å’Œå¯©æ ¸
- å»ºç«‹é…ç½®æ¼‚ç§»æª¢æ¸¬æ©Ÿåˆ¶

### âœ… ç›£æ§å’Œå›é€€æ©Ÿåˆ¶
- è¨­è¨ˆå¤šå±¤æ¬¡çš„å¥åº·æª¢æŸ¥
- å¯¦ä½œè‡ªå‹•å’Œæ‰‹å‹•å›é€€æ©Ÿåˆ¶
- å»ºç«‹éƒ¨ç½²ç›£æ§å’Œå‘Šè­¦ç³»çµ±

---

**æ­å–œå®Œæˆ C02ï¼** ğŸ‰

ä½ å·²ç¶“æŒæ¡äº†ä¼æ¥­ç´šå¤šç’°å¢ƒéƒ¨ç½²çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œé€™æ˜¯ DevOps å·¥ç¨‹å¸«å¿…å‚™çš„é€²éšèƒ½åŠ›ã€‚

**ä¸‹ä¸€æ­¥**ï¼š
- æŒ‘æˆ°å…¶ä»–çµ„åˆç´šæƒ…å¢ƒ (C03-C10)
- æˆ–é€²å…¥è¤‡é›œç´šæƒ…å¢ƒ (E01-E02)
- æˆ–å°‡é€™äº›æŠ€èƒ½æ‡‰ç”¨åˆ°å¯¦éš›å°ˆæ¡ˆä¸­