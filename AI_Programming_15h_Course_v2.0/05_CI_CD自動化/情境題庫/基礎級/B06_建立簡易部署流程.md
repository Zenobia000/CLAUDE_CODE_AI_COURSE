# B06ï¼šå»ºç«‹ç°¡æ˜“éƒ¨ç½²æµç¨‹

## ğŸ“‹ æƒ…å¢ƒè³‡è¨Š

**é›£åº¦ç­‰ç´š**ï¼šâ­ åŸºç¤ç´š
**é ä¼°æ™‚é–“**ï¼š40 åˆ†é˜
**æ ¸å¿ƒæŠ€èƒ½**ï¼šè‡ªå‹•åŒ–éƒ¨ç½²ã€GitHub Pagesã€ç°¡å–® CD
**å‰ç½®çŸ¥è­˜**ï¼šB05ï¼ˆé…ç½®ä¾è³´æƒæï¼‰

---

## ğŸ¯ æƒ…å¢ƒèƒŒæ™¯

ä½ çš„åœ˜éšŠç¾åœ¨æœ‰äº†å®Œæ•´çš„ CI ç®¡ç·šï¼ˆæ¸¬è©¦ã€å“è³ªæª¢æŸ¥ã€å®‰å…¨æƒæã€ä¾è³´ç›£æ§ï¼‰ï¼Œä½†æ¯æ¬¡éƒ¨ç½²é‚„æ˜¯æ‰‹å‹•é€²è¡Œï¼š

**æ‰‹å‹•éƒ¨ç½²çš„ç—›è‹¦**ï¼š
```bash
# æ¯æ¬¡ç™¼å¸ƒçš„æ‰‹å‹•æµç¨‹
1. æœ¬æ©Ÿæ¸¬è©¦ï¼špytest
2. æ§‹å»º Docker æ˜ åƒï¼šdocker build -t app:latest .
3. æ¨é€åˆ° registryï¼šdocker push registry.com/app:latest
4. SSH åˆ°ä¼ºæœå™¨ï¼šssh user@server
5. æ‹‰å–æ–°æ˜ åƒï¼šdocker pull registry.com/app:latest
6. åœæ­¢èˆŠå®¹å™¨ï¼šdocker stop app-container
7. å•Ÿå‹•æ–°å®¹å™¨ï¼šdocker run -d app:latest
8. æª¢æŸ¥æœå‹™ï¼šcurl http://server/health
9. æ›´æ–° nginx é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
10. é€šçŸ¥åœ˜éšŠï¼šã€Œéƒ¨ç½²å®Œæˆã€
```

**æ˜¨å¤©çš„éƒ¨ç½²äº‹æ•…**ï¼š
- å°è¯å¿˜è¨˜åŸ·è¡Œæ­¥é©Ÿ 2ï¼Œç›´æ¥æ¨é€äº†èˆŠæ˜ åƒ
- å°æ˜åœ¨æ­¥é©Ÿ 6 å¿˜è¨˜å‚™ä»½è³‡æ–™åº«
- çµæœï¼šæœå‹™ä¸­æ–· 1 å°æ™‚ï¼Œè³‡æ–™éºå¤± 30 åˆ†é˜

**åœ˜éšŠçš„æŒ«æŠ˜**ï¼š
> ã€Œæˆ‘å€‘æœ‰è‡ªå‹•åŒ–æ¸¬è©¦ï¼Œç‚ºä»€éº¼éƒ¨ç½²é‚„è¦æ‰‹å‹•ï¼Ÿæ¯æ¬¡éƒ½æå¿ƒåŠè†½ï¼ã€

**DevOps åœ˜éšŠçš„å»ºè­°**ï¼š
> ã€Œå…ˆå¾ç°¡å–®çš„è‡ªå‹•åŒ–éƒ¨ç½²é–‹å§‹ï¼Œæ¯”å¦‚éœæ…‹ç¶²ç«™éƒ¨ç½²ï¼Œå†é€æ­¥æ“´å±•åˆ°æ‡‰ç”¨éƒ¨ç½²ã€‚ã€

**åœ˜éšŠæ±ºå®š**ï¼š
> ã€Œå»ºç«‹åŸºç¤çš„è‡ªå‹•åŒ–éƒ¨ç½²æµç¨‹ï¼Œå…ˆéƒ¨ç½²æ–‡ä»¶å’Œéœæ…‹ç¶²ç«™ï¼Œç„¶å¾Œæ“´å±•åˆ°æ‡‰ç”¨éƒ¨ç½²ã€‚ã€

**ä½ çš„ä»»å‹™**ï¼š
å»ºç«‹ç°¡æ˜“ä½†å®Œæ•´çš„è‡ªå‹•åŒ–éƒ¨ç½²æµç¨‹ï¼ŒåŒ…å«éœæ…‹ç¶²ç«™éƒ¨ç½²å’ŒåŸºç¤çš„æ‡‰ç”¨éƒ¨ç½²ã€‚

---

## ğŸ“¦ å°ˆæ¡ˆçµæ§‹

å»¶çºŒ B05 çš„å°ˆæ¡ˆï¼Œä¸¦åŠ å…¥éƒ¨ç½²ç›¸é—œæª”æ¡ˆï¼š

```
my-fastapi-project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ utils.py
â”‚   â””â”€â”€ security.py
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_main.py
â”‚   â””â”€â”€ test_security.py
â”‚
â”œâ”€â”€ docs/                     # æ–°å¢ï¼šå°ˆæ¡ˆæ–‡ä»¶
â”‚   â”œâ”€â”€ index.html           # å°ˆæ¡ˆä¸»é 
â”‚   â”œâ”€â”€ api-docs.html        # API æ–‡ä»¶
â”‚   â””â”€â”€ deployment-guide.md  # éƒ¨ç½²æŒ‡å—
â”‚
â”œâ”€â”€ scripts/                 # æ–°å¢ï¼šéƒ¨ç½²è…³æœ¬
â”‚   â”œâ”€â”€ deploy.sh           # éƒ¨ç½²è…³æœ¬
â”‚   â”œâ”€â”€ health-check.sh     # å¥åº·æª¢æŸ¥
â”‚   â””â”€â”€ rollback.sh         # å›é€€è…³æœ¬
â”‚
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ requirements-dev.txt
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ .bandit
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ dependabot.yml
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ test.yml         # ç¾æœ‰çš„å®Œæ•´ CI workflow
â”‚       â”œâ”€â”€ deploy-docs.yml  # æ–°å¢ï¼šæ–‡ä»¶éƒ¨ç½²
â”‚       â””â”€â”€ deploy-app.yml   # æ–°å¢ï¼šæ‡‰ç”¨éƒ¨ç½²
â”‚
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

**ç°¡å–®çš„æ–‡ä»¶ç¶²ç«™ï¼ˆdocs/index.htmlï¼‰**ï¼š
```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My FastAPI Project</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>ğŸš€ My FastAPI Project</h1>

    <div class="status success">
        <strong>âœ… éƒ¨ç½²ç‹€æ…‹ï¼š</strong> å·²æˆåŠŸéƒ¨ç½²
        <br><strong>ğŸ•’ æœ€å¾Œæ›´æ–°ï¼š</strong> <span id="build-time">è¼‰å…¥ä¸­...</span>
        <br><strong>ğŸ“¦ ç‰ˆæœ¬ï¼š</strong> <span id="version">1.0.0</span>
    </div>

    <h2>ğŸ“š å°ˆæ¡ˆè³‡è¨Š</h2>
    <ul>
        <li><strong>æŠ€è¡“æ£§ï¼š</strong> FastAPI + Python 3.11</li>
        <li><strong>CI/CDï¼š</strong> GitHub Actions</li>
        <li><strong>å®¹å™¨åŒ–ï¼š</strong> Docker</li>
        <li><strong>å®‰å…¨æƒæï¼š</strong> CodeQL + bandit + Snyk</li>
    </ul>

    <h2>ğŸ”— ç›¸é—œé€£çµ</h2>
    <ul>
        <li><a href="api-docs.html">ğŸ“– API æ–‡ä»¶</a></li>
        <li><a href="https://api.example.com/docs">ğŸš€ ç·šä¸Š API (Swagger)</a></li>
        <li><a href="https://github.com/username/repo">ğŸ’» GitHub å°ˆæ¡ˆ</a></li>
        <li><a href="https://github.com/username/repo/actions">âš¡ CI/CD ç‹€æ…‹</a></li>
    </ul>

    <h2>ğŸ“Š å»ºç½®è³‡è¨Š</h2>
    <div class="status info">
        <strong>ğŸ—ï¸ å»ºç½®è™Ÿï¼š</strong> <span id="build-number">{{BUILD_NUMBER}}</span>
        <br><strong>ğŸŒ¿ åˆ†æ”¯ï¼š</strong> <span id="branch">{{BRANCH}}</span>
        <br><strong>ğŸ“ æäº¤ï¼š</strong> <span id="commit">{{COMMIT_SHA}}</span>
    </div>

    <script>
        // è¨­å®šå»ºç½®æ™‚é–“
        document.getElementById('build-time').textContent = new Date().toLocaleString('zh-TW');

        // æ¨¡æ“¬è¼‰å…¥å…¶ä»–è³‡è¨Šï¼ˆåœ¨å¯¦éš›å°ˆæ¡ˆä¸­æœƒå¾ API ç²å–ï¼‰
        setTimeout(() => {
            const urlParams = new URLSearchParams(window.location.search);
            if (!urlParams.get('build')) {
                // å¦‚æœæ²’æœ‰æŸ¥è©¢åƒæ•¸ï¼Œé¡¯ç¤ºé è¨­å€¼
                document.getElementById('build-number').textContent = '{{BUILD_NUMBER}}' || 'dev-local';
                document.getElementById('branch').textContent = '{{BRANCH}}' || 'main';
                document.getElementById('commit').textContent = '{{COMMIT_SHA}}' || 'latest';
            }
        }, 100);
    </script>
</body>
</html>
```

**éƒ¨ç½²è…³æœ¬ï¼ˆscripts/deploy.shï¼‰**ï¼š
```bash
#!/bin/bash
set -e

# è¨­å®šè®Šæ•¸
APP_NAME="my-fastapi-app"
REGISTRY="ghcr.io"
IMAGE_TAG="${GITHUB_SHA:-latest}"
CONTAINER_NAME="${APP_NAME}-container"

echo "ğŸš€ Starting deployment..."
echo "App: $APP_NAME"
echo "Image: $REGISTRY/$GITHUB_REPOSITORY:$IMAGE_TAG"

# 1. æ‹‰å–æœ€æ–°æ˜ åƒ
echo "ğŸ“¦ Pulling latest image..."
docker pull "$REGISTRY/$GITHUB_REPOSITORY:$IMAGE_TAG"

# 2. åœæ­¢èˆŠå®¹å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
echo "ğŸ›‘ Stopping old container..."
docker stop "$CONTAINER_NAME" 2>/dev/null || true
docker rm "$CONTAINER_NAME" 2>/dev/null || true

# 3. å•Ÿå‹•æ–°å®¹å™¨
echo "ğŸ†• Starting new container..."
docker run -d \
    --name "$CONTAINER_NAME" \
    --restart unless-stopped \
    -p 8000:8000 \
    -e ENVIRONMENT=production \
    "$REGISTRY/$GITHUB_REPOSITORY:$IMAGE_TAG"

# 4. ç­‰å¾…å®¹å™¨å•Ÿå‹•
echo "â³ Waiting for container to start..."
sleep 10

# 5. å¥åº·æª¢æŸ¥
echo "ğŸ” Running health check..."
./scripts/health-check.sh

echo "âœ… Deployment completed successfully!"
```

---

## ğŸ¯ ä»»å‹™ç›®æ¨™

### å¿…é”ç›®æ¨™
1. âœ… å»ºç«‹ **éœæ…‹ç¶²ç«™è‡ªå‹•éƒ¨ç½²**ï¼ˆGitHub Pagesï¼‰
2. âœ… å»ºç«‹ **Docker æ˜ åƒè‡ªå‹•ç™¼å¸ƒ** æµç¨‹
3. âœ… è¨­å®š **éƒ¨ç½²è§¸ç™¼æ¢ä»¶**ï¼ˆmain åˆ†æ”¯æ¨é€ï¼‰
4. âœ… åŠ å…¥ **éƒ¨ç½²å¾Œå¥åº·æª¢æŸ¥**
5. âœ… å»ºç«‹åŸºç¤çš„ **å›é€€æ©Ÿåˆ¶**

### åŠ åˆ†é …ç›®
- ğŸŒŸ å¯¦ä½œ **å¤šç’°å¢ƒéƒ¨ç½²**ï¼ˆstaging + productionï¼‰
- ğŸŒŸ åŠ å…¥ **éƒ¨ç½²é€šçŸ¥**ï¼ˆSlack/Discordï¼‰
- ğŸŒŸ å»ºç«‹ **éƒ¨ç½²å¯©æ‰¹** æµç¨‹
- ğŸŒŸ è¨­å®š **è‡ªå‹•å›é€€** æ¢ä»¶

---

## ğŸ“š å­¸ç¿’æª¢æŸ¥é»

å®Œæˆæ­¤æƒ…å¢ƒé¡Œæ™‚ï¼Œè«‹ç¢ºèªä½ èƒ½å›ç­”ï¼š

### Checkpoint 1ï¼šéƒ¨ç½²åŸºç¤
- [ ] CI å’Œ CD çš„å·®åˆ¥æ˜¯ä»€éº¼ï¼Ÿ
- [ ] ä»€éº¼æ˜¯æŒçºŒéƒ¨ç½² vs æŒçºŒäº¤ä»˜ï¼Ÿ
- [ ] ç‚ºä»€éº¼éœ€è¦è‡ªå‹•åŒ–éƒ¨ç½²ï¼Ÿ
- [ ] éƒ¨ç½²å’Œç™¼å¸ƒçš„å·®åˆ¥ï¼Ÿ

### Checkpoint 2ï¼šéƒ¨ç½²ç­–ç•¥
- [ ] å¦‚ä½•ç¢ºä¿éƒ¨ç½²çš„å®‰å…¨æ€§ï¼Ÿ
- [ ] ä»€éº¼æ™‚å€™æ‡‰è©²è§¸ç™¼éƒ¨ç½²ï¼Ÿ
- [ ] å¦‚ä½•è™•ç†éƒ¨ç½²å¤±æ•—ï¼Ÿ
- [ ] å¥åº·æª¢æŸ¥çš„é‡è¦æ€§ï¼Ÿ

### Checkpoint 3ï¼šGitHub Actions éƒ¨ç½²
- [ ] å¦‚ä½•åœ¨ workflow ä¸­è¨­å®šéƒ¨ç½²æ¬Šé™ï¼Ÿ
- [ ] å¦‚ä½•å®‰å…¨åœ°ç®¡ç†éƒ¨ç½²å¯†é‘°ï¼Ÿ
- [ ] å¦‚ä½•å¯¦ä½œæ¢ä»¶å¼éƒ¨ç½²ï¼Ÿ

---

## ğŸš€ å¯¦ä½œæ­¥é©Ÿ

### æ–¹æ³• 1ï¼šç”¨ Claude ç”Ÿæˆï¼ˆæ¨è–¦ï¼‰

#### æ­¥é©Ÿ 1ï¼šæº–å‚™æç¤ºè©

```
æˆ‘éœ€è¦ç‚º FastAPI å°ˆæ¡ˆå»ºç«‹å®Œæ•´çš„è‡ªå‹•åŒ–éƒ¨ç½²æµç¨‹ã€‚

ç•¶å‰ç‹€æ³ï¼š
- å·²æœ‰å®Œæ•´çš„ CI ç®¡ç·šï¼ˆæ¸¬è©¦ã€å“è³ªæª¢æŸ¥ã€å®‰å…¨æƒæï¼‰
- å·²æœ‰ Docker æ˜ åƒæ§‹å»ºæµç¨‹
- å°ˆæ¡ˆçµæ§‹åŒ…å« app/ å’Œ docs/ ç›®éŒ„

éœ€æ±‚ï¼š
1. éœæ…‹ç¶²ç«™éƒ¨ç½²ï¼ˆdocs/ ç›®éŒ„åˆ° GitHub Pagesï¼‰
2. Docker æ˜ åƒç™¼å¸ƒåˆ° GitHub Container Registry
3. åŸºç¤çš„æ‡‰ç”¨éƒ¨ç½²æµç¨‹ï¼ˆå¯ä»¥æ˜¯æ¨¡æ“¬çš„ï¼‰
4. éƒ¨ç½²å¾Œå¥åº·æª¢æŸ¥
5. ç°¡å–®çš„å›é€€æ©Ÿåˆ¶

éƒ¨ç½²ç­–ç•¥ï¼š
- åªåœ¨ main åˆ†æ”¯è§¸ç™¼éƒ¨ç½²
- éœ€è¦æ‰€æœ‰ CI æª¢æŸ¥é€šé
- å…ˆéƒ¨ç½² stagingï¼Œæ¸¬è©¦é€šéå¾Œéƒ¨ç½² production

è«‹æä¾›ï¼š
1. å®Œæ•´çš„éƒ¨ç½² workflow
2. éƒ¨ç½²è…³æœ¬
3. å¥åº·æª¢æŸ¥è…³æœ¬
4. å›é€€è…³æœ¬
5. æœ€ä½³å¯¦è¸å»ºè­°

è«‹åŠ ä¸Šè©³ç´°è¨»è§£èªªæ˜éƒ¨ç½²æµç¨‹ã€‚
```

#### æ­¥é©Ÿ 2ï¼šå»ºç«‹éƒ¨ç½²è…³æœ¬

æ ¹æ“š Claude çš„å»ºè­°ï¼Œå»ºç«‹æ‰€éœ€çš„éƒ¨ç½²è…³æœ¬ï¼š

```bash
mkdir -p scripts
touch scripts/deploy.sh
touch scripts/health-check.sh
touch scripts/rollback.sh
chmod +x scripts/*.sh
```

#### æ­¥é©Ÿ 3ï¼šå»ºç«‹éƒ¨ç½² Workflow

```bash
touch .github/workflows/deploy-docs.yml
touch .github/workflows/deploy-app.yml
```

#### æ­¥é©Ÿ 4ï¼šå»ºç«‹æ–‡ä»¶ç¶²ç«™

```bash
mkdir -p docs
# å»ºç«‹åŸºæœ¬çš„ HTML æª”æ¡ˆ
```

### æ–¹æ³• 2ï¼šæ‰‹å‹•å»ºç«‹ï¼ˆå­¸ç¿’ç”¨ï¼‰

#### æ­¥é©Ÿ 1ï¼šå»ºç«‹æ–‡ä»¶éƒ¨ç½² Workflow

`.github/workflows/deploy-docs.yml`ï¼š

```yaml
name: Deploy Documentation

on:
  push:
    branches: [main]
    paths:
      - 'docs/**'
      - '.github/workflows/deploy-docs.yml'
  workflow_dispatch:

# è¨­å®š GitHub Pages éœ€è¦çš„æ¬Šé™
permissions:
  contents: read
  pages: write
  id-token: write

# ç¢ºä¿åŒæ™‚åªæœ‰ä¸€å€‹éƒ¨ç½²é‹è¡Œ
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build-docs:
    name: Build Documentation
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Pages
      uses: actions/configure-pages@v3

    # è™•ç†æ¨¡æ¿è®Šæ•¸æ›¿æ›
    - name: Process documentation templates
      run: |
        # æ›¿æ› HTML ä¸­çš„è®Šæ•¸
        find docs -name "*.html" -type f -exec sed -i \
          -e "s/{{BUILD_NUMBER}}/${{ github.run_number }}/g" \
          -e "s/{{BRANCH}}/${{ github.ref_name }}/g" \
          -e "s/{{COMMIT_SHA}}/${{ github.sha }}/g" \
          {} \;

        # ç”Ÿæˆå»ºç½®è³‡è¨Š JSON
        cat > docs/build-info.json << EOF
        {
          "buildNumber": "${{ github.run_number }}",
          "branch": "${{ github.ref_name }}",
          "commit": "${{ github.sha }}",
          "buildTime": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
          "workflow": "${{ github.workflow }}",
          "actor": "${{ github.actor }}"
        }
        EOF

    - name: Upload Pages artifact
      uses: actions/upload-pages-artifact@v2
      with:
        path: ./docs

  deploy-docs:
    name: Deploy to GitHub Pages
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build-docs

    steps:
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v2

    - name: Generate deployment summary
      run: |
        echo "## ğŸ“š Documentation Deployed" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸŒ URL:** ${{ steps.deployment.outputs.page_url }}" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸ“¦ Build:** ${{ github.run_number }}" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸŒ¿ Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸ“ Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
```

#### æ­¥é©Ÿ 2ï¼šå»ºç«‹æ‡‰ç”¨éƒ¨ç½² Workflow

`.github/workflows/deploy-app.yml`ï¼š

```yaml
name: Deploy Application

on:
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'staging'
        type: choice
        options:
          - staging
          - production

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  # ç¢ºä¿æ‰€æœ‰ CI æª¢æŸ¥é€šé
  check-ci:
    name: Check CI Status
    runs-on: ubuntu-latest
    outputs:
      can-deploy: ${{ steps.check.outputs.can-deploy }}

    steps:
    - name: Check required CI jobs
      id: check
      uses: actions/github-script@v6
      with:
        script: |
          const { data: workflows } = await github.rest.actions.listWorkflowRunsForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo,
            head_sha: context.sha,
            status: 'completed'
          });

          const requiredWorkflows = ['Complete CI/CD Pipeline with Docker'];
          const passedWorkflows = workflows.workflow_runs
            .filter(run => run.conclusion === 'success')
            .map(run => run.name);

          const allPassed = requiredWorkflows.every(required =>
            passedWorkflows.includes(required)
          );

          console.log('Required workflows:', requiredWorkflows);
          console.log('Passed workflows:', passedWorkflows);
          console.log('All required workflows passed:', allPassed);

          core.setOutput('can-deploy', allPassed);

          if (!allPassed) {
            core.setFailed('Not all required CI workflows have passed');
          }

  # éƒ¨ç½²åˆ° Staging ç’°å¢ƒ
  deploy-staging:
    name: Deploy to Staging
    needs: check-ci
    if: needs.check-ci.outputs.can-deploy == 'true'
    runs-on: ubuntu-latest
    environment:
      name: staging
      url: https://staging.example.com

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Login to Container Registry
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    # æ¨¡æ“¬éƒ¨ç½²åˆ° staging ç’°å¢ƒ
    - name: Deploy to staging
      run: |
        echo "ğŸš€ Deploying to staging environment..."
        echo "Image: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}"

        # åœ¨çœŸå¯¦ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒåŸ·è¡Œå¯¦éš›çš„éƒ¨ç½²å‘½ä»¤
        # ä¾‹å¦‚ï¼škubectl applyã€docker-compose upã€æˆ– SSH åˆ°ä¼ºæœå™¨

        # æ¨¡æ“¬éƒ¨ç½²éç¨‹
        sleep 5
        echo "âœ… Deployment to staging completed"

    - name: Run health check
      run: |
        echo "ğŸ” Running health check on staging..."
        # åœ¨çœŸå¯¦ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒåŸ·è¡Œå¯¦éš›çš„å¥åº·æª¢æŸ¥
        # curl -f https://staging.example.com/health

        sleep 3
        echo "âœ… Health check passed"

    - name: Run smoke tests
      run: |
        echo "ğŸ§ª Running smoke tests..."
        # åœ¨çœŸå¯¦ç’°å¢ƒä¸­ï¼ŒåŸ·è¡Œè¼•é‡ç´šçš„ç«¯åˆ°ç«¯æ¸¬è©¦

        sleep 5
        echo "âœ… Smoke tests passed"

  # éƒ¨ç½²åˆ° Production ç’°å¢ƒ
  deploy-production:
    name: Deploy to Production
    needs: [check-ci, deploy-staging]
    if: |
      needs.check-ci.outputs.can-deploy == 'true' &&
      (github.ref == 'refs/heads/main' || github.event.inputs.environment == 'production')
    runs-on: ubuntu-latest
    environment:
      name: production
      url: https://api.example.com

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Login to Container Registry
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    # éƒ¨ç½²å‰ç¢ºèª
    - name: Pre-deployment confirmation
      run: |
        echo "âš ï¸ Deploying to PRODUCTION environment"
        echo "Image: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}"
        echo "Branch: ${{ github.ref_name }}"
        echo "Actor: ${{ github.actor }}"

    # å‚™ä»½ç•¶å‰ç‰ˆæœ¬ï¼ˆç”¨æ–¼å›é€€ï¼‰
    - name: Backup current deployment
      run: |
        echo "ğŸ’¾ Backing up current deployment..."
        # åœ¨çœŸå¯¦ç’°å¢ƒä¸­ï¼Œå‚™ä»½ç•¶å‰é‹è¡Œçš„å®¹å™¨æˆ–è¨˜éŒ„ç‰ˆæœ¬
        echo "PREVIOUS_VERSION=${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:previous" >> $GITHUB_ENV

    # åŸ·è¡Œéƒ¨ç½²
    - name: Deploy to production
      id: deploy
      run: |
        echo "ğŸš€ Deploying to production environment..."

        # åœ¨çœŸå¯¦ç’°å¢ƒä¸­çš„éƒ¨ç½²å‘½ä»¤ç¯„ä¾‹ï¼š
        # docker pull ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
        # docker stop my-app || true
        # docker rm my-app || true
        # docker run -d --name my-app -p 80:8000 ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}

        sleep 10
        echo "deployment_success=true" >> $GITHUB_OUTPUT

    # éƒ¨ç½²å¾Œå¥åº·æª¢æŸ¥
    - name: Post-deployment health check
      if: steps.deploy.outputs.deployment_success == 'true'
      run: |
        echo "ğŸ” Running comprehensive health check..."

        # å¥åº·æª¢æŸ¥è…³æœ¬
        for i in {1..5}; do
          echo "Health check attempt $i/5..."
          # curl -f https://api.example.com/health
          sleep 2
        done

        echo "âœ… Health check passed"

    # è‡ªå‹•å›é€€ï¼ˆå¦‚æœéƒ¨ç½²å¤±æ•—ï¼‰
    - name: Auto-rollback on failure
      if: failure() && steps.deploy.outputs.deployment_success == 'true'
      run: |
        echo "âŒ Deployment failed, initiating rollback..."

        # å›é€€åˆ°ä¸Šä¸€å€‹ç‰ˆæœ¬
        # docker stop my-app || true
        # docker rm my-app || true
        # docker run -d --name my-app -p 80:8000 $PREVIOUS_VERSION

        echo "ğŸ”„ Rollback completed"

    # éƒ¨ç½²æˆåŠŸé€šçŸ¥
    - name: Deployment summary
      if: success()
      run: |
        echo "## ğŸš€ Production Deployment Successful" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸŒ Environment:** Production" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸ“¦ Image:** \`${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸŒ¿ Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸ‘¤ Deployed by:** ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸ•’ Deployed at:** $(date -u)" >> $GITHUB_STEP_SUMMARY
```

#### æ­¥é©Ÿ 3ï¼šå»ºç«‹éƒ¨ç½²è…³æœ¬

**å¥åº·æª¢æŸ¥è…³æœ¬ï¼ˆscripts/health-check.shï¼‰**ï¼š

```bash
#!/bin/bash
set -e

# é…ç½®
HEALTH_URL="${HEALTH_URL:-http://localhost:8000/health}"
MAX_ATTEMPTS="${MAX_ATTEMPTS:-5}"
WAIT_TIME="${WAIT_TIME:-10}"

echo "ğŸ” Starting health check..."
echo "URL: $HEALTH_URL"
echo "Max attempts: $MAX_ATTEMPTS"

for i in $(seq 1 $MAX_ATTEMPTS); do
    echo "Health check attempt $i/$MAX_ATTEMPTS..."

    if curl -f -s "$HEALTH_URL" > /dev/null; then
        echo "âœ… Health check passed!"

        # å–å¾—å¥åº·ç‹€æ…‹è©³æƒ…
        HEALTH_RESPONSE=$(curl -s "$HEALTH_URL")
        echo "Response: $HEALTH_RESPONSE"

        exit 0
    else
        echo "âŒ Health check failed (attempt $i)"

        if [ $i -lt $MAX_ATTEMPTS ]; then
            echo "Waiting ${WAIT_TIME}s before next attempt..."
            sleep $WAIT_TIME
        fi
    fi
done

echo "âŒ Health check failed after $MAX_ATTEMPTS attempts"
exit 1
```

**å›é€€è…³æœ¬ï¼ˆscripts/rollback.shï¼‰**ï¼š

```bash
#!/bin/bash
set -e

# é…ç½®
APP_NAME="${APP_NAME:-my-fastapi-app}"
CONTAINER_NAME="${CONTAINER_NAME:-${APP_NAME}-container}"
BACKUP_TAG="${BACKUP_TAG:-previous}"

echo "ğŸ”„ Starting rollback process..."

# æª¢æŸ¥æ˜¯å¦æœ‰å‚™ä»½æ˜ åƒ
if ! docker images | grep -q "$APP_NAME.*$BACKUP_TAG"; then
    echo "âŒ No backup image found: $APP_NAME:$BACKUP_TAG"
    echo "Available images:"
    docker images | grep "$APP_NAME" || echo "No images found"
    exit 1
fi

echo "ğŸ“¦ Found backup image: $APP_NAME:$BACKUP_TAG"

# åœæ­¢ç•¶å‰å®¹å™¨
echo "ğŸ›‘ Stopping current container..."
docker stop "$CONTAINER_NAME" 2>/dev/null || true
docker rm "$CONTAINER_NAME" 2>/dev/null || true

# å•Ÿå‹•å‚™ä»½ç‰ˆæœ¬
echo "ğŸ†• Starting backup version..."
docker run -d \
    --name "$CONTAINER_NAME" \
    --restart unless-stopped \
    -p 8000:8000 \
    -e ENVIRONMENT=production \
    "$APP_NAME:$BACKUP_TAG"

# ç­‰å¾…å•Ÿå‹•
echo "â³ Waiting for container to start..."
sleep 10

# åŸ·è¡Œå¥åº·æª¢æŸ¥
echo "ğŸ” Running health check..."
if ./scripts/health-check.sh; then
    echo "âœ… Rollback completed successfully!"
else
    echo "âŒ Rollback failed - service is not healthy"
    exit 1
fi
```

---

## âœ… åƒè€ƒè§£ç­”

### å®Œæ•´æ‡‰ç”¨éƒ¨ç½² Workflow

```yaml
name: Deploy Application

on:
  push:
    branches: [main]
    paths-ignore:
      - 'docs/**'
      - '*.md'
  release:
    types: [published]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        default: 'staging'
        type: choice
        options:
          - staging
          - production
      skip_tests:
        description: 'Skip CI tests'
        required: false
        default: false
        type: boolean

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  # é æª¢æŸ¥
  pre-deployment:
    name: Pre-deployment Checks
    runs-on: ubuntu-latest
    outputs:
      environment: ${{ steps.determine-env.outputs.environment }}
      can-deploy: ${{ steps.check-ci.outputs.can-deploy }}
      image-tag: ${{ steps.determine-tag.outputs.tag }}

    steps:
    - name: Determine environment
      id: determine-env
      run: |
        if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
          echo "environment=${{ github.event.inputs.environment }}" >> $GITHUB_OUTPUT
        elif [ "${{ github.event_name }}" = "release" ]; then
          echo "environment=production" >> $GITHUB_OUTPUT
        else
          echo "environment=staging" >> $GITHUB_OUTPUT
        fi

    - name: Determine image tag
      id: determine-tag
      run: |
        if [ "${{ github.event_name }}" = "release" ]; then
          echo "tag=${{ github.event.release.tag_name }}" >> $GITHUB_OUTPUT
        else
          echo "tag=${{ github.sha }}" >> $GITHUB_OUTPUT
        fi

    - name: Check CI status
      id: check-ci
      if: github.event.inputs.skip_tests != 'true'
      uses: actions/github-script@v6
      with:
        script: |
          const { data: checkRuns } = await github.rest.checks.listForRef({
            owner: context.repo.owner,
            repo: context.repo.repo,
            ref: context.sha
          });

          const failedChecks = checkRuns.check_runs.filter(
            check => check.conclusion === 'failure'
          );

          if (failedChecks.length > 0) {
            console.log('Failed checks:', failedChecks.map(c => c.name));
            core.setFailed('Some CI checks have failed');
            core.setOutput('can-deploy', false);
          } else {
            console.log('All checks passed');
            core.setOutput('can-deploy', true);
          }

  # éƒ¨ç½²åˆ°ç›®æ¨™ç’°å¢ƒ
  deploy:
    name: Deploy to ${{ needs.pre-deployment.outputs.environment }}
    needs: pre-deployment
    if: needs.pre-deployment.outputs.can-deploy == 'true' || github.event.inputs.skip_tests == 'true'
    runs-on: ubuntu-latest
    environment:
      name: ${{ needs.pre-deployment.outputs.environment }}
      url: ${{ steps.get-url.outputs.url }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Get environment URL
      id: get-url
      run: |
        case "${{ needs.pre-deployment.outputs.environment }}" in
          "production")
            echo "url=https://api.example.com" >> $GITHUB_OUTPUT
            ;;
          "staging")
            echo "url=https://staging.example.com" >> $GITHUB_OUTPUT
            ;;
          *)
            echo "url=https://dev.example.com" >> $GITHUB_OUTPUT
            ;;
        esac

    - name: Login to Container Registry
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    # ç¢ºä¿æ˜ åƒå­˜åœ¨
    - name: Verify image exists
      run: |
        IMAGE="${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ needs.pre-deployment.outputs.image-tag }}"
        echo "Checking image: $IMAGE"

        if docker manifest inspect "$IMAGE" > /dev/null 2>&1; then
          echo "âœ… Image exists and is accessible"
        else
          echo "âŒ Image not found or not accessible"
          exit 1
        fi

    # éƒ¨ç½²å‰æº–å‚™
    - name: Pre-deployment setup
      run: |
        echo "ğŸš€ Preparing deployment..."
        echo "Environment: ${{ needs.pre-deployment.outputs.environment }}"
        echo "Image: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ needs.pre-deployment.outputs.image-tag }}"

        # å»ºç«‹éƒ¨ç½²ç›®éŒ„
        mkdir -p deployment-logs
        echo "$(date): Starting deployment" > deployment-logs/deploy.log

    # åŸ·è¡Œéƒ¨ç½²
    - name: Execute deployment
      id: deploy
      run: |
        echo "ğŸš€ Executing deployment..."

        # è¨­å®šç’°å¢ƒè®Šæ•¸
        export IMAGE_TAG="${{ needs.pre-deployment.outputs.image-tag }}"
        export ENVIRONMENT="${{ needs.pre-deployment.outputs.environment }}"

        # åŸ·è¡Œéƒ¨ç½²è…³æœ¬
        if [ -f "scripts/deploy.sh" ]; then
          chmod +x scripts/deploy.sh
          ./scripts/deploy.sh
        else
          echo "No deployment script found, running default deployment..."

          # é è¨­éƒ¨ç½²é‚è¼¯ï¼ˆæ¨¡æ“¬ï¼‰
          echo "Pulling image..."
          # docker pull ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:$IMAGE_TAG

          echo "Updating service..."
          # kubectl set image deployment/myapp myapp=${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:$IMAGE_TAG
          # æˆ–
          # docker-compose pull && docker-compose up -d

          sleep 5
        fi

        echo "deployment_time=$(date -u +%Y-%m-%dT%H:%M:%SZ)" >> $GITHUB_OUTPUT
        echo "deployment_success=true" >> $GITHUB_OUTPUT

    # éƒ¨ç½²å¾Œé©—è­‰
    - name: Post-deployment verification
      if: steps.deploy.outputs.deployment_success == 'true'
      run: |
        echo "ğŸ” Running post-deployment verification..."

        # å¥åº·æª¢æŸ¥
        if [ -f "scripts/health-check.sh" ]; then
          chmod +x scripts/health-check.sh
          export HEALTH_URL="${{ steps.get-url.outputs.url }}/health"
          ./scripts/health-check.sh
        fi

        # ç…™éœ§æ¸¬è©¦
        echo "Running smoke tests..."
        # åœ¨é€™è£¡åŠ å…¥é—œéµåŠŸèƒ½çš„å¿«é€Ÿæ¸¬è©¦

    # å›é€€ï¼ˆå¤±æ•—æ™‚ï¼‰
    - name: Rollback on failure
      if: failure() && steps.deploy.outputs.deployment_success == 'true'
      run: |
        echo "âŒ Deployment failed, initiating rollback..."

        if [ -f "scripts/rollback.sh" ]; then
          chmod +x scripts/rollback.sh
          ./scripts/rollback.sh
        else
          echo "No rollback script found"
          # åŸ·è¡Œé è¨­å›é€€é‚è¼¯
        fi

    # æ¸…ç†
    - name: Cleanup
      if: always()
      run: |
        echo "ğŸ§¹ Cleaning up..."
        # æ¸…ç†æš«å­˜æª”æ¡ˆ
        rm -rf deployment-logs

    # ä¸Šå‚³éƒ¨ç½²å ±å‘Š
    - name: Upload deployment artifacts
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: deployment-report-${{ needs.pre-deployment.outputs.environment }}
        path: |
          deployment-logs/
        retention-days: 30

  # éƒ¨ç½²é€šçŸ¥
  notify:
    name: Send Deployment Notification
    needs: [pre-deployment, deploy]
    if: always()
    runs-on: ubuntu-latest

    steps:
    - name: Determine notification message
      id: message
      run: |
        ENV="${{ needs.pre-deployment.outputs.environment }}"
        TAG="${{ needs.pre-deployment.outputs.image-tag }}"

        if [ "${{ needs.deploy.result }}" = "success" ]; then
          echo "status=success" >> $GITHUB_OUTPUT
          echo "message=âœ… Successfully deployed to $ENV (tag: $TAG)" >> $GITHUB_OUTPUT
          echo "color=good" >> $GITHUB_OUTPUT
        else
          echo "status=failure" >> $GITHUB_OUTPUT
          echo "message=âŒ Failed to deploy to $ENV (tag: $TAG)" >> $GITHUB_OUTPUT
          echo "color=danger" >> $GITHUB_OUTPUT
        fi

    # Slack é€šçŸ¥ï¼ˆå¦‚æœæœ‰è¨­å®šï¼‰
    - name: Send Slack notification
      if: vars.SLACK_WEBHOOK_URL != ''
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ steps.message.outputs.status }}
        color: ${{ steps.message.outputs.color }}
        text: |
          ${{ steps.message.outputs.message }}

          Repository: ${{ github.repository }}
          Branch: ${{ github.ref_name }}
          Actor: ${{ github.actor }}
          Workflow: ${{ github.workflow }}
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

    # GitHub éƒ¨ç½²ç‹€æ…‹
    - name: Update deployment status
      uses: actions/github-script@v6
      with:
        script: |
          await github.rest.repos.createDeploymentStatus({
            owner: context.repo.owner,
            repo: context.repo.repo,
            deployment_id: context.payload.deployment?.id || 0,
            state: '${{ steps.message.outputs.status }}' === 'success' ? 'success' : 'failure',
            environment: '${{ needs.pre-deployment.outputs.environment }}',
            description: '${{ steps.message.outputs.message }}'
          });
```

---

## ğŸ” é©—è­‰èˆ‡é™¤éŒ¯

### æ¸¬è©¦éƒ¨ç½²æµç¨‹

**1. æ¸¬è©¦æ–‡ä»¶éƒ¨ç½²**ï¼š
```bash
# ä¿®æ”¹æ–‡ä»¶
echo "<h1>Test Update</h1>" >> docs/index.html

# æäº¤è§¸ç™¼éƒ¨ç½²
git add docs/
git commit -m "docs: test automatic deployment"
git push origin main

# æª¢æŸ¥ GitHub Pages æ˜¯å¦æ›´æ–°
```

**2. æ¸¬è©¦æ‡‰ç”¨éƒ¨ç½²**ï¼š
```bash
# è§¸ç™¼ workflow
gh workflow run "Deploy Application" --field environment=staging

# ç›£æ§åŸ·è¡Œç‹€æ…‹
gh run list --workflow="Deploy Application"

# æŸ¥çœ‹è©³ç´°æ—¥èªŒ
gh run view <run-id> --log
```

**3. æœ¬æ©Ÿæ¸¬è©¦éƒ¨ç½²è…³æœ¬**ï¼š
```bash
# è¨­å®šç’°å¢ƒè®Šæ•¸
export GITHUB_REPOSITORY="username/repo"
export GITHUB_SHA="abc123"

# æ¸¬è©¦å¥åº·æª¢æŸ¥
./scripts/health-check.sh

# æ¸¬è©¦éƒ¨ç½²é‚è¼¯ï¼ˆä¿®æ”¹è…³æœ¬ç‚ºæ¸¬è©¦æ¨¡å¼ï¼‰
./scripts/deploy.sh
```

### å¸¸è¦‹å•é¡Œèˆ‡è§£æ±º

**å•é¡Œ 1ï¼šGitHub Pages éƒ¨ç½²å¤±æ•—**
```
Error: No such file or directory
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```yaml
# ç¢ºä¿ docs ç›®éŒ„å­˜åœ¨ä¸”æœ‰å…§å®¹
- name: Check docs directory
  run: |
    if [ ! -d "docs" ] || [ -z "$(ls -A docs)" ]; then
      echo "docs directory is empty"
      mkdir -p docs
      echo "<h1>Default Page</h1>" > docs/index.html
    fi
```

**å•é¡Œ 2ï¼šç’°å¢ƒæ¬Šé™ä¸è¶³**
```
Error: Resource not accessible by integration
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```yaml
# ç¢ºä¿æœ‰æ­£ç¢ºçš„æ¬Šé™è¨­å®š
permissions:
  contents: read
  pages: write
  id-token: write
  deployments: write
```

**å•é¡Œ 3ï¼šå¥åº·æª¢æŸ¥å¤±æ•—**
```
Health check failed after 5 attempts
```

**æª¢æŸ¥æ¸…å–®**ï¼š
- [ ] æœå‹™æ˜¯å¦çœŸçš„å•Ÿå‹•å®Œæˆï¼Ÿ
- [ ] å¥åº·æª¢æŸ¥ URL æ˜¯å¦æ­£ç¢ºï¼Ÿ
- [ ] é˜²ç«ç‰†æ˜¯å¦å…è¨±é€£ç·šï¼Ÿ
- [ ] å®¹å™¨æ˜¯å¦æœ‰æš´éœ²æ­£ç¢ºçš„ç«¯å£ï¼Ÿ

---

## ğŸŒŸ å»¶ä¼¸æŒ‘æˆ°

### æŒ‘æˆ° 1ï¼šè—ç¶ éƒ¨ç½²

å¯¦ä½œé›¶åœæ©Ÿçš„è—ç¶ éƒ¨ç½²ï¼š

```yaml
- name: Blue-Green Deployment
  run: |
    # éƒ¨ç½²åˆ°ç¶ è‰²ç’°å¢ƒ
    docker run -d --name app-green -p 8001:8000 $NEW_IMAGE

    # å¥åº·æª¢æŸ¥
    curl -f http://localhost:8001/health

    # åˆ‡æ›æµé‡ï¼ˆæ›´æ–° nginx é…ç½®ï¼‰
    nginx -s reload

    # åœæ­¢è—è‰²ç’°å¢ƒ
    docker stop app-blue
```

### æŒ‘æˆ° 2ï¼šé‡‘çµ²é›€éƒ¨ç½²

å¯¦ä½œæ¼¸é€²å¼çš„é‡‘çµ²é›€éƒ¨ç½²ï¼š

```yaml
- name: Canary Deployment
  run: |
    # éƒ¨ç½² 10% æµé‡åˆ°æ–°ç‰ˆæœ¬
    kubectl patch deployment myapp -p '{"spec":{"replicas":10}}'
    kubectl set image deployment/myapp-canary myapp=$NEW_IMAGE
    kubectl scale deployment myapp-canary --replicas=1

    # ç›£æ§æŒ‡æ¨™ 5 åˆ†é˜
    sleep 300

    # å¦‚æœæŒ‡æ¨™æ­£å¸¸ï¼Œæ“´å±•åˆ° 100%
    kubectl scale deployment myapp-canary --replicas=10
    kubectl scale deployment myapp --replicas=0
```

### æŒ‘æˆ° 3ï¼šè‡ªå‹•å›é€€è§¸ç™¼å™¨

åŸºæ–¼æŒ‡æ¨™è‡ªå‹•è§¸ç™¼å›é€€ï¼š

```yaml
- name: Monitor and auto-rollback
  run: |
    # ç›£æ§éŒ¯èª¤ç‡
    ERROR_RATE=$(curl -s "http://prometheus:9090/api/v1/query?query=rate(http_requests_total{status=~'5..'}[5m])" | jq '.data.result[0].value[1]')

    if (( $(echo "$ERROR_RATE > 0.05" | bc -l) )); then
      echo "Error rate too high: $ERROR_RATE"
      ./scripts/rollback.sh
      exit 1
    fi
```

---

## ğŸ“– çŸ¥è­˜å›é¡§

å®Œæˆé€™å€‹æƒ…å¢ƒé¡Œå¾Œï¼Œä½ æ‡‰è©²å­¸æœƒï¼š

### æ ¸å¿ƒæ¦‚å¿µ
- âœ… CI vs CD çš„å·®åˆ¥å’Œåƒ¹å€¼
- âœ… éƒ¨ç½²ç­–ç•¥çš„é¸æ“‡è€ƒé‡
- âœ… å¥åº·æª¢æŸ¥å’Œå›é€€æ©Ÿåˆ¶çš„é‡è¦æ€§
- âœ… å¤šç’°å¢ƒéƒ¨ç½²çš„ç®¡ç†

### å¯¦æˆ°æŠ€èƒ½
- âœ… å»ºç«‹è‡ªå‹•åŒ–éƒ¨ç½² workflow
- âœ… é…ç½® GitHub Pages éƒ¨ç½²
- âœ… è¨­è¨ˆéƒ¨ç½²è…³æœ¬å’Œå¥åº·æª¢æŸ¥
- âœ… å¯¦ä½œåŸºç¤çš„å›é€€æ©Ÿåˆ¶

### æœ€ä½³å¯¦è¸
- âœ… éƒ¨ç½²å‰çš„ CI æª¢æŸ¥
- âœ… éƒ¨ç½²å¾Œçš„é©—è­‰æµç¨‹
- âœ… å¤±æ•—æ™‚çš„è‡ªå‹•å›é€€
- âœ… éƒ¨ç½²é€šçŸ¥å’Œç‹€æ…‹è¿½è¹¤

### é€²éšæ¦‚å¿µ
- âœ… å¤šç’°å¢ƒéƒ¨ç½²ç­–ç•¥
- âœ… æ¢ä»¶å¼éƒ¨ç½²è§¸ç™¼
- âœ… éƒ¨ç½²å¯©æ‰¹æµç¨‹
- âœ… éƒ¨ç½²æŒ‡æ¨™ç›£æ§

---

## ğŸ“ å­¸ç¿’ç­†è¨˜ç¯„æœ¬

```markdown
## B06 å­¸ç¿’ç­†è¨˜

### å®Œæˆæ™‚é–“
[å¡«å¯«]

### éƒ¨ç½²æ¦‚å¿µç†è§£
- **CI vs CD**ï¼š[ä½ çš„ç†è§£]
- **æŒçºŒéƒ¨ç½² vs æŒçºŒäº¤ä»˜**ï¼š[å·®åˆ¥å’Œé¸æ“‡]
- **éƒ¨ç½²ç­–ç•¥**ï¼š[ä¸åŒç­–ç•¥çš„é©ç”¨å ´æ™¯]

### éƒ¨ç½²æµç¨‹è¨­è¨ˆ
1. **éƒ¨ç½²è§¸ç™¼æ¢ä»¶**ï¼š[ä½•æ™‚è§¸ç™¼éƒ¨ç½²]
2. **é æª¢æŸ¥æ©Ÿåˆ¶**ï¼š[éƒ¨ç½²å‰çš„é©—è­‰]
3. **éƒ¨ç½²åŸ·è¡Œ**ï¼š[å¯¦éš›éƒ¨ç½²æ­¥é©Ÿ]
4. **éƒ¨ç½²å¾Œé©—è­‰**ï¼š[å¥åº·æª¢æŸ¥å’Œæ¸¬è©¦]
5. **å¤±æ•—è™•ç†**ï¼š[å›é€€æ©Ÿåˆ¶]

### é‡åˆ°çš„å•é¡Œ
1. [å•é¡Œæè¿°]
   - è§£æ±ºæ–¹æ¡ˆï¼š[...]
2. [å•é¡Œæè¿°]
   - è§£æ±ºæ–¹æ¡ˆï¼š[...]

### ç’°å¢ƒç®¡ç†ç­–ç•¥
- **é–‹ç™¼ç’°å¢ƒ**ï¼š[ç®¡ç†æ–¹å¼]
- **æ¸¬è©¦ç’°å¢ƒ**ï¼š[ç”¨é€”å’Œé…ç½®]
- **ç”Ÿç”¢ç’°å¢ƒ**ï¼š[å®‰å…¨æ€§è€ƒé‡]

### é—œéµå­¸ç¿’é»
1. è‡ªå‹•åŒ–éƒ¨ç½²çš„åƒ¹å€¼ï¼š[...]
2. å¥åº·æª¢æŸ¥çš„é‡è¦æ€§ï¼š[...]
3. å›é€€æ©Ÿåˆ¶çš„è¨­è¨ˆï¼š[...]

### å¯¦éš›æ‡‰ç”¨è¨ˆç•«
- [ ] ç‚ºç¾æœ‰å°ˆæ¡ˆå»ºç«‹éƒ¨ç½²æµç¨‹
- [ ] è¨­å®šå¤šç’°å¢ƒéƒ¨ç½²ç­–ç•¥
- [ ] å»ºç«‹ç›£æ§å’Œå‘Šè­¦æ©Ÿåˆ¶

### ä¸‹ä¸€æ­¥
- [ ] å®ŒæˆæŒ‘æˆ° 1ï¼ˆè—ç¶ éƒ¨ç½²ï¼‰
- [ ] é€²å…¥çµ„åˆç´šæƒ…å¢ƒé¡Œ
```

---

**æ­å–œå®Œæˆ B06ï¼** ğŸ‰

ä½ å·²ç¶“å®Œæˆäº†æ‰€æœ‰åŸºç¤ç´šåˆ¥çš„ CI/CD æƒ…å¢ƒé¡Œï¼ŒæŒæ¡äº†ï¼š
- âœ… **B01**ï¼šåŸºç¤æ¸¬è©¦ç®¡ç·š
- âœ… **B02**ï¼šç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥
- âœ… **B03**ï¼šéœæ…‹å®‰å…¨åˆ†æ
- âœ… **B04**ï¼šDocker å®¹å™¨åŒ–
- âœ… **B05**ï¼šä¾è³´å®‰å…¨æƒæ
- âœ… **B06**ï¼šè‡ªå‹•åŒ–éƒ¨ç½²æµç¨‹

**ä¸‹ä¸€éšæ®µ**ï¼šå‰å¾€ `çµ„åˆç´š/C01_å®‰å…¨æƒæç®¡ç·šå»ºç«‹.md`ï¼ŒæŒ‘æˆ°æ›´è¤‡é›œçš„ä¼æ¥­ç´š CI/CD å·¥ä½œæµç¨‹æ•´åˆï¼