# B02ï¼šé…ç½®ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥

## ğŸ“‹ æƒ…å¢ƒè³‡è¨Š

**é›£åº¦ç­‰ç´š**ï¼šâ­ åŸºç¤ç´š
**é ä¼°æ™‚é–“**ï¼š25 åˆ†é˜
**æ ¸å¿ƒæŠ€èƒ½**ï¼šGitHub Actionsã€flake8ã€blackã€isort
**å‰ç½®çŸ¥è­˜**ï¼šB01ï¼ˆå»ºç«‹åŸºç¤æ¸¬è©¦ç®¡ç·šï¼‰

---

## ğŸ¯ æƒ…å¢ƒèƒŒæ™¯

ä½ çš„åœ˜éšŠå·²ç¶“æœ‰äº†è‡ªå‹•åŒ–æ¸¬è©¦ï¼ˆä¾†è‡ª B01ï¼‰ï¼Œä½†ç™¼ç¾äº†æ–°å•é¡Œï¼š

**ç¨‹å¼ç¢¼é¢¨æ ¼ä¸ä¸€è‡´**ï¼š
- å°æ˜å–œæ­¡ç”¨å–®å¼•è™Ÿï¼š`print('hello')`
- å°è¯å–œæ­´ç”¨é›™å¼•è™Ÿï¼š`print("hello")`
- å°æä¸åœ¨ä¹ç¸®æ’ï¼Œæ··ç”¨ tabs å’Œ spaces
- å°ç‹çš„ import é †åºç¸½æ˜¯äº‚çš„

**æ˜¨å¤©çš„ Code Review**ï¼š
```python
# å°æ˜çš„ç¨‹å¼ç¢¼
import sys,os
import requests
from app.models import User
def get_user(id):
    user=User.query.filter_by(id=id).first()
    if not user:return None
    return user

# å¯©æŸ¥è€…ï¼šã€Œé€™æ ¼å¼...çœ¼ç›å¥½ç—›ã€
# å°æ˜ï¼šã€Œä½†æ˜¯èƒ½è·‘å•Šï¼ã€
```

**åœ˜éšŠæ±ºå®š**ï¼š
> ã€Œæˆ‘å€‘éœ€è¦è‡ªå‹•åŒ–ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ï¼çµ±ä¸€æ ¼å¼ï¼Œæå‡å¯è®€æ€§ã€‚ã€

**ä½ çš„ä»»å‹™**ï¼š
åœ¨ç¾æœ‰çš„æ¸¬è©¦ç®¡ç·šä¸­åŠ å…¥ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥å·¥å…·ï¼ˆlintingï¼‰ï¼Œç¢ºä¿ç¨‹å¼ç¢¼ç¬¦åˆ PEP 8 è¦ç¯„ã€‚

---

## ğŸ“¦ å°ˆæ¡ˆçµæ§‹

å»¶çºŒ B01 çš„å°ˆæ¡ˆï¼š

```
my-fastapi-project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ models.py
â”‚   â””â”€â”€ utils.py           # æ–°å¢ï¼šå·¥å…·å‡½å¼
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_main.py
â”‚   â””â”€â”€ test_models.py
â”‚
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ test.yml       # ç¾æœ‰çš„æ¸¬è©¦ workflow
â”‚
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

**æœ‰å•é¡Œçš„ç¨‹å¼ç¢¼ç¯„ä¾‹ï¼ˆapp/utils.pyï¼‰**ï¼š
```python
import sys,os
import requests
from app.models import User

def get_user_data(id,format='json'):
    user=User.query.filter_by(id=id).first()
    if not user:return None

    data={'id':user.id,'name':user.name,'email':user.email}

    if format=='json':
        return data
    elif format=='xml':
        return f"<user><id>{data['id']}</id><name>{data['name']}</name></user>"
    else:return None
```

**å•é¡Œåˆ—è¡¨**ï¼š
1. Import é †åºä¸ç•¶ï¼ˆæ¨™æº–åº«ã€ç¬¬ä¸‰æ–¹ã€æœ¬åœ°æ··åœ¨ä¸€èµ·ï¼‰
2. è¡Œé•·åº¦è¶…é 79 å­—å…ƒ
3. ç¼ºå°‘ç©ºæ ¼ï¼ˆ`id,format` æ‡‰è©²æ˜¯ `id, format`ï¼‰
4. å‡½å¼å®šç¾©å¾Œç¼ºå°‘ç©ºè¡Œ
5. å­—å…¸å®šç¾©æ™‚ç¼ºå°‘ç©ºæ ¼

---

## ğŸ¯ ä»»å‹™ç›®æ¨™

### å¿…é”ç›®æ¨™
1. âœ… åœ¨ç¾æœ‰ workflow ä¸­åŠ å…¥ **flake8**ï¼ˆPEP 8 æª¢æŸ¥ï¼‰
2. âœ… åœ¨ç¾æœ‰ workflow ä¸­åŠ å…¥ **black**ï¼ˆç¨‹å¼ç¢¼æ ¼å¼åŒ–æª¢æŸ¥ï¼‰
3. âœ… åœ¨ç¾æœ‰ workflow ä¸­åŠ å…¥ **isort**ï¼ˆimport æ’åºæª¢æŸ¥ï¼‰
4. âœ… ç¢ºä¿ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥åœ¨æ¸¬è©¦ä¹‹å‰åŸ·è¡Œï¼ˆå¿«é€Ÿå¤±æ•—ï¼‰
5. âœ… åœ¨ GitHub Actions ä¸­çœ‹åˆ°å“è³ªæª¢æŸ¥çµæœ

### åŠ åˆ†é …ç›®
- ğŸŒŸ å»ºç«‹ `.flake8` é…ç½®æª”æ¡ˆè‡ªè¨‚è¦å‰‡
- ğŸŒŸ å»ºç«‹ `pyproject.toml` çµ±ä¸€å·¥å…·é…ç½®
- ğŸŒŸ åŠ å…¥ **mypy** å‹åˆ¥æª¢æŸ¥
- ğŸŒŸ è¨­å®šè¡Œé•·åº¦é™åˆ¶ç‚º 100 å­—å…ƒï¼ˆç¾ä»£æ¨™æº–ï¼‰

---

## ğŸ“š å­¸ç¿’æª¢æŸ¥é»

å®Œæˆæ­¤æƒ…å¢ƒé¡Œæ™‚ï¼Œè«‹ç¢ºèªä½ èƒ½å›ç­”ï¼š

### Checkpoint 1ï¼šç¨‹å¼ç¢¼å“è³ªå·¥å…·
- [ ] flake8 çš„ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿæª¢æŸ¥å“ªäº›å•é¡Œï¼Ÿ
- [ ] black å’Œ flake8 çš„å·®åˆ¥æ˜¯ä»€éº¼ï¼Ÿ
- [ ] isort è§£æ±ºä»€éº¼å•é¡Œï¼Ÿ
- [ ] ç‚ºä»€éº¼å“è³ªæª¢æŸ¥è¦åœ¨æ¸¬è©¦ä¹‹å‰åŸ·è¡Œï¼Ÿ

### Checkpoint 2ï¼šå·¥å…·é…ç½®
- [ ] å¦‚ä½•è¨­å®š flake8 å¿½ç•¥ç‰¹å®šè¦å‰‡ï¼Ÿ
- [ ] å¦‚ä½•çµ±ä¸€ black å’Œ flake8 çš„è¡Œé•·åº¦è¨­å®šï¼Ÿ
- [ ] pyproject.toml çš„å„ªå‹¢æ˜¯ä»€éº¼ï¼Ÿ

### Checkpoint 3ï¼šCI/CD æ•´åˆ
- [ ] å¦‚ä½•åœ¨ GitHub Actions ä¸­å®‰è£ linting å·¥å…·ï¼Ÿ
- [ ] å¦‚ä½•è®“å“è³ªæª¢æŸ¥å¤±æ•—æ™‚é˜»æ­¢ workflowï¼Ÿ
- [ ] å¦‚ä½•å¿«é€Ÿå®šä½å“è³ªå•é¡Œï¼Ÿ

---

## ğŸš€ å¯¦ä½œæ­¥é©Ÿ

### æ–¹æ³• 1ï¼šç”¨ Claude ç”Ÿæˆï¼ˆæ¨è–¦ï¼‰

#### æ­¥é©Ÿ 1ï¼šæº–å‚™æç¤ºè©

```
æˆ‘æœ‰ä¸€å€‹ Python FastAPI å°ˆæ¡ˆï¼Œå·²ç¶“æœ‰åŸºç¤çš„æ¸¬è©¦ workflowã€‚

ç¾åœ¨è¦åŠ å…¥ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ï¼Œè«‹å¹«æˆ‘ä¿®æ”¹ .github/workflows/test.ymlï¼š

ç•¶å‰ workflowï¼š
[è²¼ä¸Šä½ çš„ test.yml å…§å®¹]

æ–°å¢éœ€æ±‚ï¼š
1. åŠ å…¥ flake8ï¼ˆPEP 8 æª¢æŸ¥ï¼‰
2. åŠ å…¥ blackï¼ˆæ ¼å¼åŒ–æª¢æŸ¥ï¼Œä¸è‡ªå‹•ä¿®æ”¹ï¼Œåªæª¢æŸ¥ï¼‰
3. åŠ å…¥ isortï¼ˆimport æ’åºæª¢æŸ¥ï¼‰
4. å“è³ªæª¢æŸ¥è¦åœ¨æ¸¬è©¦ä¹‹å‰åŸ·è¡Œ
5. è¨­å®šè¡Œé•·åº¦ç‚º 100 å­—å…ƒ
6. ä»»ä½•æª¢æŸ¥å¤±æ•—éƒ½è¦è®“ workflow å¤±æ•—

è«‹æä¾›ï¼š
1. ä¿®æ”¹å¾Œçš„å®Œæ•´ workflow
2. å»ºè­°çš„ pyproject.toml é…ç½®
3. åœ¨æœ¬æ©ŸåŸ·è¡Œé€™äº›æª¢æŸ¥çš„æŒ‡ä»¤

è«‹åŠ ä¸Šè©³ç´°è¨»è§£èªªæ˜ã€‚
```

#### æ­¥é©Ÿ 2ï¼šå»ºç«‹é…ç½®æª”æ¡ˆ

æ ¹æ“š Claude çš„å»ºè­°ï¼Œå»ºç«‹ `pyproject.toml`ï¼š

```bash
# åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„
touch pyproject.toml
# å°‡ Claude ç”Ÿæˆçš„é…ç½®è²¼ä¸Š
```

#### æ­¥é©Ÿ 3ï¼šä¿®æ”¹ Workflow

```bash
# å‚™ä»½ç¾æœ‰æª”æ¡ˆ
cp .github/workflows/test.yml .github/workflows/test.yml.backup

# ä¿®æ”¹ workflow
vim .github/workflows/test.yml
# å°‡ Claude ç”Ÿæˆçš„å…§å®¹è²¼ä¸Š
```

#### æ­¥é©Ÿ 4ï¼šæœ¬æ©Ÿæ¸¬è©¦

åœ¨æäº¤å‰ï¼Œå…ˆåœ¨æœ¬æ©Ÿæ¸¬è©¦ï¼š

```bash
# å®‰è£å·¥å…·
pip install flake8 black isort

# åŸ·è¡Œæª¢æŸ¥
flake8 app tests
black --check app tests
isort --check-only app tests

# å¦‚æœæœ‰å•é¡Œï¼Œä¿®å¾©å¾Œå†åŸ·è¡Œ
```

### æ–¹æ³• 2ï¼šæ‰‹å‹•ç·¨å¯«ï¼ˆå­¸ç¿’ç”¨ï¼‰

#### æ­¥é©Ÿ 1ï¼šäº†è§£å·¥å…·åŠŸèƒ½

**flake8**ï¼šæª¢æŸ¥ PEP 8 è¦ç¯„
```bash
# å®‰è£
pip install flake8

# æª¢æŸ¥æŒ‡å®šç›®éŒ„
flake8 app tests

# å¸¸è¦‹éŒ¯èª¤ï¼š
# E501: line too long
# E302: expected 2 blank lines
# W503: line break before binary operator
```

**black**ï¼šç¨‹å¼ç¢¼æ ¼å¼åŒ–
```bash
# å®‰è£
pip install black

# æª¢æŸ¥æ¨¡å¼ï¼ˆä¸ä¿®æ”¹æª”æ¡ˆï¼‰
black --check app tests

# å¯¦éš›æ ¼å¼åŒ–ï¼ˆä¿®æ”¹æª”æ¡ˆï¼‰
black app tests
```

**isort**ï¼šimport æ’åº
```bash
# å®‰è£
pip install isort

# æª¢æŸ¥æ¨¡å¼
isort --check-only app tests

# å¯¦éš›æ’åº
isort app tests
```

#### æ­¥é©Ÿ 2ï¼šå»ºç«‹é…ç½®æª”æ¡ˆ

**pyproject.toml**ï¼š
```toml
[tool.black]
line-length = 100
target-version = ['py311']
include = '\.pyi?$'
extend-exclude = '''
/(
    \.eggs
  | \.git
  | \.venv
  | build
  | dist
)/
'''

[tool.isort]
profile = "black"
line_length = 100
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true

[tool.flake8]
max-line-length = 100
extend-ignore = ["E203", "W503"]
exclude = [".git", "__pycache__", "build", "dist", ".venv"]
```

#### æ­¥é©Ÿ 3ï¼šä¿®æ”¹ Workflow

åœ¨ç¾æœ‰çš„ `test.yml` ä¸­åŠ å…¥å“è³ªæª¢æŸ¥ï¼š

```yaml
name: Test and Quality Check

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    name: Code Quality Check

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Cache pip packages
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-quality-${{ hashFiles('requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-quality-

    - name: Install quality tools
      run: |
        python -m pip install --upgrade pip
        pip install flake8 black isort

    - name: Run flake8
      run: flake8 app tests --max-line-length=100

    - name: Check black formatting
      run: black --check app tests --line-length=100

    - name: Check import sorting
      run: isort --check-only app tests --profile=black

  test:
    needs: quality-check  # å“è³ªæª¢æŸ¥é€šéå¾Œæ‰åŸ·è¡Œæ¸¬è©¦
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Cache pip packages
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run tests
      run: pytest -v
```

---

## âœ… åƒè€ƒè§£ç­”

### å®Œæ•´ Workflowï¼ˆtest.ymlï¼‰

```yaml
name: Test and Quality Check

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  # Job 1: ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ï¼ˆå¿«é€Ÿå¤±æ•—ï¼‰
  quality-check:
    name: Code Quality Check
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Cache quality tools
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-quality-${{ hashFiles('pyproject.toml') }}
        restore-keys: |
          ${{ runner.os }}-quality-

    - name: Install quality tools
      run: |
        python -m pip install --upgrade pip
        pip install flake8 black isort mypy

    - name: Run flake8 (PEP 8 check)
      run: |
        echo "ğŸ” Running flake8..."
        flake8 app tests --statistics

    - name: Check black formatting
      run: |
        echo "ğŸ¨ Checking black formatting..."
        black --check app tests --diff

    - name: Check import sorting (isort)
      run: |
        echo "ğŸ“š Checking import sorting..."
        isort --check-only app tests --diff

    - name: Run mypy (type checking)
      run: |
        echo "ğŸ”¤ Running mypy type checking..."
        mypy app --ignore-missing-imports
      continue-on-error: true  # å‹åˆ¥æª¢æŸ¥å¤±æ•—ä¸é˜»æ­¢ workflow

  # Job 2: æ¸¬è©¦ï¼ˆä¾è³´å“è³ªæª¢æŸ¥é€šéï¼‰
  test:
    name: Run Tests
    needs: quality-check
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Cache pip packages
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run tests with coverage
      run: |
        pip install pytest-cov
        pytest --cov=app --cov-report=term --cov-report=xml -v

    - name: Generate test summary
      if: always()
      run: |
        echo "## Test Results ğŸ§ª" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Quality checks passed âœ…" >> $GITHUB_STEP_SUMMARY
        echo "Tests completed âœ…" >> $GITHUB_STEP_SUMMARY
```

### é…ç½®æª”æ¡ˆï¼ˆpyproject.tomlï¼‰

```toml
[tool.black]
line-length = 100
target-version = ['py311']
include = '\.pyi?$'
extend-exclude = '''
/(
    \.eggs
  | \.git
  | \.venv
  | build
  | dist
  | __pycache__
)/
'''

[tool.isort]
profile = "black"
line_length = 100
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true
src_paths = ["app", "tests"]

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
no_implicit_optional = true
show_error_codes = true

[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = false
```

### ç¨ç«‹çš„ flake8 é…ç½®ï¼ˆ.flake8ï¼‰

å¦‚æœä¸ç”¨ pyproject.tomlï¼Œå¯ä»¥å»ºç«‹ `.flake8`ï¼š

```ini
[flake8]
max-line-length = 100
extend-ignore =
    E203,  # whitespace before ':'
    W503,  # line break before binary operator
    E501,  # line too long (handled by black)
exclude =
    .git,
    __pycache__,
    build,
    dist,
    .venv,
    .tox
statistics = True
count = True
```

---

## ğŸ” é©—è­‰èˆ‡é™¤éŒ¯

### æ¸¬è©¦å“è³ªæª¢æŸ¥

**1. æ•…æ„å¼•å…¥æ ¼å¼å•é¡Œ**

ä¿®æ”¹ `app/utils.py`ï¼š
```python
import sys,os  # æ•…æ„ä¸åŠ ç©ºæ ¼
import requests
from app.models import User

def get_user_data(id,format='json'):  # æ•…æ„ä¸åŠ ç©ºæ ¼
    user=User.query.filter_by(id=id).first()  # æ•…æ„ä¸åŠ ç©ºæ ¼
    if not user:return None  # æ•…æ„å¯«åœ¨åŒä¸€è¡Œ
    return {'id':user.id,'name':user.name}  # æ•…æ„ä¸åŠ ç©ºæ ¼
```

**2. æäº¤ä¸¦è§€å¯Ÿ**

```bash
git add .
git commit -m "test: add quality issues"
git push
```

æ‡‰è©²çœ‹åˆ° workflow å¤±æ•—ï¼Œä¸¦é¡¯ç¤ºå…·é«”å•é¡Œã€‚

**3. ä¿®å¾©å•é¡Œ**

```bash
# è‡ªå‹•ä¿®å¾©æ ¼å¼
black app tests
isort app tests

# æª¢æŸ¥ä¿®å¾©çµæœ
flake8 app tests
```

### æœ¬æ©Ÿé–‹ç™¼å·¥ä½œæµç¨‹

**æ¯æ¬¡æäº¤å‰åŸ·è¡Œ**ï¼š
```bash
# ä¸€éµæª¢æŸ¥è…³æœ¬
echo '#!/bin/bash
echo "ğŸ” Running quality checks..."
flake8 app tests
black --check app tests
isort --check-only app tests
echo "âœ… All quality checks passed!"
' > scripts/quality-check.sh

chmod +x scripts/quality-check.sh
./scripts/quality-check.sh
```

**è‡ªå‹•ä¿®å¾©è…³æœ¬**ï¼š
```bash
echo '#!/bin/bash
echo "ğŸ› ï¸ Auto-fixing code quality..."
black app tests
isort app tests
echo "âœ… Code formatted!"
echo "Please review changes and commit."
' > scripts/format-code.sh

chmod +x scripts/format-code.sh
./scripts/format-code.sh
```

### å¸¸è¦‹å•é¡Œèˆ‡è§£æ±º

**å•é¡Œ 1ï¼šblack å’Œ flake8 è¡çª**
```
flake8 æŠ±æ€¨ E203: whitespace before ':'
ä½† black å°±æ˜¯é€™æ¨£æ ¼å¼åŒ–çš„
```

**è§£æ±º**ï¼šåœ¨ flake8 è¨­å®šä¸­å¿½ç•¥ E203
```ini
[flake8]
extend-ignore = E203, W503
```

**å•é¡Œ 2ï¼šimport é †åºæª¢æŸ¥å¤±æ•—**
```
isort æƒ³è¦é€™æ¨£ï¼š
import os
import sys

import requests

from app.models import User
```

**è§£æ±º**ï¼šè¨­å®š isort ä½¿ç”¨ black profile
```toml
[tool.isort]
profile = "black"
```

**å•é¡Œ 3ï¼šå‹åˆ¥æª¢æŸ¥å¤ªåš´æ ¼**
```
mypy: error: Function is missing a return type annotation
```

**è§£æ±º**ï¼šé‡å°æ¸¬è©¦æª”æ¡ˆæ”¾å¯¬é™åˆ¶
```toml
[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = false
```

---

## ğŸŒŸ å»¶ä¼¸æŒ‘æˆ°

### æŒ‘æˆ° 1ï¼šPre-commit Hook

åœ¨æœ¬æ©Ÿè¨­å®š pre-commit hookï¼š

```bash
# å®‰è£ pre-commit
pip install pre-commit

# å»ºç«‹ .pre-commit-config.yaml
cat > .pre-commit-config.yaml << EOF
repos:
  - repo: https://github.com/psf/black
    rev: 23.10.1
    hooks:
      - id: black
        language_version: python3.11

  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort

  - repo: https://github.com/pycqa/flake8
    rev: 6.1.0
    hooks:
      - id: flake8
EOF

# å®‰è£ hook
pre-commit install

# æ¸¬è©¦
pre-commit run --all-files
```

ç¾åœ¨æ¯æ¬¡ `git commit` éƒ½æœƒè‡ªå‹•åŸ·è¡Œæª¢æŸ¥ï¼

### æŒ‘æˆ° 2ï¼šè‡ªå‹•ä¿®å¾© PR

å»ºç«‹å¯ä»¥è‡ªå‹•ä¿®å¾©æ ¼å¼çš„ workflowï¼š

```yaml
name: Auto-fix Code Style

on:
  pull_request:
    branches: [main]

jobs:
  auto-fix:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        ref: ${{ github.head_ref }}

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install tools
      run: pip install black isort

    - name: Auto-fix formatting
      run: |
        black app tests
        isort app tests

    - name: Commit changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git diff --staged --quiet || git commit -m "style: auto-fix code formatting"
        git push
```

### æŒ‘æˆ° 3ï¼šå“è³ªå ±å‘Š

åœ¨ PR ä¸­é¡¯ç¤ºå“è³ªæª¢æŸ¥æ‘˜è¦ï¼š

```yaml
- name: Generate quality report
  if: github.event_name == 'pull_request'
  run: |
    echo "## Code Quality Report ğŸ“Š" > quality-report.md
    echo "" >> quality-report.md

    echo "### flake8 Results" >> quality-report.md
    flake8 app tests --statistics >> quality-report.md || true

    echo "### black Check" >> quality-report.md
    black --check app tests >> quality-report.md 2>&1 || true

    echo "### isort Check" >> quality-report.md
    isort --check-only app tests >> quality-report.md 2>&1 || true

- name: Comment PR with quality report
  uses: actions/github-script@v6
  with:
    script: |
      const fs = require('fs');
      const report = fs.readFileSync('quality-report.md', 'utf8');
      github.rest.issues.createComment({
        issue_number: context.issue.number,
        owner: context.repo.owner,
        repo: context.repo.repo,
        body: report
      });
```

---

## ğŸ“– çŸ¥è­˜å›é¡§

å®Œæˆé€™å€‹æƒ…å¢ƒé¡Œå¾Œï¼Œä½ æ‡‰è©²å­¸æœƒï¼š

### æ ¸å¿ƒæ¦‚å¿µ
- âœ… ç¨‹å¼ç¢¼å“è³ªå·¥å…·çš„ä½œç”¨ï¼ˆflake8ã€blackã€isortï¼‰
- âœ… PEP 8 è¦ç¯„çš„é‡è¦æ€§
- âœ… è‡ªå‹•åŒ–å“è³ªæª¢æŸ¥çš„åƒ¹å€¼
- âœ… å·¥å…·é…ç½®çš„çµ±ä¸€ç®¡ç†ï¼ˆpyproject.tomlï¼‰

### å¯¦æˆ°æŠ€èƒ½
- âœ… åœ¨ CI/CD ä¸­æ•´åˆå“è³ªæª¢æŸ¥
- âœ… è¨­å®šå·¥å…·é…ç½®æª”æ¡ˆ
- âœ… æœ¬æ©Ÿé–‹ç™¼å·¥ä½œæµç¨‹å„ªåŒ–
- âœ… å“è³ªå•é¡Œçš„é™¤éŒ¯å’Œä¿®å¾©

### æœ€ä½³å¯¦è¸
- âœ… å“è³ªæª¢æŸ¥åœ¨æ¸¬è©¦ä¹‹å‰åŸ·è¡Œï¼ˆå¿«é€Ÿå¤±æ•—ï¼‰
- âœ… çµ±ä¸€å·¥å…·é…ç½®é¿å…è¡çª
- âœ… æœ¬æ©Ÿå’Œ CI ä½¿ç”¨ç›¸åŒå·¥å…·ç‰ˆæœ¬
- âœ… è‡ªå‹•åŒ–ä¿®å¾©æ¸›å°‘æ‰‹å‹•å·¥ä½œ

### é€²éšæ¦‚å¿µ
- âœ… Pre-commit hook çš„è¨­ç½®
- âœ… è‡ªå‹•ä¿®å¾© workflow çš„è¨­è¨ˆ
- âœ… å“è³ªå ±å‘Šçš„ç”Ÿæˆå’Œå±•ç¤º

---

## ğŸ“ å­¸ç¿’ç­†è¨˜ç¯„æœ¬

```markdown
## B02 å­¸ç¿’ç­†è¨˜

### å®Œæˆæ™‚é–“
[å¡«å¯«]

### å·¥å…·ç†è§£
- **flake8**ï¼š[ä½ çš„ç†è§£]
- **black**ï¼š[ä½ çš„ç†è§£]
- **isort**ï¼š[ä½ çš„ç†è§£]

### é…ç½®è¦é»
1. pyproject.toml çš„å„ªå‹¢ï¼š[...]
2. å·¥å…·è¡çªçš„è§£æ±ºï¼š[...]
3. æœ¬æ©Ÿå’Œ CI çš„ä¸€è‡´æ€§ï¼š[...]

### é‡åˆ°çš„å•é¡Œ
1. [å•é¡Œæè¿°]
   - è§£æ±ºæ–¹æ¡ˆï¼š[...]
2. [å•é¡Œæè¿°]
   - è§£æ±ºæ–¹æ¡ˆï¼š[...]

### é—œéµå­¸ç¿’é»
1. [...]
2. [...]
3. [...]

### æ‡‰ç”¨åˆ°å¯¦éš›å°ˆæ¡ˆçš„è¨ˆç•«
- [ ] åŠ å…¥å“è³ªæª¢æŸ¥åˆ°ç¾æœ‰å°ˆæ¡ˆ
- [ ] è¨­å®š pre-commit hook
- [ ] çµ±ä¸€åœ˜éšŠçš„ç¨‹å¼ç¢¼é¢¨æ ¼

### ä¸‹ä¸€æ­¥
- [ ] å®ŒæˆæŒ‘æˆ° 1
- [ ] é€²å…¥ B03
```

---

**æ­å–œå®Œæˆ B02ï¼** ä½ å·²ç¶“å­¸æœƒå»ºç«‹è‡ªå‹•åŒ–çš„ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ã€‚æ¥ä¸‹ä¾†å‰å¾€ `B03_æ•´åˆéœæ…‹åˆ†æ.md`ï¼Œå­¸ç¿’æ›´æ·±å…¥çš„å®‰å…¨æƒææŠ€è¡“ã€‚