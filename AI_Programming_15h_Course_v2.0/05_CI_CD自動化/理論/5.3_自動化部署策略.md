# 5.3 è‡ªå‹•åŒ–éƒ¨ç½²ç­–ç•¥ï¼šå®‰å…¨é«˜æ•ˆçš„ç™¼å¸ƒ

## ğŸ“š æœ¬ç« æ¦‚è¿°

**å­¸ç¿’é¡å‹**ï¼šè£œå……é–±è®€ï¼ˆé¸ä¿®ï¼‰

**é–±è®€æ™‚é•·**ï¼š20-30 åˆ†é˜

**æ ¸å¿ƒç›®æ¨™**ï¼š
- ç†è§£ä¸åŒéƒ¨ç½²ç­–ç•¥çš„å„ªç¼ºé»
- æŒæ¡ Docker å®¹å™¨åŒ–éƒ¨ç½²
- å­¸æœƒç”¨ AI ç”Ÿæˆéƒ¨ç½²è…³æœ¬
- å»ºç«‹å›é€€èˆ‡ç½é›£æ¢å¾©æ©Ÿåˆ¶

**å®šä½**ï¼š
> æœ¬ç« æ˜¯è£œå……å…§å®¹ï¼Œæ¶µè“‹éƒ¨ç½²ç›¸é—œçš„é€²éšä¸»é¡Œã€‚
> æ ¸å¿ƒèª²ç¨‹ï¼ˆ1.5hï¼‰å°ˆæ³¨æ–¼ æ¸¬è©¦ + å®‰å…¨æƒæã€‚
> éƒ¨ç½²ç­–ç•¥å¯ä¾éœ€æ±‚æ·±å…¥å­¸ç¿’ã€‚

---

## 1. éƒ¨ç½²ç­–ç•¥å°æ¯”

### 1.1 äº”ç¨®å¸¸è¦‹éƒ¨ç½²ç­–ç•¥

#### ç­–ç•¥ 1ï¼šæ»¾å‹•éƒ¨ç½²ï¼ˆRolling Deploymentï¼‰

**åŸç†**ï¼š
```
[V1] [V1] [V1] [V1]    åŸæœ‰ 4 å€‹å¯¦ä¾‹
  â†“
[V2] [V1] [V1] [V1]    é€ä¸€æ›´æ–°
  â†“
[V2] [V2] [V1] [V1]
  â†“
[V2] [V2] [V2] [V1]
  â†“
[V2] [V2] [V2] [V2]    å®Œæˆ
```

**å„ªé»**ï¼š
- âœ… ç„¡éœ€é¡å¤–è³‡æº
- âœ… ç°¡å–®æ˜“å¯¦ä½œ
- âœ… é›¶åœæ©Ÿæ™‚é–“

**ç¼ºé»**ï¼š
- âŒ V1 å’Œ V2 åŒæ™‚å­˜åœ¨ï¼ˆå¯èƒ½æœ‰ç›¸å®¹æ€§å•é¡Œï¼‰
- âŒ å›é€€æ…¢ï¼ˆéœ€è¦é€ä¸€å›å¾©ï¼‰

**é©ç”¨å ´æ™¯**ï¼š
- å‘å¾Œç›¸å®¹çš„æ›´æ–°
- è³‡æºæœ‰é™çš„å°å‹æ‡‰ç”¨

**Kubernetes å¯¦ä½œ**ï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 4
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1        # æœ€å¤šå¤šå•Ÿå‹• 1 å€‹æ–°ç‰ˆæœ¬
      maxUnavailable: 1  # æœ€å¤šåœæ­¢ 1 å€‹èˆŠç‰ˆæœ¬
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:v2
```

#### ç­–ç•¥ 2ï¼šè—ç¶ éƒ¨ç½²ï¼ˆBlue-Green Deploymentï¼‰

**åŸç†**ï¼š
```
è—è‰²ç’°å¢ƒï¼ˆV1ï¼‰[æ­£åœ¨æœå‹™æµé‡]
  â†“
ç¶ è‰²ç’°å¢ƒï¼ˆV2ï¼‰[éƒ¨ç½²æ–°ç‰ˆæœ¬ï¼Œæ¸¬è©¦]
  â†“
[åˆ‡æ›æµé‡åˆ°ç¶ è‰²ç’°å¢ƒ]
  â†“
ç¶ è‰²ç’°å¢ƒï¼ˆV2ï¼‰[æ­£åœ¨æœå‹™æµé‡]
è—è‰²ç’°å¢ƒï¼ˆV1ï¼‰[ä¿ç•™ä¸€æ®µæ™‚é–“ï¼Œä»¥å‚™å›é€€]
```

**å„ªé»**ï¼š
- âœ… ç¬é–“åˆ‡æ›ï¼ˆç§’ç´šï¼‰
- âœ… å¿«é€Ÿå›é€€ï¼ˆåˆ‡å›è—è‰²ï¼‰
- âœ… é›¶åœæ©Ÿæ™‚é–“
- âœ… å®Œæ•´æ¸¬è©¦å¾Œå†åˆ‡æ›

**ç¼ºé»**ï¼š
- âŒ éœ€è¦é›™å€è³‡æºï¼ˆåŒæ™‚é‹è¡Œå…©å¥—ç’°å¢ƒï¼‰
- âŒ è³‡æ–™åº«é·ç§»è¤‡é›œï¼ˆå…©é‚Šè¦ç›¸å®¹ï¼‰

**é©ç”¨å ´æ™¯**ï¼š
- å°åœæ©Ÿæ™‚é–“é›¶å®¹å¿
- æœ‰å……è¶³è³‡æº
- éœ€è¦å¿«é€Ÿå›é€€èƒ½åŠ›

**å¯¦ä½œç¯„ä¾‹ï¼ˆç”¨ AWS ALBï¼‰**ï¼š

```yaml
# GitHub Actions workflow
name: Blue-Green Deployment

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # å»ºç«‹æ–°ç‰ˆæœ¬ï¼ˆç¶ è‰²ï¼‰
      - name: Build new version
        run: |
          docker build -t myapp:green .
          docker tag myapp:green $ECR_REGISTRY/myapp:green
          docker push $ECR_REGISTRY/myapp:green

      # éƒ¨ç½²åˆ°ç¶ è‰²ç’°å¢ƒ
      - name: Deploy to green environment
        run: |
          aws ecs update-service --cluster prod --service myapp-green --force-new-deployment

      # ç­‰å¾…ç¶ è‰²ç’°å¢ƒå¥åº·æª¢æŸ¥
      - name: Wait for green environment
        run: |
          aws ecs wait services-stable --cluster prod --services myapp-green

      # åŸ·è¡Œç…™éœ§æ¸¬è©¦
      - name: Run smoke tests on green
        run: |
          ./scripts/smoke-test.sh https://green.myapp.com

      # åˆ‡æ›æµé‡åˆ°ç¶ è‰²
      - name: Switch traffic to green
        run: |
          aws elbv2 modify-listener --listener-arn $LISTENER_ARN \
            --default-actions Type=forward,TargetGroupArn=$GREEN_TG_ARN

      # ä¿ç•™è—è‰²ç’°å¢ƒ 30 åˆ†é˜ï¼ˆä»¥å‚™å›é€€ï¼‰
      - name: Keep blue environment
        run: |
          sleep 1800  # 30 minutes

      # å¦‚æœæ²’å•é¡Œï¼Œç§»é™¤è—è‰²ç’°å¢ƒ
      - name: Teardown blue environment
        if: success()
        run: |
          aws ecs update-service --cluster prod --service myapp-blue --desired-count 0
```

#### ç­–ç•¥ 3ï¼šé‡‘çµ²é›€éƒ¨ç½²ï¼ˆCanary Deploymentï¼‰

**åŸç†**ï¼š
```
[V1] [V1] [V1] [V1]    100% æµé‡åˆ° V1
  â†“
[V2] [V1] [V1] [V1]    5% æµé‡åˆ° V2ï¼ˆé‡‘çµ²é›€ï¼‰
  â†“ ç›£æ§æŒ‡æ¨™
[V2] [V2] [V1] [V1]    20% æµé‡åˆ° V2
  â†“ ç›£æ§æŒ‡æ¨™
[V2] [V2] [V2] [V1]    50% æµé‡åˆ° V2
  â†“ ç›£æ§æŒ‡æ¨™
[V2] [V2] [V2] [V2]    100% æµé‡åˆ° V2
```

**å„ªé»**ï¼š
- âœ… é¢¨éšªæœ€ä½ï¼ˆé€æ­¥é©—è­‰ï¼‰
- âœ… å½±éŸ¿ç¯„åœå°ï¼ˆå•é¡Œåªå½±éŸ¿å°‘æ•¸ç”¨æˆ¶ï¼‰
- âœ… å¯ä»¥ç›£æ§å¯¦éš›ç”¨æˆ¶åæ‡‰

**ç¼ºé»**ï¼š
- âŒ éƒ¨ç½²æ™‚é–“é•·
- âŒ éœ€è¦è¤‡é›œçš„æµé‡ç®¡ç†
- âŒ ç›£æ§å’Œå‘Šè­¦è¦æ±‚é«˜

**é©ç”¨å ´æ™¯**ï¼š
- é«˜é¢¨éšªæ›´æ–°
- å¤§è¦æ¨¡ç”¨æˆ¶æ‡‰ç”¨
- éœ€è¦é©—è­‰çœŸå¯¦ç”¨æˆ¶åæ‡‰

**å¯¦ä½œç¯„ä¾‹ï¼ˆç”¨ Istioï¼‰**ï¼š

```yaml
# éšæ®µ 1ï¼š5% æµé‡åˆ° V2
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: myapp
spec:
  hosts:
  - myapp.com
  http:
  - match:
    - headers:
        user-agent:
          regex: ".*Mobile.*"
    route:
    - destination:
        host: myapp
        subset: v2
      weight: 5
    - destination:
        host: myapp
        subset: v1
      weight: 95
```

**è‡ªå‹•åŒ–é‡‘çµ²é›€ï¼ˆç”¨ Flaggerï¼‰**ï¼š

```yaml
apiVersion: flagger.app/v1beta1
kind: Canary
metadata:
  name: myapp
spec:
  targetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapp
  progressDeadlineSeconds: 60
  service:
    port: 80
  analysis:
    interval: 1m
    threshold: 5
    maxWeight: 50
    stepWeight: 10
    metrics:
    - name: request-success-rate
      thresholdRange:
        min: 99
    - name: request-duration
      thresholdRange:
        max: 500
    webhooks:
    - name: load-test
      url: http://load-tester/
```

#### ç­–ç•¥ 4ï¼šA/B æ¸¬è©¦éƒ¨ç½²

**åŸç†**ï¼š
```
ç”¨æˆ¶ A ç¾¤çµ„ â†’ V1ï¼ˆç¾æœ‰åŠŸèƒ½ï¼‰
ç”¨æˆ¶ B ç¾¤çµ„ â†’ V2ï¼ˆæ–°åŠŸèƒ½ï¼‰

â†’ æ¯”è¼ƒè½‰æ›ç‡ã€ç”¨æˆ¶é«”é©—ç­‰æŒ‡æ¨™
â†’ æ±ºå®šæ¡ç”¨å“ªå€‹ç‰ˆæœ¬
```

**èˆ‡é‡‘çµ²é›€çš„å·®ç•°**ï¼š
- **é‡‘çµ²é›€**ï¼šé©—è­‰ç©©å®šæ€§ï¼ˆéŒ¯èª¤ç‡ã€æ•ˆèƒ½ï¼‰
- **A/B**ï¼šé©—è­‰æ¥­å‹™æ•ˆæœï¼ˆè½‰æ›ç‡ã€ç•™å­˜ç‡ï¼‰

**é©ç”¨å ´æ™¯**ï¼š
- ç”¢å“å¯¦é©—
- åŠŸèƒ½é©—è­‰
- ç”¨æˆ¶é«”é©—å„ªåŒ–

#### ç­–ç•¥ 5ï¼šé‡å»ºéƒ¨ç½²ï¼ˆRecreateï¼‰

**åŸç†**ï¼š
```
[V1] [V1] [V1] [V1]    åœæ­¢æ‰€æœ‰ V1
  â†“ (åœæ©Ÿæ™‚é–“)
[V2] [V2] [V2] [V2]    å•Ÿå‹•æ‰€æœ‰ V2
```

**å„ªé»**ï¼š
- âœ… å¯¦ä½œæœ€ç°¡å–®
- âœ… ç„¡ç‰ˆæœ¬å…±å­˜å•é¡Œ

**ç¼ºé»**ï¼š
- âŒ æœ‰åœæ©Ÿæ™‚é–“

**é©ç”¨å ´æ™¯**ï¼š
- å…§éƒ¨å·¥å…·ï¼ˆå¯æ¥å—çŸ­æš«åœæ©Ÿï¼‰
- é–‹ç™¼/æ¸¬è©¦ç’°å¢ƒ
- ä¸ç›¸å®¹çš„é‡å¤§æ›´æ–°

### 1.2 éƒ¨ç½²ç­–ç•¥é¸æ“‡æ±ºç­–æ¨¹

```
éœ€è¦é›¶åœæ©Ÿå—ï¼Ÿ
â”œâ”€ å¦ â†’ Recreateï¼ˆæœ€ç°¡å–®ï¼‰
â””â”€ æ˜¯
    â””â”€ æœ‰å……è¶³è³‡æºå—ï¼Ÿ
        â”œâ”€ æ˜¯ â†’ Blue-Greenï¼ˆæœ€å¿«å›é€€ï¼‰
        â””â”€ å¦
            â””â”€ æ˜¯é«˜é¢¨éšªæ›´æ–°å—ï¼Ÿ
                â”œâ”€ æ˜¯ â†’ Canaryï¼ˆæœ€å®‰å…¨ï¼‰
                â””â”€ å¦ â†’ Rollingï¼ˆå¹³è¡¡ï¼‰
```

---

## 2. Docker å®¹å™¨åŒ–éƒ¨ç½²

### 2.1 ç‚ºä»€éº¼å®¹å™¨åŒ–ï¼Ÿ

**å•é¡Œï¼šç’°å¢ƒä¸ä¸€è‡´**

```
é–‹ç™¼ç’°å¢ƒï¼š
  - Python 3.11
  - Ubuntu 22.04
  - PostgreSQL 15

ç”Ÿç”¢ç’°å¢ƒï¼š
  - Python 3.9
  - CentOS 7
  - PostgreSQL 13

â†’ "åœ¨æˆ‘é›»è…¦ä¸Šå¯ä»¥" å•é¡Œ
```

**è§£æ±ºï¼šå®¹å™¨åŒ–**

```
å®¹å™¨åŒ…å«ï¼š
  - æ‡‰ç”¨ç¨‹å¼
  - æ‰€æœ‰ä¾è³´
  - åŸ·è¡Œç’°å¢ƒ

â†’ ä¸€è‡´æ€§ï¼šé–‹ç™¼ = æ¸¬è©¦ = ç”Ÿç”¢
```

### 2.2 Dockerfile æœ€ä½³å¯¦è¸

**ç¯„ä¾‹ï¼šFastAPI æ‡‰ç”¨**

```dockerfile
# ===== éšæ®µ 1ï¼šå»ºç«‹éšæ®µ =====
FROM python:3.11 AS builder

# è¨­å®šå·¥ä½œç›®éŒ„
WORKDIR /app

# å®‰è£ä¾è³´ï¼ˆåˆ†å±¤å¿«å–ï¼‰
COPY requirements.txt .
RUN pip install --user --no-cache-dir -r requirements.txt

# ===== éšæ®µ 2ï¼šåŸ·è¡Œéšæ®µ =====
FROM python:3.11-slim

# å»ºç«‹é root ä½¿ç”¨è€…ï¼ˆå®‰å…¨ï¼‰
RUN useradd -m -u 1000 appuser

# è¨­å®šå·¥ä½œç›®éŒ„
WORKDIR /app

# åªè¤‡è£½å¿…è¦çš„æª”æ¡ˆ
COPY --from=builder /root/.local /root/.local
COPY --chown=appuser:appuser . .

# è¨­å®šç’°å¢ƒè®Šæ•¸
ENV PATH=/root/.local/bin:$PATH \
    PYTHONUNBUFFERED=1

# åˆ‡æ›åˆ°é root ä½¿ç”¨è€…
USER appuser

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¥åº·æª¢æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8000/health || exit 1

# å•Ÿå‹•å‘½ä»¤
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**é—œéµæœ€ä½³å¯¦è¸**ï¼š

1. **å¤šéšæ®µå»ºç«‹**ï¼šæ¸›å°‘æœ€çµ‚æ˜ åƒå¤§å°
2. **é root ä½¿ç”¨è€…**ï¼šæå‡å®‰å…¨æ€§
3. **HEALTHCHECK**ï¼šå®¹å™¨å¥åº·æª¢æŸ¥
4. **åˆ†å±¤å¿«å–**ï¼šå…ˆè¤‡è£½ requirements.txtï¼ˆä¸å¸¸è®Šï¼‰

### 2.3 ç”¨ AI ç”Ÿæˆ Dockerfile

**æç¤ºè©ç¯„æœ¬**ï¼š

```
æˆ‘æœ‰ä¸€å€‹ FastAPI æ‡‰ç”¨ï¼Œä½¿ç”¨ä»¥ä¸‹æŠ€è¡“ï¼š
- Python 3.11
- PostgreSQL è³‡æ–™åº«
- Redis å¿«å–
- ä¾è³´åˆ—åœ¨ requirements.txt

è«‹å¹«æˆ‘å»ºç«‹ä¸€å€‹ç”Ÿç”¢ç´šåˆ¥çš„ Dockerfileï¼š
1. ä½¿ç”¨å¤šéšæ®µå»ºç«‹
2. æœ€å°åŒ–æ˜ åƒå¤§å°
3. åŠ å…¥å¥åº·æª¢æŸ¥
4. ä½¿ç”¨é root ä½¿ç”¨è€…
5. å„ªåŒ–å¿«å–å±¤

ä¹Ÿè«‹æä¾› docker-compose.yml ç”¨æ–¼æœ¬æ©Ÿé–‹ç™¼ã€‚
```

### 2.4 éƒ¨ç½² Workflow ç¯„ä¾‹

```yaml
name: Build and Deploy

on:
  push:
    branches: [main]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - uses: actions/checkout@v4

      # ç™»å…¥ GitHub Container Registry
      - name: Log in to Container Registry
        uses: docker/login-action@v2
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # è¨­å®š Docker Buildxï¼ˆå¤šå¹³å°å»ºç«‹ï¼‰
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # ç”Ÿæˆæ¨™ç±¤å’Œ labels
      - name: Extract metadata
        id: meta
        uses: docker/metadata-action@v4
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
          tags: |
            type=ref,event=branch
            type=ref,event=pr
            type=sha,prefix={{branch}}-
            type=semver,pattern={{version}}

      # å»ºç«‹ä¸¦æ¨é€æ˜ åƒ
      - name: Build and push
        uses: docker/build-push-action@v4
        with:
          context: .
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max

  deploy:
    needs: build-and-push
    runs-on: ubuntu-latest
    steps:
      # éƒ¨ç½²åˆ° Kubernetes
      - name: Deploy to Kubernetes
        uses: azure/k8s-deploy@v4
        with:
          manifests: |
            k8s/deployment.yml
            k8s/service.yml
          images: |
            ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
```

---

## 3. å›é€€èˆ‡ç½é›£æ¢å¾©

### 3.1 å¿«é€Ÿå›é€€ç­–ç•¥

**è—ç¶ éƒ¨ç½²å›é€€**ï¼ˆæœ€å¿«ï¼‰ï¼š

```bash
# åˆ‡å›è—è‰²ç’°å¢ƒï¼ˆç§’ç´šï¼‰
aws elbv2 modify-listener --listener-arn $LISTENER_ARN \
  --default-actions Type=forward,TargetGroupArn=$BLUE_TG_ARN
```

**Kubernetes å›é€€**ï¼š

```bash
# æŸ¥çœ‹éƒ¨ç½²æ­·å²
kubectl rollout history deployment/myapp

# å›é€€åˆ°ä¸Šä¸€å€‹ç‰ˆæœ¬
kubectl rollout undo deployment/myapp

# å›é€€åˆ°ç‰¹å®šç‰ˆæœ¬
kubectl rollout undo deployment/myapp --to-revision=3
```

**Docker å›é€€**ï¼š

```bash
# ä½¿ç”¨ä¹‹å‰çš„æ˜ åƒæ¨™ç±¤
docker pull myapp:previous-stable
docker stop myapp-current
docker run -d --name myapp-current myapp:previous-stable
```

### 3.2 è‡ªå‹•åŒ–å›é€€

**åœ¨ GitHub Actions ä¸­å¯¦ä½œè‡ªå‹•å›é€€**ï¼š

```yaml
name: Deploy with Auto-Rollback

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy new version
        id: deploy
        run: |
          kubectl set image deployment/myapp myapp=myapp:${{ github.sha }}
          kubectl rollout status deployment/myapp --timeout=5m
        continue-on-error: true

      # å¥åº·æª¢æŸ¥
      - name: Health check
        id: health
        if: steps.deploy.outcome == 'success'
        run: |
          sleep 30
          HEALTH=$(curl -s -o /dev/null -w "%{http_code}" https://myapp.com/health)
          if [ "$HEALTH" != "200" ]; then
            echo "Health check failed: $HEALTH"
            exit 1
          fi
        continue-on-error: true

      # ç›£æ§éŒ¯èª¤ç‡
      - name: Check error rate
        id: errors
        if: steps.health.outcome == 'success'
        run: |
          # æŸ¥è©¢ Prometheus/CloudWatch çš„éŒ¯èª¤ç‡
          ERROR_RATE=$(./scripts/check-error-rate.sh)
          if (( $(echo "$ERROR_RATE > 5" | bc -l) )); then
            echo "Error rate too high: $ERROR_RATE%"
            exit 1
          fi
        continue-on-error: true

      # è‡ªå‹•å›é€€
      - name: Auto rollback
        if: |
          steps.deploy.outcome == 'failure' ||
          steps.health.outcome == 'failure' ||
          steps.errors.outcome == 'failure'
        run: |
          echo "âŒ Deployment failed, rolling back..."
          kubectl rollout undo deployment/myapp
          kubectl rollout status deployment/myapp --timeout=3m

      # é€šçŸ¥
      - name: Notify team
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: |
            âŒ Deployment failed and rolled back
            Commit: ${{ github.sha }}
            Author: ${{ github.actor }}
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

### 3.3 ç½é›£æ¢å¾©è¨ˆç•«

**RTO å’Œ RPO å®šç¾©**ï¼š

```
RTO (Recovery Time Objective): æœ€é•·å¯æ¥å—åœæ©Ÿæ™‚é–“
RPO (Recovery Point Objective): æœ€å¤šå¯æ¥å—çš„è³‡æ–™éºå¤±

ç¯„ä¾‹ï¼š
  RTO = 1 hour  â†’ 1 å°æ™‚å…§å¿…é ˆæ¢å¾©æœå‹™
  RPO = 5 min   â†’ æœ€å¤šéºå¤± 5 åˆ†é˜çš„è³‡æ–™
```

**ç½é›£æ¢å¾©å±¤ç´š**ï¼š

```
Tier 1: å†·å‚™ä»½
  - RTO: 24+ hours
  - RPO: 24 hours
  - æˆæœ¬ï¼šä½
  - æ–¹æ³•ï¼šå®šæœŸå‚™ä»½åˆ° S3

Tier 2: æº«å‚™ä»½
  - RTO: 4-12 hours
  - RPO: 1 hour
  - æˆæœ¬ï¼šä¸­
  - æ–¹æ³•ï¼šå‚™ç”¨ç’°å¢ƒï¼ˆé—œé–‰ç‹€æ…‹ï¼‰

Tier 3: ç†±å‚™ä»½
  - RTO: < 1 hour
  - RPO: < 5 minutes
  - æˆæœ¬ï¼šé«˜
  - æ–¹æ³•ï¼šä¸»å‹•-ä¸»å‹•æ¶æ§‹ï¼Œè·¨å€åŸŸéƒ¨ç½²

Tier 4: å³æ™‚å®¹éŒ¯
  - RTO: 0 (ç„¡åœæ©Ÿ)
  - RPO: 0 (ç„¡è³‡æ–™éºå¤±)
  - æˆæœ¬ï¼šå¾ˆé«˜
  - æ–¹æ³•ï¼šåŒæ­¥è¤‡å¯«ã€è‡ªå‹•å®¹éŒ¯è½‰ç§»
```

**è‡ªå‹•åŒ–å‚™ä»½ Workflow**ï¼š

```yaml
name: Automated Backup

on:
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©å‡Œæ™¨ 2 é»

jobs:
  backup:
    runs-on: ubuntu-latest
    steps:
      # å‚™ä»½è³‡æ–™åº«
      - name: Backup database
        run: |
          pg_dump $DATABASE_URL | gzip > backup-$(date +%Y%m%d).sql.gz

      # ä¸Šå‚³åˆ° S3
      - name: Upload to S3
        run: |
          aws s3 cp backup-$(date +%Y%m%d).sql.gz \
            s3://my-backups/postgres/$(date +%Y%m%d).sql.gz

      # é©—è­‰å‚™ä»½
      - name: Verify backup
        run: |
          aws s3 ls s3://my-backups/postgres/$(date +%Y%m%d).sql.gz

      # åˆªé™¤èˆŠå‚™ä»½ï¼ˆä¿ç•™ 30 å¤©ï¼‰
      - name: Cleanup old backups
        run: |
          aws s3 ls s3://my-backups/postgres/ | \
            awk '{print $4}' | \
            head -n -30 | \
            xargs -I {} aws s3 rm s3://my-backups/postgres/{}
```

---

## 4. ç”¨ AI ç”Ÿæˆéƒ¨ç½²è…³æœ¬

### 4.1 è¤‡é›œéƒ¨ç½²å ´æ™¯

**æç¤ºè©ç¯„æœ¬**ï¼š

```
æˆ‘éœ€è¦ç‚ºä¸€å€‹å¾®æœå‹™æ‡‰ç”¨å»ºç«‹ Kubernetes éƒ¨ç½²è…³æœ¬ï¼š

æ‡‰ç”¨æ¶æ§‹ï¼š
- å‰ç«¯ï¼ˆReactï¼‰ï¼š3 å€‹å‰¯æœ¬
- å¾Œç«¯ APIï¼ˆFastAPIï¼‰ï¼š5 å€‹å‰¯æœ¬
- Workerï¼ˆCeleryï¼‰ï¼š2 å€‹å‰¯æœ¬
- Redisï¼š1 å€‹å‰¯æœ¬ï¼ˆStatefulSetï¼‰
- PostgreSQLï¼šä½¿ç”¨å¤–éƒ¨ RDS

éœ€æ±‚ï¼š
1. å‰ç«¯å’Œ API ä½¿ç”¨æ»¾å‹•æ›´æ–°
2. Worker ä½¿ç”¨é‡å»ºç­–ç•¥
3. åŠ å…¥å¥åº·æª¢æŸ¥
4. é…ç½®è³‡æºé™åˆ¶
5. ä½¿ç”¨ ConfigMap ç®¡ç†ç’°å¢ƒè®Šæ•¸
6. ä½¿ç”¨ Secret ç®¡ç†æ•æ„Ÿè³‡è¨Š

è«‹æä¾›å®Œæ•´çš„ Kubernetes manifestsã€‚
```

**Claude æœƒç”Ÿæˆ**ï¼š
- Deployment YAMLï¼ˆå‰ç«¯ã€APIã€Workerï¼‰
- StatefulSet YAMLï¼ˆRedisï¼‰
- Service YAML
- ConfigMap YAML
- Secret YAMLï¼ˆç¯„æœ¬ï¼‰
- Ingress YAML

### 4.2 éƒ¨ç½²è…³æœ¬å„ªåŒ–

**æç¤ºè©ç¯„æœ¬**ï¼š

```
æˆ‘ç›®å‰çš„éƒ¨ç½²è…³æœ¬å¦‚ä¸‹ï¼š

[è²¼ä¸Šç¾æœ‰è…³æœ¬]

è«‹å¹«æˆ‘å„ªåŒ–ï¼š
1. åŠ å…¥éŒ¯èª¤è™•ç†
2. åŠ å…¥å›é€€æ©Ÿåˆ¶
3. åŠ å…¥å¥åº·æª¢æŸ¥
4. å„ªåŒ–åŸ·è¡Œé€Ÿåº¦
5. åŠ å…¥æ—¥èªŒè¨˜éŒ„
```

---

## 5. æœ¬ç« ç¸½çµ

### 5.1 éƒ¨ç½²ç­–ç•¥ç¸½çµ

| ç­–ç•¥ | åœæ©Ÿæ™‚é–“ | è³‡æºéœ€æ±‚ | å›é€€é€Ÿåº¦ | é¢¨éšª | é©ç”¨å ´æ™¯ |
|------|---------|---------|---------|------|---------|
| Recreate | æœ‰ | ä½ | æ…¢ | é«˜ | å…§éƒ¨å·¥å…· |
| Rolling | ç„¡ | ä½ | æ…¢ | ä¸­ | ä¸€èˆ¬æ‡‰ç”¨ |
| Blue-Green | ç„¡ | é«˜ | å¿« | ä½ | é«˜å¯ç”¨æ€§ |
| Canary | ç„¡ | ä¸­ | ä¸­ | ä½ | é«˜é¢¨éšªæ›´æ–° |
| A/B | ç„¡ | ä¸­ | ä¸­ | ä½ | ç”¢å“å¯¦é©— |

### 5.2 é—œéµè¦é»

**å®¹å™¨åŒ–**ï¼š
- ä½¿ç”¨å¤šéšæ®µå»ºç«‹æ¸›å°‘æ˜ åƒå¤§å°
- ä½¿ç”¨é root ä½¿ç”¨è€…æå‡å®‰å…¨æ€§
- åŠ å…¥å¥åº·æª¢æŸ¥ç¢ºä¿å¯ç”¨æ€§

**è‡ªå‹•åŒ–å›é€€**ï¼š
- è¨­å®šå¥åº·æª¢æŸ¥é–¾å€¼
- ç›£æ§é—œéµæŒ‡æ¨™ï¼ˆéŒ¯èª¤ç‡ã€å»¶é²ï¼‰
- è‡ªå‹•è§¸ç™¼å›é€€æ©Ÿåˆ¶

**ç½é›£æ¢å¾©**ï¼š
- å®šç¾© RTO å’Œ RPO
- è‡ªå‹•åŒ–å‚™ä»½æµç¨‹
- å®šæœŸæ¸¬è©¦æ¢å¾©ç¨‹åº

### 5.3 å¯¦æˆ°å»ºè­°

**æ–°æ‰‹**ï¼š
- å¾ Rolling Deployment é–‹å§‹
- ä½¿ç”¨ Docker Compose æœ¬æ©Ÿé–‹ç™¼
- æ‰‹å‹•éƒ¨ç½²ä¸¦è§€å¯Ÿæµç¨‹

**é€²éš**ï¼š
- å¯¦ä½œ Blue-Green æˆ– Canary
- æ•´åˆç›£æ§å’Œå‘Šè­¦
- å»ºç«‹è‡ªå‹•å›é€€æ©Ÿåˆ¶

**å°ˆå®¶**ï¼š
- è¨­è¨ˆå¤šå€åŸŸå®¹éŒ¯æ¶æ§‹
- å¯¦ä½œæ··æ²Œå·¥ç¨‹æ¸¬è©¦
- å»ºç«‹å®Œæ•´çš„ç½é›£æ¢å¾©è¨ˆç•«

---

**æ­å–œå®Œæˆç†è«–å­¸ç¿’ï¼** ç¹¼çºŒå‰å¾€å¯¦æˆ°ç·´ç¿’ â†’
