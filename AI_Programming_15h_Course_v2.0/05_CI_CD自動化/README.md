# 模組 5：CI/CD 自動化整合

## 📋 模組概述

本模組教你用 AI 建立完整的 CI/CD 管線，實現從程式碼提交到生產部署的全自動化流程。

**核心理念**：
> CI/CD 就像自動化的守門員，確保每一行程式碼都經過嚴格檢查才能進入生產環境。
> 在 AI 時代，40% 的生成代碼包含安全問題——自動化安全掃描不是選項，而是必須。

**學習時長**：1.5 小時（核心模組）

---

## 🎯 學習目標

完成本模組後，你將能夠：

### 知識層面（Know）
- ✅ 理解 CI/CD 的核心概念與價值
- ✅ 掌握 GitHub Actions 的基本架構（workflow, jobs, steps）
- ✅ 認識主流安全掃描工具（CodeQL, Snyk, Trivy）
- ✅ 理解不同部署策略的適用場景
- ✅ 了解 AI 在 CI/CD 中的角色

### 技能層面（Do）
- ✅ 建立自動化測試管線（單元測試 + 整合測試）
- ✅ 配置多層次安全掃描（靜態分析 + 依賴掃描 + 容器掃描）
- ✅ 實現自動化部署流程
- ✅ 用 AI 生成和優化 workflow 配置
- ✅ 處理 CI/CD 故障並進行除錯

### 思維層面（Be）
- ✅ 從「手動測試」轉向「自動化驗證」
- ✅ 從「部署恐懼」轉向「自信發布」
- ✅ 從「事後修復」轉向「預防性掃描」
- ✅ 建立「安全優先」的工程文化

---

## 🚨 為什麼 CI/CD 在 AI 時代更重要？

### 問題：AI 生成的代碼風險

**資料來源**（課程設計文件）：
- **40%** 的 AI 生成代碼包含安全問題
- **Code Churn 翻倍**：AI 加速開發，但也增加返工率
- **信任度悖論**：80% 開發者使用 AI，但只有 29% 真正信任

### 解決方案：自動化安全網

```
傳統開發流程（有 AI 輔助）：
程式碼生成 → 手動審查 → 手動測試 → 手動部署
        ↓
    40% 包含安全問題
        ↓
   生產環境出問題

AI 時代的正確流程：
程式碼生成 → 自動安全掃描 → 自動測試 → 自動部署
        ↓
   發現問題 → AI 輔助修復 → 重新驗證
        ↓
   只有安全的代碼進入生產環境
```

---

## 📂 模組結構

```
05_CI_CD自動化/
├── README.md（本文件）
│
├── 理論/
│   ├── 5.1_GitHub_Actions整合.md（45 分鐘）
│   ├── 5.2_安全掃描與自動修復.md（45 分鐘）
│   └── 5.3_自動化部署策略.md（補充閱讀）
│
├── 情境題庫/                        # 18 個實戰情境
│   ├── README.md                   # 題庫總覽
│   ├── 基礎級/                      # 6 題（15-30 分鐘/題）
│   │   ├── B01_建立基礎測試管線.md
│   │   ├── B02_配置程式碼品質檢查.md
│   │   ├── B03_整合靜態分析.md
│   │   ├── B04_建立Docker構建流程.md
│   │   ├── B05_配置依賴掃描.md
│   │   └── B06_建立簡易部署流程.md
│   │
│   ├── 組合級/                      # 10 題（1-2 小時/題）
│   │   ├── C01_安全掃描管線建立.md   # ⭐ 完整示範
│   │   ├── C02_多環境部署策略.md
│   │   ├── C03_前端專案完整管線.md
│   │   ├── C04_後端API完整管線.md
│   │   ├── C05_Monorepo管線設計.md
│   │   ├── C06_容器化應用管線.md
│   │   ├── C07_資料庫遷移自動化.md
│   │   ├── C08_效能測試整合.md
│   │   ├── C09_通知與監控整合.md
│   │   └── C10_回退與災難恢復.md
│   │
│   └── 複雜級/                      # 2 題（3-5 小時/專案）
│       ├── E01_企業級完整DevOps管線.md
│       └── E02_微服務架構CI_CD.md
│
├── 實作/
│   ├── 練習1_基礎CI工作流程/
│   │   ├── README.md
│   │   ├── fastapi_project/
│   │   ├── .github/workflows/
│   │   ├── 參考解答/
│   │   └── 評量標準.md
│   │
│   ├── 練習2_安全掃描管線/
│   │   ├── README.md
│   │   ├── vulnerable_app/
│   │   ├── .github/workflows/
│   │   ├── 參考解答/
│   │   └── 評量標準.md
│   │
│   └── 練習3_完整CICD管線/
│       ├── README.md
│       ├── app/
│       ├── tests/
│       ├── deployment/
│       ├── scripts/
│       ├── .github/workflows/
│       ├── 參考解答/
│       └── 評量標準.md
│
├── 範例配置/
│   ├── workflow_templates/
│   │   ├── basic-test.yml           # 基礎測試管線
│   │   ├── security-scan.yml        # 安全掃描
│   │   ├── docker-build-deploy.yml  # 容器化部署
│   │   └── full-pipeline.yml        # 完整管線範本
│   │
│   └── README.md                    # 範本使用指南
│
├── 學習資源/                         # 學習資源與參考資料
│   ├── README.md                    # 學習資源說明
│   ├── CI_CD工具比較表.md          # 工具選擇指南
│   ├── 常見問題與解決方案.md         # FAQ 與疑難排解
│   ├── 安全掃描工具配置範例.md       # 安全工具設定參考
│   ├── 部署策略決策樹.md           # 部署策略選擇指南
│   └── 最佳實踐檢查清單.md         # Best Practices Checklist
│
└── 作業/
    └── 作業說明.md
```

---

## 📚 學習路徑（1.5 小時核心）

### 🔹 第 1 步：GitHub Actions 整合（45 分鐘）

**閱讀**：`理論/5.1_GitHub_Actions整合.md`

**關鍵問題**：
- CI/CD 是什麼？為什麼重要？
- GitHub Actions 的核心概念是什麼？
- 如何用 AI 生成 workflow 配置？
- 什麼是 jobs、steps、actions？
- 如何處理環境變數和密鑰？

**學習檢查點**：
- [ ] 能說明 CI/CD 的價值（自動化測試、快速回饋、風險降低）
- [ ] 理解 workflow 的基本結構（on、jobs、steps）
- [ ] 能用 Claude 生成基礎 workflow 配置
- [ ] 理解如何使用 GitHub Secrets 管理敏感資訊
- [ ] 掌握常見的 trigger 事件（push、pull_request、schedule）

**實踐建議**：
- 完成情境題：`情境題庫/基礎級/B01_建立基礎測試管線.md`
- 用 Claude 生成一個簡單的測試 workflow
- 在自己的專案中測試 workflow

**Linux 類比**：
```
GitHub Actions workflow ≈ cron job + shell script
jobs                    ≈ 獨立的 bash script
actions                 ≈ 可重用的函式庫
```

---

### 🔹 第 2 步：安全掃描與自動修復（45 分鐘）

**閱讀**：`理論/5.2_安全掃描與自動修復.md`

**關鍵問題**：
- 為什麼安全掃描在 AI 時代更重要？
- 有哪些主流的安全掃描工具？
- CodeQL、Snyk、Trivy 各自解決什麼問題？
- 如何用 AI 輔助漏洞修復？
- 什麼時候該阻止 PR 合併？

**學習檢查點**：
- [ ] 理解「40% AI 代碼含安全問題」的現實
- [ ] 能配置多層次安全掃描（靜態 + 依賴 + 容器）
- [ ] 理解 CodeQL 的工作原理
- [ ] 掌握 Snyk 依賴漏洞掃描
- [ ] 能用 AI 分析並修復常見漏洞

**實踐建議**：
- 完成情境題：`情境題庫/組合級/C01_安全掃描管線建立.md`
- 為現有專案建立安全掃描管線
- 嘗試用 GitHub Copilot Autofix 修復漏洞

**安全掃描三層防禦**：
```
Layer 1: 靜態分析（CodeQL）
         → 找出 SQL 注入、XSS、CSRF 等

Layer 2: 依賴掃描（Snyk/Dependabot）
         → 找出第三方套件的已知漏洞

Layer 3: 容器掃描（Trivy）
         → 找出 Docker 映像中的漏洞
```

---

### 🔹 第 3 步：實戰練習（彈性時間）

完成以下至少一個實作練習：

**練習 1：基礎 CI 工作流程**（建議時間：2-3 小時）
- 為 FastAPI 專案建立完整管線
- 包含：測試、linting、安全掃描、Docker 構建
- 路徑：`實作/練習1_基礎CI工作流程/`

**練習 2：安全掃描管線**（建議時間：1-2 小時）
- 為有漏洞的專案建立安全掃描
- 用 AI 輔助修復漏洞
- 路徑：`實作/練習2_安全掃描管線/`

**練習 3：完整 CI/CD 管線**（建議時間：3-4 小時）
- 建立端到端的完整管線
- 包含：多環境部署、健康檢查、自動回退
- 路徑：`實作/練習3_完整CICD管線/`

---

## 🔥 快速上手：10 分鐘建立第一個 workflow

如果你時間有限，先完成這個快速練習：

### 情境：為 Python 專案建立測試管線

**步驟 1：用 Claude 生成 workflow**

```
提示詞：
我有一個 Python FastAPI 專案，使用 pytest 做測試。
請幫我生成一個 GitHub Actions workflow，在每次 push 和 PR 時：
1. 安裝依賴（requirements.txt）
2. 執行 pytest
3. 產生測試報告

請提供完整的 .github/workflows/test.yml 配置。
```

**步驟 2：建立 workflow 檔案**

```bash
mkdir -p .github/workflows
# 將 Claude 生成的內容存為 .github/workflows/test.yml
```

**步驟 3：提交並觀察**

```bash
git add .github/workflows/test.yml
git commit -m "ci: add automated testing workflow"
git push
```

**步驟 4：在 GitHub 查看執行結果**

前往：`https://github.com/你的帳號/你的專案/actions`

**恭喜！** 你已經建立了第一個 CI/CD 管線。

---

## 🎯 學習檢查點（完成本模組前請確認）

### Level 1：基礎理解
- [ ] 能說明 CI/CD 的核心價值
- [ ] 理解 GitHub Actions 的基本結構
- [ ] 能用 Claude 生成簡單的 workflow
- [ ] 知道如何查看 workflow 執行結果

### Level 2：實戰能力
- [ ] 能為專案建立自動化測試管線
- [ ] 能配置基礎的安全掃描
- [ ] 能處理常見的 workflow 錯誤
- [ ] 能用環境變數和 secrets 管理設定

### Level 3：進階應用
- [ ] 能設計多層次安全掃描策略
- [ ] 能用 AI 輔助漏洞修復
- [ ] 能配置多環境部署流程
- [ ] 能優化 workflow 執行效率

---

## 🛠️ 常用工具與資源

### GitHub Actions Marketplace
- **超級市場概念**：GitHub Actions Marketplace 就像 Linux 的 apt/yum
- **精選 Actions**：
  - `actions/checkout@v4`：檢出代碼
  - `actions/setup-python@v4`：設置 Python 環境
  - `docker/build-push-action@v5`：構建 Docker 映像
  - `github/codeql-action@v2`：CodeQL 掃描

### 安全掃描工具
- **CodeQL**：GitHub 原生靜態分析
- **Snyk**：依賴漏洞掃描（免費額度）
- **Trivy**：容器映像掃描（開源）
- **Dependabot**：自動依賴更新

### AI 輔助工具
- **Claude Code**：生成和優化 workflow
- **GitHub Copilot**：workflow 配置自動補全
- **Copilot Autofix**：自動修復安全漏洞

---

## 🔗 相關模組連結

### 前置模組
- **模組 4：TDD/BDD 實作**
  - CI/CD 中會執行 TDD 中寫的測試
  - 理解測試驅動開發的價值

### 後續模組
- **模組 6：多代理人協作與 MCP**
  - 用 MCP 整合更多工具到 CI/CD
  - 建立更複雜的自動化工作流程

- **模組 10：安全與最佳實踐**
  - 深入探討安全治理策略
  - 企業級安全規範

---

## 📖 補充閱讀（選修）

想更深入理解 CI/CD？閱讀：

1. **自動化部署策略**（`理論/5.3_自動化部署策略.md`）
   - 藍綠部署 vs 金絲雀部署 vs 滾動部署
   - Docker 與容器化
   - 回退與災難恢復

2. **複雜情境題**（`情境題庫/複雜級/`）
   - 企業級 DevOps 管線
   - 微服務架構 CI/CD

---

## 💡 學習建議

### 給新手的建議
1. **先跑起來，再優化**：先建立最簡單的測試管線
2. **從錯誤中學習**：workflow 失敗是正常的，學會讀日誌
3. **用 AI 加速**：不要從零寫配置，讓 Claude 生成範本
4. **小步迭代**：一次加一個功能（測試 → 掃描 → 部署）

### 給進階學習者的建議
1. **深入安全**：40% AI 代碼有問題，安全掃描不能馬虎
2. **優化效率**：用 cache、並行執行提升速度
3. **監控告警**：整合 Slack/Discord 通知
4. **成本控制**：優化 workflow 減少執行時間

### Linux 學習類比
> 學 CI/CD 就像學 cron + systemd：
> - 不需要記住所有參數
> - 重點是理解「什麼時候觸發」、「執行什麼任務」
> - 會查文件、會除錯就夠了
> - AI 可以幫你生成大部分配置

---

## 🎓 學習成果驗證

完成本模組後，你應該能夠：

### ✅ 建立可運行的 CI/CD 管線
- 為任意專案建立測試管線（5 分鐘內）
- 配置多層次安全掃描（15 分鐘內）
- 實現自動化部署流程（30 分鐘內）

### ✅ 用 AI 加速 CI/CD 開發
- 用 Claude 生成 workflow 配置（節省 80% 時間）
- 用 AI 分析 workflow 失敗原因
- 用 Copilot Autofix 修復安全漏洞

### ✅ 建立安全優先的工程文化
- 理解 AI 代碼的風險（40% 含問題）
- 堅持「無掃描，不合併」原則
- 建立自動化的安全防護網

---

## 📝 下一步

1. **立即開始**：閱讀 `理論/5.1_GitHub_Actions整合.md`
2. **動手實作**：完成快速上手的 10 分鐘練習
3. **深入練習**：挑選一個情境題完整實作
4. **應用到專案**：為你的實際專案建立 CI/CD

---

## 🆘 需要協助？

- **workflow 執行失敗**：查看 `學習資源/常見問題與解決方案.md` 的疑難排解指南
- **不確定用什麼工具**：參考 `範例配置/README.md` 的工具選擇指南
- **找不到範例**：查看 `情境題庫/README.md` 尋找類似場景

---

**開始學習**：`理論/5.1_GitHub_Actions整合.md` →
