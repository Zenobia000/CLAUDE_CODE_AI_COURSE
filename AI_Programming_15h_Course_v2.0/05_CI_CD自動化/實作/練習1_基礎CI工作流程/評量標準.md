# 評量標準：練習 1 - FastAPI 專案 CI/CD 管線

## 📊 總分：100 分

---

## 評分結構

| 項目 | 配分 | 說明 |
|------|------|------|
| 功能完整性 | 50 分 | 必要功能是否實現 |
| 程式碼品質 | 20 分 | workflow 配置品質 |
| 效能優化 | 15 分 | 執行效率和資源使用 |
| 文檔與註解 | 10 分 | 文檔完整性和清晰度 |
| 進階功能 | 5 分 | 額外的優化和創新 |

---

## 📋 詳細評分標準

### 一、功能完整性（50 分）

#### 1.1 自動化測試（15 分）

**✅ 滿分標準（15 分）**：
- [ ] Workflow 在 push/PR 時自動觸發（3 分）
- [ ] pytest 測試正確執行（5 分）
- [ ] 測試覆蓋率 ≥ 80%（4 分）
- [ ] 測試報告清晰可讀（3 分）

**⚠️ 部分分數**：
- 測試執行但無覆蓋率報告：-4 分
- 測試覆蓋率 < 80%：-2 分
- 測試失敗但 workflow 顯示成功：-5 分

**❌ 零分情況**：
- 無測試或測試無法執行
- Workflow 配置錯誤導致無法運行

---

#### 1.2 程式碼品質檢查（15 分）

**✅ 滿分標準（15 分）**：
- [ ] black 格式檢查通過（5 分）
- [ ] flake8 風格檢查通過（5 分）
- [ ] isort import 排序檢查通過（3 分）
- [ ] lint job 在 test job 之前執行（2 分）

**⚠️ 部分分數**：
- 只實現部分 linting 工具：按比例給分
- lint 失敗但未阻止 workflow：-3 分
- lint 和 test 未並行執行：-2 分

**❌ 零分情況**：
- 完全沒有代碼品質檢查
- lint 配置錯誤無法執行

---

#### 1.3 安全掃描（10 分）

**✅ 滿分標準（10 分）**：
- [ ] 依賴漏洞掃描正常執行（5 分）
- [ ] 發現高危漏洞時 workflow 失敗（3 分）
- [ ] 產生並上傳安全報告（2 分）

**⚠️ 部分分數**：
- 只有掃描但不處理結果：-3 分
- 掃描工具配置不完整：-2 分

**❌ 零分情況**：
- 完全沒有安全掃描
- 掃描配置錯誤無法執行

---

#### 1.4 Docker 構建（10 分）

**✅ 滿分標準（10 分）**：
- [ ] Docker 映像成功構建（4 分）
- [ ] 映像標記包含版本資訊（2 分）
- [ ] 映像推送到 Registry（2 分）
- [ ] Docker job 依賴其他 jobs 通過（2 分）

**⚠️ 部分分數**：
- 只構建不推送：-2 分
- 映像標記不規範（如只用 latest）：-2 分
- 無依賴關係配置：-2 分

**❌ 零分情況**：
- Docker 構建失敗
- Dockerfile 配置錯誤

---

### 二、程式碼品質（20 分）

#### 2.1 Workflow 配置品質（12 分）

**✅ 滿分標準（12 分）**：
- [ ] 結構清晰，易於閱讀（3 分）
- [ ] 使用適當的 actions（不重複造輪子）（3 分）
- [ ] 環境變數和 secrets 正確管理（3 分）
- [ ] 錯誤處理機制完善（3 分）

**評分細則**：
- **結構清晰**：
  - jobs 命名語義化（如 `test`、`lint`、`build`）
  - steps 邏輯分組
  - 使用適當的縮排和空行

- **Actions 使用**：
  - 優先使用官方或知名 actions
  - 版本固定（如 `@v4`，不用 `@main`）
  - 不自己實現已有的 actions

- **環境變數管理**：
  - 敏感資訊使用 secrets
  - 環境變數命名規範
  - 適當使用 env 區塊

- **錯誤處理**：
  - 關鍵步驟失敗時整個 job 失敗
  - 錯誤訊息清晰明確
  - 使用 `continue-on-error` 的地方有註解說明

**⚠️ 常見扣分**：
- 硬編碼敏感資訊：-3 分
- Actions 版本使用 `@main`：-1 分
- 無錯誤處理：-2 分
- 結構混亂難以閱讀：-2 分

---

#### 2.2 FastAPI 專案代碼品質（8 分）

**✅ 滿分標準（8 分）**：
- [ ] 代碼符合 PEP 8 規範（2 分）
- [ ] 函數有適當的 docstring（2 分）
- [ ] 測試代碼完整且有意義（2 分）
- [ ] Dockerfile 使用最佳實踐（2 分）

**評分細則**：
- **PEP 8 規範**：通過 flake8 檢查
- **Docstring**：主要函數有清晰的說明
- **測試代碼**：不只是形式測試，真正驗證功能
- **Dockerfile**：
  - 使用適當的基礎映像
  - 多階段構建（進階）
  - 最小化層數
  - 非 root 用戶運行（進階）

---

### 三、效能優化（15 分）

#### 3.1 執行時間（8 分）

**✅ 滿分標準**：
- [ ] 完整 workflow 執行時間 ≤ 5 分鐘（8 分）
- [ ] 執行時間 5-8 分鐘（6 分）
- [ ] 執行時間 8-10 分鐘（4 分）
- [ ] 執行時間 > 10 分鐘（2 分）

**優化技巧**：
- 並行執行獨立的 jobs
- 使用 cache 減少重複安裝
- 減少不必要的步驟

---

#### 3.2 快取策略（7 分）

**✅ 滿分標準（7 分）**：
- [ ] 使用 pip cache（3 分）
- [ ] 使用 Docker layer cache（3 分）
- [ ] Cache key 設計合理（1 分）

**評分細則**：
- **Pip cache**：使用 `actions/cache` 或 `actions/setup-python` 的內建 cache
- **Docker layer cache**：使用 Docker BuildKit 或 GitHub Actions cache
- **Cache key**：
  - 包含依賴檔案的 hash（如 `requirements.txt` hash）
  - 合理的 restore-keys 設定
  - 不會因 cache 導致過期依賴

**⚠️ 常見扣分**：
- Cache key 設計不當（如固定值）：-1 分
- 完全不使用 cache：-7 分

---

### 四、文檔與註解（10 分）

#### 4.1 Workflow 註解（5 分）

**✅ 滿分標準（5 分）**：
- [ ] 每個 job 有清晰的說明（2 分）
- [ ] 複雜步驟有註解（2 分）
- [ ] 關鍵配置有說明（1 分）

**範例**：
```yaml
# ✅ 好的註解
jobs:
  test:
    name: Run unit tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 安裝 Python 並啟用 pip cache 以加速執行
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'

      # 執行測試並產生覆蓋率報告
      - name: Run pytest with coverage
        run: |
          pytest --cov=app --cov-report=xml
```

**❌ 不好的註解**：
```yaml
# ❌ 過度註解或無意義註解
- name: Install dependencies
  run: pip install -r requirements.txt  # 安裝依賴
```

---

#### 4.2 README 文檔（5 分）

**✅ 滿分標準（5 分）**：
- [ ] 說明如何運行專案（2 分）
- [ ] 說明 CI/CD 流程（2 分）
- [ ] 包含 workflow 狀態徽章（1 分）

**必要內容**：
1. 專案簡介
2. 本地開發步驟
3. 測試執行方式
4. CI/CD 說明
5. Workflow badge

---

### 五、進階功能（5 分，加分項）

以下功能可獲得額外加分（最多 5 分）：

- [ ] **並行矩陣測試**（2 分）
  - 多個 Python 版本並行測試
  - 示例：測試 3.10、3.11、3.12

- [ ] **覆蓋率徽章**（1 分）
  - 整合 Codecov 或 Coveralls
  - 在 README 顯示覆蓋率徽章

- [ ] **PR 評論**（1 分）
  - 測試結果自動評論到 PR
  - 覆蓋率變化報告

- [ ] **條件執行**（1 分）
  - 根據變更檔案決定是否執行某些 jobs
  - 示例：只有 Python 檔案變更時才執行測試

---

## 🚫 常見扣分項

### 嚴重問題（直接不及格）

1. **抄襲或直接複製範例**：0 分
2. **Workflow 完全無法執行**：0 分
3. **提交包含敏感資訊**（如 API keys）：0 分

### 重大缺陷（-10 分以上）

1. **測試通過但功能有問題**：-15 分
2. **安全掃描失敗但未處理**：-10 分
3. **Docker 映像包含嚴重安全漏洞**：-10 分

### 一般問題（-5 分以下）

1. **Workflow 名稱不語義化**：-2 分
2. **沒有使用 cache**：-5 分
3. **執行時間過長**：-3 分
4. **文檔不完整**：-3 分

---

## ✅ 優秀作品標準（90 分以上）

要獲得 90 分以上，需要滿足：

### 必要條件
- [ ] 所有基礎功能完整實現（50 分）
- [ ] Workflow 配置清晰專業（18+ 分）
- [ ] 執行時間 ≤ 5 分鐘（8 分）
- [ ] 使用完整的 cache 策略（7 分）
- [ ] 文檔完整清晰（8+ 分）

### 加分條件（至少滿足 2 項）
- [ ] 實現並行矩陣測試
- [ ] 整合覆蓋率報告和徽章
- [ ] PR 自動評論功能
- [ ] 條件執行優化

### 品質要求
- [ ] 代碼完全符合 PEP 8
- [ ] 測試覆蓋率 ≥ 90%
- [ ] Workflow 註解詳細且有幫助
- [ ] README 像專業開源專案

---

## 📝 自評表

完成練習後，請使用此表自評：

| 項目 | 自評分數 | 說明 |
|------|---------|------|
| 自動化測試 | /15 | |
| 程式碼品質檢查 | /15 | |
| 安全掃描 | /10 | |
| Docker 構建 | /10 | |
| Workflow 配置品質 | /12 | |
| 專案代碼品質 | /8 | |
| 執行時間 | /8 | |
| 快取策略 | /7 | |
| Workflow 註解 | /5 | |
| README 文檔 | /5 | |
| 進階功能 | /5 | |
| **總分** | **/100** | |

---

## 🎯 達成建議

### 要獲得 60 分（及格）
- 完成所有必要功能（測試、lint、安全、Docker）
- Workflow 可以正常運行
- 基本文檔完整

### 要獲得 80 分（良好）
- 在及格基礎上：
- 加入 cache 優化
- Workflow 配置清晰有註解
- 執行時間 ≤ 8 分鐘
- 文檔詳細

### 要獲得 90+ 分（優秀）
- 在良好基礎上：
- 實現至少 2 項進階功能
- 執行時間 ≤ 5 分鐘
- 測試覆蓋率 ≥ 90%
- 文檔專業完整

---

## 💡 評量重點提示

評量時重點關注：

1. **功能正確性 > 代碼美觀**
   - 先確保功能正確，再優化代碼

2. **實用性 > 複雜度**
   - 簡單可靠的方案優於複雜但不穩定的方案

3. **自動化程度**
   - 手動操作越少越好

4. **文檔清晰度**
   - 別人能否看懂並使用你的配置

---

**記住**：這個評量標準不只是為了打分，更是為了幫助你理解優秀 CI/CD 管線的標準。

即使沒有達到滿分，只要能從中學到東西，就是成功！ 🚀
