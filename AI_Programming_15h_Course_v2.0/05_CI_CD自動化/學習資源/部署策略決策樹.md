# éƒ¨ç½²ç­–ç•¥æ±ºç­–æ¨¹

## ğŸ¯ ç­–ç•¥é¸æ“‡ç¸½è¦½

é¸æ“‡æ­£ç¢ºçš„éƒ¨ç½²ç­–ç•¥å°æ–¼ CI/CD æˆåŠŸè‡³é—œé‡è¦ã€‚æœ¬æŒ‡å—æä¾›æ±ºç­–æ¨¹å’Œå¯¦ç”¨é…ç½®ï¼Œå¹«åŠ©ä½ æ ¹æ“šå°ˆæ¡ˆç‰¹æ€§é¸æ“‡æœ€é©åˆçš„éƒ¨ç½²æ–¹å¼ã€‚

**æ ¸å¿ƒåŸå‰‡**ï¼š
> ğŸ”’ å®‰å…¨å„ªå…ˆ > ğŸ“ˆ æ¥­å‹™é€£çºŒæ€§ > âš¡ éƒ¨ç½²é€Ÿåº¦ > ğŸ’° è³‡æºæˆæœ¬

---

## ğŸŒ³ éƒ¨ç½²ç­–ç•¥æ±ºç­–æ¨¹

### ç¬¬ä¸€å±¤ï¼šæ¥­å‹™å½±éŸ¿è©•ä¼°

```
ä½ çš„æ‡‰ç”¨å°æ¥­å‹™çš„é‡è¦æ€§ï¼Ÿ
â”œâ”€ ğŸ”´ é—œéµæ¥­å‹™ç³»çµ±ï¼ˆåœæ©Ÿ = é‡å¤§æå¤±ï¼‰
â”‚  â””â”€ å¿…é ˆï¼šé›¶åœæ©Ÿéƒ¨ç½²
â”‚     â”œâ”€ è—ç¶ éƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰
â”‚     â”œâ”€ æ»¾å‹•éƒ¨ç½²
â”‚     â””â”€ é‡‘çµ²é›€éƒ¨ç½²
â”‚
â”œâ”€ ğŸŸ¡ é‡è¦æ¥­å‹™ç³»çµ±ï¼ˆåœæ©Ÿæœ‰å½±éŸ¿ï¼‰
â”‚  â””â”€ å»ºè­°ï¼šä½é¢¨éšªéƒ¨ç½²
â”‚     â”œâ”€ é‡‘çµ²é›€éƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰
â”‚     â”œâ”€ æ»¾å‹•éƒ¨ç½²
â”‚     â””â”€ è—ç¶ éƒ¨ç½²
â”‚
â””â”€ ğŸŸ¢ é–‹ç™¼/æ¸¬è©¦ç³»çµ±ï¼ˆåœæ©Ÿå¯æ¥å—ï¼‰
   â””â”€ å¯é¸ï¼šç°¡å–®éƒ¨ç½²
      â”œâ”€ é‡å»ºéƒ¨ç½²ï¼ˆæœ€ç°¡å–®ï¼‰
      â”œâ”€ æ»¾å‹•éƒ¨ç½²
      â””â”€ è—ç¶ éƒ¨ç½²
```

### ç¬¬äºŒå±¤ï¼šæŠ€è¡“ç’°å¢ƒè©•ä¼°

```
ä½ çš„æŠ€è¡“ç’°å¢ƒç‰¹æ€§ï¼Ÿ
â”œâ”€ ğŸ³ å®¹å™¨åŒ–æ‡‰ç”¨
â”‚  â”œâ”€ Kubernetes â†’ æ»¾å‹•éƒ¨ç½²/é‡‘çµ²é›€éƒ¨ç½²
â”‚  â”œâ”€ Docker Swarm â†’ æ»¾å‹•éƒ¨ç½²
â”‚  â””â”€ å–®æ©Ÿ Docker â†’ è—ç¶ éƒ¨ç½²
â”‚
â”œâ”€ â˜ï¸ é›²ç«¯åŸç”Ÿ
â”‚  â”œâ”€ AWS ECS/EKS â†’ æ»¾å‹•/é‡‘çµ²é›€éƒ¨ç½²
â”‚  â”œâ”€ Azure Container Apps â†’ è—ç¶ /æ»¾å‹•éƒ¨ç½²
â”‚  â””â”€ Google Cloud Run â†’ æµé‡åˆ†å‰²éƒ¨ç½²
â”‚
â”œâ”€ ğŸ–¥ï¸ å‚³çµ±è™›æ“¬æ©Ÿ
â”‚  â”œâ”€ è² è¼‰å‡è¡¡å™¨ â†’ è—ç¶ éƒ¨ç½²
â”‚  â”œâ”€ å¤šå°ä¼ºæœå™¨ â†’ æ»¾å‹•éƒ¨ç½²
â”‚  â””â”€ å–®å°ä¼ºæœå™¨ â†’ é‡å»ºéƒ¨ç½²
â”‚
â””â”€ ğŸŒ ç„¡ä¼ºæœå™¨ (Serverless)
   â”œâ”€ AWS Lambda â†’ åˆ¥å/ç‰ˆæœ¬éƒ¨ç½²
   â”œâ”€ Azure Functions â†’ éƒ¨ç½²æ§½ä½
   â””â”€ Vercel/Netlify â†’ é è¦½éƒ¨ç½²
```

### ç¬¬ä¸‰å±¤ï¼šè³‡æºé™åˆ¶è©•ä¼°

```
ä½ çš„è³‡æºé™åˆ¶ï¼Ÿ
â”œâ”€ ğŸ’° æˆæœ¬æ•æ„Ÿ
â”‚  â”œâ”€ é‡å»ºéƒ¨ç½²ï¼ˆæˆæœ¬æœ€ä½ï¼‰
â”‚  â”œâ”€ æ»¾å‹•éƒ¨ç½²ï¼ˆä¸­ç­‰æˆæœ¬ï¼‰
â”‚  â””â”€ é¿å…ï¼šè—ç¶ éƒ¨ç½²ï¼ˆé›™å€è³‡æºï¼‰
â”‚
â”œâ”€ âš¡ é€Ÿåº¦å„ªå…ˆ
â”‚  â”œâ”€ è—ç¶ éƒ¨ç½²ï¼ˆæœ€å¿«åˆ‡æ›ï¼‰
â”‚  â”œâ”€ é‡å»ºéƒ¨ç½²ï¼ˆæœ€å¿«æº–å‚™ï¼‰
â”‚  â””â”€ é¿å…ï¼šé‡‘çµ²é›€éƒ¨ç½²ï¼ˆé€æ­¥æ¨å‡ºï¼‰
â”‚
â”œâ”€ ğŸ”’ å®‰å…¨å„ªå…ˆ
â”‚  â”œâ”€ é‡‘çµ²é›€éƒ¨ç½²ï¼ˆé¢¨éšªæœ€å°ï¼‰
â”‚  â”œâ”€ è—ç¶ éƒ¨ç½²ï¼ˆå¿«é€Ÿå›é€€ï¼‰
â”‚  â””â”€ é¿å…ï¼šé‡å»ºéƒ¨ç½²ï¼ˆé¢¨éšªæœ€é«˜ï¼‰
â”‚
â””â”€ ğŸ“Š ç›£æ§å®Œå–„
   â”œâ”€ é‡‘çµ²é›€éƒ¨ç½²ï¼ˆç²¾ç´°æ§åˆ¶ï¼‰
   â”œâ”€ æ»¾å‹•éƒ¨ç½²ï¼ˆæ¼¸é€²ç›£æ§ï¼‰
   â””â”€ è‡ªå‹•å›é€€æ©Ÿåˆ¶
```

---

## ğŸš€ éƒ¨ç½²ç­–ç•¥è©³è§£

### 1. ğŸ”„ é‡å»ºéƒ¨ç½² (Recreate)

**é©ç”¨å ´æ™¯**ï¼š
- ğŸŸ¢ é–‹ç™¼/æ¸¬è©¦ç’°å¢ƒ
- ğŸ’° æˆæœ¬æ•æ„Ÿå°ˆæ¡ˆ
- ğŸ”§ å¯å®¹å¿çŸ­æš«åœæ©Ÿçš„ç³»çµ±

**å„ªå‹¢**ï¼š
- âœ… é…ç½®æœ€ç°¡å–®
- âœ… è³‡æºéœ€æ±‚æœ€å°‘
- âœ… å•é¡Œå®šä½å®¹æ˜“

**åŠ£å‹¢**ï¼š
- âŒ æœ‰åœæ©Ÿæ™‚é–“
- âŒ å›é€€é€Ÿåº¦æ…¢
- âŒ ä¸é©åˆç”Ÿç”¢ç’°å¢ƒ

**é…ç½®ç¯„ä¾‹**ï¼š
```yaml
# GitHub Actions - é‡å»ºéƒ¨ç½²
name: Recreate Deployment

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # åœæ­¢èˆŠæœå‹™
      - name: Stop old service
        run: |
          kubectl delete deployment myapp
          kubectl wait --for=delete pod -l app=myapp --timeout=300s

      # éƒ¨ç½²æ–°ç‰ˆæœ¬
      - name: Deploy new version
        run: |
          kubectl apply -f k8s/deployment.yml
          kubectl wait --for=condition=ready pod -l app=myapp --timeout=300s

      # å¥åº·æª¢æŸ¥
      - name: Health check
        run: |
          kubectl get pods -l app=myapp
          curl -f http://myapp.example.com/health
```

**æ±ºç­–è¦é»**ï¼š
```
é¸æ“‡é‡å»ºéƒ¨ç½²ç•¶ï¼š
âœ… é–‹ç™¼/æ¸¬è©¦ç’°å¢ƒ
âœ… é ç®—æœ‰é™
âœ… åœ˜éšŠç¶“é©—ä¸è¶³
âœ… ç³»çµ±æ¶æ§‹ç°¡å–®

é¿å…é‡å»ºéƒ¨ç½²ç•¶ï¼š
âŒ ç”Ÿç”¢ç’°å¢ƒ
âŒ 24/7 æœå‹™è¦æ±‚
âŒ ç”¨æˆ¶é«”é©—é‡è¦
âŒ æœ‰ SLA è¦æ±‚
```

### 2. ğŸ”µğŸŸ¢ è—ç¶ éƒ¨ç½² (Blue-Green)

**é©ç”¨å ´æ™¯**ï¼š
- ğŸ”´ é—œéµæ¥­å‹™ç³»çµ±
- âš¡ éœ€è¦å¿«é€Ÿåˆ‡æ›
- ğŸ’° è³‡æºå……è¶³çš„ç’°å¢ƒ

**å„ªå‹¢**ï¼š
- âœ… é›¶åœæ©Ÿéƒ¨ç½²
- âœ… ç¬é–“åˆ‡æ›
- âœ… å¿«é€Ÿå›é€€
- âœ… å®Œæ•´çš„é ç”Ÿç”¢æ¸¬è©¦

**åŠ£å‹¢**ï¼š
- âŒ éœ€è¦é›™å€è³‡æº
- âŒ è³‡æ–™åº«åŒæ­¥è¤‡é›œ
- âŒ é…ç½®è¼ƒè¤‡é›œ

**é…ç½®ç¯„ä¾‹**ï¼š
```yaml
# GitHub Actions - è—ç¶ éƒ¨ç½²
name: Blue-Green Deployment

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # ç¢ºå®šç•¶å‰æ´»èºç’°å¢ƒ
      - name: Determine active environment
        id: env
        run: |
          ACTIVE=$(kubectl get service myapp -o jsonpath='{.spec.selector.version}')
          if [ "$ACTIVE" = "blue" ]; then
            echo "inactive=green" >> $GITHUB_OUTPUT
            echo "active=blue" >> $GITHUB_OUTPUT
          else
            echo "inactive=blue" >> $GITHUB_OUTPUT
            echo "active=green" >> $GITHUB_OUTPUT
          fi

      # éƒ¨ç½²åˆ°éæ´»èºç’°å¢ƒ
      - name: Deploy to inactive environment
        run: |
          # æ›´æ–°éƒ¨ç½²é…ç½®
          sed -i "s/VERSION_PLACEHOLDER/${{ steps.env.outputs.inactive }}/g" k8s/deployment-${{ steps.env.outputs.inactive }}.yml
          kubectl apply -f k8s/deployment-${{ steps.env.outputs.inactive }}.yml

          # ç­‰å¾…éƒ¨ç½²å®Œæˆ
          kubectl wait --for=condition=ready pod -l app=myapp,version=${{ steps.env.outputs.inactive }} --timeout=600s

      # å¥åº·æª¢æŸ¥
      - name: Health check inactive environment
        run: |
          # å…§éƒ¨å¥åº·æª¢æŸ¥
          kubectl port-forward svc/myapp-${{ steps.env.outputs.inactive }} 8080:80 &
          sleep 5
          curl -f http://localhost:8080/health

          # ç…™éœ§æ¸¬è©¦
          curl -f http://localhost:8080/api/status

      # åˆ‡æ›æµé‡
      - name: Switch traffic
        run: |
          # æ›´æ–°æœå‹™æŒ‡å‘æ–°ç’°å¢ƒ
          kubectl patch service myapp -p '{"spec":{"selector":{"version":"${{ steps.env.outputs.inactive }}"}}}'

          # é©—è­‰åˆ‡æ›æˆåŠŸ
          sleep 10
          curl -f http://myapp.example.com/health

      # æ¸…ç†èˆŠç’°å¢ƒ (å¯é¸)
      - name: Cleanup old environment
        if: success()
        run: |
          kubectl delete deployment myapp-${{ steps.env.outputs.active }}
```

**æ±ºç­–è¦é»**ï¼š
```
é¸æ“‡è—ç¶ éƒ¨ç½²ç•¶ï¼š
âœ… é›¶åœæ©Ÿè¦æ±‚åš´æ ¼
âœ… æœ‰å……è¶³çš„è³‡æº
âœ… éœ€è¦å¿«é€Ÿå›é€€
âœ… éƒ¨ç½²é »ç‡è¼ƒä½

é¿å…è—ç¶ éƒ¨ç½²ç•¶ï¼š
âŒ è³‡æºåš´é‡å—é™
âŒ æœ‰ç‹€æ…‹æ‡‰ç”¨è¤‡é›œ
âŒ è³‡æ–™åº«é·ç§»é »ç¹
âŒ æˆæœ¬æ§åˆ¶åš´æ ¼
```

### 3. ğŸŒŠ æ»¾å‹•éƒ¨ç½² (Rolling)

**é©ç”¨å ´æ™¯**ï¼š
- ğŸ”´ å¤šå¯¦ä¾‹æ‡‰ç”¨
- ğŸ“Š éœ€è¦é€æ­¥è§€å¯Ÿ
- ğŸ’° è³‡æºä½¿ç”¨å¹³è¡¡

**å„ªå‹¢**ï¼š
- âœ… é›¶åœæ©Ÿéƒ¨ç½²
- âœ… è³‡æºä½¿ç”¨æ•ˆç‡é«˜
- âœ… å¯è§€å¯Ÿéƒ¨ç½²éç¨‹
- âœ… Kubernetes åŸç”Ÿæ”¯æ´

**åŠ£å‹¢**ï¼š
- âŒ å›é€€æ™‚é–“è¼ƒé•·
- âŒ éƒ¨ç½²éç¨‹ä¸­ç‰ˆæœ¬æ··åˆ
- âŒ è¤‡é›œçš„ç‹€æ…‹ç®¡ç†

**é…ç½®ç¯„ä¾‹**ï¼š
```yaml
# Kubernetes - æ»¾å‹•éƒ¨ç½²é…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 6
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1      # æœ€å¤šåŒæ™‚åœæ­¢ 1 å€‹ Pod
      maxSurge: 2           # æœ€å¤šåŒæ™‚æ–°å¢ 2 å€‹ Pod
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:{{ .Values.image.tag }}
        readinessProbe:      # å°±ç·’æª¢æŸ¥
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 5
        livenessProbe:       # å­˜æ´»æª¢æŸ¥
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10

---
# GitHub Actions - æ»¾å‹•éƒ¨ç½²ç›£æ§
name: Rolling Deployment with Monitoring

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # æ›´æ–°éƒ¨ç½²
      - name: Update deployment
        run: |
          kubectl set image deployment/myapp myapp=myapp:${{ github.sha }}

      # ç›£æ§æ»¾å‹•æ›´æ–°
      - name: Monitor rollout
        run: |
          # ç­‰å¾…æ»¾å‹•æ›´æ–°å®Œæˆ
          kubectl rollout status deployment/myapp --timeout=600s

          # æª¢æŸ¥æ›´æ–°ç‹€æ…‹
          kubectl get deployment myapp
          kubectl get pods -l app=myapp

      # é©—è­‰éƒ¨ç½²
      - name: Verify deployment
        run: |
          # ç­‰å¾…æ‰€æœ‰ Pod å°±ç·’
          kubectl wait --for=condition=ready pod -l app=myapp --timeout=300s

          # å¥åº·æª¢æŸ¥
          for i in {1..5}; do
            curl -f http://myapp.example.com/health
            sleep 2
          done

      # è‡ªå‹•å›é€€ï¼ˆå¦‚æœæª¢æŸ¥å¤±æ•—ï¼‰
      - name: Auto rollback on failure
        if: failure()
        run: |
          echo "Deployment failed, rolling back..."
          kubectl rollout undo deployment/myapp
          kubectl rollout status deployment/myapp --timeout=300s
```

**æ±ºç­–è¦é»**ï¼š
```
é¸æ“‡æ»¾å‹•éƒ¨ç½²ç•¶ï¼š
âœ… å¤šå¯¦ä¾‹æ‡‰ç”¨
âœ… Kubernetes ç’°å¢ƒ
âœ… éœ€è¦æ¼¸é€²éƒ¨ç½²
âœ… è³‡æºä½¿ç”¨æ•æ„Ÿ

é¿å…æ»¾å‹•éƒ¨ç½²ç•¶ï¼š
âŒ å–®å¯¦ä¾‹æ‡‰ç”¨
âŒ ç‰ˆæœ¬æ··åˆæœ‰å•é¡Œ
âŒ éœ€è¦ç¬é–“åˆ‡æ›
âŒ è¤‡é›œçš„ç‹€æ…‹ç®¡ç†
```

### 4. ğŸ¤ é‡‘çµ²é›€éƒ¨ç½² (Canary)

**é©ç”¨å ´æ™¯**ï¼š
- ğŸ”’ é¢¨éšªæ•æ„Ÿç³»çµ±
- ğŸ“Š éœ€è¦æ¼¸é€²å¼é©—è­‰
- ğŸ¯ A/B æ¸¬è©¦éœ€æ±‚

**å„ªå‹¢**ï¼š
- âœ… é¢¨éšªæœ€å°åŒ–
- âœ… å¯æ§åˆ¶çš„æµé‡åˆ†é…
- âœ… å¯¦æ™‚ç›£æ§åé¥‹
- âœ… ç²¾ç´°çš„å›é€€æ§åˆ¶

**åŠ£å‹¢**ï¼š
- âŒ é…ç½®æœ€è¤‡é›œ
- âŒ éœ€è¦é€²éšç›£æ§
- âŒ éƒ¨ç½²æ™‚é–“æœ€é•·

**é…ç½®ç¯„ä¾‹**ï¼š
```yaml
# Istio - é‡‘çµ²é›€éƒ¨ç½²é…ç½®
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: myapp
spec:
  http:
  - match:
    - headers:
        canary:
          exact: "true"
    route:
    - destination:
        host: myapp
        subset: canary
  - route:
    - destination:
        host: myapp
        subset: stable
      weight: 90  # 90% æµé‡åˆ°ç©©å®šç‰ˆæœ¬
    - destination:
        host: myapp
        subset: canary
      weight: 10  # 10% æµé‡åˆ°é‡‘çµ²é›€ç‰ˆæœ¬

---
# GitHub Actions - é‡‘çµ²é›€éƒ¨ç½²æµç¨‹
name: Canary Deployment

on:
  push:
    branches: [main]

jobs:
  canary-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # éšæ®µ 1ï¼šéƒ¨ç½²é‡‘çµ²é›€ç‰ˆæœ¬ï¼ˆ5% æµé‡ï¼‰
      - name: Deploy canary version
        run: |
          # éƒ¨ç½²é‡‘çµ²é›€ç‰ˆæœ¬
          kubectl apply -f k8s/canary-deployment.yml

          # è¨­å®š 5% æµé‡åˆ°é‡‘çµ²é›€
          kubectl apply -f - <<EOF
          apiVersion: networking.istio.io/v1alpha3
          kind: VirtualService
          metadata:
            name: myapp
          spec:
            http:
            - route:
              - destination:
                  host: myapp
                  subset: stable
                weight: 95
              - destination:
                  host: myapp
                  subset: canary
                weight: 5
          EOF

      # ç›£æ§é‡‘çµ²é›€ç‰ˆæœ¬ï¼ˆ10 åˆ†é˜ï¼‰
      - name: Monitor canary (Stage 1)
        run: |
          echo "Monitoring canary with 5% traffic for 10 minutes..."
          sleep 600

          # æª¢æŸ¥éŒ¯èª¤ç‡
          ERROR_RATE=$(curl -s http://prometheus:9090/api/v1/query?query=rate\(http_requests_total\{job=\"myapp\",subset=\"canary\",status=~\"5..\"\}\[5m\]\) | jq .data.result[0].value[1])

          if (( $(echo "$ERROR_RATE > 0.01" | bc -l) )); then
            echo "âŒ High error rate detected: $ERROR_RATE"
            exit 1
          fi

      # éšæ®µ 2ï¼šå¢åŠ åˆ° 25% æµé‡
      - name: Increase canary traffic to 25%
        run: |
          kubectl apply -f - <<EOF
          apiVersion: networking.istio.io/v1alpha3
          kind: VirtualService
          metadata:
            name: myapp
          spec:
            http:
            - route:
              - destination:
                  host: myapp
                  subset: stable
                weight: 75
              - destination:
                  host: myapp
                  subset: canary
                weight: 25
          EOF

      # ç›£æ§æ“´å±•å¾Œçš„é‡‘çµ²é›€ï¼ˆ15 åˆ†é˜ï¼‰
      - name: Monitor canary (Stage 2)
        run: |
          echo "Monitoring canary with 25% traffic for 15 minutes..."
          sleep 900

          # ç¶œåˆå¥åº·æª¢æŸ¥
          python scripts/canary-health-check.py --threshold=0.02

      # éšæ®µ 3ï¼šå®Œå…¨åˆ‡æ›åˆ°æ–°ç‰ˆæœ¬
      - name: Full rollout
        run: |
          # 100% æµé‡åˆ‡æ›åˆ°é‡‘çµ²é›€ï¼ˆç¾åœ¨è®Šæˆæ–°çš„ç©©å®šç‰ˆæœ¬ï¼‰
          kubectl apply -f - <<EOF
          apiVersion: networking.istio.io/v1alpha3
          kind: VirtualService
          metadata:
            name: myapp
          spec:
            http:
            - route:
              - destination:
                  host: myapp
                  subset: canary
                weight: 100
          EOF

      # æ¸…ç†èˆŠç‰ˆæœ¬
      - name: Cleanup old version
        run: |
          kubectl delete deployment myapp-stable

          # é‡æ–°æ¨™è¨˜é‡‘çµ²é›€ç‚ºç©©å®šç‰ˆæœ¬
          kubectl patch deployment myapp-canary -p '{"metadata":{"labels":{"version":"stable"}}}'

  # è‡ªå‹•å›é€€ä»»å‹™
  rollback:
    runs-on: ubuntu-latest
    if: failure()
    needs: canary-deploy
    steps:
      - name: Emergency rollback
        run: |
          echo "ğŸš¨ Canary deployment failed, rolling back immediately"

          # ç«‹å³åˆ‡æ›å›ç©©å®šç‰ˆæœ¬
          kubectl apply -f - <<EOF
          apiVersion: networking.istio.io/v1alpha3
          kind: VirtualService
          metadata:
            name: myapp
          spec:
            http:
            - route:
              - destination:
                  host: myapp
                  subset: stable
                weight: 100
          EOF

          # æ¸…ç†å¤±æ•—çš„é‡‘çµ²é›€éƒ¨ç½²
          kubectl delete deployment myapp-canary
```

**æ±ºç­–è¦é»**ï¼š
```
é¸æ“‡é‡‘çµ²é›€éƒ¨ç½²ç•¶ï¼š
âœ… é¢¨éšªæ§åˆ¶é‡è¦
âœ… æœ‰å®Œå–„ç›£æ§
âœ… éœ€è¦æ¼¸é€²é©—è­‰
âœ… åœ˜éšŠç¶“é©—è±å¯Œ

é¿å…é‡‘çµ²é›€éƒ¨ç½²ç•¶ï¼š
âŒ ç›£æ§ç³»çµ±ä¸å®Œå–„
âŒ åœ˜éšŠç¶“é©—ä¸è¶³
âŒ éƒ¨ç½²é »ç‡å¾ˆé«˜
âŒ ç°¡å–®çš„æ‡‰ç”¨
```

---

## ğŸ¯ ç­–ç•¥é¸æ“‡å¿«é€ŸæŒ‡å—

### æ ¹æ“šæ‡‰ç”¨é¡å‹é¸æ“‡

| æ‡‰ç”¨é¡å‹ | æ¨è–¦ç­–ç•¥ | åŸå›  |
|----------|----------|------|
| **Web æ‡‰ç”¨** | è—ç¶ /æ»¾å‹• | é›¶åœæ©Ÿè¦æ±‚é«˜ |
| **API æœå‹™** | é‡‘çµ²é›€/æ»¾å‹• | éœ€è¦é€æ­¥é©—è­‰ |
| **å¾®æœå‹™** | æ»¾å‹•/é‡‘çµ²é›€ | æœå‹™é–“ä¾è³´è¤‡é›œ |
| **å–®é«”æ‡‰ç”¨** | è—ç¶ /é‡å»º | éƒ¨ç½²å–®ä½å¤§ |
| **è³‡æ–™åº«** | è—ç¶ /é‡å»º | ç‹€æ…‹ç®¡ç†è¤‡é›œ |
| **éœæ…‹ç¶²ç«™** | é‡å»º/è—ç¶  | éƒ¨ç½²ç°¡å–® |
| **æ©Ÿå™¨å­¸ç¿’æ¨¡å‹** | é‡‘çµ²é›€/è—ç¶  | éœ€è¦ A/B æ¸¬è©¦ |

### æ ¹æ“šåœ˜éšŠæˆç†Ÿåº¦é¸æ“‡

| åœ˜éšŠæ°´å¹³ | æ¨è–¦ç­–ç•¥ | å­¸ç¿’è·¯å¾‘ |
|----------|----------|----------|
| **åˆå­¸è€…** | é‡å»º â†’ æ»¾å‹• | é€æ­¥å­¸ç¿’ Kubernetes |
| **ä¸­ç´š** | æ»¾å‹• â†’ è—ç¶  | æŒæ¡è³‡æºç®¡ç† |
| **é«˜ç´š** | é‡‘çµ²é›€ â†’ è‡ªå‹•åŒ– | å»ºç«‹å®Œæ•´ç›£æ§ |
| **å°ˆå®¶** | æ··åˆç­–ç•¥ | æ ¹æ“šå ´æ™¯éˆæ´»é¸æ“‡ |

### æ ¹æ“šè³‡æºé™åˆ¶é¸æ“‡

| è³‡æºç‹€æ³ | æ¨è–¦ç­–ç•¥ | è€ƒé‡å› ç´  |
|----------|----------|----------|
| **è³‡æºå……è¶³** | è—ç¶ éƒ¨ç½² | æœ€ä½³ç”¨æˆ¶é«”é©— |
| **è³‡æºä¸­ç­‰** | æ»¾å‹•éƒ¨ç½² | å¹³è¡¡æ•ˆç‡èˆ‡é«”é©— |
| **è³‡æºå—é™** | é‡å»ºéƒ¨ç½² | æˆæœ¬å„ªå…ˆ |
| **å½ˆæ€§è³‡æº** | é‡‘çµ²é›€éƒ¨ç½² | å‹•æ…‹èª¿æ•´è³‡æº |

---

## ğŸ”§ å¯¦æ–½å»ºè­°

### ğŸš€ å¿«é€Ÿé–‹å§‹ï¼ˆ5 åˆ†é˜ï¼‰

**æ­¥é©Ÿ 1ï¼šè©•ä¼°ä½ çš„ç¾ç‹€**
```bash
# å¿«é€Ÿè©•ä¼°è…³æœ¬
#!/bin/bash
echo "ğŸ” éƒ¨ç½²ç­–ç•¥è©•ä¼°"

# æª¢æŸ¥ç’°å¢ƒé¡å‹
if kubectl version &>/dev/null; then
    echo "âœ… Kubernetes ç’°å¢ƒ â†’ æ¨è–¦æ»¾å‹•/é‡‘çµ²é›€éƒ¨ç½²"
elif docker version &>/dev/null; then
    echo "âœ… Docker ç’°å¢ƒ â†’ æ¨è–¦è—ç¶ éƒ¨ç½²"
else
    echo "â„¹ï¸ å‚³çµ±ç’°å¢ƒ â†’ æ¨è–¦é‡å»ºéƒ¨ç½²é–‹å§‹"
fi

# æª¢æŸ¥è² è¼‰å‡è¡¡
if curl -I http://your-app.com 2>/dev/null | grep -q "x-served-by"; then
    echo "âœ… æœ‰è² è¼‰å‡è¡¡ â†’ æ”¯æ´è—ç¶ /æ»¾å‹•éƒ¨ç½²"
fi

# æª¢æŸ¥ç›£æ§
if curl -I http://prometheus:9090 &>/dev/null; then
    echo "âœ… æœ‰ç›£æ§ç³»çµ± â†’ æ”¯æ´é‡‘çµ²é›€éƒ¨ç½²"
fi
```

**æ­¥é©Ÿ 2ï¼šé¸æ“‡èµ·å§‹ç­–ç•¥**
```
æ–°æ‰‹æ¨è–¦è·¯å¾‘ï¼š
é‡å»ºéƒ¨ç½² (å­¸ç¿’åŸºç¤)
    â†“
æ»¾å‹•éƒ¨ç½² (é›¶åœæ©Ÿ)
    â†“
è—ç¶ éƒ¨ç½² (å¿«é€Ÿåˆ‡æ›)
    â†“
é‡‘çµ²é›€éƒ¨ç½² (é¢¨éšªæ§åˆ¶)
```

**æ­¥é©Ÿ 3ï¼šå¯¦æ–½ç¬¬ä¸€å€‹ç­–ç•¥**
- é¸æ“‡æœ€ç°¡å–®é©ç”¨çš„ç­–ç•¥
- åœ¨æ¸¬è©¦ç’°å¢ƒå…ˆé©—è­‰
- å»ºç«‹ç›£æ§å’Œå‘Šè­¦
- é€æ­¥æ‡‰ç”¨åˆ°ç”Ÿç”¢ç’°å¢ƒ

### ğŸ“ˆ é€²éšå„ªåŒ–

**å¤šç­–ç•¥æ··åˆä½¿ç”¨**ï¼š
```
é–‹ç™¼ç’°å¢ƒï¼šé‡å»ºéƒ¨ç½²ï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰
    â†“
æ¸¬è©¦ç’°å¢ƒï¼šæ»¾å‹•éƒ¨ç½²ï¼ˆæ¨¡æ“¬ç”Ÿç”¢ï¼‰
    â†“
é ç”Ÿç”¢ï¼šé‡‘çµ²é›€éƒ¨ç½²ï¼ˆé¢¨éšªé©—è­‰ï¼‰
    â†“
ç”Ÿç”¢ç’°å¢ƒï¼šè—ç¶ éƒ¨ç½²ï¼ˆé›¶åœæ©Ÿä¿éšœï¼‰
```

**è‡ªå‹•åŒ–æ±ºç­–ç³»çµ±**ï¼š
```yaml
# æ™ºèƒ½éƒ¨ç½²ç­–ç•¥é¸æ“‡
deploy_strategy:
  conditions:
    - if: environment == "production" && risk_level == "high"
      strategy: canary
      traffic_split: [5, 25, 50, 100]

    - if: environment == "production" && risk_level == "medium"
      strategy: blue_green

    - if: environment == "staging"
      strategy: rolling

    - if: environment == "development"
      strategy: recreate
```

---

## ğŸ“š å»¶ä¼¸å­¸ç¿’

### ğŸ¯ ç›¸é—œå·¥å…·

**éƒ¨ç½²å·¥å…·**ï¼š
- **Argo Rollouts**ï¼šKubernetes é«˜ç´šéƒ¨ç½²ç­–ç•¥
- **Flagger**ï¼šè‡ªå‹•åŒ–æ¼¸é€²å¼éƒ¨ç½²
- **Spinnaker**ï¼šå¤šé›²éƒ¨ç½²ç®¡ç·š
- **Jenkins X**ï¼šGitOps é©…å‹•çš„ CI/CD

**ç›£æ§å·¥å…·**ï¼š
- **Prometheus + Grafana**ï¼šæŒ‡æ¨™ç›£æ§
- **Jaeger**ï¼šåˆ†æ•£å¼è¿½è¹¤
- **Fluentd**ï¼šæ—¥èªŒèšåˆ
- **Istio**ï¼šæœå‹™ç¶²æ ¼ç›£æ§

### ğŸ”— å¯¦æˆ°è³‡æº

- **Kubernetes å®˜æ–¹éƒ¨ç½²ç­–ç•¥æŒ‡å—**
- **AWS/Azure/GCP éƒ¨ç½²æœ€ä½³å¯¦è¸**
- **CNCF æ¼¸é€²å¼äº¤ä»˜ç™½çš®æ›¸**
- **Site Reliability Engineering (SRE) éƒ¨ç½²ç« ç¯€**

---

**ä¸‹ä¸€æ­¥**ï¼šæ ¹æ“šæ±ºç­–æ¨¹é¸æ“‡é©åˆçš„ç­–ç•¥ï¼Œåƒè€ƒå°æ‡‰çš„é…ç½®ç¯„ä¾‹é–‹å§‹å¯¦æ–½ â†’