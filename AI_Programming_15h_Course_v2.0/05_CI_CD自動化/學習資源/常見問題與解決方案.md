# CI/CD å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

## ğŸ¯ å•é¡Œåˆ†é¡ç´¢å¼•

æœ¬æ–‡æª”æ”¶é›† CI/CD å¯¦æ–½éç¨‹ä¸­æœ€å¸¸è¦‹çš„å•é¡ŒåŠå…¶è§£æ±ºæ–¹æ¡ˆï¼Œç‰¹åˆ¥é‡å° AI æ™‚ä»£çš„æ–°æŒ‘æˆ°ã€‚

**å¿«é€Ÿå°èˆª**ï¼š
- ğŸš€ [Workflow åŸ·è¡Œå•é¡Œ](#workflow-åŸ·è¡Œå•é¡Œ)
- ğŸ”’ [å®‰å…¨æƒæå•é¡Œ](#å®‰å…¨æƒæå•é¡Œ)
- ğŸ³ [Docker/å®¹å™¨åŒ–å•é¡Œ](#dockerå®¹å™¨åŒ–å•é¡Œ)
- ğŸ“¦ [ä¾è³´ç®¡ç†å•é¡Œ](#ä¾è³´ç®¡ç†å•é¡Œ)
- ğŸ”§ [é…ç½®å’Œæ¬Šé™å•é¡Œ](#é…ç½®å’Œæ¬Šé™å•é¡Œ)
- âš¡ [æ•ˆèƒ½å„ªåŒ–å•é¡Œ](#æ•ˆèƒ½å„ªåŒ–å•é¡Œ)

---

## ğŸš€ Workflow åŸ·è¡Œå•é¡Œ

### Q1: GitHub Actions workflow æ²’æœ‰è§¸ç™¼

**ç—‡ç‹€**ï¼š
- Push ç¨‹å¼ç¢¼å¾Œï¼ŒActions tab æ²’æœ‰æ–°çš„ workflow åŸ·è¡Œ
- PR å»ºç«‹å¾Œï¼Œæª¢æŸ¥ç‹€æ…‹æ²’æœ‰å‡ºç¾

**å¸¸è¦‹åŸå› åŠè§£æ±ºæ–¹æ¡ˆ**ï¼š

**1. YAML èªæ³•éŒ¯èª¤**
```yaml
# âŒ éŒ¯èª¤ï¼šç¸®æ’ä¸æ­£ç¢º
name: Test
on:
push:  # ç¸®æ’éŒ¯èª¤
  branches: [main]

# âœ… æ­£ç¢ºï¼šç¸®æ’ä¸€è‡´
name: Test
on:
  push:
    branches: [main]
```

**2. æª”æ¡ˆè·¯å¾‘éŒ¯èª¤**
```bash
# âŒ éŒ¯èª¤ä½ç½®
.github/workflow/test.yml    # ç¼ºå°‘ s

# âœ… æ­£ç¢ºä½ç½®
.github/workflows/test.yml   # workflows æœ‰ s
```

**3. åˆ†æ”¯æ¢ä»¶ä¸åŒ¹é…**
```yaml
# æª¢æŸ¥åˆ†æ”¯è¨­å®š
on:
  push:
    branches: [main, develop]  # ç¢ºä¿åŒ…å«ä½ æ¨é€çš„åˆ†æ”¯
  pull_request:
    branches: [main]           # ç¢ºä¿ PR ç›®æ¨™åˆ†æ”¯æ­£ç¢º
```

**é™¤éŒ¯æ­¥é©Ÿ**ï¼š
```bash
# 1. æª¢æŸ¥ YAML èªæ³•
yamllint .github/workflows/test.yml

# 2. æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨
ls -la .github/workflows/

# 3. æª¢æŸ¥ Git ç‹€æ…‹
git status
git log --oneline -5

# 4. æª¢æŸ¥åˆ†æ”¯åç¨±
git branch -a
```

### Q2: Workflow åŸ·è¡Œå¤±æ•—ï¼ŒéŒ¯èª¤è¨Šæ¯ä¸æ¸…æ¥š

**ç—‡ç‹€**ï¼š
- Workflow é¡¯ç¤ºç´…è‰² Xï¼Œä½†éŒ¯èª¤è¨Šæ¯æ¨¡ç³Š
- æ‰¾ä¸åˆ°å…·é«”çš„å¤±æ•—åŸå› 

**è§£æ±ºç­–ç•¥**ï¼š

**1. å•Ÿç”¨è©³ç´°æ—¥èªŒ**
```yaml
# åœ¨ workflow ä¸­åŠ å…¥é™¤éŒ¯è³‡è¨Š
jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Debug information
        run: |
          echo "GitHub Context:"
          echo "Repository: ${{ github.repository }}"
          echo "Event: ${{ github.event_name }}"
          echo "Actor: ${{ github.actor }}"
          echo "SHA: ${{ github.sha }}"
          echo "Ref: ${{ github.ref }}"

          echo "Environment:"
          env | sort

          echo "File system:"
          ls -la
```

**2. åˆ†æ­¥é©Ÿé™¤éŒ¯**
```yaml
# å°‡è¤‡é›œæ­¥é©Ÿæ‹†è§£
- name: Install dependencies
  run: |
    echo "Installing Node.js dependencies..."
    npm ci
    echo "Dependencies installed successfully"

- name: Run tests
  run: |
    echo "Running test suite..."
    npm test
    echo "Tests completed"
```

**3. ä½¿ç”¨ tmate é ç«¯é™¤éŒ¯**
```yaml
# ç•¶éœ€è¦äº’å‹•å¼é™¤éŒ¯æ™‚
- name: Setup tmate session
  if: failure()
  uses: mxschmitt/action-tmate@v3
  with:
    limit-access-to-actor: true
```

### Q3: Actions åŸ·è¡Œæ™‚é–“éé•·

**ç—‡ç‹€**ï¼š
- Workflow åŸ·è¡Œè¶…é 10-20 åˆ†é˜
- é »ç¹è¶…æ™‚å¤±æ•—

**å„ªåŒ–ç­–ç•¥**ï¼š

**1. ä½¿ç”¨å¿«å–**
```yaml
# Node.js å¿«å–
- name: Cache Node modules
  uses: actions/cache@v3
  with:
    path: ~/.npm
    key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
    restore-keys: |
      ${{ runner.os }}-node-

# Python å¿«å–
- name: Cache pip packages
  uses: actions/cache@v3
  with:
    path: ~/.cache/pip
    key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
```

**2. ä¸¦è¡ŒåŸ·è¡Œ**
```yaml
jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
        node-version: [16, 18, 20]
      fail-fast: false
    runs-on: ${{ matrix.os }}
```

**3. è·³éä¸å¿…è¦çš„æ­¥é©Ÿ**
```yaml
- name: Skip tests for docs-only changes
  id: skip
  run: |
    if git diff --name-only ${{ github.event.before }}..${{ github.sha }} | grep -qE "^docs/|\.md$"; then
      echo "skip=true" >> $GITHUB_OUTPUT
    fi

- name: Run tests
  if: steps.skip.outputs.skip != 'true'
  run: npm test
```

---

## ğŸ”’ å®‰å…¨æƒæå•é¡Œ

### Q4: CodeQL æƒæå¤±æ•—æˆ–æ‰¾ä¸åˆ°ç¨‹å¼ç¢¼

**ç—‡ç‹€**ï¼š
- CodeQL åˆå§‹åŒ–æˆåŠŸï¼Œä½†åˆ†æå¤±æ•—
- æç¤º "No source code was seen during the build"

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

**1. è‡ªå‹•å»ºç½®å¤±æ•—**
```yaml
# å°æ–¼ç·¨è­¯èªè¨€ï¼ŒæŒ‡å®šå»ºç½®æ­¥é©Ÿ
- name: Initialize CodeQL
  uses: github/codeql-action/init@v2
  with:
    languages: java

# å–ä»£ autobuildï¼Œä½¿ç”¨è‡ªå®šç¾©å»ºç½®
- name: Build project
  run: |
    mvn clean compile test-compile

- name: Perform CodeQL Analysis
  uses: github/codeql-action/analyze@v2
```

**2. èªè¨€æª¢æ¸¬å•é¡Œ**
```yaml
# æ˜ç¢ºæŒ‡å®šèªè¨€
- name: Initialize CodeQL
  uses: github/codeql-action/init@v2
  with:
    languages: javascript, python, java
    # æ˜ç¢ºæŒ‡å®šä¾†æºç›®éŒ„
    source-root: src
```

**3. æª”æ¡ˆè·¯å¾‘æ’é™¤**
```yaml
# æ’é™¤ä¸éœ€è¦æƒæçš„æª”æ¡ˆ
- name: Initialize CodeQL
  uses: github/codeql-action/init@v2
  with:
    config: |
      paths-ignore:
        - "node_modules"
        - "vendor"
        - "**/test/**"
        - "**/*.test.js"
```

### Q5: Snyk æƒæç™¼ç¾éå¤šèª¤å ±

**ç—‡ç‹€**ï¼š
- Snyk å ±å‘Šå¤§é‡ä½å±æ¼æ´
- å½±éŸ¿æ­£å¸¸çš„ PR åˆä½µæµç¨‹

**è§£æ±ºç­–ç•¥**ï¼š

**1. èª¿æ•´åš´é‡æ€§é–¾å€¼**
```yaml
- name: Run Snyk to check for vulnerabilities
  uses: snyk/actions/node@master
  env:
    SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
  with:
    args: --severity-threshold=medium  # åªé—œæ³¨ä¸­å±ä»¥ä¸Š
```

**2. ä½¿ç”¨ .snyk é…ç½®æª”æ¡ˆ**
```yaml
# .snyk
version: v1.0.0
ignore:
  # æš«æ™‚å¿½ç•¥ç‰¹å®šæ¼æ´
  SNYK-JS-LODASH-567746:
    - '*':
        reason: 'False positive - we do not use the vulnerable function'
        expires: '2024-12-31T23:59:59.999Z'

  # å¿½ç•¥é–‹ç™¼ä¾è³´çš„ä½å±æ¼æ´
  SNYK-JS-MINIMIST-559764:
    - 'devDependencies > *':
        reason: 'Dev dependency, not used in production'
```

**3. åˆ†é›¢ç”Ÿç”¢å’Œé–‹ç™¼ä¾è³´æƒæ**
```yaml
- name: Snyk production dependencies
  run: snyk test --severity-threshold=high --prod

- name: Snyk development dependencies
  run: snyk test --severity-threshold=critical --dev
  continue-on-error: true  # é–‹ç™¼ä¾è³´å¤±æ•—ä¸é˜»æ­¢æµç¨‹
```

### Q6: Trivy å®¹å™¨æƒæå ±å‘Šå¤ªå¤š OS æ¼æ´

**ç—‡ç‹€**ï¼š
- å¤§é‡çš„ä½œæ¥­ç³»çµ±å±¤ç´šæ¼æ´
- é›£ä»¥å€åˆ†æ‡‰ç”¨å±¤ç´šçš„çœŸæ­£é¢¨éšª

**å„ªåŒ–é…ç½®**ï¼š

**1. åˆ†å±¤æƒæ**
```yaml
# åªæƒææ‡‰ç”¨å±¤æ¼æ´
- name: Scan application vulnerabilities
  run: |
    trivy image --vuln-type library --severity HIGH,CRITICAL myapp:latest

# åˆ†åˆ¥æƒæ OS å±¤ï¼ˆå¯è¨­ç‚ºè­¦å‘Šï¼‰
- name: Scan OS vulnerabilities
  run: |
    trivy image --vuln-type os --severity CRITICAL myapp:latest
  continue-on-error: true
```

**2. ä½¿ç”¨ distroless åŸºç¤æ˜ åƒ**
```dockerfile
# æ¸›å°‘æ”»æ“Šé¢
FROM gcr.io/distroless/java:11
COPY app.jar /
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

**3. å®šæœŸæ›´æ–°åŸºç¤æ˜ åƒ**
```yaml
# .github/dependabot.yml
version: 2
updates:
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
```

---

## ğŸ³ Docker/å®¹å™¨åŒ–å•é¡Œ

### Q7: Docker å»ºç½®åœ¨ CI ä¸­å¤±æ•—ï¼Œä½†æœ¬åœ°æˆåŠŸ

**ç—‡ç‹€**ï¼š
- æœ¬åœ° `docker build` æˆåŠŸ
- GitHub Actions ä¸­ Docker å»ºç½®å¤±æ•—

**å¸¸è¦‹åŸå› åŠè§£æ±ºæ–¹æ¡ˆ**ï¼š

**1. å¹³å°å·®ç•°å•é¡Œ**
```yaml
# æŒ‡å®šå¹³å°
- name: Build Docker image
  run: |
    docker build --platform=linux/amd64 -t myapp:latest .
```

**2. æª”æ¡ˆè·¯å¾‘å¤§å°å¯«å•é¡Œ**
```bash
# æª¢æŸ¥ Dockerfile ä¸­çš„è·¯å¾‘
# âŒ åœ¨ Linux ä¸­å¯èƒ½å¤±æ•—
COPY App.js /app/

# âœ… ç¢ºä¿å¤§å°å¯«æ­£ç¢º
COPY app.js /app/
```

**3. å»ºç½®ä¸Šä¸‹æ–‡éå¤§**
```dockerfile
# .dockerignore
node_modules
.git
.github
*.md
tests/
coverage/
```

**4. å¤šéšæ®µå»ºç½®å•é¡Œ**
```dockerfile
# ç¢ºä¿æ‰€æœ‰éšæ®µéƒ½èƒ½å­˜å–åˆ°å¿…è¦æª”æ¡ˆ
FROM node:18 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

FROM node:18-alpine AS runtime
WORKDIR /app
# ç¢ºä¿å¾æ­£ç¢ºçš„éšæ®µè¤‡è£½æª”æ¡ˆ
COPY --from=builder /app/node_modules ./node_modules
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

### Q8: å®¹å™¨åœ¨ CI ä¸­å•Ÿå‹•å¤±æ•—

**ç—‡ç‹€**ï¼š
- Docker å»ºç½®æˆåŠŸï¼Œä½†å®¹å™¨åŸ·è¡Œå¤±æ•—
- å¥åº·æª¢æŸ¥ä¸€ç›´å¤±æ•—

**é™¤éŒ¯ç­–ç•¥**ï¼š

**1. åŠ å…¥è©³ç´°æ—¥èªŒ**
```yaml
- name: Run container with logs
  run: |
    # å•Ÿå‹•å®¹å™¨
    docker run -d --name test-container myapp:latest

    # ç­‰å¾…å•Ÿå‹•
    sleep 10

    # æª¢æŸ¥ç‹€æ…‹å’Œæ—¥èªŒ
    docker ps -a
    docker logs test-container

    # å¥åº·æª¢æŸ¥
    docker exec test-container curl -f http://localhost:8080/health
```

**2. è¨­å®šé©ç•¶çš„å¥åº·æª¢æŸ¥**
```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/health || exit 1
```

**3. æª¢æŸ¥ç’°å¢ƒè®Šæ•¸**
```yaml
- name: Debug container environment
  run: |
    docker run --rm myapp:latest env | sort
    docker run --rm myapp:latest cat /etc/passwd
    docker run --rm myapp:latest ls -la /app
```

---

## ğŸ“¦ ä¾è³´ç®¡ç†å•é¡Œ

### Q9: npm/pip å®‰è£åœ¨ CI ä¸­å¤±æ•—

**ç—‡ç‹€**ï¼š
- ä¾è³´å®‰è£è¶…æ™‚æˆ–å¤±æ•—
- ç‰ˆæœ¬è¡çªå•é¡Œ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

**1. ç¶²è·¯å•é¡Œ**
```yaml
# è¨­å®š npm registry mirror
- name: Setup npm
  run: |
    npm config set registry https://registry.npmmirror.com/
    npm config set timeout 60000

# é‡è©¦æ©Ÿåˆ¶
- name: Install dependencies with retry
  run: |
    for i in {1..3}; do
      npm ci && break
      echo "Attempt $i failed, retrying..."
      sleep 5
    done
```

**2. å¿«å–ç­–ç•¥**
```yaml
# æ›´ç²¾ç¢ºçš„å¿«å–éµ
- name: Cache dependencies
  uses: actions/cache@v3
  with:
    path: |
      ~/.npm
      node_modules
    key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}-${{ hashFiles('**/package.json') }}
    restore-keys: |
      ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
      ${{ runner.os }}-npm-
```

**3. ç‰ˆæœ¬é–å®š**
```yaml
# ç¢ºä¿ä½¿ç”¨æ­£ç¢ºçš„å¥—ä»¶ç®¡ç†å™¨ç‰ˆæœ¬
- name: Setup Node.js
  uses: actions/setup-node@v3
  with:
    node-version: '18'
    npm-version: '9.5.0'  # é–å®š npm ç‰ˆæœ¬
```

### Q10: ä¾è³´ç‰ˆæœ¬è¡çª

**ç—‡ç‹€**ï¼š
- æœ¬åœ°å¯ä»¥å®‰è£ï¼ŒCI ä¸­ç‰ˆæœ¬è¡çª
- Peer dependency è­¦å‘Š

**è§£æ±ºç­–ç•¥**ï¼š

**1. æ¸…ç†å®‰è£**
```yaml
- name: Clean install
  run: |
    rm -rf node_modules package-lock.json
    npm cache clean --force
    npm install
```

**2. ä½¿ç”¨ --legacy-peer-deps**
```yaml
- name: Install with legacy peer deps
  run: npm install --legacy-peer-deps
```

**3. æ˜ç¢ºçš„ç‰ˆæœ¬ç®¡ç†**
```json
// package.json
{
  "overrides": {
    "vulnerable-package": "^2.0.0"
  },
  "resolutions": {
    "vulnerable-package": "^2.0.0"
  }
}
```

---

## ğŸ”§ é…ç½®å’Œæ¬Šé™å•é¡Œ

### Q11: GitHub Secrets è¨­å®šå•é¡Œ

**ç—‡ç‹€**ï¼š
- Secrets ç„¡æ³•å­˜å–
- æ¬Šé™ä¸è¶³éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

**1. æª¢æŸ¥ Secrets ç¯„åœ**
```yaml
# ç¢ºä¿åœ¨æ­£ç¢ºçš„ç¯„åœè¨­å®š secrets
# Repository secrets: æ•´å€‹å€‰åº«å¯ç”¨
# Environment secrets: ç‰¹å®šç’°å¢ƒæ‰å¯ç”¨
# Organization secrets: çµ„ç¹”å±¤ç´šå…±äº«

jobs:
  deploy:
    environment: production  # å¦‚æœä½¿ç”¨ç’°å¢ƒ secrets
    steps:
      - name: Use secret
        run: echo "Secret value: ${{ secrets.SECRET_NAME }}"
```

**2. æ¬Šé™è¨­å®š**
```yaml
# workflow æª”æ¡ˆä¸­æ˜ç¢ºè¨­å®šæ¬Šé™
permissions:
  contents: read
  security-events: write
  actions: read
  packages: write

jobs:
  security-scan:
    permissions:
      security-events: write  # CodeQL éœ€è¦æ­¤æ¬Šé™
```

**3. é™¤éŒ¯ secrets**
```yaml
- name: Debug secrets (å®‰å…¨æ–¹å¼)
  run: |
    # âŒ çµ•å°ä¸è¦ç›´æ¥å°å‡º secret
    # echo "${{ secrets.SECRET_NAME }}"

    # âœ… æª¢æŸ¥ secret æ˜¯å¦å­˜åœ¨
    if [ -z "${{ secrets.SECRET_NAME }}" ]; then
      echo "SECRET_NAME is not set"
      exit 1
    else
      echo "SECRET_NAME is set (length: ${#SECRET_NAME})"
    fi
```

### Q12: è·¨å€‰åº«æ¬Šé™å•é¡Œ

**ç—‡ç‹€**ï¼š
- ç„¡æ³•å­˜å–å…¶ä»–å€‰åº«çš„è³‡æº
- GITHUB_TOKEN æ¬Šé™ä¸è¶³

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

**1. ä½¿ç”¨ Personal Access Token**
```yaml
# å»ºç«‹å…·æœ‰é©ç•¶æ¬Šé™çš„ PAT
- name: Checkout private repo
  uses: actions/checkout@v4
  with:
    repository: myorg/private-repo
    token: ${{ secrets.PAT_TOKEN }}
    path: private-repo
```

**2. ä½¿ç”¨ GitHub App**
```yaml
- name: Generate token
  id: generate_token
  uses: tibdex/github-app-token@v1
  with:
    app_id: ${{ secrets.APP_ID }}
    private_key: ${{ secrets.APP_PRIVATE_KEY }}

- name: Use generated token
  uses: actions/checkout@v4
  with:
    token: ${{ steps.generate_token.outputs.token }}
```

---

## âš¡ æ•ˆèƒ½å„ªåŒ–å•é¡Œ

### Q13: CI/CD ç®¡ç·šåŸ·è¡Œæ™‚é–“éé•·

**ç—‡ç‹€**ï¼š
- å–®æ¬¡åŸ·è¡Œè¶…é 30 åˆ†é˜
- é–‹ç™¼è€…ç­‰å¾…æ™‚é–“éé•·

**å„ªåŒ–ç­–ç•¥**ï¼š

**1. ä¸¦è¡ŒåŒ–ç­–ç•¥**
```yaml
jobs:
  test:
    strategy:
      matrix:
        group: [1, 2, 3, 4]
    steps:
      - name: Run test group ${{ matrix.group }}
        run: npm test -- --group=${{ matrix.group }}

  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Lint code
        run: npm run lint

  security:
    runs-on: ubuntu-latest
    steps:
      - name: Security scan
        run: npm audit
```

**2. æ™ºèƒ½è§¸ç™¼**
```yaml
# åªåœ¨ç›¸é—œæª”æ¡ˆè®Šæ›´æ™‚åŸ·è¡Œ
on:
  push:
    paths:
      - 'src/**'
      - 'package.json'
      - 'package-lock.json'
  pull_request:
    paths:
      - 'src/**'
      - 'tests/**'
```

**3. éšæ®µæ€§åŸ·è¡Œ**
```yaml
jobs:
  quick-check:
    runs-on: ubuntu-latest
    steps:
      - name: Lint and unit tests
        run: |
          npm run lint
          npm run test:unit

  full-test:
    needs: quick-check
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: Integration tests
        run: npm run test:integration
```

### Q14: è³‡æºä½¿ç”¨éåº¦

**ç—‡ç‹€**ï¼š
- Actions åˆ†é˜æ•¸å¿«é€Ÿæ¶ˆè€—
- è²»ç”¨è¶…å‡ºé æœŸ

**æˆæœ¬æ§åˆ¶**ï¼š

**1. ç›£æ§ä½¿ç”¨é‡**
```yaml
- name: Report resource usage
  run: |
    echo "Job started at: $(date)"
    echo "Runner: ${{ runner.os }}"
    echo "Repository: ${{ github.repository }}"
    echo "Event: ${{ github.event_name }}"
```

**2. å„ªåŒ– Runner é¸æ“‡**
```yaml
jobs:
  # è¼•é‡ä»»å‹™ä½¿ç”¨å°å‹ runner
  lint:
    runs-on: ubuntu-latest

  # é‡é‡ä»»å‹™ä½¿ç”¨é«˜æ•ˆ runner
  build:
    runs-on: ubuntu-latest-4-cores

  # è‡ªè¨—ç®¡ runner é™ä½æˆæœ¬
  deploy:
    runs-on: self-hosted
```

**3. æ¢ä»¶åŸ·è¡Œ**
```yaml
jobs:
  expensive-job:
    if: |
      github.event_name == 'push' &&
      github.ref == 'refs/heads/main' &&
      !contains(github.event.head_commit.message, '[skip ci]')
```

---

## ğŸ†˜ ç·Šæ€¥å•é¡Œè™•ç†

### ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²å¤±æ•—

**ç«‹å³è¡Œå‹•**ï¼š
```bash
# 1. å¿«é€Ÿå›é€€
kubectl rollout undo deployment/myapp

# 2. æª¢æŸ¥æœå‹™ç‹€æ…‹
kubectl get pods -l app=myapp
kubectl describe pods -l app=myapp

# 3. æŸ¥çœ‹æ—¥èªŒ
kubectl logs -l app=myapp --tail=100

# 4. æš«åœè‡ªå‹•éƒ¨ç½²
gh workflow disable deploy.yml
```

**å¾ŒçºŒåˆ†æ**ï¼š
```bash
# 1. ä¸‹è¼‰ CI æ—¥èªŒ
gh run download <run-id>

# 2. åˆ†æå¤±æ•—åŸå› 
grep -i error *.log
grep -i fail *.log

# 3. æº–å‚™ä¿®å¾©
git checkout -b hotfix/deployment-fix
```

### å®‰å…¨æ¼æ´ç·Šæ€¥ä¿®å¾©

**ç«‹å³éŸ¿æ‡‰**ï¼š
```bash
# 1. è©•ä¼°é¢¨éšªç­‰ç´š
snyk test --severity-threshold=critical

# 2. æš«åœå—å½±éŸ¿çš„æœå‹™
kubectl scale deployment myapp --replicas=0

# 3. æ‡‰ç”¨ç·Šæ€¥è£œä¸
docker pull myapp:last-known-good
kubectl set image deployment/myapp myapp=myapp:last-known-good

# 4. é©—è­‰ä¿®å¾©
curl -f https://myapp.example.com/health
```

---

## ğŸ“š å»¶ä¼¸è³‡æº

### ğŸ”§ é™¤éŒ¯å·¥å…·

- **GitHub CLI**ï¼š`gh workflow list`, `gh run view`
- **act**ï¼šæœ¬åœ°åŸ·è¡Œ GitHub Actions
- **yamllint**ï¼šYAML èªæ³•æª¢æŸ¥
- **docker-compose**ï¼šæœ¬åœ°å®¹å™¨æ¸¬è©¦

### ğŸ“– åƒè€ƒæ–‡æª”

- **GitHub Actions ç–‘é›£æ’è§£**ï¼šå®˜æ–¹é™¤éŒ¯æŒ‡å—
- **Docker æœ€ä½³å¯¦è¸**ï¼šå®¹å™¨åŒ–æŒ‡å—
- **Kubernetes å•é¡Œæ’æŸ¥**ï¼šK8s å®˜æ–¹æ–‡æª”
- **DevOps æ•…éšœæ’é™¤**ï¼šSRE å¯¦è¸æ‰‹å†Š

### ğŸ¯ é é˜²æªæ–½

- **å®šæœŸå¥åº·æª¢æŸ¥**ï¼šæ¯é€±æª¢æŸ¥ CI/CD ç‹€æ…‹
- **ç›£æ§å‘Šè­¦**ï¼šè¨­å®šé—œéµæŒ‡æ¨™å‘Šè­¦
- **æ–‡æª”æ›´æ–°**ï¼šè¨˜éŒ„æ–°ç™¼ç¾çš„å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆ
- **åœ˜éšŠåŸ¹è¨“**ï¼šæå‡åœ˜éšŠæ•…éšœæ’é™¤èƒ½åŠ›

---

**å¿«é€Ÿæ”¯æ´**ï¼šé‡åˆ°ç·Šæ€¥å•é¡Œï¼Ÿä½¿ç”¨ `Ctrl+F` æœå°‹é—œéµå­—ï¼Œæˆ–ç›´æ¥æŸ¥çœ‹å°æ‡‰åˆ†é¡ â†’