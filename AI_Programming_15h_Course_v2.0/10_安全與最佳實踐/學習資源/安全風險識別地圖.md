# å®‰å…¨é¢¨éšªè­˜åˆ¥åœ°åœ–

> **å­¸ç¿’ç›®æ¨™**: å¿«é€Ÿè­˜åˆ¥ AI ç”Ÿæˆä»£ç¢¼ä¸­çš„ Top 5 å®‰å…¨é™·é˜±ï¼Œå»ºç«‹ã€Œé©—è­‰å„ªæ–¼ä¿¡ä»»ã€çš„æœ¬èƒ½åæ‡‰

---

## Top 5 AI ç”Ÿæˆçš„å®‰å…¨é™·é˜±

### é™·é˜± #1: ç¡¬ç·¨ç¢¼æ†‘è­‰ (Hardcoded Credentials)

#### ğŸš¨ å±éšªä¿¡è™Ÿ

```python
# âŒ AI å¸¸è¦‹çš„ä¸å®‰å…¨å»ºè­°
API_KEY = "sk-proj-abc123def456..."
DATABASE_URL = "postgresql://admin:password123@localhost/db"
AWS_SECRET_KEY = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"

client = OpenAI(api_key=API_KEY)
```

**ç‚ºä»€éº¼ AI æœƒé€™æ¨£å¯«ï¼Ÿ**
- è¨“ç·´æ•¸æ“šä¸­å¤§é‡ç¯„ä¾‹ä»£ç¢¼ä½¿ç”¨ç¡¬ç·¨ç¢¼
- ç‚ºäº†è®“ä»£ç¢¼ã€Œä¸€ç›®äº†ç„¶ã€ï¼Œæ–¹ä¾¿ç†è§£
- ä¸çŸ¥é“ç•¶å‰æ˜¯å¦æ˜¯ç”Ÿç”¢ç’°å¢ƒ

#### âœ… å®‰å…¨åšæ³•

```python
# âœ… ä½¿ç”¨ç’°å¢ƒè®Šæ•¸
import os
from dotenv import load_dotenv

load_dotenv()

API_KEY = os.getenv('OPENAI_API_KEY')
if not API_KEY:
    raise ValueError("OPENAI_API_KEY not found in environment")

client = OpenAI(api_key=API_KEY)
```

**é…å¥—æªæ–½**:
1. å‰µå»º `.env` æª”æ¡ˆå­˜æ”¾æ†‘è­‰
2. ç¢ºä¿ `.env` åœ¨ `.gitignore` ä¸­
3. ä½¿ç”¨ `git-secrets` æƒæ commit
4. æä¾› `.env.example` ä½œç‚ºç¯„æœ¬

#### ğŸ“ å¿«é€Ÿè­˜åˆ¥æ–¹æ³•

**æƒæé—œéµè©**:
- `password = `
- `api_key = "`
- `secret = "`
- `token = "`
- `bearer "`
- é•·å­—ä¸²ï¼ˆ>20 å­—å…ƒï¼‰ç›´æ¥è³¦å€¼çµ¦è®Šæ•¸

**è‡ªå‹•åŒ–æª¢æ¸¬**:
```bash
# ä½¿ç”¨ git-secrets æƒæ
git secrets --scan

# ä½¿ç”¨ TruffleHog æƒææ­·å² commits
trufflehog git file://. --only-verified
```

---

### é™·é˜± #2: SQL æ³¨å…¥ (SQL Injection)

#### ğŸš¨ å±éšªä¿¡è™Ÿ

```python
# âŒ AI å¸¸è¦‹çš„ä¸å®‰å…¨å»ºè­°
def get_user(username):
    query = f"SELECT * FROM users WHERE name = '{username}'"
    return db.execute(query)

# æ”»æ“Šç¯„ä¾‹: username = "admin' OR '1'='1"
# çµæœ: SELECT * FROM users WHERE name = 'admin' OR '1'='1'
# è¿”å›æ‰€æœ‰ç”¨æˆ¶è³‡æ–™ï¼
```

**ç‚ºä»€éº¼ AI æœƒé€™æ¨£å¯«ï¼Ÿ**
- f-string çœ‹èµ·ä¾†ç°¡æ½”ç›´è§€
- ç°¡å–®æ¸¬è©¦æ•¸æ“šä¸‹çœ‹èµ·ä¾†ã€Œèƒ½å‹•ã€
- ä¸ç†è§£ SQL æ³¨å…¥çš„å¯¦éš›é¢¨éšª

#### âœ… å®‰å…¨åšæ³•

```python
# âœ… ä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢
def get_user(username):
    query = "SELECT * FROM users WHERE name = %s"
    return db.execute(query, (username,))  # åƒæ•¸åŒ–ç¶å®š

# æˆ–ä½¿ç”¨ ORM
from sqlalchemy import select

def get_user(username):
    stmt = select(User).where(User.name == username)
    return db.execute(stmt).first()
```

**ç‚ºä»€éº¼é€™æ¨£å®‰å…¨ï¼Ÿ**
- åƒæ•¸èˆ‡ SQL èªå¥åˆ†é›¢
- æ•¸æ“šåº«é©…å‹•æœƒè‡ªå‹•è½‰ç¾©ç‰¹æ®Šå­—å…ƒ
- æ”»æ“Šè€…ç„¡æ³•æ”¹è®Š SQL çµæ§‹

#### ğŸ“ å¿«é€Ÿè­˜åˆ¥æ–¹æ³•

**æƒææ¨¡å¼**:
- `f"SELECT ... {variable}"`
- `"SELECT ... " + variable`
- `.format()` ç”¨æ–¼ SQL èªå¥
- ç›´æ¥å­—ä¸²æ’å€¼åˆ° SQL æŸ¥è©¢

**è‡ªå‹•åŒ–æª¢æ¸¬**:
```bash
# ä½¿ç”¨ Semgrep è¦å‰‡
semgrep --config "p/sql-injection" .

# æˆ–ä½¿ç”¨ Bandit (Python)
bandit -r . -f json
```

---

### é™·é˜± #3: è·¯å¾‘éæ­· (Path Traversal)

#### ğŸš¨ å±éšªä¿¡è™Ÿ

```python
# âŒ AI å¸¸è¦‹çš„ä¸å®‰å…¨å»ºè­°
@app.route('/download/<filename>')
def download_file(filename):
    file_path = f"/uploads/{filename}"
    return send_file(file_path)

# æ”»æ“Šç¯„ä¾‹: filename = "../../etc/passwd"
# çµæœ: è®€å– /etc/passwd ç³»çµ±æª”æ¡ˆï¼
```

**ç‚ºä»€éº¼ AI æœƒé€™æ¨£å¯«ï¼Ÿ**
- å‡è¨­ç”¨æˆ¶è¼¸å…¥æ˜¯ã€Œè‰¯å–„çš„ã€
- æ²’æœ‰è€ƒæ…®æƒ¡æ„æ§‹é€ çš„è·¯å¾‘
- è¨“ç·´æ•¸æ“šä¸­ç¼ºå°‘å®‰å…¨é©—è­‰ç¯„ä¾‹

#### âœ… å®‰å…¨åšæ³•

```python
# âœ… ä½¿ç”¨ pathlib é©—è­‰è·¯å¾‘
from pathlib import Path

UPLOAD_DIR = Path("/uploads").resolve()

@app.route('/download/<filename>')
def download_file(filename):
    # ç¦æ­¢è·¯å¾‘åˆ†éš”ç¬¦
    if '/' in filename or '\\' in filename:
        abort(400, "Invalid filename")

    # æ§‹é€ å®Œæ•´è·¯å¾‘ä¸¦é©—è­‰
    file_path = (UPLOAD_DIR / filename).resolve()

    # ç¢ºä¿è·¯å¾‘åœ¨å…è¨±çš„ç›®éŒ„å…§
    if not file_path.is_relative_to(UPLOAD_DIR):
        abort(403, "Access denied")

    if not file_path.exists():
        abort(404, "File not found")

    return send_file(file_path)
```

**é˜²è­·å±¤æ¬¡**:
1. **è¼¸å…¥é©—è­‰**: ç¦æ­¢è·¯å¾‘åˆ†éš”ç¬¦
2. **è·¯å¾‘è§£æ**: ä½¿ç”¨ `.resolve()` å–å¾—çµ•å°è·¯å¾‘
3. **é‚Šç•Œæª¢æŸ¥**: ä½¿ç”¨ `.is_relative_to()` ç¢ºä¿åœ¨å…è¨±ç¯„åœå…§
4. **å­˜åœ¨æ€§æª¢æŸ¥**: é©—è­‰æª”æ¡ˆæ˜¯å¦å­˜åœ¨

#### ğŸ“ å¿«é€Ÿè­˜åˆ¥æ–¹æ³•

**å±éšªæ¨¡å¼**:
- ç›´æ¥æ‹¼æ¥ç”¨æˆ¶è¼¸å…¥åˆ°æª”æ¡ˆè·¯å¾‘
- æ²’æœ‰é©—è­‰è·¯å¾‘åˆ†éš”ç¬¦ (`/`, `\\`)
- æ²’æœ‰é©—è­‰ `..` (ä¸Šå±¤ç›®éŒ„)
- ä½¿ç”¨ `open(user_input)` è€Œç„¡é©—è­‰

**è‡ªå‹•åŒ–æª¢æ¸¬**:
```bash
# ä½¿ç”¨ Semgrep è¦å‰‡
semgrep --config "p/path-traversal" .
```

---

### é™·é˜± #4: ä¸å®‰å…¨çš„ååºåˆ—åŒ– (Insecure Deserialization)

#### ğŸš¨ å±éšªä¿¡è™Ÿ

```python
# âŒ AI å¸¸è¦‹çš„ä¸å®‰å…¨å»ºè­°
import pickle

@app.route('/load_data', methods=['POST'])
def load_data():
    data = request.data
    obj = pickle.loads(data)  # å±éšªï¼å¯åŸ·è¡Œä»»æ„ä»£ç¢¼
    return process(obj)
```

**ç‚ºä»€éº¼å±éšªï¼Ÿ**
- `pickle.loads()` æœƒåŸ·è¡Œåºåˆ—åŒ–å°è±¡ä¸­çš„ä»£ç¢¼
- æ”»æ“Šè€…å¯ä»¥æ§‹é€ æƒ¡æ„ pickle æ•¸æ“šåŸ·è¡Œä»»æ„ Python ä»£ç¢¼
- å¯èƒ½å°è‡´é ç¨‹ä»£ç¢¼åŸ·è¡Œ (RCE)

#### âœ… å®‰å…¨åšæ³•

```python
# âœ… ä½¿ç”¨å®‰å…¨çš„åºåˆ—åŒ–æ ¼å¼
import json
from pydantic import BaseModel, ValidationError

class DataModel(BaseModel):
    name: str
    value: int

@app.route('/load_data', methods=['POST'])
def load_data():
    try:
        raw_data = request.get_json()
        # Pydantic æœƒé©—è­‰æ•¸æ“šçµæ§‹
        data = DataModel(**raw_data)
        return process(data)
    except ValidationError as e:
        return {"error": str(e)}, 400
```

**ç‚ºä»€éº¼å®‰å…¨ï¼Ÿ**
- JSON åªèƒ½è¡¨ç¤ºæ•¸æ“šï¼Œä¸èƒ½åŒ…å«ä»£ç¢¼
- Pydantic æœƒé©—è­‰æ•¸æ“šé¡å‹èˆ‡çµæ§‹
- ç„¡æ³•è§¸ç™¼ä»£ç¢¼åŸ·è¡Œ

#### ğŸ“ å¿«é€Ÿè­˜åˆ¥æ–¹æ³•

**å±éšªå‡½æ•¸**:
- `pickle.loads()`
- `pickle.load()`
- `yaml.load()` (without `safe_load`)
- `eval(user_input)`
- `exec(user_input)`

**è‡ªå‹•åŒ–æª¢æ¸¬**:
```bash
# ä½¿ç”¨ Bandit æƒæ
bandit -r . -f json | grep "pickle\|yaml.load\|eval\|exec"
```

---

### é™·é˜± #5: éåº¦æ¬Šé™ (Excessive Permissions)

#### ğŸš¨ å±éšªä¿¡è™Ÿ

```bash
# âŒ AI å¸¸è¦‹çš„ä¸å®‰å…¨å»ºè­°
chmod 777 config.json
sudo python app.py
docker run --privileged myapp
```

```python
# âŒ è³‡æ–™åº«é€£ç·šä½¿ç”¨ root å¸³è™Ÿ
DATABASE_URL = "postgresql://postgres:password@localhost/db"
```

**ç‚ºä»€éº¼ AI æœƒé€™æ¨£å»ºè­°ï¼Ÿ**
- ã€Œæ¬Šé™å•é¡Œã€å¯ä»¥å¿«é€Ÿè§£æ±º
- æ¸¬è©¦ç’°å¢ƒä¸‹çœ‹èµ·ä¾†ã€Œèƒ½å‹•ã€
- ä¸ç†è§£æœ€å°æ¬Šé™åŸå‰‡ (Principle of Least Privilege)

#### âœ… å®‰å…¨åšæ³•

```bash
# âœ… æœ€å°æ¬Šé™è¨­ç½®
chmod 600 config.json  # åªæœ‰æ“æœ‰è€…å¯è®€å¯«
python app.py  # ä¸ä½¿ç”¨ sudo
docker run --user 1000:1000 --cap-drop=ALL myapp
```

```python
# âœ… ä½¿ç”¨å°ˆç”¨å¸³è™Ÿï¼Œåªæˆäºˆå¿…è¦æ¬Šé™
# å‰µå»ºå°ˆç”¨è³‡æ–™åº«ç”¨æˆ¶
# CREATE USER app_user WITH PASSWORD 'xxx';
# GRANT SELECT, INSERT, UPDATE ON TABLE users TO app_user;

DATABASE_URL = "postgresql://app_user:password@localhost/db"
```

**æ¬Šé™æª¢æŸ¥æ¸…å–®**:
- [ ] æª”æ¡ˆæ¬Šé™ï¼šé…ç½®æª”æ¡ˆ `chmod 600`ï¼ŒåŸ·è¡Œæª”æ¡ˆ `chmod 755`
- [ ] ç”¨æˆ¶æ¬Šé™ï¼šæ°¸ä¸ä½¿ç”¨ `root` æˆ– `sudo` é‹è¡Œæ‡‰ç”¨
- [ ] è³‡æ–™åº«æ¬Šé™ï¼šä½¿ç”¨å°ˆç”¨å¸³è™Ÿï¼Œåªæˆäºˆå¿…è¦æ¬Šé™
- [ ] å®¹å™¨æ¬Šé™ï¼šé¿å… `--privileged`ï¼Œä½¿ç”¨ `--cap-drop=ALL`

#### ğŸ“ å¿«é€Ÿè­˜åˆ¥æ–¹æ³•

**å±éšªæ¨¡å¼**:
- `chmod 777`
- `sudo` é‹è¡Œæ‡‰ç”¨ç¨‹å¼
- è³‡æ–™åº«é€£ç·šä½¿ç”¨ `root`ã€`admin`ã€`postgres`
- Docker `--privileged` æ¨¡å¼

---

## å¿«é€Ÿè­˜åˆ¥æª¢æŸ¥è¡¨

æ¥å— AI ç”Ÿæˆçš„ä»£ç¢¼å‰ï¼Œé€é …æª¢æŸ¥ï¼š

```
[ ] 1. ç¡¬ç·¨ç¢¼æ†‘è­‰ï¼Ÿ
    æœå°‹: password = ", api_key = ", secret = "
    å·¥å…·: git secrets --scan

[ ] 2. SQL æ³¨å…¥é¢¨éšªï¼Ÿ
    æœå°‹: f"SELECT ... {", "SELECT ... " +
    å·¥å…·: semgrep --config "p/sql-injection" .

[ ] 3. è·¯å¾‘éæ­·é¢¨éšªï¼Ÿ
    æœå°‹: open(user_input), f"/path/{user_input}"
    å·¥å…·: semgrep --config "p/path-traversal" .

[ ] 4. ä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼Ÿ
    æœå°‹: pickle.loads, eval(, exec(
    å·¥å…·: bandit -r . -f json

[ ] 5. éåº¦æ¬Šé™ï¼Ÿ
    æœå°‹: chmod 777, sudo, root, --privileged
    æ‰‹å‹•: æª¢æŸ¥æª”æ¡ˆæ¬Šé™èˆ‡ç”¨æˆ¶è¨­å®š
```

---

## çœŸå¯¦æ¡ˆä¾‹å°ç…§

### æ¡ˆä¾‹ 1: ChatGPT Discord Bot Token æ´©æ¼

**èƒŒæ™¯**: é–‹ç™¼è€…ä½¿ç”¨ ChatGPT å­¸ç¿’ Discord API

**é™·é˜±**: ç¡¬ç·¨ç¢¼æ†‘è­‰
```python
# AI ç”Ÿæˆçš„ç¯„ä¾‹ä»£ç¢¼
TOKEN = "MTA1NzYwNzk5ODg4MjM2NTQ4MA.GxYz..."
client.run(TOKEN)
```

**å¾Œæœ**:
- 15 åˆ†é˜å…§è¢«æƒææ©Ÿå™¨äººç™¼ç¾
- æ©Ÿå™¨äººè¢«ç”¨æ–¼ç™¼é€åƒåœ¾è¨Šæ¯
- Discord å¸³è™Ÿè¢«å°ç¦

**æ•™è¨“**: æ°¸é ä½¿ç”¨ç’°å¢ƒè®Šæ•¸å­˜æ”¾ token

---

### æ¡ˆä¾‹ 2: AI ç”Ÿæˆçš„ SQL æŸ¥è©¢æ¼æ´

**èƒŒæ™¯**: ä½¿ç”¨ Copilot ç”Ÿæˆç”¨æˆ¶æœå°‹åŠŸèƒ½

**é™·é˜±**: SQL æ³¨å…¥
```python
# Copilot ç”Ÿæˆçš„ä»£ç¢¼
def search_users(keyword):
    return db.execute(f"SELECT * FROM users WHERE name LIKE '%{keyword}%'")
```

**å¾Œæœ**:
- å®‰å…¨ç ”ç©¶å“¡æäº¤ `keyword = "' OR '1'='1"`
- æ´©æ¼æ‰€æœ‰ç”¨æˆ¶è³‡æ–™
- éœ€è¦ç·Šæ€¥ä¿®è£œä¸¦é€šçŸ¥ç”¨æˆ¶

**æ•™è¨“**: æ°¸é ä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢

---

### æ¡ˆä¾‹ 3: æª”æ¡ˆä¸Šå‚³è·¯å¾‘éæ­·

**èƒŒæ™¯**: ä½¿ç”¨ AI ç”Ÿæˆæª”æ¡ˆä¸‹è¼‰åŠŸèƒ½

**é™·é˜±**: è·¯å¾‘éæ­·
```python
# AI ç”Ÿæˆçš„ä»£ç¢¼
@app.route('/file/<path>')
def download(path):
    return send_file(f"/uploads/{path}")
```

**å¾Œæœ**:
- æ”»æ“Šè€…è¨ªå• `/file/../../etc/passwd`
- è®€å–ç³»çµ±æ•æ„Ÿæª”æ¡ˆ
- è³‡å®‰åœ˜éšŠç™¼ç¾ä¸¦ç·Šæ€¥ä¸‹ç·š

**æ•™è¨“**: æ°¸é é©—è­‰ä¸¦é™åˆ¶æª”æ¡ˆè·¯å¾‘

---

## è¨˜æ†¶å£è¨£

**äº”å¤§é™·é˜±è¨˜æ†¶æ³•**:

> **ã€Œå¯† (æ†‘è­‰) ç¢¼ (SQL) è·¯ (è·¯å¾‘) åº (ååºåˆ—åŒ–) æ¬Š (æ¬Šé™)ã€**

1. **å¯†** - ç¡¬ç·¨ç¢¼æ†‘è­‰
2. **ç¢¼** - SQL æ³¨å…¥
3. **è·¯** - è·¯å¾‘éæ­·
4. **åº** - ä¸å®‰å…¨çš„ååºåˆ—åŒ–
5. **æ¬Š** - éåº¦æ¬Šé™

---

## å­¸ç¿’é©—è­‰

å®Œæˆæœ¬å­¸ç¿’å¡å¾Œï¼Œä½ æ‡‰è©²èƒ½å¤ ï¼š

- [ ] åœ¨ 30 ç§’å…§è­˜åˆ¥ç¡¬ç·¨ç¢¼æ†‘è­‰
- [ ] å€åˆ†åƒæ•¸åŒ–æŸ¥è©¢èˆ‡å­—ä¸²æ‹¼æ¥ SQL
- [ ] ç†è§£è·¯å¾‘éæ­·çš„æ”»æ“ŠåŸç†
- [ ] çŸ¥é“ç‚ºä»€éº¼ `pickle.loads()` å±éšª
- [ ] æ‡‰ç”¨æœ€å°æ¬Šé™åŸå‰‡è¨­ç½®æª”æ¡ˆæ¬Šé™

---

## ä¸‹ä¸€æ­¥

1. **å¯¦ä½œç·´ç¿’**: å®Œæˆã€Œæƒ…å¢ƒé¡Œåº«/åŸºç¤ç´š/B02_AIä»£ç¢¼å®‰å…¨å¯©æŸ¥.mdã€
2. **å·¥å…·è¨­ç½®**: é–±è®€ã€Œå·¥å…·æ•´åˆå¯¦æˆ°.mdã€ä¸¦è¨­ç½®è‡ªå‹•åŒ–æƒæ
3. **æ·±å…¥å­¸ç¿’**: é–±è®€ã€Œç†è«–/10.1_AIç”Ÿæˆä»£ç¢¼å®‰å…¨é¢¨éšª.mdã€äº†è§£æ›´å¤šç´°ç¯€

---

**è¨˜ä½**ï¼š

> **ã€ŒAI ç”Ÿæˆçš„ä»£ç¢¼åƒæ˜¯é™Œç”Ÿäººçµ¦çš„é£Ÿç‰© â€” çœ‹èµ·ä¾†ç¾å‘³ï¼Œä½†åœ¨åƒä¹‹å‰å¿…é ˆæª¢æŸ¥ã€**

å¾ä»Šå¤©é–‹å§‹ï¼Œè®“å®‰å…¨æª¢æŸ¥æˆç‚ºä½ æ¥å— AI ä»£ç¢¼çš„ç¬¬ä¸€åæ‡‰ã€‚
