# B01：程式碼品質檢查 - Agent 初體驗

## 🎯 學習目標

**知識目標**：
- [ ] 理解 Claude Code 的 Agent 系統概念
- [ ] 掌握 `code-reviewer` agent 的基本使用
- [ ] 了解程式碼品質評估的關鍵指標

**技能目標**：
- [ ] 能使用 agent 切換指令
- [ ] 能解讀程式碼審查報告
- [ ] 能根據建議改進程式碼

**時間估計**：20-25 分鐘

---

## 📋 情境描述

### 背景故事
你剛加入一個新專案團隊，負責維護一個 Python Web API。前任開發者留下了一些程式碼，但程式碼品質參差不齊。你的第一個任務是評估現有程式碼的品質，並提出改進建議。

### 問題陳述
你需要快速了解以下程式碼的品質問題：

```python
# user_service.py
def get_users(db, filter=None):
    users = db.query("SELECT * FROM users")
    result = []
    for user in users:
        if filter != None:
            if user.status == filter:
                result.append(user)
        else:
            result.append(user)
    return result

def create_user(db, name, email, password):
    # TODO: 需要驗證 email 格式
    user = User(name, email, password)
    db.insert(user)
    return user

class User:
    def __init__(self, name, email, password):
        self.name = name
        self.email = email
        self.password = password  # 密碼應該加密
```

### 任務要求
1. 使用 Claude Code 的 Agent 功能進行程式碼審查
2. 識別程式碼品質問題
3. 獲得具體的改進建議
4. 理解不同類型的問題（安全性、效能、可讀性等）

---

## 🛠️ 實作步驟

### 步驟 1：準備工作環境
```bash
# 1. 創建工作目錄
mkdir code_quality_check
cd code_quality_check

# 2. 創建測試檔案
# 將上述 Python 程式碼保存為 user_service.py
```

### 步驟 2：初始化 Claude Code
```bash
# 啟動 Claude Code 並添加檔案
claude --add-file user_service.py

# 初始化專案記憶（可選，但建議養成習慣）
```

**提示詞**：
```
請初始化這個程式碼審查專案的記憶。這是一個 Python Web API 專案，我需要評估和改進現有程式碼的品質。
```

### 步驟 3：切換到程式碼審查 Agent
```bash
# 關鍵指令：切換到專門的程式碼審查 agent
```

**提示詞**：
```
/agents:code-reviewer

現在請審查 user_service.py 這個檔案，我需要了解：

1. 程式碼品質問題（按嚴重程度分類）
2. 安全性風險
3. 效能問題
4. 可讀性和維護性問題
5. 最佳實踐建議

請給出詳細的分析報告。
```

### 步驟 4：分析審查結果

**預期 Claude 會指出的問題**：

**🔴 嚴重問題（Critical）**：
- 密碼以明文儲存（安全風險）
- SQL 查詢可能有注入風險
- 缺少 email 格式驗證

**🟡 中等問題（Medium）**：
- 效能問題：查詢所有用戶再過濾
- 命名不一致：filter 是 Python 內建函數
- 缺少錯誤處理

**🟢 輕微問題（Minor）**：
- 程式碼註解不足
- 缺少型別提示
- 可以使用更 Pythonic 的寫法

### 步驟 5：獲取改進建議
**提示詞**：
```
基於剛才的審查結果，請提供具體的程式碼改進版本。請優先解決嚴重和中等問題，並保持程式碼的功能不變。
```

---

## ✅ 成功檢查點

完成此情境後，你應該能夠：

**理解檢查點**：
- [ ] 我了解什麼是 Agent，以及為什麼要使用 `code-reviewer` agent
- [ ] 我能區分不同嚴重程度的程式碼問題
- [ ] 我明白為什麼要進行程式碼審查

**技能檢查點**：
- [ ] 我成功使用了 `/agents:code-reviewer` 指令
- [ ] 我獲得了結構化的程式碼審查報告
- [ ] 我理解了報告中的每個建議

**應用檢查點**：
- [ ] 我能解釋為什麼明文儲存密碼是安全風險
- [ ] 我能識別這段程式碼的主要效能問題
- [ ] 我知道下一步該如何改進程式碼

---

## 🎓 學習收穫

### 核心概念
1. **Agent 概念**：Claude Code 不只是一般的 AI，而是可以切換成不同專家的平台
2. **程式碼審查的價值**：系統性地發現問題，而不是憑感覺
3. **問題分級**：不是所有問題都同等重要，要分優先級

### 實用技巧
1. **使用流程**：`claude` → `/agents:code-reviewer` → 明確的審查要求
2. **提問技巧**：具體說明要審查的面向（安全、效能、可讀性）
3. **結果應用**：不只看建議，更要理解背後的原理

### 延伸思考
- 如果這是一個團隊專案，你會如何將這個審查過程標準化？
- 除了 `code-reviewer`，還有哪些 agent 可能對程式碼工作有幫助？
- 你會如何將審查結果整合到開發流程中？

---

## 🚀 進階挑戰

如果你完成得很順利，可以嘗試：

### 挑戰 1：比較不同 Agent
```bash
# 先用一般模式審查
claude
# 然後用 security-auditor
/agents:security-auditor
# 比較兩者的差異
```

### 挑戰 2：建立審查清單
**提示詞**：
```
根據剛才的審查經驗，請幫我建立一個「程式碼審查清單」，
包含：
1. 必檢項目（安全、功能）
2. 建議檢查項目（效能、可讀性）
3. 可選項目（風格、最佳實踐）

格式化為可列印的檢查清單。
```

### 挑戰 3：自動化思考
思考：如果要將這個審查過程自動化（例如在 Git commit 時執行），你會如何設計？

---

## 📚 相關資源

**後續學習**：
- B02：API 文檔自動生成 - 學習 `documentation-writer` agent
- C01：智能代碼審查系統 - 更複雜的審查工作流程

**參考資料**：
- [Python 程式碼品質工具比較](https://realpython.com/python-code-quality/)
- [安全編程最佳實踐](https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/)

---

## 💭 反思問題

完成後思考以下問題：

1. **效率對比**：使用 Agent 審查 vs 手動審查，時間差異是多少？
2. **發現問題**：AI 發現的問題中，哪些是你可能忽略的？
3. **學習效果**：通過這個過程，你對程式碼品質的理解有什麼變化？
4. **實際應用**：你會如何將這個方法應用到日常工作中？

---

**完成時間記錄**：___ 分鐘
**難度評分** (1-5)：___
**推薦指數** (1-5)：___
**筆記區域**：
```
在此記錄你的學習筆記、疑問或心得...
```

---

*本情境設計用於初次體驗 Claude Code 的 Agent 功能。重點是理解概念，而非追求完美的程式碼改進。*