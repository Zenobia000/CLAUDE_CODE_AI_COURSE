# 常用組合模式速查表

## 🧩 組合模式概述

組合模式是將多個 Agent、MCP 工具和輸出風格有機結合，形成高效工作流程的方法。本速查表提供經過實戰驗證的組合模式範本。

---

## 🚀 基礎組合模式

### 模式 1：APEV (分析-規劃-執行-驗證)

**適用場景**：任何重要的程式碼變更、新功能開發

**流程結構**：
```
Analyze → Plan → Execute → Verify
  ↓       ↓       ↓        ↓
 分析     規劃     執行     驗證
```

**實作範本**：
```bash
# 階段 1：分析 (Analyze)
/agents:code-reviewer
"分析現有程式碼結構和相關模組"

# 階段 2：規劃 (Plan)
/agents:off
"基於分析結果，設計 [功能] 的實作方案，包含：
1. 架構設計
2. 介面定義
3. 測試策略
4. 風險評估"

# 階段 3：執行 (Execute)
/agents:test-generator
"根據設計方案生成測試案例"

"實作功能，確保測試通過"

# 階段 4：驗證 (Verify)
/agents:code-reviewer
"審查實作的程式碼品質"

/agents:security-auditor
"檢查安全性問題"

/agents:performance-analyzer
"評估效能影響"
```

**預期時間**：1-3 小時
**成功率**：95%+

---

### 模式 2：EFD (探索-聚焦-深入)

**適用場景**：理解大型專案、學習新技術、研究複雜問題

**流程結構**：
```
Explore → Focus → Deep-dive
   ↓       ↓        ↓
  探索    聚焦     深入
```

**實作範本**：
```bash
# 階段 1：探索 (Explore)
claude --add-dir ./project

"請給我這個專案的全貌概覽：
1. 主要功能和目標
2. 技術架構和技術棧
3. 目錄結構和模組組織
4. 關鍵檔案和配置"

# 階段 2：聚焦 (Focus)
"我想深入了解 [特定模組/功能]，請：
1. 列出相關的檔案和依賴
2. 解釋核心邏輯和資料流
3. 識別關鍵的類別和函數"

# 階段 3：深入 (Deep-dive)
/agents:code-reviewer
"詳細分析 [核心檔案] 的實作細節，包含：
1. 設計模式和架構決策
2. 程式碼品質和最佳實踐
3. 潛在的改進空間
4. 與其他模組的互動"
```

**預期時間**：30 分鐘 - 2 小時
**適用頻率**：每當接觸新專案時

---

### 模式 3：TDD (測試驅動開發)

**適用場景**：新功能開發、重構、Bug 修復

**流程結構**：
```
Red → Green → Refactor
 ↓     ↓       ↓
紅燈   綠燈    重構
```

**實作範本**：
```bash
# 階段 1：紅燈 (Red) - 寫失敗的測試
/agents:test-generator
"為尚未實作的 [功能] 生成測試案例，
功能需求：[詳細描述]

請生成：
1. 正常情況測試
2. 邊界條件測試
3. 異常情況測試
4. 整合測試"

# 執行測試確認失敗
"執行測試套件，確認新測試失敗"

# 階段 2：綠燈 (Green) - 實作讓測試通過
"實作 [功能]，目標是讓所有測試通過
可以使用簡陋的實作，重點是功能正確"

# 執行測試確認通過
"執行測試套件，確認所有測試通過"

# 階段 3：重構 (Refactor) - 改善程式碼
/agents:refactoring-specialist
"在保持測試通過的前提下，重構程式碼：
1. 改善程式碼結構
2. 優化效能
3. 增強可讀性
4. 遵循最佳實踐"

/agents:code-reviewer
"審查重構後的程式碼品質"
```

**預期時間**：1-4 小時
**品質保證**：高

---

### 模式 4：LIG (本地-整合-全域)

**適用場景**：大規模程式碼變更、系統升級、架構調整

**流程結構**：
```
Local → Integration → Global
  ↓        ↓           ↓
本地      整合        全域
```

**實作範本**：
```bash
# 階段 1：本地變更 (Local)
/agents:code-reviewer
"分析需要修改的具體模組和檔案"

"執行本地變更，範圍限制在 [特定模組]"

/agents:test-generator
"為變更的模組生成/更新測試"

# 階段 2：整合測試 (Integration)
"執行模組層級的整合測試"

/agents:performance-analyzer
"檢查變更對相關模組的效能影響"

"修復整合層級發現的問題"

# 階段 3：全域驗證 (Global)
"執行完整的系統測試套件"

/agents:security-auditor
"進行系統層級的安全檢查"

"執行端到端測試和使用者驗收測試"

/memory
"記錄變更的影響範圍和經驗教訓"
```

**預期時間**：1-3 天
**風險控制**：最佳

---

### 模式 5：DRP (草稿-精煉-完成)

**適用場景**：文檔撰寫、文章創作、報告生成

**流程結構**：
```
Draft → Refine → Polish
  ↓       ↓       ↓
草稿    精煉     完成
```

**實作範本**：
```bash
# 階段 1：草稿 (Draft)
"快速生成 [文檔/文章] 的初稿，包含：
1. 基本結構和大綱
2. 主要章節的內容框架
3. 關鍵點和範例
重點是完整性，不追求完美"

# 階段 2：精煉 (Refine)
/agents:documentation-writer
/output-style:[適當格式]
"基於草稿，精煉內容：
1. 補充詳細資訊
2. 改善結構和邏輯
3. 添加實用範例
4. 確保準確性"

# 階段 3：完成 (Polish)
"最終打磨：
1. 檢查語法和拼寫
2. 優化可讀性
3. 確保格式一致
4. 添加索引和參考資料"

/output-style:[最終格式]
"生成最終版本"
```

**預期時間**：30 分鐘 - 2 小時
**品質等級**：專業級

---

## 🔧 進階組合模式

### 模式 6：狀態機組合 (State Machine)

**適用場景**：複雜的多狀態任務、自動化流程

**流程結構**：
```
狀態評估 → 條件判斷 → 狀態轉換 → 執行動作
    ↓         ↓         ↓         ↓
 Current   Condition  Transition  Action
```

**實作範本**：
```bash
# 智能 PR 處理流程
"分析 PR 的當前狀態和內容"

# 條件判斷
"根據分析結果決定處理路徑：

如果是新 PR：
  → 執行自動檢查流程
  → 分配審查者
  → 生成檢查清單

如果是更新 PR：
  → 檢查變更差異
  → 重新執行相關測試
  → 更新審查狀態

如果通過所有檢查：
  → 準備合併流程
  → 生成發布筆記
  → 通知相關人員

如果發現問題：
  → 生成問題報告
  → 標記需要修正
  → 提供修正建議"
```

---

### 模式 7：並行組合 (Parallel)

**適用場景**：獨立任務的同時處理、多維度分析

**流程結構**：
```
        ┌→ 任務 A → 結果 A
主任務 ─┼→ 任務 B → 結果 B
        └→ 任務 C → 結果 C
             ↓
          整合結果
```

**實作範本**：
```bash
# 專案全面評估
"請並行分析這個專案的多個面向：

[任務 1：程式碼品質]
/agents:code-reviewer
- 程式碼結構和組織
- 命名規範和風格
- 錯誤處理機制
- 測試覆蓋率

[任務 2：安全性評估]
/agents:security-auditor
- 潛在安全漏洞
- 認證和授權機制
- 資料保護措施
- 配置安全性

[任務 3：效能分析]
/agents:performance-analyzer
- 效能瓶頸識別
- 資源使用效率
- 可擴展性評估
- 優化建議

[任務 4：文檔完整性]
/agents:documentation-writer
- 文檔覆蓋率
- 文檔品質
- 使用者友好性
- 維護更新狀態

最後整合所有分析結果，生成綜合評估報告"
```

---

### 模式 8：管道組合 (Pipeline)

**適用場景**：資料處理、內容生產、自動化部署

**流程結構**：
```
輸入 → 處理1 → 處理2 → 處理3 → 輸出
  ↓      ↓       ↓       ↓       ↓
Data   Stage1  Stage2  Stage3  Result
```

**實作範本**：
```bash
# 內容發布管道
"執行完整的內容發布流程：

[Stage 1: 內容準備]
- 檢查原始內容品質
- 進行語法和拼寫檢查
- 優化 SEO 元素
- 生成目錄和索引

[Stage 2: 格式轉換]
/output-style:technical-blog
- 轉換為部落格格式
- 添加程式碼高亮
- 插入相關圖片和圖表
- 生成社群媒體摘要

[Stage 3: 多平台調整]
- 生成 Medium 版本
- 生成 Dev.to 版本
- 生成 LinkedIn 版本
- 生成 Twitter 宣傳文案

[Stage 4: 發布和追蹤]
- 排程發布時間
- 設置追蹤標籤
- 生成分析報告模板
- 建立後續行動計畫"
```

---

## 🎯 場景特化組合

### 場景 1：開源專案貢獻

**完整工作流程**：
```bash
# 1. 專案理解 (EFD 模式)
"使用 EFD 模式深入理解專案"

# 2. 貢獻規劃 (APEV 模式)
"使用 APEV 模式規劃貢獻內容"

# 3. 實作開發 (TDD 模式)
"使用 TDD 模式實作功能"

# 4. 提交準備 (DRP 模式)
"使用 DRP 模式準備 PR 文檔"

# 5. 知識記錄 (/memory)
"記錄貢獻經驗和學習心得"
```

---

### 場景 2：技術債務處理

**完整工作流程**：
```bash
# 1. 債務識別
/agents:code-reviewer
"全面分析技術債務情況"

# 2. 風險評估
/agents:security-auditor
"評估債務的安全風險"

/agents:performance-analyzer
"評估債務的效能影響"

# 3. 優先級排序
"基於風險和影響，排序處理優先級"

# 4. 逐步重構 (LIG 模式)
"使用 LIG 模式逐步處理債務"

# 5. 預防機制
"建立預防技術債務的機制"
```

---

### 場景 3：新團隊成員導引

**完整工作流程**：
```bash
# 1. 知識準備
"整理專案的核心知識和文檔"

# 2. 學習路徑設計 (EFD 模式)
"設計新人的學習路徑"

# 3. 實戰練習設計 (TDD 模式)
"設計練習任務"

# 4. 導引文檔 (DRP 模式)
/agents:documentation-writer
/output-style:tutorial
"生成完整的新人導引文檔"

# 5. 持續支援機制
"建立新人問題解答和進度追蹤機制"
```

---

## ⚡ 快速決策指南

### 選擇組合模式的決策樹

```
任務複雜度？
├─ 簡單 (1-2步驟)
│   └─ 使用單一 Agent
├─ 中等 (3-5步驟)
│   ├─ 有依賴關係 → APEV/TDD
│   └─ 無依賴關係 → 並行組合
└─ 複雜 (6+步驟)
    ├─ 探索性質 → EFD
    ├─ 創作性質 → DRP
    ├─ 變更性質 → LIG
    └─ 流程性質 → 管道組合
```

### 時間預算對應

| 時間預算 | 推薦模式 | 適用場景 |
|---------|---------|---------|
| 15-30分鐘 | 單一 Agent | 簡單任務 |
| 30-60分鐘 | EFD/DRP | 理解/創作 |
| 1-2小時 | APEV | 功能開發 |
| 2-4小時 | TDD/LIG | 重要變更 |
| 4+小時 | 多模式組合 | 複雜專案 |

---

## 🔧 組合模式優化技巧

### 1. 模式串聯
```bash
# 範例：大型功能開發
EFD (理解現狀) → APEV (設計方案) → TDD (實作) → LIG (整合)
```

### 2. 檢查點設置
```bash
# 在每個階段設置驗證點
"階段 1 完成，請檢查結果是否符合預期"
"是否繼續下一階段？"
```

### 3. 錯誤恢復
```bash
# 當某階段出現問題時
"暫停流程，分析問題原因"
"調整策略後重新執行"
```

### 4. 效果追蹤
```bash
# 記錄組合模式的使用效果
/memory
"記錄此次使用 APEV 模式的效果：
- 時間效率：節省 X 小時
- 品質提升：發現 X 個問題
- 經驗教訓：[具體心得]"
```

---

## 📊 模式效果統計

| 組合模式 | 平均節省時間 | 品質提升 | 學習曲線 | 推薦指數 |
|---------|------------|---------|---------|---------|
| APEV | 70% | 高 | 容易 | ⭐⭐⭐⭐⭐ |
| EFD | 80% | 中 | 容易 | ⭐⭐⭐⭐⭐ |
| TDD | 60% | 很高 | 中等 | ⭐⭐⭐⭐ |
| LIG | 75% | 高 | 困難 | ⭐⭐⭐⭐ |
| DRP | 85% | 高 | 容易 | ⭐⭐⭐⭐⭐ |
| 並行組合 | 65% | 中 | 中等 | ⭐⭐⭐ |
| 管道組合 | 90% | 高 | 困難 | ⭐⭐⭐⭐ |

---

## 🎓 組合模式進階

### 自訂組合模式
```bash
# 基於團隊需求設計專屬模式
"設計適合我們團隊的組合模式：
- 團隊規模：[人數]
- 主要技術棧：[技術]
- 開發流程：[流程描述]
- 品質要求：[要求等級]

請提供客製化的組合模式建議"
```

### 模式演進
```bash
# 隨著經驗累積，改進組合模式
"基於過去 3 個月的使用經驗，優化 APEV 模式：
- 識別瓶頸環節
- 調整步驟順序
- 增加自動化元素
- 提升整體效率"
```

---

**最後更新**：2025年1月
**版本**：v1.0
**維護者**：Claude Code 課程團隊

---

## 🔗 相關速查表

- [Agent使用速查](./Agent使用速查.md) - Agent 專家系統
- [MCP配置速查](./MCP配置速查.md) - 工具整合
- [輸出風格速查](./輸出風格速查.md) - 格式控制
- [問題排查速查](./問題排查速查.md) - 故障診斷